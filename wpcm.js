var w2ui=w2ui||{},w2obj=w2obj||{},w2utils=function(a){function d(a){var b=/^[0-1]+$/;return b.test(a)}function e(a){var b=/^[-+]?[0-9]+$/;return b.test(a)}function f(a){return"string"==typeof a&&(a=a.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),("number"==typeof a||"string"==typeof a&&""!==a)&&!isNaN(Number(a))}function g(a){var b=w2utils.settings,c=new RegExp("^"+(b.currencyPrefix?"\\"+b.currencyPrefix+"?":"")+"[-+]?"+(b.currencyPrefix?"\\"+b.currencyPrefix+"?":"")+"[0-9]*[\\"+b.decimalSymbol+"]?[0-9]+"+(b.currencySuffix?"\\"+b.currencySuffix+"?":"")+"$","i");return"string"==typeof a&&(a=a.replace(new RegExp(b.groupSymbol,"g"),"")),"object"!=typeof a&&""!==a&&c.test(a)}function h(a){var b=/^[a-fA-F0-9]+$/;return b.test(a)}function i(a){var b=/^[a-zA-Z0-9_-]+$/;return b.test(a)}function j(a){var b=/^[a-zA-Z0-9._%-+]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return b.test(a)}function k(a,b,c){if(!a)return!1;var f,g,h,d="Invalid Date";if(null==b&&(b=w2utils.settings.dateFormat),"function"==typeof a.getUTCFullYear)h=a.getUTCFullYear(),f=a.getUTCMonth()+1,g=a.getUTCDate();else if(parseInt(a)==a&&parseInt(a)>0)a=new Date(parseInt(a)),h=a.getUTCFullYear(),f=a.getUTCMonth()+1,g=a.getUTCDate();else{if(a=String(a),new RegExp("mon","ig").test(b)){b=b.replace(/month/gi,"m").replace(/mon/gi,"m").replace(/dd/gi,"d").replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase(),a=a.replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase();for(var i=0,j=w2utils.settings.fullmonths.length;i<j;i++){var k=w2utils.settings.fullmonths[i];a=a.replace(new RegExp(k,"ig"),parseInt(i)+1).replace(new RegExp(k.substr(0,3),"ig"),parseInt(i)+1)}}var l=a.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),m=b.replace(/-/g,"/").replace(/\./g,"/").toLowerCase();"mm/dd/yyyy"===m&&(f=l[0],g=l[1],h=l[2]),"m/d/yyyy"===m&&(f=l[0],g=l[1],h=l[2]),"dd/mm/yyyy"===m&&(f=l[1],g=l[0],h=l[2]),"d/m/yyyy"===m&&(f=l[1],g=l[0],h=l[2]),"yyyy/dd/mm"===m&&(f=l[2],g=l[1],h=l[0]),"yyyy/d/m"===m&&(f=l[2],g=l[1],h=l[0]),"yyyy/mm/dd"===m&&(f=l[1],g=l[2],h=l[0]),"yyyy/m/d"===m&&(f=l[1],g=l[2],h=l[0]),"mm/dd/yy"===m&&(f=l[0],g=l[1],h=l[2]),"m/d/yy"===m&&(f=l[0],g=l[1],h=parseInt(l[2])+1900),"dd/mm/yy"===m&&(f=l[1],g=l[0],h=parseInt(l[2])+1900),"d/m/yy"===m&&(f=l[1],g=l[0],h=parseInt(l[2])+1900),"yy/dd/mm"===m&&(f=l[2],g=l[1],h=parseInt(l[0])+1900),"yy/d/m"===m&&(f=l[2],g=l[1],h=parseInt(l[0])+1900),"yy/mm/dd"===m&&(f=l[1],g=l[2],h=parseInt(l[0])+1900),"yy/m/d"===m&&(f=l[1],g=l[2],h=parseInt(l[0])+1900)}return!!e(h)&&(!!e(f)&&(!!e(g)&&(h=+h,f=+f,g=+g,d=new Date(h,f-1,g),null!=f&&("Invalid Date"!=String(d)&&(d.getMonth()+1===f&&d.getDate()===g&&d.getFullYear()===h&&(c!==!0||d))))))}function l(b,c){if(null==b)return!1;var d,e,f;b=String(b),b=b.toUpperCase(),e=b.indexOf("AM")>=0,f=b.indexOf("PM")>=0;var g=f||e;d=g?12:24,b=b.replace("AM","").replace("PM",""),b=a.trim(b);var h=b.split(":"),i=parseInt(h[0]||0),j=parseInt(h[1]||0),k=parseInt(h[2]||0);return!!(g&&1===h.length||2===h.length||3===h.length)&&(!(""===h[0]||i<0||i>d||!this.isInt(h[0])||h[0].length>2)&&(!(h.length>1&&(""===h[1]||j<0||j>59||!this.isInt(h[1])||2!==h[1].length))&&(!(h.length>2&&(""===h[2]||k<0||k>59||!this.isInt(h[2])||2!==h[2].length))&&(!!(g||d!==i||0===j&&0===k)&&((!g||1!==h.length||0!==i)&&(c!==!0||(f&&12!==i&&(i+=12),e&&12===i&&(i+=12),{hours:i,minutes:j,seconds:k})))))))}function m(a,b,c){null==b&&(b=w2utils.settings.datetimeFormat);var d=b.split("|");if("function"==typeof a.getUTCFullYear)return c!==!0||a;if(parseInt(a)==a&&parseInt(a)>0)return a=new Date(parseInt(a)),c!==!0||a;var e=String(a).indexOf(" "),f=[a.substr(0,e),a.substr(e).trim()];d[0]=d[0].trim(),d[1]&&(d[1]=d[1].trim());var g=w2utils.isDate(f[0],d[0],!0),h=w2utils.isTime(f[1],!0);return g!==!1&&h!==!1&&(c!==!0||(g.setHours(h.hours),g.setMinutes(h.minutes),g.setSeconds(h.seconds),g))}function n(a){var b;if(""===a||null==a)return"";if(b="function"==typeof a.getUTCFullYear?a:parseInt(a)==a&&parseInt(a)>0?new Date(parseInt(a)):new Date(a),"Invalid Date"==String(b))return"";var c=new Date,d=(c.getTime()-b.getTime())/1e3,e="",f="";return d<0?(e=0,f="sec"):d<60?(e=Math.floor(d),f="sec",d<0&&(e=0,f="sec")):d<3600?(e=Math.floor(d/60),f="min"):d<86400?(e=Math.floor(d/60/60),f="hour"):d<2592e3?(e=Math.floor(d/24/60/60),f="day"):d<31536e3?(e=Math.floor(d/30/24/60/60*10)/10,f="month"):d<126144e3?(e=Math.floor(d/365/24/60/60*10)/10,f="year"):d>=126144e3&&(e=Math.floor(d/365.25/24/60/60*10)/10,f="year"),e+" "+f+(e>1?"s":"")}function o(a){var b="";return b=a<1e3?"< 1 sec":a<6e4?Math.floor(a/1e3)+" secs":a<36e5?Math.floor(a/6e4)+" mins":a<864e5?Math.floor(a/36e5*10)/10+" hours":a<2628e6?Math.floor(a/864e5*10)/10+" days":a<31536e6?Math.floor(a/2628e6*10)/10+" months":Math.floor(a/31536e5)/10+" years"}function p(a){if(""===a||null==a||"object"==typeof a&&!a.getMonth)return"";var b=new Date(a);if(w2utils.isInt(a)&&(b=new Date(Number(a))),"Invalid Date"==String(b))return"";var c=w2utils.settings.shortmonths,d=new Date,e=new Date;e.setTime(e.getTime()-864e5);var f=c[b.getMonth()]+" "+b.getDate()+", "+b.getFullYear(),g=c[d.getMonth()]+" "+d.getDate()+", "+d.getFullYear(),h=c[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear(),i=b.getHours()-(b.getHours()>12?12:0)+":"+(b.getMinutes()<10?"0":"")+b.getMinutes()+" "+(b.getHours()>=12?"pm":"am"),j=b.getHours()-(b.getHours()>12?12:0)+":"+(b.getMinutes()<10?"0":"")+b.getMinutes()+":"+(b.getSeconds()<10?"0":"")+b.getSeconds()+" "+(b.getHours()>=12?"pm":"am"),k=f;return f===g&&(k=i),f===h&&(k=w2utils.lang("Yesterday")),'<span title="'+f+" "+j+'">'+k+"</span>"}function q(a){if(!w2utils.isFloat(a)||""===a)return"";if(a=parseFloat(a),0===a)return 0;var b=["Bt","KB","MB","GB","TB","PB","EB","ZB"],c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return(Math.floor(a/Math.pow(1024,c)*10)/10).toFixed(0===c?0:1)+" "+(b[c]||"??")}function r(a,b,c){if(null==a||""===a||"object"==typeof a)return"";var d={minimumFractionDigits:b,maximumFractionDigits:b,useGrouping:c};return(null==b||b<0)&&(d.minimumFractionDigits=0,d.maximumFractionDigits=20),parseFloat(a).toLocaleString(w2utils.settings.locale,d)}function s(a,b){if(b||(b=this.settings.dateFormat),""===a||null==a||"object"==typeof a&&!a.getMonth)return"";var c=new Date(a);if(w2utils.isInt(a)&&(c=new Date(Number(a))),"Invalid Date"==String(c))return"";var d=c.getFullYear(),e=c.getMonth(),f=c.getDate();return b.toLowerCase().replace("month",w2utils.settings.fullmonths[e]).replace("mon",w2utils.settings.shortmonths[e]).replace(/yyyy/g,d).replace(/yyy/g,d).replace(/yy/g,d>2e3?100+parseInt(String(d).substr(2)):String(d).substr(2)).replace(/(^|[^a-z$])y/g,"$1"+d).replace(/mm/g,(e+1<10?"0":"")+(e+1)).replace(/dd/g,(f<10?"0":"")+f).replace(/th/g,1==f?"st":"th").replace(/th/g,2==f?"nd":"th").replace(/th/g,3==f?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(e+1)).replace(/(^|[^a-z$])d/g,"$1"+f)}function t(a,b){w2utils.settings.shortmonths,w2utils.settings.fullmonths;if(b||(b=this.settings.timeFormat),""===a||null==a||"object"==typeof a&&!a.getMonth)return"";var e=new Date(a);if(w2utils.isInt(a)&&(e=new Date(Number(a))),w2utils.isTime(a)){var f=w2utils.isTime(a,!0);e=new Date,e.setHours(f.hours),e.setMinutes(f.minutes)}if("Invalid Date"==String(e))return"";var g="am",h=e.getHours(),i=e.getHours(),j=e.getMinutes(),k=e.getSeconds();return j<10&&(j="0"+j),k<10&&(k="0"+k),b.indexOf("am")===-1&&b.indexOf("pm")===-1||(h>=12&&(g="pm"),h>12&&(h-=12)),b.toLowerCase().replace("am",g).replace("pm",g).replace("hhh",h<10?"0"+h:h).replace("hh24",i<10?"0"+i:i).replace("h24",i).replace("hh",h).replace("mm",j).replace("mi",j).replace("ss",k).replace(/(^|[^a-z$])h/g,"$1"+h).replace(/(^|[^a-z$])m/g,"$1"+j).replace(/(^|[^a-z$])s/g,"$1"+k)}function u(a,b){var c;return""===a||null==a||"object"==typeof a&&!a.getMonth?"":("string"!=typeof b?c=[this.settings.dateFormat,this.settings.timeFormat]:(c=b.split("|"),c[0]=c[0].trim(),c[1]=c.length>1?c[1].trim():this.settings.timeFormat),"h12"==c[1]&&(c[1]="h:m pm"),"h24"==c[1]&&(c[1]="h24:m"),this.formatDate(a,c[0])+" "+this.formatTime(a,c[1]))}function v(b){if(null==b)return b;switch(typeof b){case"number":break;case"string":b=String(b).replace(/(<([^>]+)>)/gi,"");break;case"object":if(Array.isArray(b)){b=a.extend(!0,[],b);for(var c=0;c<b.length;c++)b[c]=this.stripTags(b[c])}else{b=a.extend(!0,{},b);for(var c in b)b[c]=this.stripTags(b[c])}}return b}function w(b){if(null==b)return b;switch(typeof b){case"number":break;case"string":b=String(b).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case"object":if(Array.isArray(b)){b=a.extend(!0,[],b);for(var c=0;c<b.length;c++)b[c]=this.encodeTags(b[c])}else{b=a.extend(!0,{},b);for(var c in b)b[c]=this.encodeTags(b[c])}}return b}function x(b){if(null==b)return b;switch(typeof b){case"number":break;case"string":b=String(b).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&");break;case"object":if(Array.isArray(b)){b=a.extend(!0,[],b);for(var c=0;c<b.length;c++)b[c]=this.decodeTags(b[c])}else{b=a.extend(!0,{},b);for(var c in b)b[c]=this.decodeTags(b[c])}}return b}function y(a){return""===a||null==a?"":String(a).replace(/([;&,\.\+\*\~'`:"\!\^#$%@\[\]\(\)=<>\|\/? {}\\])/g,"\\$1")}function z(a){function l(a){a=String(a).replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var c,d,e,f,g,h,i,b="",j=0,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(a=l(a);j<a.length;)c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=a.charCodeAt(j++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),b=b+k.charAt(f)+k.charAt(g)+k.charAt(h)+k.charAt(i);return b}function A(a){function l(a){for(var e,f,b="",c=0,d=0;c<a.length;)d=a.charCodeAt(c),d<128?(b+=String.fromCharCode(d),c++):d>191&&d<224?(e=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&e),c+=2):(e=a.charCodeAt(c+1),f=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&e)<<6|63&f),c+=3);return b}var c,d,e,f,g,h,i,b="",j=0,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)f=k.indexOf(a.charAt(j++)),g=k.indexOf(a.charAt(j++)),h=k.indexOf(a.charAt(j++)),i=k.indexOf(a.charAt(j++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,b+=String.fromCharCode(c),64!==h&&(b+=String.fromCharCode(d)),64!==i&&(b+=String.fromCharCode(e));return b=l(b)}function B(a){function d(a){return l(j(o(a)))}function j(a){return s(t(r(a),8*a.length))}function l(a){try{}catch(a){b=0}for(var e,c=b?"0123456789ABCDEF":"0123456789abcdef",d="",f=0;f<a.length;f++)e=a.charCodeAt(f),d+=c.charAt(e>>>4&15)+c.charAt(15&e);return d}function o(a){for(var d,e,b="",c=-1;++c<a.length;)d=a.charCodeAt(c),e=c+1<a.length?a.charCodeAt(c+1):0,55296<=d&&d<=56319&&56320<=e&&e<=57343&&(d=65536+((1023&d)<<10)+(1023&e),c++),d<=127?b+=String.fromCharCode(d):d<=2047?b+=String.fromCharCode(192|d>>>6&31,128|63&d):d<=65535?b+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|63&d):d<=2097151&&(b+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|63&d));return b}function r(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(var c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32;return b}function s(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b}function t(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;for(var c=1732584193,d=-271733879,e=-1732584194,f=271733878,g=0;g<a.length;g+=16){var h=c,i=d,j=e,k=f;c=v(c,d,e,f,a[g+0],7,-680876936),f=v(f,c,d,e,a[g+1],12,-389564586),e=v(e,f,c,d,a[g+2],17,606105819),d=v(d,e,f,c,a[g+3],22,-1044525330),c=v(c,d,e,f,a[g+4],7,-176418897),f=v(f,c,d,e,a[g+5],12,1200080426),e=v(e,f,c,d,a[g+6],17,-1473231341),d=v(d,e,f,c,a[g+7],22,-45705983),c=v(c,d,e,f,a[g+8],7,1770035416),f=v(f,c,d,e,a[g+9],12,-1958414417),e=v(e,f,c,d,a[g+10],17,-42063),d=v(d,e,f,c,a[g+11],22,-1990404162),c=v(c,d,e,f,a[g+12],7,1804603682),f=v(f,c,d,e,a[g+13],12,-40341101),e=v(e,f,c,d,a[g+14],17,-1502002290),d=v(d,e,f,c,a[g+15],22,1236535329),c=w(c,d,e,f,a[g+1],5,-165796510),f=w(f,c,d,e,a[g+6],9,-1069501632),e=w(e,f,c,d,a[g+11],14,643717713),d=w(d,e,f,c,a[g+0],20,-373897302),c=w(c,d,e,f,a[g+5],5,-701558691),f=w(f,c,d,e,a[g+10],9,38016083),e=w(e,f,c,d,a[g+15],14,-660478335),d=w(d,e,f,c,a[g+4],20,-405537848),c=w(c,d,e,f,a[g+9],5,568446438),f=w(f,c,d,e,a[g+14],9,-1019803690),e=w(e,f,c,d,a[g+3],14,-187363961),d=w(d,e,f,c,a[g+8],20,1163531501),c=w(c,d,e,f,a[g+13],5,-1444681467),f=w(f,c,d,e,a[g+2],9,-51403784),e=w(e,f,c,d,a[g+7],14,1735328473),d=w(d,e,f,c,a[g+12],20,-1926607734),c=x(c,d,e,f,a[g+5],4,-378558),f=x(f,c,d,e,a[g+8],11,-2022574463),e=x(e,f,c,d,a[g+11],16,1839030562),d=x(d,e,f,c,a[g+14],23,-35309556),c=x(c,d,e,f,a[g+1],4,-1530992060),f=x(f,c,d,e,a[g+4],11,1272893353),e=x(e,f,c,d,a[g+7],16,-155497632),d=x(d,e,f,c,a[g+10],23,-1094730640),c=x(c,d,e,f,a[g+13],4,681279174),f=x(f,c,d,e,a[g+0],11,-358537222),e=x(e,f,c,d,a[g+3],16,-722521979),d=x(d,e,f,c,a[g+6],23,76029189),c=x(c,d,e,f,a[g+9],4,-640364487),f=x(f,c,d,e,a[g+12],11,-421815835),e=x(e,f,c,d,a[g+15],16,530742520),d=x(d,e,f,c,a[g+2],23,-995338651),c=y(c,d,e,f,a[g+0],6,-198630844),f=y(f,c,d,e,a[g+7],10,1126891415),e=y(e,f,c,d,a[g+14],15,-1416354905),d=y(d,e,f,c,a[g+5],21,-57434055),c=y(c,d,e,f,a[g+12],6,1700485571),f=y(f,c,d,e,a[g+3],10,-1894986606),e=y(e,f,c,d,a[g+10],15,-1051523),d=y(d,e,f,c,a[g+1],21,-2054922799),c=y(c,d,e,f,a[g+8],6,1873313359),f=y(f,c,d,e,a[g+15],10,-30611744),e=y(e,f,c,d,a[g+6],15,-1560198380),d=y(d,e,f,c,a[g+13],21,1309151649),c=y(c,d,e,f,a[g+4],6,-145523070),f=y(f,c,d,e,a[g+11],10,-1120210379),e=y(e,f,c,d,a[g+2],15,718787259),d=y(d,e,f,c,a[g+9],21,-343485551),c=z(c,h),d=z(d,i),e=z(e,j),f=z(f,k)}return Array(c,d,e,f)}function u(a,b,c,d,e,f){return z(A(z(z(b,a),z(d,f)),e),c)}function v(a,b,c,d,e,f,g){return u(b&c|~b&d,a,b,e,f,g)}function w(a,b,c,d,e,f,g){return u(b&d|c&~d,a,b,e,f,g)}function x(a,b,c,d,e,f,g){return u(b^c^d,a,b,e,f,g)}function y(a,b,c,d,e,f,g){return u(c^(b|~d),a,b,e,f,g)}function z(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function A(a,b){return a<<b|a>>>32-b}var b=0;return d(a)}function C(b,c,d,e){var f=a(b).width(),g=a(b).height(),h=.5;if(!b||!c)return void console.log("ERROR: Cannot do transition when one of the divs is null");switch(b.parentNode.style.cssText+="perspective: 900px; overflow: hidden;",b.style.cssText+="; position: absolute; z-index: 1019; backface-visibility: hidden",c.style.cssText+="; position: absolute; z-index: 1020; backface-visibility: hidden",d){case"slide-left":b.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",c.style.cssText+="overflow: hidden; transform: translate3d("+f+"px, 0, 0)",a(c).show(),window.setTimeout(function(){c.style.cssText+="transition: "+h+"s; transform: translate3d(0, 0, 0)",b.style.cssText+="transition: "+h+"s; transform: translate3d(-"+f+"px, 0, 0)"},1);break;case"slide-right":b.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",c.style.cssText+="overflow: hidden; transform: translate3d(-"+f+"px, 0, 0)",a(c).show(),window.setTimeout(function(){c.style.cssText+="transition: "+h+"s; transform: translate3d(0px, 0, 0)",b.style.cssText+="transition: "+h+"s; transform: translate3d("+f+"px, 0, 0)"},1);break;case"slide-down":b.style.cssText+="overflow: hidden; z-index: 1; transform: translate3d(0, 0, 0)",c.style.cssText+="overflow: hidden; z-index: 0; transform: translate3d(0, 0, 0)",a(c).show(),window.setTimeout(function(){c.style.cssText+="transition: "+h+"s; transform: translate3d(0, 0, 0)",b.style.cssText+="transition: "+h+"s; transform: translate3d(0, "+g+"px, 0)"},1);break;case"slide-up":b.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",c.style.cssText+="overflow: hidden; transform: translate3d(0, "+g+"px, 0)",a(c).show(),window.setTimeout(function(){c.style.cssText+="transition: "+h+"s; transform: translate3d(0, 0, 0)",b.style.cssText+="transition: "+h+"s; transform: translate3d(0, 0, 0)"},1);break;case"flip-left":b.style.cssText+="overflow: hidden; transform: rotateY(0deg)",c.style.cssText+="overflow: hidden; transform: rotateY(-180deg)",a(c).show(),window.setTimeout(function(){c.style.cssText+="transition: "+h+"s; transform: rotateY(0deg)",b.style.cssText+="transition: "+h+"s; transform: rotateY(180deg)"},1);break;case"flip-right":b.style.cssText+="overflow: hidden; transform: rotateY(0deg)",c.style.cssText+="overflow: hidden; transform: rotateY(180deg)",a(c).show(),window.setTimeout(function(){c.style.cssText+="transition: "+h+"s; transform: rotateY(0deg)",b.style.cssText+="transition: "+h+"s; transform: rotateY(-180deg)"},1);break;case"flip-down":b.style.cssText+="overflow: hidden; transform: rotateX(0deg)",c.style.cssText+="overflow: hidden; transform: rotateX(180deg)",a(c).show(),window.setTimeout(function(){c.style.cssText+="transition: "+h+"s; transform: rotateX(0deg)",b.style.cssText+="transition: "+h+"s; transform: rotateX(-180deg)"},1);break;case"flip-up":b.style.cssText+="overflow: hidden; transform: rotateX(0deg)",c.style.cssText+="overflow: hidden; transform: rotateX(-180deg)",a(c).show(),window.setTimeout(function(){c.style.cssText+="transition: "+h+"s; transform: rotateX(0deg)",b.style.cssText+="transition: "+h+"s; transform: rotateX(180deg)"},1);break;case"pop-in":b.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",c.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(.8); opacity: 0;",a(c).show(),window.setTimeout(function(){c.style.cssText+="transition: "+h+"s; transform: scale(1); opacity: 1;",b.style.cssText+="transition: "+h+"s;"},1);break;case"pop-out":b.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(1); opacity: 1;",c.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); opacity: 0;",a(c).show(),window.setTimeout(function(){c.style.cssText+="transition: "+h+"s; opacity: 1;",b.style.cssText+="transition: "+h+"s; transform: scale(1.7); opacity: 0;"},1);break;default:b.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",c.style.cssText+="overflow: hidden; translate3d(0, 0, 0); opacity: 0;",a(c).show(),window.setTimeout(function(){c.style.cssText+="transition: "+h+"s; opacity: 1;",b.style.cssText+="transition: "+h+"s"},1)}setTimeout(function(){"slide-down"===d&&(a(b).css("z-index","1019"),a(c).css("z-index","1020")),c&&a(c).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),b&&a(b).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),"function"==typeof e&&e()},1e3*h)}function D(b,c,d){var e={};"object"==typeof c?e=c:(e.msg=c,e.spinner=d),e.msg||0===e.msg||(e.msg=""),w2utils.unlock(b),a(b).prepend('<div class="w2ui-lock"></div><div class="w2ui-lock-msg"></div>');var f=a(b).find(".w2ui-lock"),g=a(b).find(".w2ui-lock-msg");e.msg||g.css({"background-color":"transparent",border:"0px"}),e.spinner===!0&&(e.msg='<div class="w2ui-spinner" '+(e.msg?"":'style="width: 35px; height: 35px"')+"></div>"+e.msg),null!=e.opacity&&f.css("opacity",e.opacity),"function"==typeof f.fadeIn?(f.fadeIn(200),g.html(e.msg).fadeIn(200)):(f.show(),g.html(e.msg).show(0))}function E(b,c){e(c)?(a(b).find(".w2ui-lock").fadeOut(c),setTimeout(function(){a(b).find(".w2ui-lock").remove(),a(b).find(".w2ui-lock-msg").remove()},c)):(a(b).find(".w2ui-lock").remove(),a(b).find(".w2ui-lock-msg").remove())}function F(b,c){function p(c,e){if(null==f&&(f=e.trigger({phase:"before",type:"open",target:"self"}),f.isCancelled===!0))return k.css("z-index",k.data("old-z-index")),void a(b.box).find("#w2ui-message"+m).remove();var g=c.data("prev_focus");c.remove(),g&&g.length>0?g.focus():d&&d.focus&&d.focus(),k.css("z-index",k.data("old-z-index")),e.trigger(a.extend(f,{phase:"after"}))}var e,f,d=this;a().w2tag(),c||(c={width:200,height:100}),null==c.on&&a.extend(c,w2utils.event),null==c.width&&(c.width=200),null==c.height&&(c.height=100);var g=parseInt(a(b.box).width()),h=parseInt(a(b.box).height()),i=parseInt(a(b.box).find(b.title).css("height")||0);c.width>g&&(c.width=g-10),c.height>h-i&&(c.height=h-10-i),c.originalWidth=c.width,c.originalHeight=c.height,parseInt(c.width)<0&&(c.width=g+c.width),parseInt(c.width)<10&&(c.width=10),parseInt(c.height)<0&&(c.height=h+c.height-i),parseInt(c.height)<10&&(c.height=10),null==c.hideOnClick&&(c.hideOnClick=!1);var j=a(b.box).data("options")||{};(null==c.width||c.width>j.width-10)&&(c.width=j.width-10),(null==c.height||c.height>j.height-i-5)&&(c.height=j.height-i-5),c.originalHeight<0&&(c.height=h+c.originalHeight-i),c.originalWidth<0&&(c.width=g+2*c.originalWidth);var k=a(b.box).find(b.title),l=a(b.box).find(".w2ui-message.w2ui-closing");a(b.box).find(".w2ui-message.w2ui-closing").length>0&&(clearTimeout(e),p(l,l.data("options")||{}));var m=a(b.box).find(".w2ui-message").length;if(""===a.trim(c.html)&&""===a.trim(c.body)&&""===a.trim(c.buttons)){if(0===m)return;var n=a(b.box).find("#w2ui-message"+(m-1)),c=n.data("options")||{};if(f=c.trigger({phase:"before",type:"close",target:"self"}),f.isCancelled===!0)return;n.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+c.height+"px)"})).addClass("w2ui-closing"),1==m?this.unlock&&(b.param?this.unlock(b.param,150):this.unlock(150)):a(b.box).find("#w2ui-message"+(m-2)).css("z-index",1500),e=setTimeout(function(){p(n,c)},150)}else{""===a.trim(c.body)&&""===a.trim(c.buttons)||(c.html='<div class="w2ui-message-body">'+(c.body||"")+'</div><div class="w2ui-message-buttons">'+(c.buttons||"")+"</div>"),a(b.box).find(".w2ui-message").css("z-index",1390),k.data("old-z-index",k.css("z-index")),k.css("z-index",1501),a(b.box).find(b.body).before('<div id="w2ui-message'+m+'" onmousedown="event.stopPropagation();"    class="w2ui-message" style="display: none; z-index: 1500; '+(0===k.length?"top: 0px;":"top: "+w2utils.getSize(k,"height")+"px;")+(null!=c.width?"width: "+c.width+"px; left: "+(g-c.width)/2+"px;":"left: 10px; right: 10px;")+(null!=c.height?"height: "+c.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(c.hideOnClick===!0?b.param?'onclick="'+b.path+".message('"+b.param+"');\"":'onclick="'+b.path+'.message();"':"")+"></div>"),a(b.box).find("#w2ui-message"+m).data("options",c).data("prev_focus",a(":focus"));var o=a(b.box).find("#w2ui-message"+m).css("display");if(a(b.box).find("#w2ui-message"+m).css(w2utils.cssPrefix({transform:"none"==o?"translateY(-"+c.height+"px)":"translateY(0px)"})),"none"==o){if(a(b.box).find("#w2ui-message"+m).show().html(c.html),c.box=a(b.box).find("#w2ui-message"+m),f=c.trigger({phase:"before",type:"open",target:"self"}),f.isCancelled===!0)return k.css("z-index",k.data("old-z-index")),void a(b.box).find("#w2ui-message"+m).remove();setTimeout(function(){a(b.box).find("#w2ui-message"+m).css(w2utils.cssPrefix({transform:"none"==o?"translateY(0px)":"translateY(-"+c.height+"px)"}))},1),0===m&&this.lock&&(b.param?this.lock(b.param):this.lock()),setTimeout(function(){a(b.box).find("#w2ui-message"+m).css(w2utils.cssPrefix({transition:"0s"})),c.trigger(a.extend(f,{phase:"after"}))},350)}}}function G(b,c){var d=a(b),e={left:parseInt(d.css("border-left-width"))||0,right:parseInt(d.css("border-right-width"))||0,top:parseInt(d.css("border-top-width"))||0,bottom:parseInt(d.css("border-bottom-width"))||0},f={left:parseInt(d.css("margin-left"))||0,right:parseInt(d.css("margin-right"))||0,top:parseInt(d.css("margin-top"))||0,bottom:parseInt(d.css("margin-bottom"))||0},g={left:parseInt(d.css("padding-left"))||0,right:parseInt(d.css("padding-right"))||0,top:parseInt(d.css("padding-top"))||0,bottom:parseInt(d.css("padding-bottom"))||0};switch(c){case"top":return e.top+f.top+g.top;case"bottom":return e.bottom+f.bottom+g.bottom;case"left":return e.left+f.left+g.left;case"right":return e.right+f.right+g.right;case"width":return e.left+e.right+f.left+f.right+g.left+g.right+parseInt(d.width());case"height":return e.top+e.bottom+f.top+f.bottom+g.top+g.bottom+parseInt(d.height());case"+width":return e.left+e.right+f.left+f.right+g.left+g.right;case"+height":return e.top+e.bottom+f.top+f.bottom+g.top+g.bottom}return 0}function H(b,c){var d,e='<div id="_tmp_width" style="position: absolute; top: -900px;'+(c||"")+'">'+w(b)+"</div>";return a("body").append(e),d=a("#_tmp_width").width(),a("#_tmp_width").remove(),d}function I(a){var b=this.settings.phrases[a];return null==b?a:b}function J(b){return b||(b="en-us"),"string"!=typeof b?void(w2utils.settings=a.extend(!0,w2utils.settings,b)):(5===b.length&&(b="locale/"+b+".json"),w2utils.settings.phrases={},void a.ajax({url:b,type:"GET",dataType:"JSON",async:!1,success:function(b,c,d){w2utils.settings=a.extend(!0,w2utils.settings,b)},error:function(a,c,d){console.log("ERROR: Cannot load locale "+b)}}))}function K(){if(b.scrollBarSize)return b.scrollBarSize;var c='<div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">    <div style="height: 120px">1</div></div>';return a("body").append(c),b.scrollBarSize=100-a("#_scrollbar_width > div").width(),a("#_scrollbar_width").remove(),String(navigator.userAgent).indexOf("MSIE")>=0&&(b.scrollBarSize=b.scrollBarSize/2),b.scrollBarSize}function L(a,b){return a&&null!=a.name?null!=w2ui[a.name]?(console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+a.name+")."),!1):!!w2utils.isAlphaNumeric(a.name)||(console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). '),!1):(console.log('ERROR: The parameter "name" is required but not supplied in $().'+b+"()."),!1)}function M(b,c,d,e){a.isArray(c)||(c=[c]);for(var f=0;f<c.length;f++)if(c[f].id===b)return console.log('ERROR: The parameter "id='+b+'" is not unique within the current '+d+". (obj: "+e+")"),!1;return!0}function N(a){var b=[],c=a.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,f,g){return b.push({name:e,optional:!!g}),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return{path:new RegExp("^"+c+"$","i"),keys:b}}function O(b,c,d){var e={},f={},g="";a.isPlainObject(b)?(e=b,c===!0&&(d=!0)):e[b]=c;for(var h in e)f[h]=e[h],f["-webkit-"+h]=e[h],f["-moz-"+h]=e[h].replace("-webkit-","-moz-"),f["-ms-"+h]=e[h].replace("-webkit-","-ms-"),f["-o-"+h]=e[h].replace("-webkit-","-o-");if(d===!0)for(var h in f)g+=h+": "+f[h]+"; ";else g=f;return g}function P(a){if(null==a)return null;var e,b=0,c=a.ownerDocument||a.document,d=c.defaultView||c.parentWindow;if(a.tagName&&"INPUT"==a.tagName.toUpperCase()&&a.selectionStart)b=a.selectionStart;else if(d.getSelection){if(e=d.getSelection(),e.rangeCount>0){var f=e.getRangeAt(0),g=f.cloneRange();g.selectNodeContents(a),g.setEnd(f.endContainer,f.endOffset),b=g.toString().length}}else if((e=c.selection)&&"Control"!=e.type){var h=e.createRange(),i=c.body.createTextRange();i.moveToElementText(a),i.setEndPoint("EndToEnd",h),b=i.text.length}return b}function Q(b,c,d){var f,e=document.createRange(),g=window.getSelection();if(null!=b){for(var h=0;h<b.childNodes.length;h++){var i=a(b.childNodes[h]).text();if(b.childNodes[h].tagName&&(i=a(b.childNodes[h]).html(),i=i.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&nbsp;/g," ")),c<=i.length){f=b.childNodes[h],f.childNodes&&f.childNodes.length>0&&(f=f.childNodes[0]),f.childNodes&&f.childNodes.length>0&&(f=f.childNodes[0]);break}c-=i.length}null!=f&&(c>f.length&&(c=f.length),e.setStart(f,c),d?e.setEnd(f,d):e.collapse(!0),g.removeAllRanges(),g.addRange(e))}}function R(){var a="w2ui_test";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(a){return!1}}function S(a){if("string"!=typeof a)return null;a=a.trim().toUpperCase(),"#"==a[0]&&(a=a.substr(1));var b={};if(3==a.length)b={r:parseInt(a[0]+a[0],16),g:parseInt(a[1]+a[1],16),b:parseInt(a[2]+a[2],16),a:1};else if(6==a.length)b={r:parseInt(a.substr(0,2),16),g:parseInt(a.substr(2,2),16),b:parseInt(a.substr(4,2),16),a:1};else if(a.length>4&&"RGB("==a.substr(0,4)){var c=a.replace("RGB","").replace(/\(/g,"").replace(/\)/g,"").split(",");b={r:parseInt(c[0],10),g:parseInt(c[1],10),b:parseInt(c[2],10),a:1}}else{if(!(a.length>5&&"RGBA("==a.substr(0,5)))return null;var c=a.replace("RGBA","").replace(/\(/g,"").replace(/\)/g,"").split(",");b={r:parseInt(c[0],10),g:parseInt(c[1],10),b:parseInt(c[2],10),a:parseFloat(c[3])}}return b}function T(a,b,c,d){var e,f,g,h,i,j,k,l;switch(1===arguments.length&&(b=a.s,c=a.v,d=a.a,a=a.h),a/=360,b/=100,c/=100,h=Math.floor(6*a),i=6*a-h,j=c*(1-b),k=c*(1-i*b),l=c*(1-(1-i)*b),h%6){case 0:e=c,f=l,g=j;break;case 1:e=k,f=c,g=j;break;case 2:e=j,f=c,g=l;break;case 3:e=j,f=k,g=c;break;case 4:e=l,f=j,g=c;break;case 5:e=c,f=j,g=k}return{r:Math.round(255*e),g:Math.round(255*f),b:Math.round(255*g),a:null!=d?d:1}}function U(a,b,c,d){1===arguments.length&&(b=a.g,c=a.b,d=a.a,a=a.r);var h,e=Math.max(a,b,c),f=Math.min(a,b,c),g=e-f,i=0===e?0:g/e,j=e/255;switch(e){case f:h=0;break;case a:h=b-c+g*(b<c?6:0),h/=6*g;break;case b:h=c-a+2*g,h/=6*g;break;case c:h=a-b+4*g,h/=6*g}return{h:Math.round(360*h),s:Math.round(100*i),v:Math.round(100*j),a:null!=d?d:1}}var b={},c={version:"1.5.x",settings:{locale:"en-us",dateFormat:"yyyy-mm-dd",timeFormat:"hh24:mm:ss",datetimeFormat:"yyyy-mm-dd|hh24:mm:ss",currencyPrefix:"$",currencySuffix:"",currencyPrecision:2,groupSymbol:",",decimalSymbol:".",shortmonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullmonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortdays:["M","T","W","T","F","S","S"],fulldays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekStarts:"M",dataType:"HTTP",phrases:{},dateStartYear:1950,dateEndYear:2020},isBin:d,isInt:e,isFloat:f,isMoney:g,isHex:h,isAlphaNumeric:i,isEmail:j,isDate:k,isTime:l,isDateTime:m,age:n,interval:o,date:p,formatSize:q,formatNumber:r,formatDate:s,formatTime:t,formatDateTime:u,stripTags:v,encodeTags:w,decodeTags:x,escapeId:y,base64encode:z,base64decode:A,md5:B,transition:C,lock:D,unlock:E,message:F,lang:I,locale:J,getSize:G,getStrWidth:H,scrollBarSize:K,checkName:L,checkUniqueId:M,parseRoute:N,cssPrefix:O,parseColor:S,hsv2rgb:T,rgb2hsv:U,getCursorPosition:P,setCursorPosition:Q,testLocalStorage:R,hasLocalStorage:R(),isIOS:navigator.userAgent.toLowerCase().indexOf("iphone")!=-1||navigator.userAgent.toLowerCase().indexOf("ipod")!=-1||navigator.userAgent.toLowerCase().indexOf("ipad")!=-1,isIE:navigator.userAgent.toLowerCase().indexOf("msie")!=-1||navigator.userAgent.toLowerCase().indexOf("trident")!=-1};return c}(jQuery);w2utils.formatters={number:function(a,b){return parseInt(b)>20&&(b=20),parseInt(b)<0&&(b=0),null==a||""===a?"":w2utils.formatNumber(parseFloat(a),b,!0)},float:function(a,b){return w2utils.formatters.number(a,b)},int:function(a,b){return w2utils.formatters.number(a,0)},money:function(a,b){if(null==a||""===a)return"";var c=w2utils.formatNumber(Number(a),w2utils.settings.currencyPrecision||2);return(w2utils.settings.currencyPrefix||"")+c+(w2utils.settings.currencySuffix||"")},currency:function(a,b){return w2utils.formatters.money(a,b)},percent:function(a,b){return null==a||""===a?"":w2utils.formatNumber(a,b||1)+"%"},size:function(a,b){return null==a||""===a?"":w2utils.formatSize(parseInt(a))},date:function(a,b){if(""===b&&(b=w2utils.settings.dateFormat),null==a||0===a||""===a)return"";var c=w2utils.isDateTime(a,b,!0);return c===!1&&(c=w2utils.isDate(a,b,!0)),'<span title="'+c+'">'+w2utils.formatDate(c,b)+"</span>"},datetime:function(a,b){if(""===b&&(b=w2utils.settings.datetimeFormat),
null==a||0===a||""===a)return"";var c=w2utils.isDateTime(a,b,!0);return c===!1&&(c=w2utils.isDate(a,b,!0)),'<span title="'+c+'">'+w2utils.formatDateTime(c,b)+"</span>"},time:function(a,b){if(""===b&&(b=w2utils.settings.timeFormat),"h12"===b&&(b="hh:mi pm"),"h24"===b&&(b="h24:mi"),null==a||0===a||""===a)return"";var c=w2utils.isDateTime(a,b,!0);return c===!1&&(c=w2utils.isDate(a,b,!0)),'<span title="'+c+'">'+w2utils.formatTime(a,b)+"</span>"},timestamp:function(a,b){if(""===b&&(b=w2utils.settings.datetimeFormat),null==a||0===a||""===a)return"";var c=w2utils.isDateTime(a,b,!0);return c===!1&&(c=w2utils.isDate(a,b,!0)),c.toString?c.toString():""},gmt:function(a,b){if(""===b&&(b=w2utils.settings.datetimeFormat),null==a||0===a||""===a)return"";var c=w2utils.isDateTime(a,b,!0);return c===!1&&(c=w2utils.isDate(a,b,!0)),c.toUTCString?c.toUTCString():""},age:function(a,b){if(null==a||0===a||""===a)return"";var c=w2utils.isDateTime(a,null,!0);return c===!1&&(c=w2utils.isDate(a,null,!0)),'<span title="'+c+'">'+w2utils.age(a)+(b?" "+b:"")+"</span>"},interval:function(a,b){return null==a||0===a||""===a?"":w2utils.interval(a)+(b?" "+b:"")},toggle:function(a,b){return a?"Yes":""},password:function(a,b){for(var c="",d=0;d<a.length;d++)c+="*";return c}},w2utils.event={on:function(a,b){var d,c=jQuery;if("string"==typeof a&&a.indexOf(".")!=-1){var e=a.split(".");a=e[0],d=e[1]}if("string"==typeof a&&a.indexOf(":")!=-1){var e=a.split(":");["complete","done"].indexOf(a[1])!=-1&&(a[1]="after"),a={type:e[0],execute:e[1]}}return c.isPlainObject(a)||(a={type:a,scope:d}),a=c.extend({type:null,execute:"before",target:null,onComplete:null},a),a.type?b?(c.isArray(this.handlers)||(this.handlers=[]),void this.handlers.push({edata:a,handler:b})):void console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name):void console.log("ERROR: You must specify event type when calling .on() method of "+this.name)},off:function(a,b){var d,c=jQuery;if("string"==typeof a&&a.indexOf(".")!=-1){var e=a.split(".");a=e[0],d=e[1]}if("string"==typeof a&&a.indexOf(":")!=-1){var e=a.split(":");["complete","done"].indexOf(a[1])!=-1&&(a[1]="after"),a={type:e[0],execute:e[1]}}if(c.isPlainObject(a)||(a={type:a}),a=c.extend({},{type:null,execute:"before",target:null,onComplete:null},a),!a.type&&!d)return void console.log("ERROR: You must specify event type when calling .off() method of "+this.name);b||(b=null);for(var f=[],g=0,h=this.handlers.length;g<h;g++){var i=this.handlers[g];(i.edata.type!==a.type&&"*"!==a.type&&(null==i.edata.scope||""!=a.type)||i.edata.target!==a.target&&null!=a.target||i.edata.execute!==a.execute&&null!=a.execute||i.handler!==b&&null!=b&&(null==d||i.edata.scope!=d))&&f.push(i)}this.handlers=f},trigger:function(a){var b=jQuery,a=b.extend({type:null,phase:"before",target:null,doneHandlers:[]},a,{isStopped:!1,isCancelled:!1,done:function(a){this.doneHandlers.push(a)},preventDefault:function(){this.isCancelled=!0},stopPropagation:function(){this.isStopped=!0}});"before"===a.phase&&(a.onComplete=null);var c,d,e;null==a.target&&(a.target=null),b.isArray(this.handlers)||(this.handlers=[]);for(var f=this.handlers.length-1;f>=0;f--){var g=this.handlers[f];if(!(g.edata.type!==a.type&&"*"!==g.edata.type||g.edata.target!==a.target&&null!=g.edata.target||g.edata.execute!==a.phase&&"*"!==g.edata.execute&&"*"!==g.edata.phase)&&(a=b.extend({},g.edata,a),c=[],e=new RegExp(/\((.*?)\)/).exec(g.handler),e&&(c=e[1].split(/\s*,\s*/)),2===c.length?g.handler.call(this,a.target,a):g.handler.call(this,a),a.isStopped===!0||a.stop===!0))return a}var h="on"+a.type.substr(0,1).toUpperCase()+a.type.substr(1);if("before"===a.phase&&"function"==typeof this[h]&&(d=this[h],c=[],e=new RegExp(/\((.*?)\)/).exec(d),e&&(c=e[1].split(/\s*,\s*/)),2===c.length?d.call(this,a.target,a):d.call(this,a),a.isStopped===!0||a.stop===!0))return a;if(null!=a.object&&"before"===a.phase&&"function"==typeof a.object[h]&&(d=a.object[h],c=[],e=new RegExp(/\((.*?)\)/).exec(d),e&&(c=e[1].split(/\s*,\s*/)),2===c.length?d.call(this,a.target,a):d.call(this,a),a.isStopped===!0||a.stop===!0))return a;if("after"===a.phase){"function"==typeof a.onComplete&&a.onComplete.call(this,a);for(var i=0;i<a.doneHandlers.length;i++)"function"==typeof a.doneHandlers[i]&&a.doneHandlers[i].call(this,a)}return a}},function(a){a.fn.w2render=function(b){a(this).length>0&&("string"==typeof b&&w2ui[b]&&w2ui[b].render(a(this)[0]),"object"==typeof b&&b.render(a(this)[0]))},a.fn.w2destroy=function(a){!a&&this.length>0&&(a=this.attr("name")),"string"==typeof a&&w2ui[a]&&w2ui[a].destroy(),"object"==typeof a&&a.destroy()},a.fn.w2marker=function(){function c(a,b){for(;b.innerHTML.indexOf('<span class="w2ui-marker">')!=-1;)b.innerHTML=b.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>((.|\n|\r)*)\<\/span\>/gi,"$1")}var b=Array.prototype.slice.call(arguments,0);return Array.isArray(b[0])&&(b=b[0]),0!==b.length&&b[0]?a(this).each(function(a,d){function h(a){return'<span class="w2ui-marker">'+a+"</span>"}c(a,d);for(var e=0;e<b.length;e++){var f=b[e];"string"!=typeof f&&(f=String(f)),f=f.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;");var g=new RegExp(f+"(?!([^<]+)?>)","gi");d.innerHTML=d.innerHTML.replace(g,h)}}):a(this).each(c)},a.fn.w2tag=function(b,c){return 1==arguments.length&&"object"==typeof b&&(c=b,null!=c.html&&(b=c.html)),c=a.extend({id:null,html:b,position:"right|top",align:"none",left:0,top:0,style:"",css:{},className:"",inputClass:"",onShow:null,onHide:null,hideOnKeyPress:!0,hideOnBlur:!1,hideOnClick:!1,hideOnChange:!0},c),null!=c.name&&null==c.id&&(c.id=c.name),""!==c.class&&""===c.inputClass&&(c.inputClass=c.class),0===a(this).length?void a(".w2ui-tag").each(function(b,c){var d=a(c).data("w2tag");d&&d.hide()}):a(this).each(function(d,e){function i(){if(f.box.css("display","block"),f&&f.box&&a(f.attachedTo).offset()){var b=f.getPos();f.box.css({opacity:"1",left:b.left+"px",top:b.top+"px"}).data("w2tag",f).find(".w2ui-tag-body").addClass(b.posClass),f.tmp.pos=b.left+"x"+b.top,a(f.attachedTo).off(".w2tag").css(f.options.css).addClass(f.options.inputClass),f.options.hideOnKeyPress&&a(f.attachedTo).on("keypress.w2tag",f.hide),c.hideOnChange&&("INPUT"==e.nodeName?a(e).on("change.w2tag",f.hide):a(e).find("input").on("change.w2tag",f.hide)),f.options.hideOnBlur&&a(f.attachedTo).on("blur.w2tag",f.hide),f.options.hideOnClick&&a(document).on("click.w2tag",f.hide),"function"==typeof f.options.onShow&&f.options.onShow(),k()}}function j(){f.box.length<=0||(f.tmp.timer&&clearTimeout(f.tmp.timer),f.box.remove(),f.options.hideOnClick&&a(document).off(".w2tag"),a(f.attachedTo).off(".w2tag").removeClass(f.options.inputClass).removeData("w2tag"),a(f.attachedTo).length>0&&(a(f.attachedTo)[0].style.cssText=f.tmp.originalCSS),"function"==typeof f.options.onHide&&f.options.onHide())}function k(b){var c=a(f.attachedTo).offset();if(0===a(f.attachedTo).length||0===c.left&&0===c.top||0===f.box.find(".w2ui-tag-body").length)return void f.hide();var d=l();f.tmp.pos!==d.left+"x"+d.top&&(f.box.css(w2utils.cssPrefix({transition:b?"0s":".2s"})).css({left:d.left+"px",top:d.top+"px"}),f.tmp.pos=d.left+"x"+d.top),f.tmp.timer&&clearTimeout(f.tmp.timer),f.tmp.timer=setTimeout(k,100)}function l(){var b=a(f.attachedTo).offset(),c="w2ui-tag-right",d=parseInt(b.left+f.attachedTo.offsetWidth+(f.options.left?f.options.left:0)),e=parseInt(b.top+(f.options.top?f.options.top:0)),g=f.box.find(".w2ui-tag-body"),h=g[0].offsetWidth,i=g[0].offsetHeight;if("string"==typeof f.options.position&&f.options.position.indexOf("|")!=-1&&(f.options.position=f.options.position.split("|")),"top"==f.options.position)c="w2ui-tag-top",d=parseInt(b.left+(f.options.left?f.options.left:0))-14,e=parseInt(b.top+(f.options.top?f.options.top:0))-i-10;else if("bottom"==f.options.position)c="w2ui-tag-bottom",d=parseInt(b.left+(f.options.left?f.options.left:0))-14,e=parseInt(b.top+f.attachedTo.offsetHeight+(f.options.top?f.options.top:0))+10;else if("left"==f.options.position)c="w2ui-tag-left",d=parseInt(b.left+(f.options.left?f.options.left:0))-h-20,e=parseInt(b.top+(f.options.top?f.options.top:0));else if(Array.isArray(f.options.position)){for(var j=window.innerWidth,k=window.innerHeight,l=0;l<f.options.position.length;l++){var m=f.options.position[l];if("right"==m){if(c="w2ui-tag-right",d=parseInt(b.left+f.attachedTo.offsetWidth+(f.options.left?f.options.left:0)),e=parseInt(b.top+(f.options.top?f.options.top:0)),d+h<=j)break}else if("left"==m){if(c="w2ui-tag-left",d=parseInt(b.left+(f.options.left?f.options.left:0))-h-20,e=parseInt(b.top+(f.options.top?f.options.top:0)),d>=0)break}else if("top"==m){if(c="w2ui-tag-top",d=parseInt(b.left+(f.options.left?f.options.left:0))-14,e=parseInt(b.top+(f.options.top?f.options.top:0))-i-10,d+h<=j&&e>=0)break}else if("bottom"==m&&(c="w2ui-tag-bottom",d=parseInt(b.left+(f.options.left?f.options.left:0))-14,e=parseInt(b.top+f.attachedTo.offsetHeight+(f.options.top?f.options.top:0))+10,d+h<=j&&e+i<=k))break}g.data("posClass")!==c&&g.removeClass("w2ui-tag-right w2ui-tag-left w2ui-tag-top w2ui-tag-bottom").addClass(c).data("posClass",c)}return{left:d,top:e,posClass:c}}var f,g=c.id?c.id:e.id;""==g&&(g=a(e).find("input").attr("id")),g||(g="noid");var h=w2utils.escapeId(g);null!=a(this).data("w2tag")?(f=a(this).data("w2tag"),a.extend(f.options,c)):f={id:g,attachedTo:e,box:a("#w2ui-tag-"+h),options:a.extend({},c),init:i,hide:j,getPos:l,isMoved:k,tmp:{}},""===b||null==b?f.hide():0!==f.box.length?f.box.find(".w2ui-tag-body").css(f.options.css).attr("style",f.options.style).addClass(f.options.className).html(f.options.html):(f.tmp.originalCSS="",a(f.attachedTo).length>0&&(f.tmp.originalCSS=a(f.attachedTo)[0].style.cssText),a("body").append('<div onclick="event.stopPropagation()" style="display: none;" id="w2ui-tag-'+f.id+'"        class="w2ui-tag '+(a(f.attachedTo).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length>0?"w2ui-tag-popup":"")+'">   <div style="margin: -2px 0px 0px -2px; white-space: nowrap;">      <div class="w2ui-tag-body '+f.options.className+'" style="'+(f.options.style||"")+'">'+b+"</div>   </div></div>"),f.box=a("#w2ui-tag-"+h),a(f.attachedTo).data("w2tag",f),setTimeout(i,1))})},a.fn.w2overlay=function(b,c){function l(){var b=a("#w2ui-overlay"+e);if(b.data("element")===d[0]&&0!==b.length){var c=a(d).offset()||{},f=c.left+"x"+c.top;b.data("position")!==f?m():setTimeout(l,250)}}function m(b){if(!b||0===b.button){var d=a("#w2ui-overlay"+e);if(d.data("keepOpen")===!0)return void d.removeData("keepOpen");var f;"function"==typeof c.onHide&&(f=c.onHide()),f!==!1&&(d.remove(),a(document).off(".w2overlay"+e),clearInterval(d.data("timer")))}}function n(){var b=a("#w2ui-overlay"+e),f=b.find(" > div"),g=a("#w2ui-overlay"+e+" div.menu");if(g.css("overflow-y","hidden"),b.length>0){f.height("auto").width("auto");var i=!1,j=f.height(),k=f.width();c.width&&c.width<k&&(k=c.width),k<30&&(k=30),c.tmp.contentHeight&&(j=parseInt(c.tmp.contentHeight),f.height(j),setTimeout(function(){var a=f.find("div.menu");j>a.height()&&f.find("div.menu").css("overflow-y","hidden")},1),setTimeout(function(){var a=f.find("div.menu");"auto"!=a.css("overflow-y")&&a.css("overflow-y","auto")},10)),c.tmp.contentWidth&&"both"!=c.align&&(k=parseInt(c.tmp.contentWidth),f.width(k),setTimeout(function(){k>f.find("div.menu > table").width()&&f.find("div.menu > table").css("overflow-x","hidden")},1),setTimeout(function(){f.find("div.menu > table").css("overflow-x","auto")},10));var l=c.left,m=c.width,o=c.tipLeft;switch(c.align){case"both":l=17,0===c.width&&(c.width=w2utils.getSize(a(d),"width")),c.maxWidth&&c.width>c.maxWidth&&(c.width=c.maxWidth);break;case"left":l=17;break;case"right":l=w2utils.getSize(a(d),"width")-k+10,o=k-40}m=30!==k||m?c.width?c.width:"auto":30;var p=(k-17)/2;"auto"!=m&&(p=(m-17)/2),p<25&&(l=25-p,o=Math.floor(p));var q,r,s;if(c.contextMenu)q=c.pageX+8,r=c.pageY-0,s=c.pageY;else{var t=d.offset()||{};q=(t.left>25?t.left:25)+l,r=t.top+w2utils.getSize(d,"height")+c.top+7,s=t.top}b.css({left:q+"px",top:r+"px","min-width":m,"min-height":c.height?c.height:"auto"});var t=f.offset()||{},u=window.innerHeight+a(document).scrollTop()-t.top-7,v=window.innerWidth+a(document).scrollLeft()-t.left-7;if(c.contextMenu&&(u=window.innerHeight+a(document).scrollTop()-c.pageY-15,v=window.innerWidth+a(document).scrollLeft()-c.pageX),u>-50&&u<210||c.openAbove===!0){var w;c.contextMenu?(u=c.pageY-7,w=5):(u=t.top-a(document).scrollTop()-7,w=24),c.maxHeight&&u>c.maxHeight&&(u=c.maxHeight),j>u&&(i=!0,f.height(u).width(k).css({"overflow-y":"auto"}),j=u),b.addClass("bottom-arrow"),b.css("top",s-j-w+c.top+"px"),b.find(">style").html("#w2ui-overlay"+e+":before { margin-left: "+parseInt(o)+"px; }#w2ui-overlay"+e+":after { margin-left: "+parseInt(o)+"px; }")}else c.maxHeight&&u>c.maxHeight&&(u=c.maxHeight),j>u&&(i=!0,f.height(u).width(k).css({"overflow-y":"auto"})),b.addClass("top-arrow"),b.find(">style").html("#w2ui-overlay"+e+":before { margin-left: "+parseInt(o)+"px; }#w2ui-overlay"+e+":after { margin-left: "+parseInt(o)+"px; }");k=f.width(),v=window.innerWidth+a(document).scrollLeft()-t.left-7,c.maxWidth&&v>c.maxWidth&&(v=c.maxWidth),k>v&&"both"!==c.align&&(c.align="right",setTimeout(function(){n()},1)),(c.contextMenu||c.noTip)&&b.find(">style").html("#w2ui-overlay"+e+":before { display: none; }#w2ui-overlay"+e+":after { display: none; }"),i&&"both"!=c.align&&f.width(k+w2utils.scrollBarSize()+2)}g.css("overflow-y","auto")}var d=this,e="",f={name:null,html:"",align:"none",left:0,top:0,tipLeft:30,noTip:!1,selectable:!1,width:0,height:0,maxWidth:null,maxHeight:null,contextMenu:!1,pageX:null,pageY:null,originalEvent:null,style:"",class:"",overlayStyle:"",onShow:null,onHide:null,openAbove:!1,tmp:{}};1==arguments.length&&(c="object"==typeof b?b:{html:b}),2==arguments.length&&(c.html=b),a.isPlainObject(c)||(c={}),c=a.extend({},f,c),c.name&&(e="-"+c.name);var g;if(0===this.length||""===c.html||null==c.html)return a("#w2ui-overlay"+e).length>0?(g=a("#w2ui-overlay"+e)[0].hide,"function"==typeof g&&g()):a("#w2ui-overlay"+e).remove(),a(this);a("#w2ui-overlay"+e).length>0&&(g=a("#w2ui-overlay"+e)[0].hide,a(document).off(".w2overlay"+e),"function"==typeof g&&g()),d.length>0&&(null==d[0].tagName||"BODY"==d[0].tagName.toUpperCase())&&(c.contextMenu=!0),c.contextMenu&&c.originalEvent&&(c.pageX=c.originalEvent.pageX,c.pageY=c.originalEvent.pageY),!c.contextMenu||null!=c.pageX&&null!=c.pageY||console.log("ERROR: to display menu at mouse location, pass options.pageX and options.pageY."),a("body").append('<div id="w2ui-overlay'+e+'" style="display: none; left: 0px; top: 0px; '+c.overlayStyle+'"        class="w2ui-reset w2ui-overlay '+(a(this).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length>0?"w2ui-overlay-popup":"")+'">    <style></style>    <div style="min-width: 100%; '+c.style+'" class="'+c.class+'"></div></div>');var h=a("#w2ui-overlay"+e),i=h.find(" > div");i.html(c.html);var j=i.css("background-color");null!=j&&"rgba(0, 0, 0, 0)"!==j&&"transparent"!==j&&h.css({"background-color":j,"border-color":j});var k=a(d).offset()||{};return h.data("element",d.length>0?d[0]:null).data("options",c).data("position",k.left+"x"+k.top).fadeIn("fast").on("click",function(b){a("#w2ui-overlay"+e).data("keepOpen",!0),"LABEL"==b.target.tagName.toUpperCase()&&b.stopPropagation()}).on("mousedown",function(b){a("#w2ui-overlay"+e).data("keepOpen",!0);var d=b.target.tagName.toUpperCase();["INPUT","TEXTAREA","SELECT"].indexOf(d)!=-1||c.selectable||b.preventDefault()}),h[0].hide=m,h[0].resize=n,setTimeout(function(){n(),a(document).off(".w2overlay"+e).on("click.w2overlay"+e,m),"function"==typeof c.onShow&&c.onShow()},10),l(),a(this)},a.fn.w2menu=function(b,c){function o(){setTimeout(function(){a("#w2ui-overlay"+f+" tr.w2ui-selected").removeClass("w2ui-selected");var b=a("#w2ui-overlay"+f+" tr[index="+c.index+"]"),d=a("#w2ui-overlay"+f+" div.menu").scrollTop();if(b.addClass("w2ui-selected"),c.tmp&&(c.tmp.contentHeight=a("#w2ui-overlay"+f+" table").height()+(c.search?50:10)),c.tmp&&(c.tmp.contentWidth=a("#w2ui-overlay"+f+" table").width()),a("#w2ui-overlay"+f).length>0&&a("#w2ui-overlay"+f)[0].resize(),b.length>0){var e=b[0].offsetTop-5,g=a("#w2ui-overlay"+f+" div.menu"),h=g.height();a("#w2ui-overlay"+f+" div.menu").scrollTop(d),(e<d||e+b.height()>d+h)&&a("#w2ui-overlay"+f+" div.menu").animate({scrollTop:e-(h-2*b.height())/2},200,"linear")}},1)}function p(b){var d=this.value,g=b.keyCode,h=!1;switch(g){case 13:a("#w2ui-overlay"+f).remove(),a.fn.w2menuClick(b,c.index);break;case 9:case 27:a("#w2ui-overlay"+f).remove(),a.fn.w2menuClick(b,-1);break;case 38:for(c.index=w2utils.isInt(c.index)?parseInt(c.index):0,c.index--;c.index>0&&c.items[c.index].hidden;)c.index--;if(0===c.index&&c.items[c.index].hidden)for(;c.items[c.index]&&c.items[c.index].hidden;)c.index++;c.index<0&&(c.index=0),h=!0;break;case 40:for(c.index=w2utils.isInt(c.index)?parseInt(c.index):0,c.index++;c.index<c.items.length-1&&c.items[c.index].hidden;)c.index++;if(c.index===c.items.length-1&&c.items[c.index].hidden)for(;c.items[c.index]&&c.items[c.index].hidden;)c.index--;c.index>=c.items.length&&(c.index=c.items.length-1),h=!0}if(!h){for(var i=0,j=0;j<c.items.length;j++){var k=c.items[j],l="",m="";["is","begins with"].indexOf(c.match)!==-1&&(l="^"),["is","ends with"].indexOf(c.match)!==-1&&(m="$");try{var n=new RegExp(l+d+m,"i");n.test(k.text)||"..."===k.text?k.hidden=!1:k.hidden=!0}catch(a){}"enum"===e.type&&a.inArray(k.id,ids)!==-1&&(k.hidden=!0),k.hidden!==!0&&i++}for(c.index=0;c.index<c.items.length-1&&c.items[c.index].hidden;)c.index++;i<=0&&(c.index=-1)}a(e).w2menu("refresh",c),o()}function q(){if(c.spinner)return'<table class="w2ui-drop-menu"><tbody><tr><td style="padding: 5px 10px 10px 10px; text-align: center">    <div class="w2ui-spinner" style="width: 18px; height: 18px; position: relative; top: 5px;"></div>     <div style="display: inline-block; padding: 3px; color: #999;">'+w2utils.lang("Loading...")+"</div></td></tr></tbody></table>";for(var a=0,b='<table cellspacing="0" cellpadding="0" class="w2ui-drop-menu"><tbody>',d=null,e=null,f=0;f<c.items.length;f++){var g=c.items[f];if("string"==typeof g?g={id:g,text:g}:(null!=g.text&&null==g.id&&(g.id=g.text),null==g.text&&null!=g.id&&(g.text=g.id),null!=g.caption&&(g.text=g.caption),d=g.img,e=g.icon,null==d&&(d=null),null==e&&(e=null)),["radio","check"].indexOf(c.type)!=-1&&(e=g.checked===!0?"w2ui-icon-check":"w2ui-icon-empty"),g.hidden!==!0){var h="",i=g.text;if("function"==typeof c.render&&(i=c.render(g,c)),d&&(h='<td class="menu-icon"><div class="w2ui-tb-image w2ui-icon '+d+'"></div></td>'),e&&(h='<td class="menu-icon" align="center"><span class="w2ui-icon '+e+'"></span></td>'),null==i||""===i||/^-+$/.test(i))b+='<tr><td colspan="3" style="padding: 6px; pointer-events: none"><div style="border-top: 1px solid silver;"></div></td></tr>';else{var j=a%2===0?"w2ui-item-even":"w2ui-item-odd";c.altRows!==!0&&(j="");var k=1;""===h&&k++,null==g.count&&null==g.hotkey&&k++,null==g.tooltip&&null!=g.hint&&(g.tooltip=g.hint),b+='<tr index="'+f+'" style="'+(g.style?g.style:"")+'" '+(g.tooltip?'title="'+w2utils.lang(g.tooltip)+'"':"")+'        class="'+j+" "+(c.index===f?"w2ui-selected":"")+" "+(g.disabled===!0?"w2ui-disabled":"")+'"        onmousedown="if ('+(g.disabled===!0?"true":"false")+") return;               jQuery.fn.w2menuDown(event, '"+f+'\');"        onclick="event.stopPropagation();                if ('+(g.disabled===!0?"true":"false")+") return;               jQuery.fn.w2menuClick(event, '"+f+"');\">"+h+'   <td class="menu-text" colspan="'+k+'">'+w2utils.lang(i)+'</td>   <td class="menu-count">'+(null!=g.count?"<span>"+g.count+"</span>":"")+(null!=g.hotkey?'<span class="hotkey">'+g.hotkey+"</span>":"")+"</td></tr>",a++}}c.items[f]=g}return 0===a&&(b+='<tr><td style="padding: 13px; color: #999; text-align: center">'+c.msgNoItems+"</div></td></tr>"),b+="</tbody></table>"}c&&"function"==typeof c.items&&(c.items=c.items());var d={type:"normal",index:null,items:[],render:null,msgNoItems:"No items",onSelect:null,tmp:{}},e=this,f="";if("refresh"===b)if(a("#w2ui-overlay"+f).length>0){c=a.extend(a.fn.w2menuOptions,c);var g=a("#w2ui-overlay"+f+" div.menu").scrollTop();a("#w2ui-overlay"+f+" div.menu").html(q()),a("#w2ui-overlay"+f+" div.menu").scrollTop(g),o()}else a(this).w2menu(c);else{if("refresh-index"!==b){1===arguments.length?c=b:c.items=b,"object"!=typeof c&&(c={}),c=a.extend({},d,c),a.fn.w2menuOptions=c,c.name&&(f="-"+c.name),"function"==typeof c.select&&"function"!=typeof c.onSelect&&(c.onSelect=c.select),"function"==typeof c.onRender&&"function"!=typeof c.render&&(c.render=c.onRender),a.fn.w2menuClick=function(b,d){var e=!1;["radio","check"].indexOf(c.type)!=-1&&(b.shiftKey||b.metaKey||b.ctrlKey)&&(e=!0),"function"==typeof c.onSelect&&setTimeout(function(){c.onSelect({index:d,item:c.items[d],keepOpen:e,originalEvent:b})},10);var g=a("#w2ui-overlay"+f);g.removeData("keepOpen"),"function"!=typeof g[0].hide||e||g[0].hide()},a.fn.w2menuDown=function(b,d){var e=a(b.target).parents("tr"),f=e.find(".w2ui-icon");if("check"==c.type||"radio"==c.type){var g=c.items[d];g.checked=!g.checked,g.checked?("radio"==c.type&&f.parents("table").find(".w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),"check"==c.type&&null!=g.group&&c.items.forEach(function(a,b){a.group===g.group&&a.checked&&(f.parents("table").find("tr[index="+b+"] .w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),a.checked=!1)}),f.removeClass("w2ui-icon-empty").addClass("w2ui-icon-check")):"check"==c.type&&null==g.group&&f.removeClass("w2ui-icon-check").addClass("w2ui-icon-empty")}e.parent().find("tr").removeClass("w2ui-selected"),e.addClass("w2ui-selected")};var l="";if(c.search){l+='<div style="position: absolute; top: 0px; height: 40px; left: 0px; right: 0px; border-bottom: 1px solid silver; background-color: #ECECEC; padding: 8px 5px;">    <div class="w2ui-icon icon-search" style="position: absolute; margin-top: 4px; margin-left: 6px; width: 11px; background-position: left !important;"></div>    <input id="menu-search" type="text" style="width: 100%; outline: none; padding-left: 20px;" onclick="event.stopPropagation();"/></div>',c.style+=";background-color: #ECECEC",c.index=0;for(var m=0;m<c.items.length;m++)c.items[m].hidden=!1}l+='<div class="menu" style="position: absolute; top: '+(c.search?40:0)+'px; bottom: 0px; width: 100%;">'+q()+"</div>";var n=a(this).w2overlay(l,c);return setTimeout(function(){if(a("#w2ui-overlay"+f+" #menu-search").on("keyup",p).on("keydown",function(a){9===a.keyCode&&(a.stopPropagation(),a.preventDefault())}),c.search){if(["text","password"].indexOf(a(e)[0].type)!=-1||"TEXTAREA"==a(e)[0].tagName.toUpperCase())return;a("#w2ui-overlay"+f+" #menu-search").focus()}o()},200),o(),n}var h=a("#w2ui-overlay"+f+" div.menu"),i=h.find("tr[index="+c.index+"]"),g=h.scrollTop();if(h.find("tr.w2ui-selected").removeClass("w2ui-selected"),i.addClass("w2ui-selected"),i.length>0){var j=i[0].offsetTop-5,k=h.height();h.scrollTop(g),(j<g||j+i.height()>g+k)&&h.animate({scrollTop:j-(k-2*i.height())/2},200,"linear")}o()}},a.fn.w2color=function(b,c){function u(a){for(var c,d=(a.color,'<div class="w2ui-color" onmousedown="jQuery(this).parents(\'.w2ui-overlay\').data(\'keepOpen\', true)"><div class="w2ui-color-palette"><table cellspacing="5"><tbody>'),e=0;e<h.length;e++){d+="<tr>";for(var f=0;f<h[e].length;f++)c="FFFFFF"==h[e][f]?";border: 1px solid #efefef":"",d+='<td>    <div class="color '+(""===h[e][f]?"no-color":"")+'" style="background-color: #'+h[e][f]+c+';"        name="'+h[e][f]+'" index="'+e+":"+f+'">'+(a.color==h[e][f]?"&#149;":"&#160;")+"    </div></td>",a.color==h[e][f]&&(g=[e,f]);d+="</tr>",e<2&&(d+='<tr><td style="height: 8px" colspan="8"></td></tr>')}return d+="</tbody></table></div>",d+='<div class="w2ui-color-advanced" style="display: none">   <div class="color-info">       <div class="color-preview-bg"><div class="color-preview"></div><div class="color-original"></div></div>       <div class="color-part">           <span>H</span> <input name="h" maxlength="3" max="360" tabindex="101">           <span>R</span> <input name="r" maxlength="3" max="255" tabindex="104">       </div>       <div class="color-part">           <span>S</span> <input name="s" maxlength="3" max="100" tabindex="102">           <span>G</span> <input name="g" maxlength="3" max="255" tabindex="105">       </div>       <div class="color-part">           <span>V</span> <input name="v" maxlength="3" max="100" tabindex="103">           <span>B</span> <input name="b" maxlength="3" max="255" tabindex="106">       </div>       <div class="color-part" style="margin: 30px 0px 0px 2px">           <span style="width: 40px">Opacity</span>            <input name="a" maxlength="5" max="1" style="width: 32px !important" tabindex="107">       </div>   </div>   <div class="palette" name="palette">       <div class="palette-bg"></div>       <div class="value1 move-x move-y"></div>   </div>   <div class="rainbow" name="rainbow">       <div class="value2 move-x"></div>   </div>   <div class="alpha" name="alpha">       <div class="alpha-bg"></div>       <div class="value2 move-x"></div>   </div></div>',d+="<div class=\"w2ui-color-tabs\">   <div class=\"w2ui-color-tab selected\" onclick=\"jQuery(this).addClass('selected').next().removeClass('selected').parents('.w2ui-overlay').find('.w2ui-color-advanced').hide().parent().find('.w2ui-color-palette').show(); jQuery.fn._colorAdvanced = false; jQuery('#w2ui-overlay')[0].resize()\"><span class=\"w2ui-icon w2ui-icon-colors\"></span></div>   <div class=\"w2ui-color-tab\" onclick=\"jQuery(this).addClass('selected').prev().removeClass('selected').parents('.w2ui-overlay').find('.w2ui-color-advanced').show().parent().find('.w2ui-color-palette').hide(); jQuery.fn._colorAdvanced = true; jQuery('#w2ui-overlay')[0].resize()\"><span class=\"w2ui-icon w2ui-icon-settings\"></span></div></div></div><div style=\"clear: both; height: 0\"></div>"}var e=a(this),f=e[0];if(e.data("skipInit"))return void e.removeData("skipInit");var g=[-1,-1];null==a.fn.w2colorPalette&&(a.fn.w2colorPalette=[["000000","333333","555555","777777","888888","999999","AAAAAA","CCCCCC","DDDDDD","EEEEEE","F7F7F7","FFFFFF"],["FF011B","FF9838","FFC300","FFFD59","86FF14","14FF7A","2EFFFC","2693FF","006CE7","9B24F4","FF21F5","FF0099"],["FFEAEA","FCEFE1","FCF4DC","FFFECF","EBFFD9","D9FFE9","E0FFFF","E8F4FF","ECF4FC","EAE6F4","FFF5FE","FCF0F7"],["F4CCCC","FCE5CD","FFF1C2","FFFDA1","D5FCB1","B5F7D0","BFFFFF","D6ECFF","CFE2F3","D9D1E9","FFE3FD","FFD9F0"],["EA9899","F9CB9C","FFE48C","F7F56F","B9F77E","84F0B1","83F7F7","B5DAFF","9FC5E8","B4A7D6","FAB9F6","FFADDE"],["E06666","F6B26B","DEB737","E0DE51","8FDB48","52D189","4EDEDB","76ACE3","6FA8DC","8E7CC3","E07EDA","F26DBD"],["CC0814","E69138","AB8816","B5B20E","6BAB30","27A85F","1BA8A6","3C81C7","3D85C6","674EA7","A14F9D","BF4990"],["99050C","B45F17","80650E","737103","395E14","10783D","13615E","094785","0A5394","351C75","780172","782C5A"]]);var h=a.fn.w2colorPalette;"string"==typeof b&&(b={color:b,transparent:!0}),null==b.onSelect&&null!=c&&(b.onSelect=c),b.transparent&&"333333"==h[0][1]&&(h[0].splice(1,1),h[0].push("")),b.transparent||"333333"==h[0][1]||(h[0].splice(1,0,"333333"),h[0].pop()),b.color&&(b.color=String(b.color).toUpperCase()),"#"==b.color.substr(0,1)&&(b.color=b.color.substr(1)),null==b.fireChange&&(b.fireChange=!0),0===a("#w2ui-overlay").length?a(f).w2overlay(u(b),b):a("#w2ui-overlay .w2ui-color").parent().html(u(b)),a("#w2ui-overlay .color").off(".w2color").on("mousedown.w2color",function(c){var d="#"+a(c.originalEvent.target).attr("name");"#"==d&&(d=""),g=a(c.originalEvent.target).attr("index").split(":"),"INPUT"==f.tagName?(a(f).val(d).data("skipInit",!0),b.fireChange&&a(f).change(),a(f).next().find(">div").css("background-color",d)):a(f).data("_color",d),"function"==typeof b.onSelect&&b.onSelect(d)}).on("mouseup.w2color",function(){setTimeout(function(){a("#w2ui-overlay").length>0&&a("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),a("#w2ui-overlay .color-original").off(".w2color").on("click.w2color",function(b){var c=w2utils.parseColor(a(b.target).css("background-color"));null!=c&&(k=c,j=w2utils.rgb2hsv(k),l(j),m(),n())}),a("#w2ui-overlay input").off(".w2color").on("mousedown.w2color",function(b){a("#w2ui-overlay").data("keepOpen",!0),setTimeout(function(){a("#w2ui-overlay").data("keepOpen",!0)},10),b.stopPropagation()}).on("change.w2color",function(){var b=a(this),c=parseFloat(b.val()),d=parseFloat(b.attr("max"));isNaN(c)&&(c=0),d>1&&(c=parseInt(c)),d>0&&c>d&&(b.val(d),c=d),c<0&&(b.val(0),c=0);var e=b.attr("name"),f={};["r","g","b","a"].indexOf(e)!=-1?(k[e]=c,j=w2utils.rgb2hsv(k)):["h","s","v"].indexOf(e)!=-1&&(f[e]=c),l(f),m(),n()});var i,j,k=w2utils.parseColor(b.color);null==k&&(k={r:140,g:150,b:160,a:1},j=w2utils.rgb2hsv(k)),j=w2utils.rgb2hsv(k);var l=function(c,d){null!=c.h&&(j.h=c.h),null!=c.s&&(j.s=c.s),null!=c.v&&(j.v=c.v),null!=c.a&&(k.a=c.a,j.a=c.a),k=w2utils.hsv2rgb(j);var e="rgba("+k.r+","+k.g+","+k.b+","+k.a+")",g=[Number(k.r).toString(16).toUpperCase(),Number(k.g).toString(16).toUpperCase(),Number(k.b).toString(16).toUpperCase()];g.forEach(function(a,b){1==a.length&&(g[b]="0"+a)}),1==k.a&&(e="#"+g[0]+g[1]+g[2]),a("#w2ui-overlay .color-preview").css("background-color",e),a("#w2ui-overlay input").each(function(a,b){b.name&&(null!=k[b.name]&&(b.value=k[b.name]),null!=j[b.name]&&(b.value=j[b.name]),"a"==b.name&&(b.value=k.a))}),d?a("#w2ui-overlay .color-original").css("background-color",e):("INPUT"==f.tagName?(a(f).val(e).data("skipInit",!0),b.fireChange&&a(f).change(),a(f).next().find(">div").css("background-color",e)):a(f).data("_color",e),"function"==typeof b.onSelect&&b.onSelect(e))},m=function(){var b=a("#w2ui-overlay .palette .value1"),c=a("#w2ui-overlay .rainbow .value2"),d=a("#w2ui-overlay .alpha .value2"),e=parseInt(b.width())/2,f=parseInt(c.width())/2;b.css({left:150*j.s/100-e,top:125*(100-j.v)/100-e}),c.css("left",j.h/2.4-f),d.css("left",150*k.a-f)},n=function(){var b=w2utils.hsv2rgb(j.h,100,100),c=b.r+","+b.g+","+b.b;a("#w2ui-overlay .palette").css("background-image","linear-gradient(90deg, rgba("+c+",0) 0%, rgba("+c+",1) 100%)")},o=function(b){var c=a(this).find(".value1, .value2"),d=parseInt(c.width())/2;c.hasClass("move-x")&&c.css({left:b.offsetX-d+"px"}),c.hasClass("move-y")&&c.css({top:b.offsetY-d+"px"}),i={$el:c,x:b.pageX,y:b.pageY,width:c.parent().width(),height:c.parent().height(),left:parseInt(c.css("left")),top:parseInt(c.css("top"))},q(b),a("body").off(".w2color").on(t,q).on(s,p)},p=function(b){a("body").off(".w2color")},q=function(a){var b=i.$el,c=a.pageX-i.x,d=a.pageY-i.y,e=i.left+c,f=i.top+d,g=parseInt(b.width())/2;e<-g&&(e=-g),f<-g&&(f=-g),e>i.width-g&&(e=i.width-g),f>i.height-g&&(f=i.height-g),b.hasClass("move-x")&&b.css({left:e+"px"}),b.hasClass("move-y")&&b.css({top:f+"px"});var h=parseInt(b.css("left"))+g,j=parseInt(b.css("top"))+g,k=b.parent().attr("name");if("palette"==k&&l({s:Math.round(h/b.parent().width()*100),v:Math.round(100-j/b.parent().height()*100)}),"rainbow"==k){var m=Math.round(2.4*h);l({h:m}),n()}"alpha"==k&&l({a:parseFloat(Number(h/150).toFixed(2))})};a.fn._colorAdvanced!==!0&&b.advanced!==!0||a("#w2ui-overlay .w2ui-color-tabs :nth-child(2)").click(),l({},!0),n(),m();var r="mousedown.w2color",s="mouseup.w2color",t="mousemove.w2color";w2utils.isIOS&&(r="touchstart.w2color",s="touchend.w2color",t="touchmove.w2color  "),a("#w2ui-overlay .palette").off(".w2color").on("mousedown.w2color",o),a("#w2ui-overlay .rainbow").off(".w2color").on("mousedown.w2color",o),a("#w2ui-overlay .alpha").off(".w2color").on("mousedown.w2color",o),f.nav=function(b){switch(b){case"up":g[0]--;break;case"down":g[0]++;break;case"right":g[1]++;break;case"left":g[1]--}return g[0]<0&&(g[0]=0),g[0]>h.length-2&&(g[0]=h.length-2),g[1]<0&&(g[1]=0),g[1]>h[0].length-1&&(g[1]=h[0].length-1),color=h[g[0]][g[1]],a(f).data("_color",color),color;
}}}(jQuery),function(a,b){if("function"==typeof define&&define.amd)return define(function(){return b});if("undefined"!=typeof exports){if("undefined"!=typeof module&&module.exports)return exports=module.exports=b;a=exports}for(var c in b)a[c]=b[c]}(this,{w2ui:w2ui,w2obj:w2obj,w2utils:w2utils}),function($){var w2grid=function(a){this.name=null,this.box=null,this.header="",this.url="",this.routeData={},this.columns=[],this.columnGroups=[],this.records=[],this.summary=[],this.searches=[],this.searchData=[],this.sortData=[],this.postData={},this.httpHeaders={},this.toolbar={},this.stateId=null,this.show={header:!1,toolbar:!0,footer:!0,columnHeaders:!0,lineNumbers:!0,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!0,toolbarSearch:!0,toolbarInput:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,searchAll:!0,statusRange:!0,statusBuffered:!1,statusRecordID:!0,statusSelection:!0,statusResponse:!0,statusSort:!1,statusSearch:!1,recordTitles:!1,selectionBorder:!0,skipRecords:!1,saveRestoreState:!0},this.hasFocus=!1,this.autoLoad=!0,this.fixedBody=!0,this.recordHeight=24,this.lineNumberWidth=null,this.vs_start=150,this.vs_extra=15,this.keyboard=!0,this.selectType="row",this.multiSearch=!0,this.multiSelect=!0,this.multiSort=!0,this.reorderColumns=!1,this.reorderRows=!1,this.markSearch=!0,this.columnTooltip="normal",this.disableCVS=!1,this.textSearch="contains",this.total=0,this.limit=100,this.offset=0,this.style="",this.ranges=[],this.menu=[],this.method=null,this.recid=null,this.parser=null,this.last={field:"",caption:"",logic:"OR",search:"",searchIds:[],selection:{indexes:[],columns:{}},multi:!1,scrollTop:0,scrollLeft:0,colStart:0,colEnd:0,sortData:null,sortCount:0,xhr:null,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,edit_col:null,isSafari:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},$.extend(!0,this,w2obj.grid,a)};$.fn.w2grid=function(a){if($.isPlainObject(a)){if(!w2utils.checkName(a,"w2grid"))return;var b=a.columns,c=a.columnGroups,d=a.records,e=a.searches,f=a.searchData,g=a.sortData,h=a.postData,i=a.httpHeaders,j=a.toolbar,k=new w2grid(a);$.extend(k,{postData:{},httpHeaders:{},records:[],columns:[],searches:[],toolbar:{},sortData:[],searchData:[],handlers:[]}),null!=k.onExpand&&(k.show.expandColumn=!0),$.extend(!0,k.toolbar,j);var l;if(b)for(l=0;l<b.length;l++)k.columns[l]=$.extend(!0,{},b[l]);if(c)for(l=0;l<c.length;l++)k.columnGroups[l]=$.extend(!0,{},c[l]);if(e)for(l=0;l<e.length;l++)k.searches[l]=$.extend(!0,{},e[l]);if(f)for(l=0;l<f.length;l++)k.searchData[l]=$.extend(!0,{},f[l]);if(g)for(l=0;l<g.length;l++)k.sortData[l]=$.extend(!0,{},g[l]);if(k.postData=$.extend(!0,{},h),k.httpHeaders=$.extend(!0,{},i),d)for(var m=0;m<d.length;m++){if(null==d[m].recid&&null==d[m][k.recid])return void console.log("ERROR: Cannot add records without recid. (obj: "+k.name+")");k.records[m]=$.extend(!0,{},d[m])}for(var n=0;n<k.columns.length;n++){var o=k.columns[n],p=o.searchable;if(null!=p&&p!==!1&&null==k.getSearch(o.field))if($.isPlainObject(p))k.addSearch($.extend({field:o.field,caption:o.caption,type:"text"},p));else{var q=o.searchable,r="";o.searchable===!0&&(q="text",r='size="20"'),k.addSearch({field:o.field,caption:o.caption,type:q,attr:r})}}return k.initToolbar(),0!==$(this).length&&k.render($(this)[0]),w2ui[k.name]=k,k}var s=w2ui[$(this).attr("name")];return s?arguments.length>0?(s[a]&&s[a].apply(s,Array.prototype.slice.call(arguments,1)),this):s:null},w2grid.prototype={msgDelete:"Are you sure you want to delete selected records?",msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Loadding...",msgNeedReload:"Your remote data source record count has changed, reloading from the first record.",msgEmpty:"",buttons:{reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",tooltip:"Reload data in the list"},columns:{type:"drop",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",tooltip:"Show/hide columns",arrow:!1,html:""},search:{type:"html",id:"w2ui-search",html:"<div class=\"w2ui-icon icon-search-down w2ui-search-down\" onclick=\"var obj = w2ui[jQuery(this).parents('div.w2ui-grid').attr('name')]; obj.searchShowFields();\"></div>"},"search-go":{type:"drop",id:"w2ui-search-advanced",icon:"w2ui-icon-search",text:"Search",tooltip:"Open Search Fields"},add:{type:"button",id:"w2ui-add",text:"Add New",tooltip:"Add new record",icon:"w2ui-icon-plus"},edit:{type:"button",id:"w2ui-edit",text:"Edit",tooltip:"Edit selected record",icon:"w2ui-icon-pencil",disabled:!0},delete:{type:"button",id:"w2ui-delete",text:"Delete",tooltip:"Delete selected records",icon:"w2ui-icon-cross",disabled:!0},save:{type:"button",id:"w2ui-save",text:"Save",tooltip:"Save changed records",icon:"w2ui-icon-check"}},operators:{text:["is","begins","contains","ends"],number:["is","between",{oper:"less",text:"less than"},{oper:"more",text:"more than"}],date:["is","between",{oper:"less",text:"before"},{oper:"more",text:"after"}],list:["is"],hex:["is","between"],color:["is","begins","contains","ends"],enum:["in","not in"]},operatorsMap:{text:"text",int:"number",float:"number",money:"number",currency:"number",percent:"number",hex:"hex",alphanumeric:"text",color:"color",date:"date",time:"date",datetime:"date",list:"list",combo:"text",enum:"enum",file:"enum",select:"list",radio:"list",checkbox:"list",toggle:"list"},onAdd:null,onEdit:null,onRequest:null,onLoad:null,onDelete:null,onSave:null,onSelect:null,onUnselect:null,onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onColumnClick:null,onColumnDblClick:null,onColumnResize:null,onSort:null,onSearch:null,onSearchOpen:null,onChange:null,onRestore:null,onExpand:null,onCollapse:null,onError:null,onKeydown:null,onToolbar:null,onColumnOnOff:null,onCopy:null,onPaste:null,onSelectionExtend:null,onEditField:null,onRender:null,onRefresh:null,onReload:null,onResize:null,onDestroy:null,onStateSave:null,onStateRestore:null,onFocus:null,onBlur:null,onReorderRow:null,add:function(a,b){$.isArray(a)||(a=[a]);for(var c=0,d=0;d<a.length;d++){var e=a[d];null!=e.recid||null!=e[this.recid]?(e.w2ui&&e.w2ui.summary===!0?b?this.summary.unshift(e):this.summary.push(e):b?this.records.unshift(e):this.records.push(e),c++):console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")")}var f="object"!=typeof this.url?this.url:this.url.get;return f?(this.refresh(),c):(this.total=this.records.length,this.localSort(!1,!0),this.localSearch(),this.refreshBody(),this.resizeRecords(),c)},find:function(a,b){null==a&&(a={});var c=[],d=!1;for(var e in a)String(e).indexOf(".")!=-1&&(d=!0);for(var f=0;f<this.records.length;f++){var g=!0;for(var e in a){var h=this.records[f][e];d&&String(e).indexOf(".")!=-1&&(h=this.parseField(this.records[f],e)),"not-null"==a[e]?null!=h&&""!==h||(g=!1):a[e]!=h&&(g=!1)}g&&b!==!0&&c.push(this.records[f].recid),g&&b===!0&&c.push(f)}return c},set:function(a,b,c){if("object"==typeof a&&null!==a&&(c=b,b=a,a=null),null==a){for(var d=0;d<this.records.length;d++)$.extend(!0,this.records[d],b);c!==!0&&this.refresh()}else{var e=this.get(a,!0);if(null==e)return!1;var f=!this.records[e]||this.records[e].recid!=a;f?$.extend(!0,this.summary[e],b):$.extend(!0,this.records[e],b),c!==!0&&this.refreshRow(a,e)}return!0},get:function(a,b){if($.isArray(a)){for(var c=[],d=0;d<this.records.length;d++)$.inArray(this.records[d].recid,a)!=-1&&(b===!0?c.push(d):c.push(this.records[d]));for(var d=0;d<this.summary.length;d++)$.inArray(this.summary[d].recid,a)!=-1&&(b===!0?c.push(d):c.push(this.summary[d]));return c}for(var d=0;d<this.records.length;d++)if(this.records[d].recid==a)return b===!0?d:this.records[d];for(var d=0;d<this.summary.length;d++)if(this.summary[d].recid==a)return b===!0?d:this.summary[d];return null},getFirst:function(){if(0==this.records.length)return null;var a=this.records[0].recid,b=this.last.searchIds;return Array.isArray(b)&&b.length>0&&(a=this.records[b[0]].recid),a},remove:function(){for(var a=0,b=0;b<arguments.length;b++){for(var c=this.records.length-1;c>=0;c--)this.records[c].recid==arguments[b]&&(this.records.splice(c,1),a++);for(var c=this.summary.length-1;c>=0;c--)this.summary[c].recid==arguments[b]&&(this.summary.splice(c,1),a++)}var d="object"!=typeof this.url?this.url:this.url.get;return d||(this.localSort(!1,!0),this.localSearch()),this.refresh(),a},addColumn:function(a,b){var c=0;1==arguments.length?(b=a,a=this.columns.length):("string"==typeof a&&(a=this.getColumn(a,!0)),null==a&&(a=this.columns.length)),$.isArray(b)||(b=[b]);for(var d=0;d<b.length;d++){if(this.columns.splice(a,0,b[d]),b[d].searchable){var e=b[d].searchable,f="";b[d].searchable===!0&&(e="text",f='size="20"'),this.addSearch({field:b[d].field,caption:b[d].caption,type:e,attr:f})}a++,c++}return this.refresh(),c},removeColumn:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.columns.length-1;c>=0;c--)this.columns[c].field==arguments[b]&&(this.columns[c].searchable&&this.removeSearch(arguments[b]),this.columns.splice(c,1),a++);return this.refresh(),a},getColumn:function(a,b){if(0===arguments.length){for(var c=[],d=0;d<this.columns.length;d++)c.push(this.columns[d].field);return c}for(var d=0;d<this.columns.length;d++)if(this.columns[d].field==a)return b===!0?d:this.columns[d];return null},toggleColumn:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.columns.length-1;c>=0;c--){var d=this.columns[c];d.field==arguments[b]&&(d.hidden=!d.hidden,a++)}return this.refreshBody(),this.resizeRecords(),a},showColumn:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.columns.length-1;c>=0;c--){var d=this.columns[c];d.gridMinWidth&&delete d.gridMinWidth,d.field==arguments[b]&&d.hidden!==!1&&(d.hidden=!1,a++)}return this.refreshBody(),this.resizeRecords(),a},hideColumn:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.columns.length-1;c>=0;c--){var d=this.columns[c];d.field==arguments[b]&&d.hidden!==!0&&(d.hidden=!0,a++)}return this.refreshBody(),this.resizeRecords(),a},addSearch:function(a,b){var c=0;1==arguments.length?(b=a,a=this.searches.length):("string"==typeof a&&(a=this.getSearch(a,!0)),null==a&&(a=this.searches.length)),$.isArray(b)||(b=[b]);for(var d=0;d<b.length;d++)this.searches.splice(a,0,b[d]),a++,c++;return this.searchClose(),c},removeSearch:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.searches.length-1;c>=0;c--)this.searches[c].field==arguments[b]&&(this.searches.splice(c,1),a++);return this.searchClose(),a},getSearch:function(a,b){if(0===arguments.length){for(var c=[],d=0;d<this.searches.length;d++)c.push(this.searches[d].field);return c}for(var d=0;d<this.searches.length;d++)if(this.searches[d].field==a)return b===!0?d:this.searches[d];return null},toggleSearch:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.searches.length-1;c>=0;c--)this.searches[c].field==arguments[b]&&(this.searches[c].hidden=!this.searches[c].hidden,a++);return this.searchClose(),a},showSearch:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.searches.length-1;c>=0;c--)this.searches[c].field==arguments[b]&&this.searches[c].hidden!==!1&&(this.searches[c].hidden=!1,a++);return this.searchClose(),a},hideSearch:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.searches.length-1;c>=0;c--)this.searches[c].field==arguments[b]&&this.searches[c].hidden!==!0&&(this.searches[c].hidden=!0,a++);return this.searchClose(),a},getSearchData:function(a){for(var b=0;b<this.searchData.length;b++)if(this.searchData[b].field==a)return this.searchData[b];return null},localSort:function(a,b){function h(){for(var a=0;a<e.records.length;a++){var b=e.records[a];b.w2ui&&null!=b.w2ui.parent_recid&&(b.w2ui._path=k(b))}}function i(){for(var a=0;a<e.records.length;a++){var b=e.records[a];b.w2ui&&null!=b.w2ui.parent_recid&&(b.w2ui._path=null)}}function j(a,b){if(!(a.w2ui&&null!=a.w2ui.parent_recid||b.w2ui&&null!=b.w2ui.parent_recid))return l(a,b);for(var c=k(a),d=k(b),e=0;e<Math.min(c.length,d.length);e++){var f=l(c[e],d[e]);if(0!==f)return f}return c.length>d.length?1:c.length<d.length?-1:(console.log("ERROR: two paths should not be equal."),0)}function k(a){if(!a.w2ui||null==a.w2ui.parent_recid)return[a];if(a.w2ui._path)return a.w2ui._path;var b=e.get(a.w2ui.parent_recid);return b?k(b).concat(a):(console.log("ERROR: no parent record: "+a.w2ui.parent_recid),[a])}function l(a,b){if(a===b)return 0;for(var c=0;c<e.sortData.length;c++){var d=e.sortData[c].field;e.sortData[c].field_&&(d=e.sortData[c].field_);var f=a[d],g=b[d];String(d).indexOf(".")!=-1&&(f=e.parseField(a,d),g=e.parseField(b,d));var h=e.getColumn(d);h&&null!=h.editable&&($.isPlainObject(f)&&f.text&&(f=f.text),$.isPlainObject(g)&&g.text&&(g=g.text));var i=m(f,g,c,e.sortData[c].direction);if(0!==i)return i}var i=m(a.recid,b.recid,-1,"asc");return 0!==i?i:0}function m(a,b,c,d){if(a===b)return 0;if((null==a||""===a)&&null!=b&&""!==b)return 1;if(null!=a&&""!==a&&(null==b||""===b))return-1;var e="asc"===d.toLowerCase()?1:-1;if(typeof a!=typeof b)return typeof a>typeof b?e:-e;if(a.constructor.name!=b.constructor.name)return a.constructor.name>b.constructor.name?e:-e;a&&"object"==typeof a&&(a=a.valueOf()),b&&"object"==typeof b&&(b=b.valueOf());var f={}.toString;return a&&"object"==typeof a&&a.toString!=f&&(a=String(a)),b&&"object"==typeof b&&b.toString!=f&&(b=String(b)),"string"==typeof a&&(a=$.trim(a.toLowerCase())),"string"==typeof b&&(b=$.trim(b.toLowerCase())),a>b?e:a<b?-e:0}var c="object"!=typeof this.url?this.url:this.url.get;if(c)return void console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty.");if(!$.isEmptyObject(this.sortData)){var d=(new Date).getTime(),e=this;e.selectionSave(),e.prepareData(),b||e.reset();for(var f=0;f<this.sortData.length;f++){var g=this.getColumn(this.sortData[f].field);if(!g)return;"string"==typeof g.render&&(["date","age"].indexOf(g.render.split(":")[0])!=-1&&(this.sortData[f].field_=g.field+"_"),["time"].indexOf(g.render.split(":")[0])!=-1&&(this.sortData[f].field_=g.field+"_"))}return h(),this.records.sort(function(a,b){return j(a,b)}),i(),e.selectionRestore(b),d=(new Date).getTime()-d,a!==!0&&e.show.statusSort&&setTimeout(function(){e.status(w2utils.lang("Sorting took")+" "+d/1e3+" "+w2utils.lang("sec"))},10),d}},localSearch:function(a){function j(a){for(var b=0,c=0;c<d.searchData.length;c++){var f=d.searchData[c],g=d.getSearch(f.field);if(null!=f){null==g&&(g={field:f.field,type:f.type});var h=d.parseField(a,g.field),i=null===h||void 0===h||"object"==typeof h&&h.toString==e?"":String(h).toLowerCase();if(null!=f.value)if($.isArray(f.value))var k=f.value[0],l=f.value[1];else var k=String(f.value).toLowerCase();switch(f.operator){case"is":if(d.parseField(a,g.field)==f.value)b++;else if("date"==g.type){var m=d.parseField(a,g.field+"_")instanceof Date?d.parseField(a,g.field+"_"):d.parseField(a,g.field),i=w2utils.formatDate(m,"yyyy-mm-dd"),k=w2utils.formatDate(w2utils.isDate(k,w2utils.settings.dateFormat,!0),"yyyy-mm-dd");i==k&&b++}else if("time"==g.type){var m=d.parseField(a,g.field+"_")instanceof Date?d.parseField(a,g.field+"_"):d.parseField(a,g.field),i=w2utils.formatTime(m,"hh24:mi"),k=w2utils.formatTime(k,"hh24:mi");i==k&&b++}else if("datetime"==g.type){var m=d.parseField(a,g.field+"_")instanceof Date?d.parseField(a,g.field+"_"):d.parseField(a,g.field),i=w2utils.formatDateTime(m,"yyyy-mm-dd|hh24:mm:ss"),k=w2utils.formatDateTime(w2utils.isDateTime(k,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss");i==k&&b++}break;case"between":if(["int","float","money","currency","percent"].indexOf(g.type)!=-1)parseFloat(d.parseField(a,g.field))>=parseFloat(k)&&parseFloat(d.parseField(a,g.field))<=parseFloat(l)&&b++;else if("date"==g.type){var m=d.parseField(a,g.field+"_")instanceof Date?d.parseField(a,g.field+"_"):d.parseField(a,g.field),i=w2utils.isDate(m,w2utils.settings.dateFormat,!0),k=w2utils.isDate(k,w2utils.settings.dateFormat,!0),l=w2utils.isDate(l,w2utils.settings.dateFormat,!0);null!=l&&(l=new Date(l.getTime()+864e5)),i>=k&&i<l&&b++}else if("time"==g.type){var i=d.parseField(a,g.field+"_")instanceof Date?d.parseField(a,g.field+"_"):d.parseField(a,g.field),k=w2utils.isTime(k,!0),l=w2utils.isTime(l,!0);k=(new Date).setHours(k.hours,k.minutes,k.seconds?k.seconds:0,0),l=(new Date).setHours(l.hours,l.minutes,l.seconds?l.seconds:0,0),i>=k&&i<l&&b++}else if("datetime"==g.type){var i=d.parseField(a,g.field+"_")instanceof Date?d.parseField(a,g.field+"_"):d.parseField(a,g.field),k=w2utils.isDateTime(k,w2utils.settings.datetimeFormat,!0),l=w2utils.isDateTime(l,w2utils.settings.datetimeFormat,!0);l&&(l=new Date(l.getTime()+864e5)),i>=k&&i<l&&b++}break;case"less":if(["int","float","money","currency","percent"].indexOf(g.type)!=-1)parseFloat(d.parseField(a,g.field))<=parseFloat(f.value)&&b++;else if("date"==g.type){var m=d.parseField(a,g.field+"_")instanceof Date?d.parseField(a,g.field+"_"):d.parseField(a,g.field),i=w2utils.formatDate(w2utils.isDate(m,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"),k=w2utils.formatDate(w2utils.isDate(k,w2utils.settings.dateFormat,!0),"yyyy-mm-dd");i<=k&&b++}else if("time"==g.type){var m=d.parseField(a,g.field+"_")instanceof Date?d.parseField(a,g.field+"_"):d.parseField(a,g.field),i=w2utils.formatTime(m,"hh24:mi"),k=w2utils.formatTime(k,"hh24:mi");i<=k&&b++}else if("datetime"==g.type){var m=d.parseField(a,g.field+"_")instanceof Date?d.parseField(a,g.field+"_"):d.parseField(a,g.field),i=w2utils.formatDateTime(m,"yyyy-mm-dd|hh24:mm:ss"),k=w2utils.formatDateTime(w2utils.isDateTime(k,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss");i.length==k.length&&i<=k&&b++}break;case"more":if(["int","float","money","currency","percent"].indexOf(g.type)!=-1)parseFloat(d.parseField(a,g.field))>=parseFloat(f.value)&&b++;else if("date"==g.type){var m=d.parseField(a,g.field+"_")instanceof Date?d.parseField(a,g.field+"_"):d.parseField(a,g.field),i=w2utils.formatDate(w2utils.isDate(m,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"),k=w2utils.formatDate(w2utils.isDate(k,w2utils.settings.dateFormat,!0),"yyyy-mm-dd");i>=k&&b++}else if("time"==g.type){var m=d.parseField(a,g.field+"_")instanceof Date?d.parseField(a,g.field+"_"):d.parseField(a,g.field),i=w2utils.formatTime(m,"hh24:mi"),k=w2utils.formatTime(k,"hh24:mi");i>=k&&b++}else if("datetime"==g.type){var m=d.parseField(a,g.field+"_")instanceof Date?d.parseField(a,g.field+"_"):d.parseField(a,g.field),i=w2utils.formatDateTime(m,"yyyy-mm-dd|hh24:mm:ss"),k=w2utils.formatDateTime(w2utils.isDateTime(k,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss");i.length==k.length&&i>=k&&b++}break;case"in":var m=f.value;f.svalue&&(m=f.svalue),m.indexOf(w2utils.isFloat(i)?parseFloat(i):i)!==-1&&b++,m.indexOf(w2utils.isFloat(h)?parseFloat(h):h)!==-1&&b++;break;case"not in":var m=f.value;f.svalue&&(m=f.svalue),m.indexOf(w2utils.isFloat(i)?parseFloat(i):i)==-1&&b++,m.indexOf(w2utils.isFloat(h)?parseFloat(h):h)==-1&&b++;break;case"begins":case"begins with":0===i.indexOf(k)&&b++;break;case"contains":i.indexOf(k)>=0&&b++;break;case"null":null==d.parseField(a,g.field)&&b++;break;case"not null":null!=d.parseField(a,g.field)&&b++;break;case"ends":case"ends with":var n=i.lastIndexOf(k);n!==-1&&n==i.length-k.length&&b++}}}if("OR"==d.last.logic&&0!==b||"AND"==d.last.logic&&b==d.searchData.length)return!0;if(a.w2ui&&a.w2ui.children&&a.w2ui.expanded!==!0)for(var o=0;o<a.w2ui.children.length;o++){var p=a.w2ui.children[o];if(j(p))return!0}return!1}function k(a){if(void 0!==a&&!f[a]){f[a]=!0;var b=d.get(a,!0);if(null!=b&&$.inArray(b,d.last.searchIds)==-1){var c=d.records[b];c&&c.w2ui&&k(c.w2ui.parent_recid),d.last.searchIds.push(b)}}}var b="object"!=typeof this.url?this.url:this.url.get;if(b)return void console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.");var c=(new Date).getTime(),d=this,e={}.toString,f={};if(this.total=this.records.length,this.last.searchIds=[],this.prepareData(),this.searchData.length>0&&!b){this.total=0;for(var g=0;g<this.records.length;g++){var h=this.records[g],i=j(h);i&&(h&&h.w2ui&&k(h.w2ui.parent_recid),this.last.searchIds.push(g))}this.total=this.last.searchIds.length}return c=(new Date).getTime()-c,a!==!0&&d.show.statusSearch&&setTimeout(function(){d.status(w2utils.lang("Search took")+" "+c/1e3+" "+w2utils.lang("sec"))},10),c},getRangeData:function(a,b){var c=this.get(a[0].recid,!0),d=this.get(a[1].recid,!0),e=a[0].column,f=a[1].column,g=[];if(e==f)for(var h=c;h<=d;h++){var i=this.records[h],j=i[this.columns[e].field]||null;b!==!0?g.push(j):g.push({data:j,column:e,index:h,record:i})}else if(c==d)for(var i=this.records[c],k=e;k<=f;k++){var j=i[this.columns[k].field]||null;b!==!0?g.push(j):g.push({data:j,column:k,index:c,record:i})}else for(var h=c;h<=d;h++){var i=this.records[h];g.push([]);for(var k=e;k<=f;k++){var j=i[this.columns[k].field];b!==!0?g[g.length-1].push(j):g[g.length-1].push({data:j,column:k,index:h,record:i})}}return g},addRange:function(a){var b=0;if("row"==this.selectType)return b;$.isArray(a)||(a=[a]);for(var c=0;c<a.length;c++){if("object"!=typeof a[c]&&(a[c]={name:"selection"}),"selection"==a[c].name){if(this.show.selectionBorder===!1)continue;var d=this.getSelection();if(0===d.length){this.removeRange("selection");continue}var e=d[0],f=d[d.length-1]}else var e=a[c].range[0],f=a[c].range[1];if(e){for(var g={name:a[c].name,range:[{recid:e.recid,column:e.column},{recid:f.recid,column:f.column}],style:a[c].style||""},h=!1,i=0;i<this.ranges.length;i++)if(this.ranges[i].name==a[c].name){h=i;break}h!==!1?this.ranges[h]=g:this.ranges.push(g),b++}}return this.refreshRanges(),b},removeRange:function(){for(var a=0,b=0;b<arguments.length;b++){var c=arguments[b];$("#grid_"+this.name+"_"+c).remove(),$("#grid_"+this.name+"_f"+c).remove();for(var d=this.ranges.length-1;d>=0;d--)this.ranges[d].name==c&&(this.ranges.splice(d,1),a++)}return a},refreshRanges:function(){function z(b){var c=a.getSelection();a.last.move={type:"expand",x:b.screenX,y:b.screenY,divX:0,divY:0,recid:c[0].recid,column:c[0].column,originalRange:[{recid:c[0].recid,column:c[0].column},{recid:c[c.length-1].recid,column:c[c.length-1].column}],newRange:[{recid:c[0].recid,column:c[0].column},{recid:c[c.length-1].recid,column:c[c.length-1].column}]},$(document).off(".w2ui-"+a.name).on("mousemove.w2ui-"+a.name,A).on("mouseup.w2ui-"+a.name,B),b.preventDefault()}function A(b){var c=a.last.move;if(c&&"expand"==c.type){c.divX=b.screenX-c.x,c.divY=b.screenY-c.y;var d,e,f=b.originalEvent.target;if("TD"!=f.tagName.toUpperCase()&&(f=$(f).parents("td")[0]),null!=$(f).attr("col")&&(e=parseInt($(f).attr("col"))),f=$(f).parents("tr")[0],d=$(f).attr("recid"),c.newRange[1].recid!=d||c.newRange[1].column!=e){var g=$.extend({},c.newRange);return c.newRange=[{recid:c.recid,column:c.column},{recid:d,column:e}],y=a.trigger($.extend(y,{originalRange:c.originalRange,newRange:c.newRange})),y.isCancelled===!0?(c.newRange=g,void(y.newRange=g)):(a.removeRange("grid-selection-expand"),void a.addRange({name:"grid-selection-expand",range:y.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"}))}}}function B(b){a.removeRange("grid-selection-expand"),delete a.last.move,$(document).off(".w2ui-"+a.name),a.trigger($.extend(y,{phase:"after"}))}if(0!==this.ranges.length){for(var a=this,b=(new Date).getTime(),c=$("#grid_"+this.name+"_frecords"),d=$("#grid_"+this.name+"_records"),e=0;e<this.ranges.length;e++){var f=this.ranges[e],g=f.range[0],h=f.range[1];null==g.index&&(g.index=this.get(g.recid,!0)),null==h.index&&(h.index=this.get(h.recid,!0));var i=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(g.recid)+' td[col="'+g.column+'"]'),j=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(h.recid)+' td[col="'+h.column+'"]'),k=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(g.recid)+' td[col="'+g.column+'"]'),l=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(h.recid)+' td[col="'+h.column+'"]'),m=h.column;g.column<this.last.colStart&&h.column>this.last.colStart&&(i=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(g.recid)+' td[col="start"]')),g.column<this.last.colEnd&&h.column>this.last.colEnd&&(m='"end"',j=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(h.recid)+' td[col="end"]'));var n=parseInt($("#grid_"+this.name+"_rec_top").next().attr("index")),o=parseInt($("#grid_"+this.name+"_rec_bottom").prev().attr("index")),p=parseInt($("#grid_"+this.name+"_frec_top").next().attr("index")),q=parseInt($("#grid_"+this.name+"_frec_bottom").prev().attr("index"));0===i.length&&g.index<n&&h.index>n&&(i=$("#grid_"+this.name+"_rec_top").next().find("td[col="+g.column+"]")),0===j.length&&h.index>o&&g.index<o&&(j=$("#grid_"+this.name+"_rec_bottom").prev().find("td[col="+m+"]")),0===k.length&&g.index<p&&h.index>p&&(k=$("#grid_"+this.name+"_frec_top").next().find("td[col="+g.column+"]")),0===l.length&&h.index>q&&g.index<q&&(l=$("#grid_"+this.name+"_frec_bottom").prev().find("td[col="+h.column+"]"));var r=$(this.box).find("#grid_"+this.name+"_editable"),s=r.find(".w2ui-input"),t=s.attr("recid"),u=s.attr("column");if("selection"!=f.name||f.range[0].recid!=t||f.range[0].column!=u){var v=$("#grid_"+this.name+"_f"+f.name);if(k.length>0||l.length>0)if(0===v.length?(c.append('<div id="grid_'+this.name+"_f"+f.name+'" class="w2ui-selection" style="'+f.style+'">'+("selection"==f.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),v=$("#grid_"+this.name+"_f"+f.name)):(v.attr("style",f.style),v.find(".w2ui-selection-resizer").show()),0===l.length&&(l=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(h.recid)+" td:last-child"),0===l.length&&(l=$("#grid_"+this.name+"_frec_bottom td:first-child")),v.css("border-right","0px"),v.find(".w2ui-selection-resizer").hide()),null!=g.recid&&null!=h.recid&&k.length>0&&l.length>0){var w=k.position().left-1+c.scrollLeft(),x=k.position().top-1+c.scrollTop();v.show().css({left:(w>0?w:0)+"px",top:(x>0?x:0)+"px",width:l.position().left-k.position().left+l.width()+3+"px",height:l.position().top-k.position().top+l.height()+3+"px"})}else v.hide();else v.hide();var v=$("#grid_"+this.name+"_"+f.name);if(i.length>0||j.length>0)if(0===v.length?(d.append('<div id="grid_'+this.name+"_"+f.name+'" class="w2ui-selection" style="'+f.style+'">'+("selection"==f.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),v=$("#grid_"+this.name+"_"+f.name)):v.attr("style",f.style),0===i.length&&(i=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(g.recid)+" td:first-child"),0===i.length&&(i=$("#grid_"+this.name+"_rec_top td:first-child"))),0!==l.length&&v.css("border-left","0px"),null!=g.recid&&null!=h.recid&&i.length>0&&j.length>0){var w=i.position().left-1+d.scrollLeft(),x=i.position().top-1+d.scrollTop();v.show().css({left:(w>0?w:0)+"px",top:(x>0?x:0)+"px",width:j.position().left-i.position().left+j.width()+3+"px",height:j.position().top-i.position().top+j.height()+3+"px"})}else v.hide();else v.hide()}}$(this.box).find(".w2ui-selection-resizer").off("mousedown").on("mousedown",z).off("dblclick").on("dblclick",function(b){var c=a.trigger({phase:"before",type:"resizerDblClick",target:a.name,originalEvent:b});c.isCancelled!==!0&&a.trigger($.extend(c,{phase:"after"}))});var y={phase:"before",type:"selectionExtend",target:a.name,originalRange:null,newRange:null};return(new Date).getTime()-b}},select:function(){if(0===arguments.length)return 0;var b=((new Date).getTime(),0),c=this.last.selection;this.multiSelect||this.selectNone();var d={phase:"before",type:"select",target:this.name};1==arguments.length?(d.multiple=!1,$.isPlainObject(arguments[0])?(d.recid=arguments[0].recid,d.column=arguments[0].column):d.recid=arguments[0]):(d.multiple=!0,d.recids=Array.prototype.slice.call(arguments,0));var e=this.trigger(d);if(e.isCancelled===!0)return 0;if("row"==this.selectType)for(var f=0;f<arguments.length;f++){var g="object"==typeof arguments[f]?arguments[f].recid:arguments[f],h=this.get(g,!0);if(null!=h){var i=null,j=null;if((0!==this.searchData.length||h+1>=this.last.range_start&&h+1<=this.last.range_end)&&(i=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(g)),j=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(g))),"row"==this.selectType){if(c.indexes.indexOf(h)!=-1)continue;c.indexes.push(h),i&&j&&(i.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),j.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),i.find(".w2ui-grid-select-check").prop("checked",!0)),b++}}}else{for(var k={},f=0;f<arguments.length;f++){var g="object"==typeof arguments[f]?arguments[f].recid:arguments[f],l="object"==typeof arguments[f]?arguments[f].column:null;if(k[g]=k[g]||[],$.isArray(l))k[g]=l;else if(w2utils.isInt(l))k[g].push(l);else for(var m=0;m<this.columns.length;m++)this.columns[m].hidden||k[g].push(parseInt(m))}var n=[];for(var g in k){var h=this.get(g,!0);if(null!=h){var i=null,j=null;h+1>=this.last.range_start&&h+1<=this.last.range_end&&(i=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(g)),j=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(g)));var o=c.columns[h]||[];c.indexes.indexOf(h)==-1&&c.indexes.push(h);for(var p=0;p<k[g].length;p++)o.indexOf(k[g][p])==-1&&o.push(k[g][p]);o.sort(function(a,b){return a-b});for(var p=0;p<k[g].length;p++){var q=k[g][p];n.indexOf(q)==-1&&n.push(q),i&&(i.find("#grid_"+this.name+"_data_"+h+"_"+q).addClass("w2ui-selected"),i.find(".w2ui-col-number").addClass("w2ui-row-selected"),i.data("selected","yes"),i.find(".w2ui-grid-select-check").prop("checked",!0)),j&&(j.find("#grid_"+this.name+"_data_"+h+"_"+q).addClass("w2ui-selected"),j.find(".w2ui-col-number").addClass("w2ui-row-selected"),j.data("selected","yes"),j.find(".w2ui-grid-select-check").prop("checked",!0)),b++}c.columns[h]=o}}for(var r=0;r<n.length;r++)$(this.box).find("#grid_"+this.name+"_column_"+n[r]+" .w2ui-col-header").addClass("w2ui-col-selected")}c.indexes.sort(function(a,b){return a-b});var s=this.records.length>0&&c.indexes.length==this.records.length,t=c.indexes.length>0&&0!==this.searchData.length&&c.indexes.length==this.last.searchIds.length;return s||t?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.trigger($.extend(e,{phase:"after"})),b},unselect:function(){for(var a=0,b=this.last.selection,c=0;c<arguments.length;c++){var d="object"==typeof arguments[c]?arguments[c].recid:arguments[c],e=this.get(d);if(null!=e){var f=this.get(e.recid,!0),g=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(d)),h=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(d));if("row"==this.selectType){if(b.indexes.indexOf(f)==-1)continue;var i=this.trigger({phase:"before",type:"unselect",target:this.name,recid:d,index:f});if(i.isCancelled===!0)continue;b.indexes.splice(b.indexes.indexOf(f),1),g.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),h.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),0!=g.length&&(g[0].style.cssText="height: "+this.recordHeight+"px; "+g.attr("custom_style"),h[0].style.cssText="height: "+this.recordHeight+"px; "+h.attr("custom_style")),g.find(".w2ui-grid-select-check").prop("checked",!1),a++}else{var j=arguments[c].column;if(!w2utils.isInt(j)){for(var k=[],l=0;l<this.columns.length;l++)this.columns[l].hidden||k.push({recid:d,column:l});return this.unselect.apply(this,k)}var m=b.columns[f];if(!$.isArray(m)||m.indexOf(j)==-1)continue;var i=this.trigger({phase:"before",type:"unselect",target:this.name,recid:d,column:j});if(i.isCancelled===!0)continue;m.splice(m.indexOf(j),1),$("#grid_"+this.name+"_rec_"+w2utils.escapeId(d)).find(" > td[col="+j+"]").removeClass("w2ui-selected w2ui-inactive"),$("#grid_"+this.name+"_frec_"+w2utils.escapeId(d)).find(" > td[col="+j+"]").removeClass("w2ui-selected w2ui-inactive");
for(var n=!1,o=!1,p=this.getSelection(),l=0;l<p.length;l++)p[l].column==j&&(n=!0),p[l].recid==d&&(o=!0);n||$(this.box).find(".w2ui-grid-columns td[col="+j+"] .w2ui-col-header, .w2ui-grid-fcolumns td[col="+j+"] .w2ui-col-header").removeClass("w2ui-col-selected"),o||$("#grid_"+this.name+"_frec_"+w2utils.escapeId(d)).find(".w2ui-col-number").removeClass("w2ui-row-selected"),a++,0===m.length&&(delete b.columns[f],b.indexes.splice(b.indexes.indexOf(f),1),g.removeData("selected"),g.find(".w2ui-grid-select-check").prop("checked",!1),h.removeData("selected"))}this.trigger($.extend(i,{phase:"after"}))}}var q=this.records.length>0&&b.indexes.length==this.records.length,r=b.indexes.length>0&&0!==this.searchData.length&&b.indexes.length==this.last.searchIds.length;return q||r?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),a},selectAll:function(){var a=(new Date).getTime();if(this.multiSelect!==!1){var b=this.trigger({phase:"before",type:"select",target:this.name,all:!0});if(b.isCancelled!==!0){for(var c="object"!=typeof this.url?this.url:this.url.get,d=this.last.selection,e=[],f=0;f<this.columns.length;f++)e.push(f);if(d.indexes=[],c||0===this.searchData.length){var g=this.records.length;0==this.searchData.length||c||(g=this.last.searchIds.length);for(var f=0;f<g;f++)d.indexes.push(f),"row"!=this.selectType&&(d.columns[f]=e.slice())}else for(var f=0;f<this.last.searchIds.length;f++)d.indexes.push(this.last.searchIds[f]),"row"!=this.selectType&&(d.columns[this.last.searchIds[f]]=e.slice());"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0)):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").addClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0));var d=this.getSelection();return 1==d.length?(this.toolbar.enable("w2ui-edit"),this.toolbar.enable("w2ui-open"),this.toolbar.enable("w2ui-reply")):(this.toolbar.disable("w2ui-edit"),this.toolbar.disable("w2ui-open"),this.toolbar.disable("w2ui-reply")),d.length>=1?(this.toolbar.enable("w2ui-delete"),this.toolbar.enable("w2ui-status")):(this.toolbar.disable("w2ui-delete"),this.toolbar.disable("w2ui-status")),this.addRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!0),this.trigger($.extend(b,{phase:"after"})),(new Date).getTime()-a}}},selectNone:function(){var a=(new Date).getTime(),b=this.trigger({phase:"before",type:"unselect",target:this.name,all:!0});if(b.isCancelled!==!0){var c=this.last.selection;return"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1)):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").removeClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-data.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1)),c.indexes=[],c.columns={},this.toolbar.disable("w2ui-edit","w2ui-delete","w2ui-status","w2ui-open","w2ui-reply"),this.removeRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!1),this.trigger($.extend(b,{phase:"after"})),(new Date).getTime()-a}},getSelection:function(a){var b=[],c=this.last.selection;if("row"==this.selectType){for(var d=0;d<c.indexes.length;d++)this.records[c.indexes[d]]&&(a===!0?b.push(c.indexes[d]):b.push(this.records[c.indexes[d]].recid));return b}for(var d=0;d<c.indexes.length;d++){var e=c.columns[c.indexes[d]];if(this.records[c.indexes[d]])for(var f=0;f<e.length;f++)b.push({recid:this.records[c.indexes[d]].recid,index:parseInt(c.indexes[d]),column:e[f]})}return b},search:function(a,b){for(var d="object"!=typeof this.url?this.url:this.url.get,e=[],f=this.last.multi,g=this.last.logic,h=this.last.field,i=this.last.search,j=!1,k=0;k<this.searches.length;k++)this.searches[k].hidden&&(e.push({field:this.searches[k].field,operator:this.searches[k].operator||"is",type:this.searches[k].type,value:this.searches[k].value||""}),j=!0);if(0===arguments.length){i="";for(var k=0;k<this.searches.length;k++){var l=this.searches[k],m=$("#grid_"+this.name+"_operator_"+k).val(),n=$("#grid_"+this.name+"_field_"+k),o=$("#grid_"+this.name+"_field2_"+k),p=n.val(),q=o.val(),r=null,s=null;if(["int","float","money","currency","percent"].indexOf(l.type)!=-1){var t=n.data("w2field"),u=o.data("w2field");t&&(p=t.clean(p)),u&&(q=u.clean(q))}if(["list","enum"].indexOf(l.type)!=-1)if(p=n.data("selected")||{},$.isArray(p)){r=[];for(var v=0;v<p.length;v++)r.push(w2utils.isFloat(p[v].id)?parseFloat(p[v].id):String(p[v].id).toLowerCase()),delete p[v].hidden;$.isEmptyObject(p)&&(p="")}else s=p.text||"",p=p.id||"";if(""!==p&&null!=p||null!=q&&""!==q){var w={field:l.field,type:l.type,operator:m};"between"==m?$.extend(w,{value:[p,q]}):"in"==m&&"string"==typeof p?$.extend(w,{value:p.split(",")}):"not in"==m&&"string"==typeof p?$.extend(w,{value:p.split(",")}):$.extend(w,{value:p}),r&&$.extend(w,{svalue:r}),s&&$.extend(w,{text:s});try{"date"==l.type&&"between"==m&&(w.value[0]=p,w.value[1]=q),"date"==l.type&&"is"==m&&(w.value=p)}catch(a){}e.push(w)}}f=!0,g="AND"}if("string"==typeof a&&(1==arguments.length&&(b=a,a="all"),h=a,i=b,f=!1,g=j?"AND":"OR",null!=b))if("all"==a.toLowerCase())if(this.searches.length>0)for(var k=0;k<this.searches.length;k++){var l=this.searches[k];if("text"==l.type||"alphanumeric"==l.type&&w2utils.isAlphaNumeric(b)||"int"==l.type&&w2utils.isInt(b)||"float"==l.type&&w2utils.isFloat(b)||"percent"==l.type&&w2utils.isFloat(b)||("hex"==l.type||"color"==l.type)&&w2utils.isHex(b)||"currency"==l.type&&w2utils.isMoney(b)||"money"==l.type&&w2utils.isMoney(b)||"date"==l.type&&w2utils.isDate(b)||"time"==l.type&&w2utils.isTime(b)||"datetime"==l.type&&w2utils.isDateTime(b)||"enum"==l.type&&w2utils.isAlphaNumeric(b)||"list"==l.type&&w2utils.isAlphaNumeric(b)){var w={field:l.field,type:l.type,operator:null!=l.operator?l.operator:"text"==l.type?this.textSearch:"is",value:b};""!=$.trim(b)&&e.push(w)}if(["int","float","money","currency","percent"].indexOf(l.type)!=-1&&2==$.trim(String(b)).split("-").length){var x=$.trim(String(b)).split("-"),w={field:l.field,type:l.type,operator:null!=l.operator?l.operator:"between",value:[x[0],x[1]]};e.push(w)}if(["list","enum"].indexOf(l.type)!=-1){for(var y=[],v=0;v<l.options.items;v++){var w=l.options.items[v];try{var z=new RegExp(b,"i");z.test(w)&&y.push(v),w.text&&z.test(w.text)&&y.push(w.id)}catch(a){}}if(y.length>0){var w={field:l.field,type:l.type,operator:null!=l.operator?l.operator:"in",value:y};e.push(w)}}}else for(var k=0;k<this.columns.length;k++){var w={field:this.columns[k].field,type:"text",operator:this.textSearch,value:b};e.push(w)}else{var A=$("#grid_"+this.name+"_search_all"),l=this.getSearch(a);if(null==l&&(l={field:a,type:"text"}),l.field==a&&(this.last.caption=l.caption),""!==b){var B=this.textSearch,C=b;if(["date","time","datetime"].indexOf(l.type)!=-1&&(B="less"),["list","enum"].indexOf(l.type)!=-1){B="is";var w=A.data("selected");C=w&&!$.isEmptyObject(w)?w.id:""}if("int"==l.type&&""!==b){if(B="is",String(b).indexOf("-")!=-1){var w=b.split("-");2==w.length&&(B="between",C=[parseInt(w[0]),parseInt(w[1])])}if(String(b).indexOf(",")!=-1){var w=b.split(",");B="in",C=[];for(var k=0;k<w.length;k++)C.push(w[k])}}null!=l.operator&&(B=l.operator);var w={field:l.field,type:l.type,operator:B,value:C};e.push(w)}}if($.isArray(a)){var D="AND";"string"==typeof b&&(D=b.toUpperCase(),"OR"!=D&&"AND"!=D&&(D="AND")),i="",f=!0,g=D;for(var k=0;k<a.length;k++){var E=a[k],l=this.getSearch(E.field);if(null==l&&(l={type:"text",operator:"begins"}),$.isArray(E.value))for(var v=0;v<E.value.length;v++)"string"==typeof E.value[v]&&(E.value[v]=E.value[v].toLowerCase());e.push($.extend(!0,{},l,E))}}var F=this.trigger({phase:"before",type:"search",multi:0===arguments.length,target:this.name,searchData:e,searchField:a?a:"multi",searchValue:a?b:"multi"});F.isCancelled!==!0&&(this.searchData=F.searchData,this.last.field=h,this.last.search=i,this.last.multi=f,this.last.logic=g,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),d?(this.last.xhr_offset=0,this.reload()):(this.localSearch(),this.refresh()),this.trigger($.extend(F,{phase:"after"})),this.selectNone())},searchOpen:function(){if(this.box&&0!==this.searches.length){var a=this,b=a.toolbar.get("w2ui-search-advanced"),c="#tb_"+a.toolbar.name+"_item_"+w2utils.escapeId(b.id)+" table.w2ui-button",d=this.trigger({phase:"before",type:"searchOpen",target:this.name});return d.isCancelled===!0?void setTimeout(function(){a.toolbar.uncheck("w2ui-search-advanced")},1):void $("#tb_"+this.name+"_toolbar_item_w2ui-search-advanced").w2overlay({html:this.getSearchesHTML(),name:this.name+"-searchOverlay",left:-10,class:"w2ui-grid-searches",onShow:function(){a.initSearches(),$("#w2ui-overlay-"+a.name+"-searchOverlay .w2ui-grid-searches").data("grid-name",a.name);var e=$("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]");e.length>0&&e[0].focus(),b.checked||(b.checked=!0,$(c).addClass("checked")),a.trigger($.extend(d,{phase:"after"}))},onHide:function(){b.checked=!1,$(c).removeClass("checked")}})}},searchClose:function(){this.box&&0!==this.searches.length&&(this.toolbar&&this.toolbar.uncheck("w2ui-search-advanced"),$().w2overlay({name:this.name+"-searchOverlay"}))},searchReset:function(a){for(var b=[],c=!1,d=0;d<this.searches.length;d++)this.searches[d].hidden&&(b.push({field:this.searches[d].field,operator:this.searches[d].operator||"is",type:this.searches[d].type,value:this.searches[d].value||""}),c=!0);var e=this.trigger({phase:"before",type:"search",reset:!0,target:this.name,searchData:b});if(e.isCancelled!==!0){if(this.searchData=e.searchData,this.last.search="",this.last.logic=c?"AND":"OR",this.searches.length>0)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.caption=w2utils.lang("All Fields");else{for(var f=0;f<this.searches.length&&(this.searches[f].hidden||this.searches[f].simple===!1);)f++;f>=this.searches.length?(this.last.field="",this.last.caption=""):(this.last.field=this.searches[f].field,this.last.caption=this.searches[f].caption)}this.last.multi=!1,this.last.xhr_offset=0,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),$("#grid_"+this.name+"_search_all").val("").removeData("selected"),a||this.reload(),this.trigger($.extend(e,{phase:"after"}))}},searchShowFields:function(){for(var a=this,b=$("#grid_"+this.name+"_search_all"),c='<div class="w2ui-select-field"><table><tbody>',d=-1;d<this.searches.length;d++){var e=this.searches[d];if(d==-1){if(!this.multiSearch||!this.show.searchAll)continue;e={field:"all",caption:w2utils.lang("All Fields")}}else if(this.searches[d].hidden===!0||this.searches[d].simple===!1)continue;c+="<tr "+(w2utils.isIOS?"onTouchStart":"onClick")+"=\"w2ui['"+this.name+"'].initAllField('"+e.field+"');      event.stopPropagation(); jQuery('#grid_"+this.name+"_search_all').w2overlay({ name: '"+this.name+'-searchFields\' });">   <td>       <span class="w2ui-column-check w2ui-icon-'+(e.field==this.last.field?"check":"empty")+'"></span>   </td>   <td>'+e.caption+"</td></tr>"}c+="</tbody></table></div>",setTimeout(function(){$(b).w2overlay({html:c,name:a.name+"-searchFields",left:-10})},1)},initAllField:function(a,b){var c=$("#grid_"+this.name+"_search_all");if("all"==a){var d={field:"all",caption:w2utils.lang("All Fields")};c.w2field("clear"),c.change()}else{var d=this.getSearch(a);if(null==d)return;var e=d.type;["enum","select"].indexOf(e)!=-1&&(e="list"),c.w2field(e,$.extend({},d.options,{suffix:"",autoFormat:!1,selected:b})),["list","enum","date","time","datetime"].indexOf(d.type)!=-1&&(this.last.search="",this.last.item="",c.val(""))}""!=this.last.search?(this.last.caption=d.caption,this.search(d.field,this.last.search)):(this.last.field=d.field,this.last.caption=d.caption),c.attr("placeholder",w2utils.lang(d.caption)),$().w2overlay({name:this.name+"-searchFields"})},clear:function(a){this.total=0,this.records=[],this.summary=[],this.last.xhr_offset=0,this.reset(!0),a||this.refresh()},reset:function(a){this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection={indexes:[],columns:{}},this.last.range_start=null,this.last.range_end=null,$("#grid_"+this.name+"_records").prop("scrollTop",0),a||this.refresh()},skip:function(a,b){var c="object"!=typeof this.url?this.url:this.url.get;c?(this.offset=parseInt(a),this.offset>this.total&&(this.offset=this.total-this.limit),(this.offset<0||!w2utils.isInt(this.offset))&&(this.offset=0),this.clear(!0),this.reload(b)):console.log("ERROR: grid.skip() can only be called when you have remote data source.")},load:function(a,b){return null==a?void console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.'):(this.clear(!0),void this.request("get",{},a,b))},reload:function(a){var b=this,c="object"!=typeof this.url?this.url:this.url.get;b.selectionSave(),c?this.load(c,function(){b.selectionRestore(),"function"==typeof a&&a()}):(this.reset(!0),this.localSearch(),this.selectionRestore(),"function"==typeof a&&a({status:"success"}))},request:function(a,b,c,d){if(null==b&&(b={}),""!=c&&null!=c||(c=this.url),""!=c&&null!=c){var e={};if(w2utils.isInt(this.offset)||(this.offset=0),w2utils.isInt(this.last.xhr_offset)||(this.last.xhr_offset=0),e.cmd=a,e.selected=this.getSelection(),e.limit=this.limit,e.offset=parseInt(this.offset)+parseInt(this.last.xhr_offset),e.search=this.searchData,e.searchLogic=this.last.logic,e.sort=this.sortData,0===this.searchData.length&&(delete e.search,delete e.searchLogic),0===this.sortData.length&&delete e.sort,$.extend(e,this.postData),$.extend(e,b),"get"==a){var f=this.trigger({phase:"before",type:"request",target:this.name,url:c,postData:e,httpHeaders:this.httpHeaders});if(f.isCancelled===!0)return void("function"==typeof d&&d({status:"error",message:"Request aborted."}))}else var f={url:c,postData:e,httpHeaders:this.httpHeaders};var g=this;if(0===this.last.xhr_offset)g.lock(w2utils.lang(g.msgRefresh),!0);else{var h=$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more");this.autoLoad===!0?h.show().find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'):h.find("td").html("<div>"+w2utils.lang("Load")+" "+g.limit+" "+w2utils.lang("More")+"...</div>")}if(this.last.xhr)try{this.last.xhr.abort()}catch(a){}if(c="object"!=typeof f.url?f.url:f.url.get,"save"==e.cmd&&"object"==typeof f.url&&(c=f.url.save),"delete"==e.cmd&&"object"==typeof f.url&&(c=f.url.remove),!$.isEmptyObject(g.routeData)){var i=w2utils.parseRoute(c);if(i.keys.length>0)for(var j=0;j<i.keys.length;j++)null!=g.routeData[i.keys[j].name]&&(c=c.replace(new RegExp(":"+i.keys[j].name,"g"),g.routeData[i.keys[j].name]))}var k={type:"POST",url:c,data:f.postData,headers:f.httpHeaders,dataType:"text"};"HTTP"==w2utils.settings.dataType&&(k.data="object"==typeof k.data?String($.param(k.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):k.data),"HTTPJSON"==w2utils.settings.dataType&&(k.data={request:JSON.stringify(k.data)}),"RESTFULL"==w2utils.settings.dataType&&(k.type="GET","save"==e.cmd&&(k.type="PUT"),"delete"==e.cmd&&(k.type="DELETE"),k.data="object"==typeof k.data?String($.param(k.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):k.data),"RESTFULLJSON"==w2utils.settings.dataType&&(k.type="GET","save"==e.cmd&&(k.type="PUT"),"delete"==e.cmd&&(k.type="DELETE"),k.data=JSON.stringify(k.data),k.contentType="application/json"),"JSON"==w2utils.settings.dataType&&(k.type="POST",k.data=JSON.stringify(k.data),k.contentType="application/json"),this.method&&(k.type=this.method),this.last.xhr_cmd=e.cmd,this.last.xhr_start=(new Date).getTime(),this.last.xhr=$.ajax(k).done(function(b,c,e){g.requestComplete(c,a,d)}).fail(function(b,c,e){var f={status:c,error:e,rawResponseText:b.responseText},h=g.trigger({phase:"before",type:"error",error:f,xhr:b});if(h.isCancelled!==!0){if("abort"!=c){var i;try{i=$.parseJSON(b.responseText)}catch(a){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",total:5,records:[{recid:1,field:"value"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof i?i:b.responseText),g.requestComplete("error",a,d)}g.trigger($.extend(h,{phase:"after"}))}}),"get"==a&&this.trigger($.extend(f,{phase:"after"}))}},requestComplete:function(status,cmd,callBack){var obj=this;this.unlock(),setTimeout(function(){obj.show.statusResponse&&obj.status(w2utils.lang("Server Response")+" "+((new Date).getTime()-obj.last.xhr_start)/1e3+" "+w2utils.lang("sec"))},10),this.last.pull_more=!1,this.last.pull_refresh=!0;var event_name="load";"save"==this.last.xhr_cmd&&(event_name="save"),"delete"==this.last.xhr_cmd&&(event_name="delete");var edata=this.trigger({phase:"before",target:this.name,type:event_name,xhr:this.last.xhr,status:status});if(edata.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));var data,responseText=this.last.xhr.responseText;if("error"!=status){if(null!=responseText&&""!=responseText){if("object"==typeof responseText)data=responseText;else if("function"==typeof obj.parser)data=obj.parser(responseText),"object"!=typeof data&&console.log("ERROR: Your parser did not return proper object");else try{eval("data = "+responseText)}catch(a){}if(null==data?data={status:"error",message:w2utils.lang(this.msgNotJSON),responseText:responseText}:Array.isArray(data)&&(data={status:"success",records:data}),obj.recid&&data.records)for(var i=0;i<data.records.length;i++)data.records[i].recid=data.records[i][obj.recid];if("error"==data.status)obj.error(data.message);else{if("get"==cmd){if(null==data.total&&(data.total=-1),data.records.length==this.limit?this.last.xhr_hasMore=!0:(this.last.xhr_hasMore=!1,this.total=this.last.xhr_offset+data.records.length),0===this.last.xhr_offset)this.records=[],this.summary=[],w2utils.isInt(data.total)&&(this.total=parseInt(data.total));else if(data.total!=-1&&parseInt(data.total)!=parseInt(this.total))return void this.message(w2utils.lang(this.msgNeedReload),function(){delete this.last.xhr_offset,this.reload()}.bind(this));if(data.records)for(var r=0;r<data.records.length;r++)this.records.push(data.records[r]);if(data.summary){this.summary=[];for(var r=0;r<data.summary.length;r++)this.summary.push(data.summary[r])}}if("delete"==cmd)return this.reset(),void this.reload()}}}else data={status:"error",message:w2utils.lang(this.msgAJAXerror),responseText:responseText},obj.error(w2utils.lang(this.msgAJAXerror));var url="object"!=typeof this.url?this.url:this.url.get;url||(this.localSort(),this.localSearch()),this.total=parseInt(this.total),0===this.last.xhr_offset?this.refresh():(this.scroll(),this.resize()),"function"==typeof callBack&&callBack(data),this.trigger($.extend(edata,{phase:"after"}))},error:function(a){var c=this.trigger({target:this.name,type:"error",message:a,xhr:this.last.xhr});return c.isCancelled===!0?void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})):(this.message(a),void this.trigger($.extend(c,{phase:"after"})))},getChanges:function(){for(var a=[],b=0;b<this.records.length;b++){var c=this.records[b];c.w2ui&&null!=c.w2ui.changes&&a.push($.extend(!0,{recid:c.recid},c.w2ui.changes))}return a},mergeChanges:function(){for(var changes=this.getChanges(),c=0;c<changes.length;c++){var record=this.get(changes[c].recid);for(var s in changes[c])if("recid"!=s){"object"==typeof changes[c][s]&&(changes[c][s]=changes[c][s].text);try{s.indexOf(".")!=-1?eval("record['"+s.replace(/\./g,"']['")+"'] = changes[c][s]"):record[s]=changes[c][s]}catch(a){console.log("ERROR: Cannot merge. ",a.message||"",a)}record.w2ui&&delete record.w2ui.changes}}this.refresh()},save:function(){var a=this,b=this.getChanges(),c=this.trigger({phase:"before",target:this.name,type:"save",changes:b});if(c.isCancelled!==!0){var d="object"!=typeof this.url?this.url:this.url.save;d?this.request("save",{changes:c.changes},null,function(b){"error"!==b.status&&a.mergeChanges(),a.trigger($.extend(c,{phase:"after"}))}):(this.mergeChanges(),this.trigger($.extend(c,{phase:"after"})))}},editField:function(a,b,c,d){function v(a){try{var b="DIV"==this.tagName.toUpperCase()?$(this).text():this.value,c=$("#grid_"+e.name+"_editable"),d="font-family: "+$(this).css("font-family")+"; font-size: "+$(this).css("font-size")+"; white-space: pre;",f=w2utils.getStrWidth(b,d);f+20>c.width()&&c.width(f+20)}catch(a){}}var e=this,f=e.get(a,!0),g=e.getCellEditable(f,b);if(g){var h=e.records[f],i=e.columns[b],j=i.frozen===!0?"_f":"_";if(["enum","file"].indexOf(g.type)!=-1)return void console.log('ERROR: input types "enum" and "file" are not supported in inline editing.');var k=e.trigger({phase:"before",type:"editField",target:e.name,recid:a,column:b,value:c,index:f,originalEvent:d});if(k.isCancelled!==!0&&(c=k.value,this.selectNone(),this.select({recid:a,column:b}),this.last.edit_col=b,["checkbox","check"].indexOf(g.type)==-1)){var l=$("#grid_"+e.name+j+"rec_"+w2utils.escapeId(a)),m=l.find("[col="+b+"] > div");$(this.box).find("div.w2ui-edit-box").remove(),"row"!=this.selectType&&($("#grid_"+this.name+j+"selection").attr("id","grid_"+this.name+"_editable").removeClass("w2ui-selection").addClass("w2ui-edit-box").prepend('<div style="position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;"></div>').find(".w2ui-selection-resizer").remove(),m=$("#grid_"+this.name+"_editable >div:first-child")),null==g.inTag&&(g.inTag=""),null==g.outTag&&(g.outTag=""),null==g.style&&(g.style=""),null==g.items&&(g.items=[]);var n=h.w2ui&&h.w2ui.changes&&null!=h.w2ui.changes[i.field]?w2utils.stripTags(h.w2ui.changes[i.field]):w2utils.stripTags(h[i.field]);null==n&&(n="");var o="object"!=typeof n?n:"";null!=k.old_value&&(o=k.old_value),null!=c&&(n=c);var p=null!=i.style?i.style+";":"";switch("string"==typeof i.render&&["number","int","float","money","percent","size"].indexOf(i.render.split(":")[0])!=-1&&(p+="text-align: right;"),g.items.length>0&&!$.isPlainObject(g.items[0])&&(g.items=w2obj.field.prototype.normMenu(g.items)),g.type){case"select":for(var q="",r=0;r<g.items.length;r++)q+='<option value="'+g.items[r].id+'"'+(g.items[r].id==n?' selected="selected"':"")+">"+g.items[r].text+"</option>";m.addClass("w2ui-editable").html('<select id="grid_'+e.name+"_edit_"+a+"_"+b+'" column="'+b+'" class="w2ui-input"    style="width: 100%; pointer-events: auto; padding: 0 0 0 3px; margin: 0px; border-left: 0; border-right: 0; border-radius: 0px;            outline: none; font-family: inherit;'+p+g.style+'"     field="'+i.field+'" recid="'+a+'"     '+g.inTag+">"+q+"</select>"+g.outTag),setTimeout(function(){m.find("select").on("change",function(a){delete e.last.move}).on("blur",function(a){1!=$(this).data("keep-open")&&e.editChange.call(e,this,f,b,a)})},10);break;case"div":var s=l.find("[col="+b+"] > div"),t="font-family: "+s.css("font-family")+"; font-size: "+s.css("font-size")+";";m.addClass("w2ui-editable").html('<div id="grid_'+e.name+"_edit_"+a+"_"+b+'" class="w2ui-input"    contenteditable style="'+t+p+g.style+'" autocorrect="off" autocomplete="off" spellcheck="false"     field="'+i.field+'" recid="'+a+'" column="'+b+'" '+g.inTag+"></div>"+g.outTag),null==c&&m.find("div.w2ui-input").text("object"!=typeof n?n:"");var u=m.find("div.w2ui-input").get(0);setTimeout(function(){var a=u;$(a).on("blur",function(c){1!=$(this).data("keep-open")&&e.editChange.call(e,a,f,b,c)})},10),null!=c&&$(u).text("object"!=typeof n?n:"");break;default:var s=l.find("[col="+b+"] > div"),t="font-family: "+s.css("font-family")+"; font-size: "+s.css("font-size");m.addClass("w2ui-editable").html('<input id="grid_'+e.name+"_edit_"+a+"_"+b+'" autocorrect="off" autocomplete="off" spellcheck="false" type="text"     style="'+t+"; width: 100%; height: 100%; padding: 3px; border-color: transparent; outline: none; border-radius: 0;        pointer-events: auto; "+p+g.style+'"     field="'+i.field+'" recid="'+a+'" column="'+b+'" class="w2ui-input"'+g.inTag+"/>"+g.outTag),"number"==g.type&&(n=w2utils.formatNumber(n)),"date"==g.type&&(n=w2utils.formatDate(w2utils.isDate(n,g.format,!0),g.format)),null==c&&m.find("input").val("object"!=typeof n?n:"");var u=m.find("input").get(0);$(u).w2field(g.type,$.extend(g,{selected:n})),setTimeout(function(){var a=u;"list"==g.type&&(a=$($(u).data("w2field").helpers.focus).find("input"),"object"!=typeof n&&""!=n&&a.val(n).css({opacity:1}).prev().css({opacity:1}),m.find("input").on("change",function(a){e.editChange.call(e,u,f,b,a)})),$(a).on("blur",function(a){1!=$(this).data("keep-open")&&e.editChange.call(e,u,f,b,a)})},10),null!=c&&$(u).val("object"!=typeof n?n:"")}setTimeout(function(){m.find("input, select, div.w2ui-input").data("old_value",o).on("mousedown",function(a){a.stopPropagation()}).on("click",function(a){"div"==g.type?v.call(m.find("div.w2ui-input")[0],null):v.call(m.find("input, select")[0],null)}).on("paste",function(a){var b=a.originalEvent;a.preventDefault();var c=b.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,c)}).on("keydown",function(c){var d=this,j="DIV"==d.tagName.toUpperCase()?$(d).text():$(d).val();switch(c.keyCode){case 8:"list"!=g.type||$(u).data("w2field")||c.preventDefault();break;case 9:case 13:c.preventDefault();break;case 37:0===w2utils.getCursorPosition(d)&&c.preventDefault();break;case 39:w2utils.getCursorPosition(d)==j.length&&(w2utils.setCursorPosition(d,j.length),c.preventDefault())}setTimeout(function(){switch(c.keyCode){case 9:var g=a,j=c.shiftKey?e.prevCell(f,b,!0):e.nextCell(f,b,!0);if(null==j){var k=c.shiftKey?e.prevRow(f,b):e.nextRow(f,b);if(null!=k&&k!=f){g=e.records[k].recid;for(var l=0;l<e.columns.length;l++){var m=e.getCellEditable(f,l);if(null!=m&&["checkbox","check"].indexOf(m.type)==-1&&(j=parseInt(l),!c.shiftKey))break}}}g===!1&&(g=a),null==j&&(j=b),d.blur(),setTimeout(function(){"row"!=e.selectType?(e.selectNone(),e.select({recid:g,column:j})):e.editField(g,j,null,c)},1),c.preventDefault&&c.preventDefault();break;case 13:d.blur();var n=c.shiftKey?e.prevRow(f,b):e.nextRow(f,b);null!=n&&n!=f&&setTimeout(function(){"row"!=e.selectType?(e.selectNone(),e.select({recid:e.records[n].recid,column:b})):e.editField(e.records[n].recid,b,null,c)},1),"DIV"==d.tagName.toUpperCase()&&c.preventDefault();break;case 27:var o=e.parseField(h,i.field);h.w2ui&&h.w2ui.changes&&null!=h.w2ui.changes[i.field]&&(o=h.w2ui.changes[i.field]),null!=$(d).data("old_value")&&(o=$(d).data("old_value")),"DIV"==d.tagName.toUpperCase()?$(d).text(null!=o?o:""):d.value=null!=o?o:"",d.blur(),setTimeout(function(){e.select({recid:a,column:b})},1)}v.call(d,c)},1)}).on("keyup",function(a){v.call(this,a)}),setTimeout(function(){var a=m.find(".w2ui-input"),b=$(a).val().length;"div"==g.type&&(b=$(a).text().length),a.length>0&&(a.focus(),clearTimeout(e.last.kbd_timer),"SELECT"!=a[0].tagName&&w2utils.setCursorPosition(a[0],b),a[0].resize=v,v.call(a[0],null))},50),e.trigger($.extend(k,{phase:"after",input:m.find("input, select, div.w2ui-input")}))},5)}}},editChange:function(a,b,c,d){var e=this;setTimeout(function(){var a=$(e.box).find("#grid_"+e.name+"_focus");a.is(":focus")||a.focus()},10);var f=b<0;b=b<0?-b-1:b;var g=f?this.summary:this.records,h=g[b],i=this.columns[c],j=$("#grid_"+this.name+(i.frozen===!0?"_frec_":"_rec_")+w2utils.escapeId(h.recid)),k=a.tagName&&"DIV"==a.tagName.toUpperCase()?$(a).text():a.value,l=this.parseField(h,i.field),m=$(a).data("w2field");m&&("list"==m.type&&(k=$(a).data("selected")),($.isEmptyObject(k)||null==k)&&(k=""),$.isPlainObject(k)||(k=m.clean(k))),"checkbox"==a.type&&(h.w2ui&&h.w2ui.editable===!1&&(a.checked=!a.checked),k=a.checked);var n={phase:"before",type:"change",target:this.name,input_id:a.id,recid:h.recid,index:b,column:c,originalEvent:d.originalEvent?d.originalEvent:d,value_new:k,value_previous:h.w2ui&&h.w2ui.changes&&h.w2ui.changes.hasOwnProperty(i.field)?h.w2ui.changes[i.field]:l,value_original:l};for(null!=$(d.target).data("old_value")&&(n.value_previous=$(d.target).data("old_value"));;){if(k=n.value_new,"object"!=typeof k&&String(l)!=String(k)||"object"==typeof k&&k.id!=l&&("object"!=typeof l||null==l||k.id!=l.id)){if(n=this.trigger($.extend(n,{type:"change",phase:"before"})),n.isCancelled!==!0){if(k!==n.value_new)continue;h.w2ui=h.w2ui||{},h.w2ui.changes=h.w2ui.changes||{},h.w2ui.changes[i.field]=n.value_new,this.trigger($.extend(n,{phase:"after"}))}}else if(n=this.trigger($.extend(n,{type:"restore",phase:"before"})),n.isCancelled!==!0){if(k!==n.value_new)continue;h.w2ui&&h.w2ui.changes&&delete h.w2ui.changes[i.field],h.w2ui&&$.isEmptyObject(h.w2ui.changes)&&delete h.w2ui.changes,this.trigger($.extend(n,{phase:"after"}))}break}var o=$(j).find("[col="+c+"]");f||(h.w2ui&&h.w2ui.changes&&null!=h.w2ui.changes[i.field]?o.addClass("w2ui-changed"):o.removeClass("w2ui-changed"),o.replaceWith(this.getCellHTML(b,c,f))),$(this.box).find("div.w2ui-edit-box").remove(),this.show.toolbarSave&&(this.getChanges().length>0?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save"))},delete:function(a){var c=((new Date).getTime(),this),d=this.trigger({phase:"before",target:this.name,type:"delete",force:a});if(d.isCancelled!==!0){a=d.force,setTimeout(function(){$().w2tag()},20);var e=this.getSelection();if(0!==e.length){if(""!=this.msgDelete&&!a)return void this.message({width:350,height:170,body:'<div class="w2ui-centered">'+w2utils.lang(c.msgDelete)+"</div>",buttons:'<button class="w2ui-btn w2ui-btn-red" onclick="w2ui[\''+this.name+"'].delete(true)\">"+w2utils.lang("Yes")+'</button><button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">"+w2utils.lang("No")+"</button>",onOpen:function(a){var b=$(this.box).find("input, textarea, select, button");b.off(".message").on("blur.message",function(a){b.index(a.target)+1===b.length&&(b.get(0).focus(),a.preventDefault())}).on("keydown.message",function(a){27==a.keyCode&&c.message()}),setTimeout(function(){$(this.box).find(".w2ui-btn:last-child").focus(),clearTimeout(c.last.kbd_timer)},25)}});this.message();var f="object"!=typeof this.url?this.url:this.url.remove;if(f)this.request("delete");else if("object"!=typeof e[0])this.selectNone(),this.remove.apply(this,e);else{for(var g=0;g<e.length;g++){var h=this.columns[e[g].column].field,i=this.get(e[g].recid,!0),j=this.records[i];null!=i&&"recid"!=h&&(this.records[i][h]="",
j.w2ui&&j.w2ui.changes&&delete j.w2ui.changes[h])}this.update()}this.trigger($.extend(d,{phase:"after"}))}}},click:function(a,b){var c=(new Date).getTime(),d=null,e=this;if(!(1==this.last.cancelClick||b&&b.altKey)){if("object"==typeof a&&null!==a&&(d=a.column,a=a.recid),null==b&&(b={}),c-parseInt(this.last.click_time)<350&&this.last.click_recid==a&&"click"==b.type)return void this.dblClick(a,b);this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null),this.last.click_time=c;var f=this.last.click_recid;if(this.last.click_recid=a,null==d&&b.target){var g=b.target;"TD"!=g.tagName.toUpperCase()&&(g=$(g).parents("td")[0]),null!=$(g).attr("col")&&(d=parseInt($(g).attr("col")))}var h=this.trigger({phase:"before",target:this.name,type:"click",recid:a,column:d,originalEvent:b});if(h.isCancelled!==!0){var e=this,i=this.getSelection();$("#grid_"+this.name+"_check_all").prop("checked",!1);var j=this.get(a,!0),l=(this.records[j],[]);if(e.last.sel_ind=j,e.last.sel_col=d,e.last.sel_recid=a,e.last.sel_type="click",b.shiftKey&&i.length>0&&e.multiSelect){if(i[0].recid){var m=this.get(i[0].recid,!0),n=this.get(a,!0);if(d>i[0].column)var o=i[0].column,p=d;else var o=d,p=i[0].column;for(var q=o;q<=p;q++)l.push(q)}else var m=this.get(f,!0),n=this.get(a,!0);var r=[];if(m>n){var g=m;m=n,n=g}for(var s="object"!=typeof this.url?this.url:this.url.get,t=m;t<=n;t++)if(!(this.searchData.length>0)||s||$.inArray(t,this.last.searchIds)!=-1)if("row"==this.selectType)r.push(this.records[t].recid);else for(var u=0;u<l.length;u++)r.push({recid:this.records[t].recid,column:l[u]});this.select.apply(this,r)}else{var v=this.last.selection,w=v.indexes.indexOf(j)!=-1,x=!1;if($(b.target).parents("td").hasClass("w2ui-col-select")&&(x=!0),(b.ctrlKey||b.shiftKey||b.metaKey||x)&&this.multiSelect||this.showSelectColumn){var y=$(b.target).parents("tr").find(".w2ui-grid-select-check").is(":checked");"row"==this.selectType||$.inArray(d,v.columns[j])!=-1||y||(w=!1),w===!0?this.unselect({recid:a,column:d}):this.select({recid:a,column:d})}else"row"!=this.selectType&&$.inArray(d,v.columns[j])==-1&&(w=!1),i.length>300?this.selectNone():this.unselect.apply(this,i),w===!0&&1==i.length?this.unselect({recid:a,column:d}):this.select({recid:a,column:d})}this.status(),e.initResize(),this.trigger($.extend(h,{phase:"after"}))}}},columnClick:function(a,b){var c=this.trigger({phase:"before",type:"columnClick",target:this.name,field:a,originalEvent:b});if(c.isCancelled!==!0){if("row"==this.selectType){var d=this.getColumn(a);d&&d.sortable&&this.sort(a,null,!(!b||!b.ctrlKey&&!b.metaKey)),"line-number"==c.field&&(this.getSelection().length>=this.records.length?this.selectNone():this.selectAll())}else if("line-number"==c.field)this.getSelection().length>=this.records.length?this.selectNone():this.selectAll();else{b.shiftKey||b.metaKey||b.ctrlKey||this.selectNone();var e=this.getSelection(),d=this.getColumn(c.field,!0),f=[],g=[];if(0!=e.length&&b.shiftKey){var h=d,i=e[0].column;h>i&&(h=e[0].column,i=d);for(var j=h;j<=i;j++)g.push(j)}else g.push(d);var c=this.trigger({phase:"before",type:"columnSelect",target:this.name,columns:g});if(c.isCancelled!==!0){for(var j=0;j<this.records.length;j++)f.push({recid:this.records[j].recid,column:g});this.select.apply(this,f)}this.trigger($.extend(c,{phase:"after"}))}this.trigger($.extend(c,{phase:"after"}))}},columnDblClick:function(a,b){var c=this.trigger({phase:"before",type:"columnDblClick",target:this.name,field:a,originalEvent:b});c.isCancelled!==!0&&this.trigger($.extend(c,{phase:"after"}))},focus:function(a){var b=this,c=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:a});return c.isCancelled!==!0&&(this.hasFocus=!0,$(this.box).find(".w2ui-inactive").removeClass("w2ui-inactive"),setTimeout(function(){var a=$(b.box).find("#grid_"+b.name+"_focus");a.is(":focus")||a.focus()},10),void this.trigger($.extend(c,{phase:"after"})))},blur:function(a){var b=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:a});return b.isCancelled!==!0&&(this.hasFocus=!1,$(this.box).find(".w2ui-selected").addClass("w2ui-inactive"),$(this.box).find(".w2ui-selection").addClass("w2ui-inactive"),void this.trigger($.extend(b,{phase:"after"})))},keydown:function(a){function B(){var a=Math.floor(f[0].scrollTop/b.recordHeight)+1;(!b.records[a]||a<2)&&(a=0),b.select({recid:b.records[a].recid,column:0})}function C(){if("click"!=b.last.sel_type)return!1;if("row"!=b.selectType){if(b.last.sel_type="key",g.length>1){for(var a=0;a<g.length;a++)if(g[a].recid==b.last.sel_recid&&g[a].column==b.last.sel_col){g.splice(a,1);break}return b.unselect.apply(b,g),!0}return!1}return b.last.sel_type="key",g.length>1&&(g.splice(g.indexOf(b.records[b.last.sel_ind].recid),1),b.unselect.apply(b,g),!0)}var b=this,c="object"!=typeof this.url?this.url:this.url.get;if(b.keyboard===!0){var d=b.trigger({phase:"before",type:"keydown",target:b.name,originalEvent:a});if(d.isCancelled!==!0){if($(this.box).find(">.w2ui-message").length>0)return void(27==a.keyCode&&this.message());var e=!1,f=$("#grid_"+b.name+"_records"),g=b.getSelection();0===g.length&&(e=!0);var h=g[0]||null,i=[],j=g[g.length-1];if("object"==typeof h&&null!=h){h=g[0].recid,i=[];for(var k=0;;){if(!g[k]||g[k].recid!=h)break;i.push(g[k].column),k++}j=g[g.length-1].recid}var l=b.get(h,!0),m=b.get(j,!0),o=(b.get(h),$("#grid_"+b.name+"_rec_"+(null!=l?w2utils.escapeId(b.records[l].recid):"none"))),p=!1,q=a.keyCode,r=a.shiftKey;switch(q){case 8:case 46:(this.show.toolbarDelete||this.onDelete)&&b.delete(),p=!0,a.stopPropagation();break;case 27:b.selectNone(),p=!0;break;case 65:if(!a.metaKey&&!a.ctrlKey)break;b.selectAll(),p=!0;break;case 13:if("row"==this.selectType&&b.show.expandColumn===!0){if(o.length<=0)break;b.toggle(h,a),p=!0}else{for(var s=0;s<this.columns.length;s++){var t=this.getCellEditable(l,s);if(t){i.push(parseInt(s));break}}"row"==this.selectType&&this.last.edit_col&&(i=[this.last.edit_col]),i.length>0&&(b.editField(h,i[0],null,a),p=!0)}break;case 37:if(e){B();break}if("row"==this.selectType){if(o.length<=0)break;var u=this.records[l].w2ui||{};!u||null==u.parent_recid||Array.isArray(u.children)&&0!==u.children.length&&u.expanded?b.collapse(h,a):(b.unselect(h),b.collapse(u.parent_recid,a),b.select(u.parent_recid))}else{var v=b.prevCell(l,i[0]);if(r||null!=v||(this.selectNone(),v=0),null!=v)if(r&&b.multiSelect){if(C())return;var u=[],w=[],x=[];if(0===i.indexOf(this.last.sel_col)&&i.length>1){for(var y=0;y<g.length;y++)u.indexOf(g[y].recid)==-1&&u.push(g[y].recid),x.push({recid:g[y].recid,column:i[i.length-1]});b.unselect.apply(b,x),b.scrollIntoView(l,i[i.length-1],!0)}else{for(var y=0;y<g.length;y++)u.indexOf(g[y].recid)==-1&&u.push(g[y].recid),w.push({recid:g[y].recid,column:v});b.select.apply(b,w),b.scrollIntoView(l,v,!0)}}else a.metaKey=!1,b.click({recid:h,column:v},a),b.scrollIntoView(l,v,!0);else if(!r)if(g.length>1)b.selectNone();else for(var z=1;z<g.length;z++)b.unselect(g[z])}p=!0;break;case 39:if(e){B();break}if("row"==this.selectType){if(o.length<=0)break;b.expand(h,a)}else{var A=b.nextCell(l,i[i.length-1]);if(r||null!=A||(this.selectNone(),A=this.columns.length-1),null!=A)if(r&&39==q&&b.multiSelect){if(C())return;var u=[],w=[],x=[];if(i.indexOf(this.last.sel_col)==i.length-1&&i.length>1){for(var y=0;y<g.length;y++)u.indexOf(g[y].recid)==-1&&u.push(g[y].recid),x.push({recid:g[y].recid,column:i[0]});b.unselect.apply(b,x),b.scrollIntoView(l,i[0],!0)}else{for(var y=0;y<g.length;y++)u.indexOf(g[y].recid)==-1&&u.push(g[y].recid),w.push({recid:g[y].recid,column:A});b.select.apply(b,w),b.scrollIntoView(l,A,!0)}}else a.metaKey=!1,b.click({recid:h,column:A},a),b.scrollIntoView(l,A,!0);else if(!r)if(g.length>1)b.selectNone();else for(var z=0;z<g.length-1;z++)b.unselect(g[z])}p=!0;break;case 38:if(e&&B(),o.length<=0)break;var v=b.prevRow(l,i[0]);if(r||null!=v||(v=0==this.searchData.length||c?0:this.last.searchIds[0]),null!=v){if(r&&b.multiSelect){if(C())return;if("row"==b.selectType)b.last.sel_ind>v&&b.last.sel_ind!=m?b.unselect(b.records[m].recid):b.select(b.records[v].recid);else if(b.last.sel_ind>v&&b.last.sel_ind!=m){v=m;for(var u=[],s=0;s<i.length;s++)u.push({recid:b.records[v].recid,column:i[s]});b.unselect.apply(b,u)}else{for(var u=[],s=0;s<i.length;s++)u.push({recid:b.records[v].recid,column:i[s]});b.select.apply(b,u)}}else g.length>300?this.selectNone():this.unselect.apply(this,g),b.click({recid:b.records[v].recid,column:i[0]},a);b.scrollIntoView(v),a.preventDefault&&a.preventDefault()}else if(!r)if(g.length>1)b.selectNone();else for(var z=1;z<g.length;z++)b.unselect(g[z]);break;case 40:if(e&&B(),o.length<=0)break;var A=b.nextRow(m,i[0]);if(r||null!=A||(A=0==this.searchData.length||c?this.records.length-1:this.last.searchIds[this.last.searchIds.length-1]),null!=A){if(r&&b.multiSelect){if(C())return;if("row"==b.selectType)this.last.sel_ind<A&&this.last.sel_ind!=l?b.unselect(b.records[l].recid):b.select(b.records[A].recid);else if(this.last.sel_ind<A&&this.last.sel_ind!=l){A=l;for(var u=[],s=0;s<i.length;s++)u.push({recid:b.records[A].recid,column:i[s]});b.unselect.apply(b,u)}else{for(var u=[],s=0;s<i.length;s++)u.push({recid:b.records[A].recid,column:i[s]});b.select.apply(b,u)}}else g.length>300?this.selectNone():this.unselect.apply(this,g),b.click({recid:b.records[A].recid,column:i[0]},a);b.scrollIntoView(A),p=!0}else if(!r)if(g.length>1)b.selectNone();else for(var z=0;z<g.length-1;z++)b.unselect(g[z]);break;case 17:case 91:if(e)break;b.last.isSafari&&(b.last.copy_event=b.copy(!1,a),$("#grid_"+b.name+"_focus").val(b.last.copy_event.text).select());break;case 67:(a.metaKey||a.ctrlKey)&&(b.last.isSafari?b.copy(b.last.copy_event,a):(b.last.copy_event=b.copy(!1,a),$("#grid_"+b.name+"_focus").val(b.last.copy_event.text).select(),b.copy(b.last.copy_event,a)));break;case 88:if(e)break;(a.ctrlKey||a.metaKey)&&(b.last.isSafari?b.copy(b.last.copy_event,a):(b.last.copy_event=b.copy(!1,a),$("#grid_"+b.name+"_focus").val(b.last.copy_event.text).select(),b.copy(b.last.copy_event,a)))}for(var u=[32,187,189,192,219,220,221,186,222,188,190,191],y=48;y<=111;y++)u.push(y);u.indexOf(q)==-1||a.ctrlKey||a.metaKey||p||(0===i.length&&i.push(0),p=!1,setTimeout(function(){var c=$("#grid_"+b.name+"_focus"),d=c.val();c.val(""),b.editField(h,i[0],d,a)},1)),p&&a.preventDefault&&a.preventDefault(),b.trigger($.extend(d,{phase:"after"}))}}},scrollIntoView:function(a,b,c){var d=this.records.length;if(0==this.searchData.length||this.url||(d=this.last.searchIds.length),0!==d){if(null==a){var e=this.getSelection();if(0===e.length)return;$.isPlainObject(e[0])?(a=e[0].index,b=e[0].column):a=this.get(e[0],!0)}var f=$("#grid_"+this.name+"_records"),g=this.last.searchIds.length;if(g>0&&(a=this.last.searchIds.indexOf(a)),f.height()<this.recordHeight*(g>0?g:d)&&f.length>0){var h=Math.floor(f[0].scrollTop/this.recordHeight),i=h+Math.floor(f.height()/this.recordHeight);a==h&&(c===!0?f.prop({scrollTop:f.scrollTop()-f.height()/1.3}):(f.stop(),f.animate({scrollTop:f.scrollTop()-f.height()/1.3},250,"linear"))),a==i&&(c===!0?f.prop({scrollTop:f.scrollTop()+f.height()/1.3}):(f.stop(),f.animate({scrollTop:f.scrollTop()+f.height()/1.3},250,"linear"))),(a<h||a>i)&&(c===!0?f.prop({scrollTop:(a-1)*this.recordHeight}):(f.stop(),f.animate({scrollTop:(a-1)*this.recordHeight},250,"linear")))}if(null!=b){for(var j=0,k=0,l=w2utils.scrollBarSize(),m=0;m<=b;m++){var n=this.columns[m];n.frozen||n.hidden||(j=k,k+=parseInt(n.sizeCalculated))}f.width()<k-f.scrollLeft()?c===!0?f.prop({scrollLeft:j-l}):f.animate({scrollLeft:j-l},250,"linear"):j<f.scrollLeft()&&(c===!0?f.prop({scrollLeft:k-f.width()+2*l}):f.animate({scrollLeft:k-f.width()+2*l},250,"linear"))}}},dblClick:function(a,b){var c=null;if("object"==typeof a&&null!==a&&(c=a.column,a=a.recid),null==b&&(b={}),null==c&&b.target){var d=b.target;"TD"!=d.tagName.toUpperCase()&&(d=$(d).parents("td")[0]),c=parseInt($(d).attr("col"))}var e=this.get(a,!0),f=this.records[e],g=this.trigger({phase:"before",target:this.name,type:"dblClick",recid:a,column:c,originalEvent:b});if(g.isCancelled!==!0){this.selectNone();var h=this.getCellEditable(e,c);h?this.editField(a,c,null,b):(this.select({recid:a,column:c}),(this.show.expandColumn||f.w2ui&&Array.isArray(f.w2ui.children))&&this.toggle(a)),this.trigger($.extend(g,{phase:"after"}))}},contextMenu:function(a,b,c){var d=this;if("text"!=d.last.userSelect){null==c&&(c={offsetX:0,offsetY:0,target:$("#grid_"+d.name+"_rec_"+a)[0]}),null==c.offsetX&&(c.offsetX=c.layerX-c.target.offsetLeft,c.offsetY=c.layerY-c.target.offsetTop),w2utils.isFloat(a)&&(a=parseFloat(a));var e=this.getSelection();if("row"==this.selectType)e.indexOf(a)==-1&&d.click(a);else{var f=$(c.target);"TD"!=f[0].tagName.toUpperCase()&&(f=$(c.target).parents("td"));var g=!1;b=f.attr("col");for(var h=0;h<e.length;h++)e[h].recid!=a&&e[h].column!=b||(g=!0);g||null==a||d.click({recid:a,column:b}),g||null==b||d.columnClick(this.columns[b].field,c)}var i=d.trigger({phase:"before",type:"contextMenu",target:d.name,originalEvent:c,recid:a,column:b});i.isCancelled!==!0&&(d.menu.length>0&&$(d.box).find(c.target).w2menu(d.menu,{originalEvent:c,contextMenu:!0,onSelect:function(b){d.menuClick(a,parseInt(b.index),b.originalEvent)}}),c.preventDefault&&c.preventDefault(),d.trigger($.extend(i,{phase:"after"})))}},menuClick:function(a,b,c){var d=this,e=d.trigger({phase:"before",type:"menuClick",target:d.name,originalEvent:c,recid:a,menuIndex:b,menuItem:d.menu[b]});e.isCancelled!==!0&&d.trigger($.extend(e,{phase:"after"}))},toggle:function(a){var b=this.get(a);return b.w2ui=b.w2ui||{},b.w2ui.expanded===!0?this.collapse(a):this.expand(a)},expand:function(a){var c=this.get(a,!0),d=this.records[c];d.w2ui=d.w2ui||{};var e=w2utils.escapeId(a),f=d.w2ui.children;if(Array.isArray(f)){if(d.w2ui.expanded===!0||0===f.length)return!1;var g=this.trigger({phase:"before",type:"expand",target:this.name,recid:a});if(g.isCancelled===!0)return!1;d.w2ui.expanded=!0,f.forEach(function(a){a.w2ui=a.w2ui||{},a.w2ui.parent_recid=d.recid,null==a.w2ui.children&&(a.w2ui.children=[])}),this.records.splice.apply(this.records,[c+1,0].concat(f)),this.total+=f.length;var h="object"!=typeof this.url?this.url:this.url.get;h||(this.localSort(!0,!0),this.searchData.length>0&&this.localSearch(!0)),this.refresh(),this.trigger($.extend(g,{phase:"after"}))}else{if($("#grid_"+this.name+"_rec_"+e+"_expanded_row").length>0||this.show.expandColumn!==!0)return!1;if("none"==d.w2ui.expanded)return!1;$("#grid_"+this.name+"_rec_"+e).after('<tr id="grid_'+this.name+"_rec_"+a+'_expanded_row" class="w2ui-expanded-row">    <td colspan="100" class="w2ui-expanded2">        <div id="grid_'+this.name+"_rec_"+a+'_expanded"></div>    </td>    <td class="w2ui-grid-data-last"></td></tr>'),$("#grid_"+this.name+"_frec_"+e).after('<tr id="grid_'+this.name+"_frec_"+a+'_expanded_row" class="w2ui-expanded-row">'+(this.show.lineNumbers?'<td class="w2ui-col-number"></td>':"")+'    <td class="w2ui-grid-data w2ui-expanded1" colspan="100">       <div id="grid_'+this.name+"_frec_"+a+'_expanded"></div>   </td></tr>');var g=this.trigger({phase:"before",type:"expand",target:this.name,recid:a,box_id:"grid_"+this.name+"_rec_"+a+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+e+"_expanded"});if(g.isCancelled===!0)return $("#grid_"+this.name+"_rec_"+e+"_expanded_row").remove(),$("#grid_"+this.name+"_frec_"+e+"_expanded_row").remove(),!1;var i=$(this.box).find("#grid_"+this.name+"_rec_"+a+"_expanded"),j=$(this.box).find("#grid_"+this.name+"_frec_"+a+"_expanded"),k=i.find("> div:first-child").height();i.height()<k&&i.css({height:k+"px"}),j.height()<k&&j.css({height:k+"px"}),$("#grid_"+this.name+"_rec_"+e).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+e).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(a,!0)+"_expand div").html("-"),d.w2ui.expanded=!0,this.trigger($.extend(g,{phase:"after"})),this.resizeRecords()}return!0},collapse:function(a){function m(a){a.w2ui.expanded=!1;for(var b=0;b<a.w2ui.children.length;b++){var c=a.w2ui.children[b];c.w2ui.expanded&&m(c)}}var b=this,c=this.get(a,!0),d=this.records[c];d.w2ui=d.w2ui||{};var e=w2utils.escapeId(a),f=d.w2ui.children;if(Array.isArray(f)){if(d.w2ui.expanded!==!0)return!1;var g=this.trigger({phase:"before",type:"collapse",target:this.name,recid:a});if(g.isCancelled===!0)return!1;m(d);for(var h=[],i=d;null!=i;i=this.get(i.w2ui.parent_recid))h.push(i.w2ui.parent_recid);for(var j=c+1,k=j;;){if(this.records.length<=k+1||null==this.records[k+1].w2ui||h.indexOf(this.records[k+1].w2ui.parent_recid)>=0)break;k++}this.records.splice(j,k-j+1),this.total-=k-j+1;var l="object"!=typeof this.url?this.url:this.url.get;l||this.searchData.length>0&&this.localSearch(!0),this.refresh(),b.trigger($.extend(g,{phase:"after"}))}else{if(0===$("#grid_"+this.name+"_rec_"+e+"_expanded_row").length||this.show.expandColumn!==!0)return!1;var g=this.trigger({phase:"before",type:"collapse",target:this.name,recid:a,box_id:"grid_"+this.name+"_rec_"+e+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+e+"_expanded"});if(g.isCancelled===!0)return!1;$("#grid_"+this.name+"_rec_"+e).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+e).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(a,!0)+"_expand div").html("+"),$("#grid_"+b.name+"_rec_"+e+"_expanded").css("height","0px"),$("#grid_"+b.name+"_frec_"+e+"_expanded").css("height","0px"),setTimeout(function(){$("#grid_"+b.name+"_rec_"+e+"_expanded_row").remove(),$("#grid_"+b.name+"_frec_"+e+"_expanded_row").remove(),d.w2ui.expanded=!1,b.trigger($.extend(g,{phase:"after"})),b.resizeRecords()},300)}return!0},sort:function(a,b,c){var d=this.trigger({phase:"before",type:"sort",target:this.name,field:a,direction:b,multiField:c});if(d.isCancelled!==!0){if(null!=a){for(var e=this.sortData.length,f=0;f<this.sortData.length;f++)if(this.sortData[f].field==a){e=f;break}if(null==b)if(null==this.sortData[e])b="asc";else switch(null==this.sortData[e].direction&&(this.sortData[e].direction=""),this.sortData[e].direction.toLowerCase()){case"asc":b="desc";break;case"desc":b="asc";break;default:b="asc"}this.multiSort===!1&&(this.sortData=[],e=0),1!=c&&(this.sortData=[],e=0),null==this.sortData[e]&&(this.sortData[e]={}),this.sortData[e].field=a,this.sortData[e].direction=b}else this.sortData=[];var g="object"!=typeof this.url?this.url:this.url.get;g?(this.trigger($.extend(d,{phase:"after"})),this.last.xhr_offset=0,this.reload()):(this.localSort(!0,!0),this.searchData.length>0&&this.localSearch(!0),this.last.scrollTop=0,$("#grid_"+this.name+"_records").prop("scrollTop",0),this.trigger($.extend(d,{phase:"after"})),this.refresh())}},copy:function(a,b){if($.isPlainObject(a))return this.trigger($.extend(a,{phase:"after"})),a.text;var c=this.getSelection();if(0===c.length)return"";var d="";if("object"==typeof c[0]){for(var e=c[0].column,f=c[0].column,g=[],h=0;h<c.length;h++)c[h].column<e&&(e=c[h].column),c[h].column>f&&(f=c[h].column),g.indexOf(c[h].index)==-1&&g.push(c[h].index);g.sort(function(a,b){return a-b});for(var i=0;i<g.length;i++){for(var j=g[i],k=e;k<=f;k++){var l=this.columns[k];l.hidden!==!0&&(d+=w2utils.stripTags(this.getCellHTML(j,k))+"\t")}d=d.substr(0,d.length-1),d+="\n"}}else{for(var k=0;k<this.columns.length;k++){var l=this.columns[k];if(l.hidden!==!0){var m=l.caption?l.caption:l.field;l.caption&&l.caption.length<3&&l.tooltip&&(m=l.tooltip),d+='"'+w2utils.stripTags(m)+'"\t'}}d=d.substr(0,d.length-1),d+="\n";for(var h=0;h<c.length;h++){for(var j=this.get(c[h],!0),k=0;k<this.columns.length;k++){var l=this.columns[k];l.hidden!==!0&&(d+='"'+w2utils.stripTags(this.getCellHTML(j,k))+'"\t')}d=d.substr(0,d.length-1),d+="\n"}}if(d=d.substr(0,d.length-1),null==a){var n=this.trigger({phase:"before",type:"copy",target:this.name,text:d,cut:88==b.keyCode,originalEvent:b});return n.isCancelled===!0?"":(d=n.text,this.trigger($.extend(n,{phase:"after"})),d)}if(a===!1){var n=this.trigger({phase:"before",type:"copy",target:this.name,text:d,cut:88==b.keyCode,originalEvent:b});return n.isCancelled===!0?"":(d=n.text,n)}},paste:function(a){var b=this.getSelection(),c=this.get(b[0].recid,!0),d=b[0].column,e=this.trigger({phase:"before",type:"paste",target:this.name,text:a,index:c,column:d});if(e.isCancelled!==!0){if(a=e.text,"row"==this.selectType||0===b.length)return console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected."),void this.trigger($.extend(e,{phase:"after"}));for(var f=[],a=a.split("\n"),g=0;g<a.length;g++){var h=a[g].split("\t"),i=0,j=this.records[c],k=[];if(null!=j){for(var l=0;l<h.length;l++)if(this.columns[d+i]){var m=this.columns[d+i].field;j.w2ui=j.w2ui||{},j.w2ui.changes=j.w2ui.changes||{},j.w2ui.changes[m]=h[l],k.push(d+i),i++}for(var n=0;n<k.length;n++)f.push({recid:j.recid,column:k[n]});c++}}this.selectNone(),this.select.apply(this,f),this.refresh(),this.trigger($.extend(e,{phase:"after"}))}},resize:function(){var a=this,b=(new Date).getTime();if(this.box&&$(this.box).attr("name")==this.name){$(this.box).find("> div.w2ui-grid-box").css("width",$(this.box).width()).css("height",$(this.box).height());var c=this.trigger({phase:"before",type:"resize",target:this.name});if(c.isCancelled!==!0)return a.resizeBoxes(),a.resizeRecords(),a.toolbar&&a.toolbar.resize&&a.toolbar.resize(),this.trigger($.extend(c,{phase:"after"})),(new Date).getTime()-b}},update:function(a){var b=(new Date).getTime();if(null==this.box)return 0;if(null==a){for(var c=this.last.range_start-1;c<=this.last.range_end-1;c++)if(!(c<0)){var d=this.records[c]||{};d.w2ui||(d.w2ui={});for(var e=0;e<this.columns.length;e++){var f=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(d.recid)),g=$(this.box).find("#grid_"+this.name+"_data_"+c+"_"+e);g.replaceWith(this.getCellHTML(c,e,!1)),g=$(this.box).find("#grid_"+this.name+"_data_"+c+"_"+e),null==d.w2ui.style||$.isEmptyObject(d.w2ui.style)?g.attr("style",""):("string"==typeof d.w2ui.style&&f.attr("style",d.w2ui.style),$.isPlainObject(d.w2ui.style)&&"string"==typeof d.w2ui.style[e]&&g.attr("style",d.w2ui.style[e])),null==d.w2ui.class||$.isEmptyObject(d.w2ui.class)||("string"==typeof d.w2ui.class&&f.addClass(d.w2ui.class),$.isPlainObject(d.w2ui.class)&&"string"==typeof d.w2ui.class[e]&&g.addClass(d.w2ui.class[e]))}}}else for(var h=0;h<a.length;h++){var c=a[h].index,e=a[h].column;if(!(c<0))if(null!=c&&null!=e){var d=this.records[c]||{},f=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(d.recid)),g=$(this.box).find("#grid_"+this.name+"_data_"+c+"_"+e);d.w2ui||(d.w2ui={}),g.replaceWith(this.getCellHTML(c,e,!1)),g=$(this.box).find("#grid_"+this.name+"_data_"+c+"_"+e),null==d.w2ui.style||$.isEmptyObject(d.w2ui.style)?g.attr("style",""):("string"==typeof d.w2ui.style&&f.attr("style",d.w2ui.style),$.isPlainObject(d.w2ui.style)&&"string"==typeof d.w2ui.style[e]&&g.attr("style",d.w2ui.style[e])),null==d.w2ui.class||$.isEmptyObject(d.w2ui.class)||("string"==typeof d.w2ui.class&&f.addClass(d.w2ui.class),$.isPlainObject(d.w2ui.class)&&"string"==typeof d.w2ui.class[e]&&g.addClass(d.w2ui.class[e]))}else console.log("ERROR: Wrong argument for grid.update(cells), cells should be [{ index: X, column: Y }, ...]")}return(new Date).getTime()-b},refreshCell:function(a,b){var c=this.get(a,!0),d=!this.records[c]||this.records[c].recid!=a,e=this.getColumn(b,!0),f=d?this.summary[c]:this.records[c],g=this.columns[e],h=$(this.box).find("#grid_"+this.name+"_data_"+c+"_"+e);return null!=f&&(h.replaceWith(this.getCellHTML(c,e,d)),h=$(this.box).find("#grid_"+this.name+"_data_"+c+"_"+e),f.w2ui&&f.w2ui.changes&&null!=f.w2ui.changes[g.field]?h.addClass("w2ui-changed"):h.removeClass("w2ui-changed"),f.w2ui&&null!=f.w2ui.style&&!$.isEmptyObject(f.w2ui.style)?("string"==typeof f.w2ui.style&&$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(f.recid)).attr("style",f.w2ui.style),$.isPlainObject(f.w2ui.style)&&"string"==typeof f.w2ui.style[e]&&h.attr("style",f.w2ui.style[e])):h.attr("style",""),void(f.w2ui&&null!=f.w2ui.class&&!$.isEmptyObject(f.w2ui.class)&&("string"==typeof f.w2ui.class&&$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(f.recid)).addClass(f.w2ui.class),$.isPlainObject(f.w2ui.class)&&"string"==typeof f.w2ui.class[e]&&h.addClass(f.w2ui.class[e]))))},refreshRow:function(a,b){var c=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(a)),d=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(a));if(c.length>0){null==b&&(b=this.get(a,!0));var e=c.attr("line"),f=!this.records[b]||this.records[b].recid!=a,g="object"!=typeof this.url?this.url:this.url.get;if(this.searchData.length>0&&!g)for(var h=0;h<this.last.searchIds.length;h++)this.last.searchIds[h]==b&&(b=h);var i=this.getRecordHTML(b,e,f);$(c).replaceWith(i[0]),$(d).replaceWith(i[1]);var j=this.records[b].w2ui?this.records[b].w2ui.style:"";if("string"==typeof j){var c=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(a)),d=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(a));c.attr("custom_style",j),d.attr("custom_style",j),c.hasClass("w2ui-selected")&&(j=j.replace("background-color","none")),c[0].style.cssText="height: "+this.recordHeight+"px;"+j,d[0].style.cssText="height: "+this.recordHeight+"px;"+j}f&&this.resize()}},refresh:function(){var a=this,b=(new Date).getTime(),c="object"!=typeof this.url?this.url:this.url.get;if(this.total<=0&&!c&&0===this.searchData.length&&(this.total=this.records.length),this.toolbar.disable("w2ui-edit","w2ui-delete","w2ui-status","w2ui-open","w2ui-reply"),this.box){var d=this.trigger({phase:"before",target:this.name,type:"refresh"});if(d.isCancelled!==!0){if(this.show.header?$("#grid_"+this.name+"_header").html(this.header+"&#160;").show():$("#grid_"+this.name+"_header").hide(),this.show.toolbar){if(this.toolbar&&this.toolbar.get("w2ui-column-on-off")&&this.toolbar.get("w2ui-column-on-off").checked);else if($("#grid_"+this.name+"_toolbar").show(),"object"==typeof this.toolbar)for(var e=this.toolbar.items,f=0;f<e.length;f++)"w2ui-search"!=e[f].id&&"break"!=e[f].type&&this.toolbar.refresh(e[f].id)}else $("#grid_"+this.name+"_toolbar").hide();this.searchClose();var g=$("#grid_"+a.name+"_search_all");!this.multiSearch&&"all"==this.last.field&&this.searches.length>0&&(this.last.field=this.searches[0].field,this.last.caption=this.searches[0].caption);for(var h=0;h<this.searches.length;h++)this.searches[h].field==this.last.field&&(this.last.caption=this.searches[h].caption);if(this.last.multi?(g.attr("placeholder","["+w2utils.lang("Multiple Fields")+"]"),g.w2field("clear")):g.attr("placeholder",w2utils.lang(this.last.caption)),g.val()!=this.last.search){var i=this.last.search,e=g.data("w2field");e&&(i=e.format(i)),g.val(i)}a.refreshBody(),this.show.footer?$("#grid_"+this.name+"_footer").html(this.getFooterHTML()).show():$("#grid_"+this.name+"_footer").hide();var j=$("#grid_"+this.name+"_searchClear");j.hide(),this.searchData.some(function(b){var c=a.getSearch(b.field);if(a.last.multi||c&&!c.hidden&&"list"!=c.type)return j.show(),!0});var k=this.last.selection,l=this.records.length>0&&k.indexes.length==this.records.length,m=k.indexes.length>0&&0!==this.searchData.length&&k.indexes.length==this.last.searchIds.length;l||m?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status();for(var n=a.find({"w2ui.expanded":!0},!0),o=0;o<n.length;o++){var e=a.records[n[o]].w2ui;e&&!Array.isArray(e.children)&&(e.expanded=!1)}return a.markSearch&&setTimeout(function(){for(var b=[],c=0;c<a.searchData.length;c++){var d=a.searchData[c],e=a.getSearch(d.field);e&&!e.hidden&&b.indexOf(d.value)==-1&&b.push(d.value)}b.length>0&&$(a.box).find(".w2ui-grid-data > div").w2marker(b)},50),this.show.toolbarSave&&(this.getChanges().length>0?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save")),this.trigger($.extend(d,{phase:"after"})),a.resize(),a.addRange("selection"),setTimeout(function(){a.resize(),a.scroll()},1),a.reorderColumns&&!a.last.columnDrag?a.last.columnDrag=a.initColumnDrag():!a.reorderColumns&&a.last.columnDrag&&a.last.columnDrag.remove(),(new Date).getTime()-b}}},refreshBody:function(){var a=this.find({"w2ui.summary":!0},!0);if(a.length>0){for(var b=0;b<a.length;b++)this.summary.push(this.records[a[b]]);for(var b=a.length-1;b>=0;b--)this.records.splice(a[b],1)}this.scroll();var c=this.getRecordsHTML(),d=this.getColumnsHTML(),e='<div id="grid_'+this.name+'_frecords" class="w2ui-grid-frecords" style="margin-bottom: '+(w2utils.scrollBarSize()-1)+'px;">'+c[0]+'</div><div id="grid_'+this.name+'_records" class="w2ui-grid-records" onscroll="w2ui[\''+this.name+"'].scroll(event);\">"+c[1]+'</div><div id="grid_'+this.name+'_scroll1" class="w2ui-grid-scroll1" style="height: '+w2utils.scrollBarSize()+'px"></div><div id="grid_'+this.name+'_fcolumns" class="w2ui-grid-fcolumns">    <table><tbody>'+d[0]+'</tbody></table></div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">    <table><tbody>'+d[1]+"</tbody></table></div>";if($("#grid_"+this.name+"_body").html(e),0===this.records.length&&this.msgEmpty?$("#grid_"+this.name+"_body").append('<div id="grid_'+this.name+'_empty_msg" class="w2ui-grid-empty-msg"><div>'+this.msgEmpty+"</div></div>"):$("#grid_"+this.name+"_empty_msg").length>0&&$("#grid_"+this.name+"_empty_msg").remove(),this.summary.length>0){var f=this.getSummaryHTML();$("#grid_"+this.name+"_fsummary").html(f[0]).show(),$("#grid_"+this.name+"_summary").html(f[1]).show()}else $("#grid_"+this.name+"_fsummary").hide(),$("#grid_"+this.name+"_summary").hide()},render:function(a){function k(a){if(1==a.which&&("text"==b.last.userSelect&&(delete b.last.userSelect,$(b.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","none"))),!("row"==b.selectType&&($(a.target).parents().hasClass("w2ui-head")||$(a.target).hasClass("w2ui-head"))||b.last.move&&"expand"==b.last.move.type))){if(a.altKey)$(b.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","text")),b.selectNone(),b.last.move={type:"text-select"},b.last.userSelect="text";else{for(var c=a.target,d={x:a.offsetX-10,y:a.offsetY-10},e=!1;c&&(!c.classList||!c.classList.contains("w2ui-grid"));)c.tagName&&"TD"==c.tagName.toUpperCase()&&(e=!0),c.tagName&&"TR"!=c.tagName.toUpperCase()&&1==e&&(d.x+=c.offsetLeft,d.y+=c.offsetTop),c=c.parentNode;b.last.move={x:a.screenX,y:a.screenY,divX:0,divY:0,focusX:d.x,focusY:d.y,recid:$(a.target).parents("tr").attr("recid"),column:parseInt("TD"==a.target.tagName.toUpperCase()?$(a.target).attr("col"):$(a.target).parents("td").attr("col")),type:"select",ghost:!1,start:!0},null==b.last.move.recid&&(b.last.move.type="select-column");var f=a.target,g=$(b.box).find("#grid_"+b.name+"_focus");if(b.last.move){var h=b.last.move.focusX,i=b.last.move.focusY,j=$(f).parents("table").parent();(j.hasClass("w2ui-grid-records")||j.hasClass("w2ui-grid-frecords")||j.hasClass("w2ui-grid-columns")||j.hasClass("w2ui-grid-fcolumns")||j.hasClass("w2ui-grid-summary"))&&(h=b.last.move.focusX-$(b.box).find("#grid_"+b.name+"_records").scrollLeft(),i=b.last.move.focusY-$(b.box).find("#grid_"+b.name+"_records").scrollTop()),($(f).hasClass("w2ui-grid-footer")||$(f).parents("div.w2ui-grid-footer").length>0)&&(i=$(b.box).find("#grid_"+b.name+"_footer").position().top),g.css({left:h-10,top:i})}setTimeout(function(){["INPUT","TEXTAREA","SELECT"].indexOf(f.tagName.toUpperCase())!=-1?$(f).focus():g.is(":focus")||g.focus()},50),b.multiSelect||b.reorderRows||"drag"!=b.last.move.type||delete b.last.move}if(1==b.reorderRows){var k=a.target;if("TD"!=k.tagName.toUpperCase()&&(k=$(k).parents("td")[0]),$(k).hasClass("w2ui-col-number")){b.selectNone(),b.last.move.reorder=!0;var n=$(b.box).find(".w2ui-even.w2ui-empty-record").css("background-color"),o=$(b.box).find(".w2ui-odd.w2ui-empty-record").css("background-color");$(b.box).find(".w2ui-even td").not(".w2ui-col-number").css("background-color",n),$(b.box).find(".w2ui-odd td").not(".w2ui-col-number").css("background-color",o);var p=b.last.move;
if(!p.ghost){var q=$("#grid_"+b.name+"_rec_"+p.recid),c=q.parents("table").find("tr:first-child").clone();p.offsetY=a.offsetY,p.from=p.recid,p.pos=q.position(),p.ghost=$(q).clone(!0),p.ghost.removeAttr("id"),q.find("td").remove(),q.append('<td colspan="1000" style="height: '+b.recordHeight+'px; background-color: #eee; border-bottom: 1px dashed #aaa; border-top: 1px dashed #aaa;"></td>');var r=$(b.box).find(".w2ui-grid-records");r.append('<table id="grid_'+b.name+'_ghost" style="position: absolute; z-index: 999999; opacity: 0.7; pointer-events: none;"></table>'),$("#grid_"+b.name+"_ghost").append(c).append(p.ghost)}var s=$("#grid_"+b.name+"_ghost"),r=$(b.box).find(".w2ui-grid-records");s.css({top:p.pos.top+r.scrollTop(),left:p.pos.left,"border-top":"1px solid #aaa","border-bottom":"1px solid #aaa"})}else b.last.move.reorder=!1}$(document).on("mousemove.w2ui-"+b.name,l).on("mouseup.w2ui-"+b.name,m),a.stopPropagation()}}function l(a){var c=b.last.move;if(c&&["select","select-column"].indexOf(c.type)!=-1&&(c.divX=a.screenX-c.x,c.divY=a.screenY-c.y,!(Math.abs(c.divX)<=1&&Math.abs(c.divY)<=1))){if(b.last.cancelClick=!0,1==b.reorderRows&&b.last.move.reorder){var d=$(a.target).parents("tr"),e=d.attr("recid");if(e!=c.from){var g=($("#grid_"+b.name+"_rec_"+c.recid),$("#grid_"+b.name+"_rec_"+e));$(b.box).find(".tmp-ghost").css("border-top","0px"),g.addClass("tmp-ghost").css("border-top","2px solid #769EFC"),c.lastY=a.screenY,c.to=e}var h=$("#grid_"+b.name+"_ghost"),i=$(b.box).find(".w2ui-grid-records");return void h.css({top:c.pos.top+c.divY+i.scrollTop(),left:c.pos.left})}c.start&&c.recid&&(b.selectNone(),c.start=!1);var k=[],e="TR"==a.target.tagName.toUpperCase()?$(a.target).attr("recid"):$(a.target).parents("tr").attr("recid");if(null==e){if("row"==b.selectType)return;if(b.last.move&&"select"==b.last.move.type)return;var l=parseInt($(a.target).parents("td").attr("col"));if(isNaN(l))b.removeRange("column-selection"),$(b.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected"),$(b.box).find(".w2ui-col-number").removeClass("w2ui-row-selected"),delete c.colRange;else{var m=l+"-"+l;c.column<l&&(m=c.column+"-"+l),c.column>l&&(m=l+"-"+c.column);for(var n=[],d=m.split("-"),o=parseInt(d[0]);o<=parseInt(d[1]);o++)n.push(o);if(c.colRange!=m&&(j=b.trigger({phase:"before",type:"columnSelect",target:b.name,columns:n,isCancelled:!1}),j.isCancelled!==!0)){null==c.colRange&&b.selectNone();var d=m.split("-");$(b.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected");for(var p=parseInt(d[0]);p<=parseInt(d[1]);p++)$(b.box).find("#grid_"+b.name+"_column_"+p+" .w2ui-col-header").addClass("w2ui-col-selected");$(b.box).find(".w2ui-col-number").not(".w2ui-head").addClass("w2ui-row-selected"),c.colRange=m,b.removeRange("column-selection"),b.addRange({name:"column-selection",range:[{recid:b.records[0].recid,column:d[0]},{recid:b.records[b.records.length-1].recid,column:d[1]}],style:"background-color: rgba(90, 145, 234, 0.1)"})}}}else{var q=b.get(c.recid,!0);if(null==q||b.records[q]&&b.records[q].recid!=c.recid)return;var r=b.get(e,!0);if(null==r)return;var s=parseInt(c.column),t=parseInt("TD"==a.target.tagName.toUpperCase()?$(a.target).attr("col"):$(a.target).parents("td").attr("col"));if(isNaN(s)&&isNaN(t)&&(s=0,t=b.columns.length-1),q>r){var d=q;q=r,r=d}var d="ind1:"+q+",ind2;"+r+",col1:"+s+",col2:"+t;if(c.range==d)return;c.range=d;for(var u=q;u<=r;u++)if(!(b.last.searchIds.length>0&&b.last.searchIds.indexOf(u)==-1))if("row"!=b.selectType){if(s>t){var d=s;s=t,t=d}for(var d=[],v=s;v<=t;v++)b.columns[v].hidden||k.push({recid:b.records[u].recid,column:parseInt(v)})}else k.push(b.records[u].recid);if("row"!=b.selectType){for(var w=b.getSelection(),d=[],x=0;x<k.length;x++){for(var y=!1,z=0;z<w.length;z++)k[x].recid==w[z].recid&&k[x].column==w[z].column&&(y=!0);y||d.push({recid:k[x].recid,column:k[x].column})}b.select.apply(b,d);for(var d=[],z=0;z<w.length;z++){for(var y=!1,x=0;x<k.length;x++)k[x].recid==w[z].recid&&k[x].column==w[z].column&&(y=!0);y||d.push({recid:w[z].recid,column:w[z].column})}b.unselect.apply(b,d)}else if(b.multiSelect){for(var w=b.getSelection(),x=0;x<k.length;x++)w.indexOf(k[x])==-1&&b.select(k[x]);for(var z=0;z<w.length;z++)k.indexOf(w[z])==-1&&b.unselect(w[z])}}}}function m(a){var c=b.last.move;if(setTimeout(function(){delete b.last.cancelClick},1),!$(a.target).parents().hasClass(".w2ui-head")&&!$(a.target).hasClass(".w2ui-head")){if(c&&["select","select-column"].indexOf(c.type)!=-1){if(null!=c.colRange&&j.isCancelled!==!0){for(var d=c.colRange.split("-"),e=[],f=0;f<b.records.length;f++){for(var g=[],h=parseInt(d[0]);h<=parseInt(d[1]);h++)g.push(h);e.push({recid:b.records[f].recid,column:g})}b.removeRange("column-selection"),b.trigger($.extend(j,{phase:"after"})),b.select.apply(b,e)}if(1==b.reorderRows&&b.last.move.reorder){var i=b.trigger({phase:"before",target:b.name,type:"reorderRow",recid:c.from,moveAfter:c.to});if(i.isCancelled===!0)return $("#grid_"+b.name+"_ghost").remove(),void b.refresh();var k=b.get(c.from,!0),l=b.get(c.to,!0),d=b.records[k];null!=k&&null!=l&&(b.records.splice(k,1),k>l?b.records.splice(l,0,d):b.records.splice(l-1,0,d)),$("#grid_"+b.name+"_ghost").remove(),b.refresh(),b.trigger($.extend(i,{phase:"after"}))}}delete b.last.move,$(document).off(".w2ui-"+b.name)}}var b=this,c=(new Date).getTime();if(null!=a&&($(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),this.box=a),this.box){var d="object"!=typeof this.url?this.url:this.url.get,e=this.trigger({phase:"before",target:this.name,type:"render",box:a});if(e.isCancelled!==!0){if(this.reset(!0),!this.last.field)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.caption=w2utils.lang("All Fields");else{for(var f=0;f<this.searches.length&&(this.searches[f].hidden||this.searches[f].simple===!1);)f++;f>=this.searches.length?(this.last.field="",this.last.caption=""):(this.last.field=this.searches[f].field,this.last.caption=this.searches[f].caption)}if($(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid").html('<div class="w2ui-grid-box">    <div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>    <div id="grid_'+this.name+'_toolbar" class="w2ui-grid-toolbar"></div>    <div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>    <div id="grid_'+this.name+'_fsummary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div>    <textarea id="grid_'+this.name+'_focus" class="w2ui-grid-focus-input"></textarea></div>'),"row"!=this.selectType&&$(this.box).addClass("w2ui-ss"),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),this.initToolbar(),null!=this.toolbar&&this.toolbar.render($("#grid_"+this.name+"_toolbar")[0]),this.last.field&&"all"!=this.last.field){var g=this.searchData;setTimeout(function(){b.initAllField(b.last.field,1==g.length?g[0].value:null)},1)}$("#grid_"+this.name+"_footer").html(this.getFooterHTML()),this.last.state||(this.last.state=this.stateSave(!0)),this.stateRestore(),d&&this.refresh();for(var h=!1,i=0;i<this.searches.length;i++)if(this.searches[i].hidden){h=!0;break}h?(this.searchReset(!1),d||setTimeout(function(){b.searchReset()},1)):this.reload(),$(this.box).find("#grid_"+this.name+"_focus").on("focus",function(a){clearTimeout(b.last.kbd_timer),b.hasFocus||b.focus()}).on("blur",function(a){clearTimeout(b.last.kbd_timer),b.last.kbd_timer=setTimeout(function(){b.hasFocus&&b.blur()},100)}).on("paste",function(a){var c=this;setTimeout(function(){w2ui[b.name].paste(c.value),c.value=""},1)}).on("keydown",function(a){w2ui[b.name].keydown.call(w2ui[b.name],a)});var j;return $(this.box).on("mousedown",k),this.trigger($.extend(e,{phase:"after"})),0===$(".w2ui-layout").length&&$(window).off("resize.w2ui-"+this.name).on("resize.w2ui-"+this.name,function(a){w2ui[b.name].resize()}),(new Date).getTime()-c}}},destroy:function(){var a=this.trigger({phase:"before",target:this.name,type:"destroy"});a.isCancelled!==!0&&($(window).off("resize.w2ui-"+this.name),"object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),$(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),delete w2ui[this.name],this.trigger($.extend(a,{phase:"after"})))},initColumnOnOff:function(){if(this.show.toolbarColumns){for(var a=this,b='<div class="w2ui-col-on-off"><table><tbody><tr id="grid_'+this.name+'_column_ln_check" onclick="w2ui[\''+a.name+'\'].columnOnOff(event, \'line-numbers\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(a.show.lineNumbers?"check":"empty")+'"></span>   </td>   <td onclick="jQuery(\'.w2ui-overlay\')[0].hide();">      <label>'+w2utils.lang("Line #")+"</label>   </td></tr>",c=0;c<this.columns.length;c++){var d=this.columns[c],e=this.columns[c].caption;d.hideable!==!1&&(!e&&this.columns[c].tooltip&&(e=this.columns[c].tooltip),e||(e="- column "+(parseInt(c)+1)+" -"),b+='<tr id="grid_'+this.name+"_column_"+c+'_check"        onclick="w2ui[\''+a.name+"'].columnOnOff(event, '"+d.field+'\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(d.hidden?"empty":"check")+'"></span>   </td>   <td onclick="jQuery(\'.w2ui-overlay\')[0].hide();">       <label>'+w2utils.stripTags(e)+"</label>   </td></tr>")}var f="object"!=typeof this.url?this.url:this.url.get;(f&&a.show.skipRecords||a.show.saveRestoreState)&&(b+='<tr style="pointer-events: none"><td colspan="2"><div style="border-top: 1px solid #ddd;"></div></td></tr>'),f&&a.show.skipRecords&&(b+='<tr><td colspan="2" style="padding: 0px">    <div style="cursor: pointer; padding: 2px 8px; cursor: default">'+w2utils.lang("Skip")+'        <input type="text" style="width: 60px" value="'+this.offset+'"             onkeydown="if ([48,49,50,51,52,53,54,55,56,57,58,13,8,46,37,39].indexOf(event.keyCode) == -1) { event.preventDefault() }"            onkeypress="if (event.keyCode == 13) {                w2ui[\''+a.name+"'].skip(this.value);                jQuery('.w2ui-overlay')[0].hide();             }\"/> "+w2utils.lang("Records")+"    </div></td></tr>"),a.show.saveRestoreState&&(b+='<tr><td colspan="2" onclick="var obj = w2ui[\''+a.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateSave();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Save Grid State")+'</div></td></tr><tr><td colspan="2" onclick="var obj = w2ui[\''+a.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateReset();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Restore Default State")+"</div></td></tr>"),b+="</tbody></table></div>",this.toolbar.get("w2ui-column-on-off").html=b}},initColumnDrag:function(a){function d(){c.pressed=!1,clearTimeout(c.timeout)}function e(a){c.timeout&&clearTimeout(c.timeout);var d=this;c.pressed=!0,c.timeout=setTimeout(function(){if(c.pressed){var e,h,i,j,k,l=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"],m=["w2ui-head-last"],n=l.concat(m),o=".w2ui-col-number, .w2ui-col-expand, .w2ui-col-select",p=".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select";if($(a.originalEvent.target).parents().hasClass("w2ui-head")){for(var q=0,r=n.length;q<r;q++)if($(a.originalEvent.target).parents().hasClass(n[q]))return;if(c.numberPreColumnsPresent=$(b.box).find(p).length,c.columnHead=j=$(a.originalEvent.target).parents(".w2ui-head"),k=parseInt(j.attr("col"),10),e=b.trigger({type:"columnDragStart",phase:"before",originalEvent:a,origColumnNumber:k,target:j[0]}),e.isCancelled===!0)return!1;h=c.columns=$(b.box).find(".w2ui-head:not(.w2ui-head-last)"),$(document).on("mouseup",g),$(document).on("mousemove",f),c.originalPos=parseInt($(a.originalEvent.target).parent(".w2ui-head").attr("col"),10),c.ghost=$(d).clone(!0),$(c.ghost).find('[col]:not([col="'+c.originalPos+'"]), .w2ui-toolbar, .w2ui-grid-header').remove(),$(c.ghost).find(o).remove(),$(c.ghost).find(".w2ui-grid-body").css({top:0}),i=$(c.ghost).find('[col="'+c.originalPos+'"]'),$(document.body).append(c.ghost),$(c.ghost).css({width:0,height:0,margin:0,position:"fixed",zIndex:999999,opacity:0}).addClass(".w2ui-grid-ghost").animate({width:i.width(),height:$(b.box).find(".w2ui-grid-body:first").height(),left:a.pageX,top:a.pageY,opacity:.8},0),c.offsets=[];for(var q=0,r=h.length;q<r;q++)c.offsets.push($(h[q]).offset().left);b.trigger($.extend(e,{phase:"after"}))}}},150)}function f(a){if(c.pressed){var b=a.originalEvent.pageX,d=a.originalEvent.pageY,e=c.offsets,f=$(".w2ui-head:not(.w2ui-head-last)").width();c.targetInt=Math.max(c.numberPreColumnsPresent,i(b,e,f)),h(c.targetInt),j(b,d)}}function g(a){c.pressed=!1;var d,e,h,i,j,k=$(".w2ui-grid-ghost");return d=b.trigger({type:"columnDragEnd",phase:"before",originalEvent:a,target:c.columnHead[0]}),d.isCancelled!==!0&&(h=b.columns[c.originalPos],i=b.columns,j=$(c.columns[Math.min(c.lastInt,c.columns.length-1)]),e=c.lastInt<c.columns.length?parseInt(j.attr("col")):i.length,e!==c.originalPos+1&&e!==c.originalPos&&j&&j.length?($(c.ghost).animate({top:$(b.box).offset().top,left:j.offset().left,width:0,height:0,opacity:.2},300,function(){$(this).remove(),k.remove()}),i.splice(e,0,$.extend({},h)),i.splice(i.indexOf(h),1)):($(c.ghost).remove(),k.remove()),$(document).off("mouseup",g),$(document).off("mousemove",f),c.marker&&c.marker.remove(),c={},b.refresh(),void b.trigger($.extend(d,{phase:"after",targetColumnNumber:e-1})))}function h(a){c.marker||c.markerLeft||(c.marker=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'),c.markerLeft=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>')),c.lastInt&&c.lastInt===a||(c.lastInt=a,c.marker.remove(),c.markerLeft.remove(),$(".w2ui-head").removeClass("w2ui-col-intersection"),a>=c.columns.length?($(c.columns[c.columns.length-1]).children("div:last").append(c.marker.addClass("right").removeClass("left")),$(c.columns[c.columns.length-1]).addClass("w2ui-col-intersection")):a<=c.numberPreColumnsPresent?($(c.columns[c.numberPreColumnsPresent]).prepend(c.marker.addClass("left").removeClass("right")).css({position:"relative"}),$(c.columns[c.numberPreColumnsPresent]).prev().addClass("w2ui-col-intersection")):($(c.columns[a]).children("div:last").prepend(c.marker.addClass("left").removeClass("right")),$(c.columns[a]).prev().children("div:last").append(c.markerLeft.addClass("right").removeClass("left")).css({position:"relative"}),$(c.columns[a-1]).addClass("w2ui-col-intersection")))}function i(a,b,c){if(a<=b[0])return 0;if(a>=b[b.length-1]+c)return b.length;for(var d=0,e=b.length;d<e;d++){var f=b[d],g=b[d+1]||b[d]+c,h=(g-b[d])/2+b[d];if(a>f&&a<=h)return d;if(a>h&&a<=g)return d+1}return intersection}function j(a,b){$(c.ghost).css({left:a-10,top:b-10})}if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";var b=this,c={};return c.lastInt=null,c.pressed=!1,c.timeout=null,c.columnHead=null,$(b.box).on("mousedown",e),$(b.box).on("mouseup",d),{remove:function(){$(b.box).off("mousedown",e),$(b.box).off("mouseup",d),$(b.box).find(".w2ui-head").removeAttr("draggable"),b.last.columnDrag=!1}}},columnOnOff:function(a,b){var c=$(a.target).parents("tr").find(".w2ui-column-check"),d=this.trigger({phase:"before",target:this.name,type:"columnOnOff",field:b,originalEvent:a});if(d.isCancelled!==!0){for(var e=this,f=e.find({"w2ui.expanded":!0},!0),g=0;g<f.length;g++){var h=this.records[g].w2ui;h&&!Array.isArray(h.children)&&(this.records[g].w2ui.expanded=!1)}if("line-numbers"==b)this.show.lineNumbers=!this.show.lineNumbers,this.show.lineNumbers?c.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"):c.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.refreshBody(),this.resizeRecords();else{var i=this.getColumn(b);i.hidden?(c.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"),this.showColumn(i.field)):(c.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.hideColumn(i.field))}a.shiftKey||a.metaKey||a.ctrlKey||setTimeout(function(){$().w2overlay({name:e.name+"_toolbar"})},150),this.trigger($.extend(d,{phase:"after"}))}},scrollToColumn:function(a){if(null!=a){for(var b=0,c=!1,d=0;d<this.columns.length;d++){var e=this.columns[d];if(e.field==a){c=!0;break}if(!e.frozen&&!e.hidden){var f=parseInt(e.sizeCalculated?e.sizeCalculated:e.size);b+=f}}c&&(this.last.scrollLeft=b+1,this.scroll())}},initToolbar:function(){var a=this;if(null==this.toolbar.render){var b=this.toolbar.items;if(this.toolbar.items=[],this.toolbar=$().w2toolbar($.extend(!0,{},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.show.toolbarReload&&this.toolbar.items.push($.extend(!0,{},this.buttons.reload)),this.show.toolbarColumns&&this.toolbar.items.push($.extend(!0,{},this.buttons.columns)),(this.show.toolbarReload||this.show.toolbarColumns)&&this.toolbar.items.push({type:"break",id:"w2ui-break0"}),this.show.toolbarInput){var c='<div class="w2ui-toolbar-search"><table cellpadding="0" cellspacing="0"><tbody><tr>    <td>'+this.buttons.search.html+'</td>    <td>        <input type="text" id="grid_'+this.name+'_search_all" class="w2ui-search-all" tabindex="-1"             placeholder="'+w2utils.lang(this.last.caption)+'" value="'+this.last.search+'"            onfocus="clearTimeout(w2ui[\''+this.name+'\'].last.kbd_timer);"            onkeydown="if (event.keyCode == 13 &amp;&amp; w2utils.isIE) this.onchange();"            onchange="                var grid = w2ui[\''+this.name+"'];                 var val = this.value;                 var sel = jQuery(this).data('selected');                var fld = jQuery(this).data('w2field');                 if (fld) val = fld.clean(val);                if (fld &amp;&amp; fld.type == 'list' &amp;&amp; sel &amp;&amp; typeof sel.id == 'undefined') {                   grid.searchReset();                } else {                   grid.search(grid.last.field, val);                }            \"/>    </td>    <td>        <div class=\"w2ui-search-clear\" id=\"grid_"+this.name+'_searchClear"               onclick="var obj = w2ui[\''+this.name+'\']; obj.searchReset();" style="display: none"        >&#160;&#160;</div>    </td></tr></tbody></table></div>';this.toolbar.items.push({type:"html",id:"w2ui-search",html:c})}if(this.show.toolbarSearch&&this.multiSearch&&this.searches.length>0&&this.toolbar.items.push($.extend(!0,{},this.buttons["search-go"])),(this.show.toolbarSearch||this.show.toolbarInput)&&(this.show.toolbarAdd||this.show.toolbarEdit||this.show.toolbarDelete||this.show.toolbarSave)&&this.toolbar.items.push({type:"break",id:"w2ui-break1"}),this.show.toolbarAdd&&this.toolbar.items.push($.extend(!0,{},this.buttons.add)),this.show.toolbarEdit&&this.toolbar.items.push($.extend(!0,{},this.buttons.edit)),this.show.toolbarDelete&&this.toolbar.items.push($.extend(!0,{},this.buttons.delete)),this.show.toolbarSave&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"w2ui-break2"}),this.toolbar.items.push($.extend(!0,{},this.buttons.save))),b)for(var d=0;d<b.length;d++)this.toolbar.items.push(b[d]);var a=this;this.toolbar.on("click",function(b){var c=a.trigger({phase:"before",type:"toolbar",target:b.target,originalEvent:b});if(c.isCancelled!==!0){var d=b.target;switch(d){case"w2ui-reload":var e=a.trigger({phase:"before",type:"reload",target:a.name});if(e.isCancelled===!0)return!1;a.reload(),a.trigger($.extend(e,{phase:"after"}));break;case"w2ui-column-on-off":a.initColumnOnOff(),a.initResize(),a.resize();break;case"w2ui-search-advanced":var f=this.get(d);f.checked?a.searchClose():a.searchOpen(),a.toolbar.tooltipHide("w2ui-search-advanced"),b.preventDefault();break;case"w2ui-add":var c=a.trigger({phase:"before",target:a.name,type:"add",recid:null});a.trigger($.extend(c,{phase:"after"})),setTimeout(function(){$().w2tag()},20);break;case"w2ui-edit":var g=a.getSelection(),h=null;1==g.length&&(h=g[0]);var c=a.trigger({phase:"before",target:a.name,type:"edit",recid:h});a.trigger($.extend(c,{phase:"after"})),setTimeout(function(){$().w2tag()},20);break;case"w2ui-delete":a.delete();break;case"w2ui-save":a.save()}a.trigger($.extend(c,{phase:"after"}))}})}},initResize:function(){var a=this;$(this.box).find(".w2ui-resizer").off("click").on("click",function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault&&a.preventDefault()}).off("mousedown").on("mousedown",function(b){b||(b=window.event),a.resizing=!0,a.last.tmp={x:b.screenX,y:b.screenY,gx:b.screenX,gy:b.screenY,col:parseInt($(this).attr("name"))},b.stopPropagation?b.stopPropagation():b.cancelBubble=!0,b.preventDefault&&b.preventDefault();for(var c=0;c<a.columns.length;c++)a.columns[c].hidden||(null==a.columns[c].sizeOriginal&&(a.columns[c].sizeOriginal=a.columns[c].size),a.columns[c].size=a.columns[c].sizeCalculated);var d={phase:"before",type:"columnResize",target:a.name,column:a.last.tmp.col,field:a.columns[a.last.tmp.col].field};d=a.trigger($.extend(d,{resizeBy:0,originalEvent:b}));var e=function(b){if(1==a.resizing){if(b||(b=window.event),d=a.trigger($.extend(d,{resizeBy:b.screenX-a.last.tmp.gx,originalEvent:b})),d.isCancelled===!0)return void(d.isCancelled=!1);a.last.tmp.x=b.screenX-a.last.tmp.x,a.last.tmp.y=b.screenY-a.last.tmp.y,a.columns[a.last.tmp.col].size=parseInt(a.columns[a.last.tmp.col].size)+a.last.tmp.x+"px",a.resizeRecords(),a.scroll(),a.last.tmp.x=b.screenX,a.last.tmp.y=b.screenY}},f=function(b){delete a.resizing,$(document).off("mousemove","body"),$(document).off("mouseup","body"),a.resizeRecords(),a.scroll(),a.trigger($.extend(d,{phase:"after",originalEvent:b}))};$(document).on("mousemove","body",e),$(document).on("mouseup","body",f)}).each(function(a,b){var c=$(b).parent();$(b).css({height:"25px","margin-left":c.width()-3+"px"})})},resizeBoxes:function(){var a=$("#grid_"+this.name+"_header"),b=$("#grid_"+this.name+"_toolbar"),c=$("#grid_"+this.name+"_fsummary"),d=$("#grid_"+this.name+"_summary"),e=$("#grid_"+this.name+"_footer"),f=$("#grid_"+this.name+"_body");this.show.header&&a.css({top:"0px",left:"0px",right:"0px"}),this.show.toolbar&&b.css({top:0+(this.show.header?w2utils.getSize(a,"height"):0)+"px",left:"0px",right:"0px"}),this.summary.length>0&&(c.css({bottom:0+(this.show.footer?w2utils.getSize(e,"height"):0)+"px"}),d.css({bottom:0+(this.show.footer?w2utils.getSize(e,"height"):0)+"px",right:"0px"})),this.show.footer&&e.css({bottom:"0px",left:"0px",right:"0px"}),f.css({top:0+(this.show.header?w2utils.getSize(a,"height"):0)+(this.show.toolbar?w2utils.getSize(b,"height"):0)+"px",bottom:0+(this.show.footer?w2utils.getSize(e,"height"):0)+(this.summary.length>0?w2utils.getSize(d,"height"):0)+"px",left:"0px",right:"0px"})},resizeRecords:function(){function A(a,b,c){var d="",e="",f="";d+='<tr class="'+(a%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+b+'px">',e+='<tr class="'+(a%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+b+'px">',c.show.lineNumbers&&(d+='<td class="w2ui-col-number"></td>'),c.show.selectColumn&&(d+='<td class="w2ui-grid-data w2ui-col-select"></td>'),c.show.expandColumn&&(d+='<td class="w2ui-grid-data w2ui-col-expand"></td>'),e+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';for(var g=0;g<c.columns.length;g++){var h=c.columns[g];(h.hidden||g<c.last.colStart||g>c.last.colEnd)&&!h.frozen||(f='<td class="w2ui-grid-data" '+(null!=h.attr?h.attr:"")+' col="'+g+'"></td>',h.frozen?d+=f:e+=f)}d+='<td class="w2ui-grid-data-last"></td> </tr>',e+='<td class="w2ui-grid-data-last" col="end"></td> </tr>',$("#grid_"+c.name+"_frecords > table").append(d),$("#grid_"+c.name+"_records > table").append(e)}var a=this;$(this.box).find(".w2ui-empty-record").remove();var b=$(this.box),c=$(this.box).find("> div.w2ui-grid-box"),d=$("#grid_"+this.name+"_header"),e=$("#grid_"+this.name+"_toolbar"),f=$("#grid_"+this.name+"_summary"),g=$("#grid_"+this.name+"_fsummary"),h=$("#grid_"+this.name+"_footer"),i=$("#grid_"+this.name+"_body"),j=$("#grid_"+this.name+"_columns"),k=$("#grid_"+this.name+"_fcolumns"),l=$("#grid_"+this.name+"_records"),m=$("#grid_"+this.name+"_frecords"),n=$("#grid_"+this.name+"_scroll1"),o=8*String(this.total).length+10;o<34&&(o=34),null!=this.lineNumberWidth&&(o=this.lineNumberWidth);for(var p=!1,q=!1,r=0,s=0;s<a.columns.length;s++)if(!a.columns[s].frozen&&!a.columns[s].hidden){var t=parseInt(a.columns[s].sizeCalculated?a.columns[s].sizeCalculated:a.columns[s].size);r+=t}if(l.width()<r&&(p=!0),i.height()-j.height()<$(l).find(">table").height()+(p?w2utils.scrollBarSize():0)&&(q=!0),this.fixedBody){var u=c.height()-(this.show.header?w2utils.getSize(d,"height"):0)-(this.show.toolbar?w2utils.getSize(e,"height"):0)-("none"!=f.css("display")?w2utils.getSize(f,"height"):0)-(this.show.footer?w2utils.getSize(h,"height"):0);i.css("height",u)}else{var u=w2utils.getSize(j,"height")+w2utils.getSize($("#grid_"+a.name+"_records table"),"height")+(p?w2utils.scrollBarSize():0);a.height=u+w2utils.getSize(c,"+height")+(a.show.header?w2utils.getSize(d,"height"):0)+(a.show.toolbar?w2utils.getSize(e,"height"):0)+("none"!=f.css("display")?w2utils.getSize(f,"height"):0)+(a.show.footer?w2utils.getSize(h,"height"):0),c.css("height",a.height),i.css("height",u),b.css("height",w2utils.getSize(c,"height")+w2utils.getSize(b,"+height"))}var v=this.records.length,w="object"!=typeof this.url?this.url:this.url.get;if(0==this.searchData.length||w||(v=this.last.searchIds.length),this.fixedBody||(q=!1),p||q?(j.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show(),l.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(j,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":p?"auto":"hidden","overflow-y":q?"auto":"hidden"})):(j.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),l.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(j,"height")+"px",overflow:"hidden"}),l.length>0&&(this.last.scrollTop=0,this.last.scrollLeft=0)),p?(m.css("margin-bottom",w2utils.scrollBarSize()),n.show()):(m.css("margin-bottom",0),n.hide()),m.css({overflow:"hidden",top:l.css("top")}),this.show.emptyRecords&&!q){var x=Math.floor(l.height()/this.recordHeight)-1,y=0;if(l[0]&&(y=l[0].scrollHeight-x*this.recordHeight),y>=this.recordHeight&&(y-=this.recordHeight,x++),this.fixedBody){for(var z=v;z<x;z++)A(z,this.recordHeight,this);A(x,y,this)}}if(i.length>0){for(var B=parseInt(i.width())-(q?w2utils.scrollBarSize():0)-(this.show.lineNumbers?o:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0)-1,C=B,D=0,E=!1,s=0;s<this.columns.length;s++){var F=this.columns[s];F.gridMinWidth>0&&(F.gridMinWidth>C&&F.hidden!==!0&&(F.hidden=!0,E=!0),F.gridMinWidth<C&&F.hidden===!0&&(F.hidden=!1,E=!0))}if(E===!0)return void this.refresh();for(var s=0;s<this.columns.length;s++){var F=this.columns[s];F.hidden||("px"==String(F.size).substr(String(F.size).length-2).toLowerCase()?(B-=parseFloat(F.size),this.columns[s].sizeCalculated=F.size,this.columns[s].sizeType="px"):(D+=parseFloat(F.size),this.columns[s].sizeType="%",delete F.sizeCorrected))}if(100!=D&&D>0)for(var s=0;s<this.columns.length;s++){var F=this.columns[s];F.hidden||"%"==F.sizeType&&(F.sizeCorrected=Math.round(100*parseFloat(F.size)*100/D)/100+"%")}for(var s=0;s<this.columns.length;s++){var F=this.columns[s];F.hidden||"%"==F.sizeType&&(null!=this.columns[s].sizeCorrected?this.columns[s].sizeCalculated=Math.floor(B*parseFloat(F.sizeCorrected)/100)-1+"px":this.columns[s].sizeCalculated=Math.floor(B*parseFloat(F.size)/100)-1+"px")}}for(var G=0,s=0;s<this.columns.length;s++){var F=this.columns[s];F.hidden||(null==F.min&&(F.min=20),parseInt(F.sizeCalculated)<parseInt(F.min)&&(F.sizeCalculated=F.min+"px"),parseInt(F.sizeCalculated)>parseInt(F.max)&&(F.sizeCalculated=F.max+"px"),G+=parseInt(F.sizeCalculated))}var H=parseInt(C)-parseInt(G);if(H>0&&D>0)for(var s=0;;){var F=this.columns[s];if(null!=F)if(F.hidden||"px"==F.sizeType)s++;else{if(F.sizeCalculated=parseInt(F.sizeCalculated)+1+"px",H--,0===H)break;s++}else s=0}else H>0&&j.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show();var I=1;this.show.lineNumbers&&(I+=o),this.show.selectColumn&&(I+=26),this.show.expandColumn&&(I+=26);for(var s=0;s<this.columns.length;s++)this.columns[s].hidden||this.columns[s].frozen&&(I+=parseInt(this.columns[s].sizeCalculated));k.css("width",I),m.css("width",I),g.css("width",I),n.css("width",I),j.css("left",I),l.css("left",I),f.css("left",I),j.find("> table > tbody > tr:nth-child(1) td").add(k.find("> table > tbody > tr:nth-child(1) td")).each(function(b,c){$(c).hasClass("w2ui-col-number")&&$(c).css("width",o);var d=$(c).attr("col");if(null!=d){if("start"==d){for(var e=0,f=0;f<a.last.colStart;f++)!a.columns[f]||a.columns[f].frozen||a.columns[f].hidden||(e+=parseInt(a.columns[f].sizeCalculated));$(c).css("width",e+"px")}a.columns[d]&&$(c).css("width",a.columns[d].sizeCalculated)}if($(c).hasClass("w2ui-head-last"))if(a.last.colEnd+1<a.columns.length){for(var e=0,f=a.last.colEnd+1;f<a.columns.length;f++)!a.columns[f]||a.columns[f].frozen||a.columns[f].hidden||(e+=parseInt(a.columns[f].sizeCalculated));$(c).css("width",e+"px")}else $(c).css("width",w2utils.scrollBarSize()+(H>0&&0===D?H:0)+"px")}),3==j.find("> table > tbody > tr").length&&j.find("> table > tbody > tr:nth-child(1) td").add(k.find("> table > tbody > tr:nth-child(1) td")).html("").css({height:"0px",border:"0px",padding:"0px",margin:"0px"}),l.find("> table > tbody > tr:nth-child(1) td").add(m.find("> table > tbody > tr:nth-child(1) td")).each(function(b,c){$(c).hasClass("w2ui-col-number")&&$(c).css("width",o);var d=$(c).attr("col");if(null!=d){if("start"==d){for(var e=0,f=0;f<a.last.colStart;f++)!a.columns[f]||a.columns[f].frozen||a.columns[f].hidden||(e+=parseInt(a.columns[f].sizeCalculated));$(c).css("width",e+"px")}a.columns[d]&&$(c).css("width",a.columns[d].sizeCalculated)}if($(c).hasClass("w2ui-grid-data-last")&&0===$(c).parents(".w2ui-grid-frecords").length)if(a.last.colEnd+1<a.columns.length){for(var e=0,f=a.last.colEnd+1;f<a.columns.length;f++)!a.columns[f]||a.columns[f].frozen||a.columns[f].hidden||(e+=parseInt(a.columns[f].sizeCalculated));$(c).css("width",e+"px")}else $(c).css("width",(H>0&&0===D?H:0)+"px")}),f.find("> table > tbody > tr:nth-child(1) td").add(g.find("> table > tbody > tr:nth-child(1) td")).each(function(b,c){$(c).hasClass("w2ui-col-number")&&$(c).css("width",o);var d=$(c).attr("col");if(null!=d){if("start"==d){for(var e=0,f=0;f<a.last.colStart;f++)!a.columns[f]||a.columns[f].frozen||a.columns[f].hidden||(e+=parseInt(a.columns[f].sizeCalculated));$(c).css("width",e+"px")}a.columns[d]&&$(c).css("width",a.columns[d].sizeCalculated)}$(c).hasClass("w2ui-grid-data-last")&&0===$(c).parents(".w2ui-grid-frecords").length&&$(c).css("width",w2utils.scrollBarSize()+(H>0&&0===D?H:0)+"px")}),this.initResize(),this.refreshRanges(),(this.last.scrollTop||this.last.scrollLeft)&&l.length>0&&(j.prop("scrollLeft",this.last.scrollLeft),l.prop("scrollTop",this.last.scrollTop),l.prop("scrollLeft",this.last.scrollLeft))},getSearchesHTML:function(){function i(b,c){var d="",e=a.operators[a.operatorsMap[b]];null!=c&&(e=c);for(var f=0;f<e.length;f++){var g=e[f],h=g;Array.isArray(g)?(h=g[1],g=g[0],null==h&&(h=g)):$.isPlainObject(g)&&(h=g.text,g=g.oper),d+='<option value="'+g+'">'+w2utils.lang(h)+"</option>\n"}return d}for(var a=this,b='<table cellspacing="0"><tbody>',c=!1,d=0;d<this.searches.length;d++){
var e=this.searches[d];if(e.type=String(e.type).toLowerCase(),!e.hidden){var f="";0==c&&(f='<button class="w2ui-btn close-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) obj.searchClose()\">X</button>",c=!0),null==e.inTag&&(e.inTag=""),null==e.outTag&&(e.outTag=""),null==e.style&&(e.style=""),null==e.type&&(e.type="text");var g='<select id="grid_'+this.name+"_operator_"+d+'" class="w2ui-input"    onchange="w2ui[\''+this.name+"'].initOperator(this, "+d+')">'+i(e.type,e.operators)+"</select>";switch(b+='<tr>    <td class="close-btn">'+f+'</td>    <td class="caption">'+(e.caption||"")+'</td>    <td class="operator">'+g+'</td>    <td class="value">',e.type){case"text":case"alphanumeric":case"hex":case"color":case"list":case"combo":case"enum":var h="width: 250px;";["hex","color"].indexOf(e.type)!=-1&&(h="width: 90px;"),b+='<input rel="search" type="text" id="grid_'+this.name+"_field_"+d+'" name="'+e.field+'"    class="w2ui-input" style="'+h+e.style+'" '+e.inTag+"/>";break;case"int":case"float":case"money":case"currency":case"percent":case"date":case"time":case"datetime":var h="width: 90px";"datetime"==e.type&&(h="width: 140px;"),b+='<input rel="search" type="text" class="w2ui-input" style="'+h+e.style+'" id="grid_'+this.name+"_field_"+d+'" name="'+e.field+'" '+e.inTag+'/><span id="grid_'+this.name+"_range_"+d+'" style="display: none">&#160;-&#160;&#160;<input rel="search" type="text" class="w2ui-input" style="'+h+e.style+'" id="grid_'+this.name+"_field2_"+d+'" name="'+e.field+'" '+e.inTag+"/></span>";break;case"select":b+='<select rel="search" class="w2ui-input" style="'+e.style+'" id="grid_'+this.name+"_field_"+d+'"  name="'+e.field+'" '+e.inTag+"></select>"}b+=e.outTag+"    </td></tr>"}}return b+='<tr>    <td colspan="4" class="actions">        <div>        <button class="w2ui-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.searchReset(); }\">"+w2utils.lang("Reset")+'</button>        <button class="w2ui-btn w2ui-btn-blue" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.search(); }\">"+w2utils.lang("Search")+"</button>        </div>    </td></tr></tbody></table>"},initOperator:function(a,b){var c=this,d=c.searches[b],e=$("#grid_"+c.name+"_range_"+b),f=$("#grid_"+c.name+"_field_"+b),g=f.parent().find("span input");switch(f.show(),e.hide(),$(a).val()){case"between":e.show(),g.w2field(d.type,d.options);break;case"not null":case"null":f.hide(),f.val("1"),f.change()}},initSearches:function(){for(var a=this,b=0;b<this.searches.length;b++){var c=this.searches[b],d=this.getSearchData(c.field);c.type=String(c.type).toLowerCase();var e=a.operators[a.operatorsMap[c.type]];c.operators&&(e=c.operators);var f=e[0];$.isPlainObject(f)&&(f=f.oper),"object"!=typeof c.options&&(c.options={}),"text"==c.type&&(f="contains");for(var g=0;g<e.length;g++){var h=e[g];if($.isPlainObject(h)&&(h=h.oper),c.operator==h){f=c.operator;break}}switch(c.type){case"text":case"alphanumeric":$("#grid_"+this.name+"_field_"+b).w2field(c.type,c.options);break;case"int":case"float":case"hex":case"color":case"money":case"currency":case"percent":case"date":case"time":case"datetime":$("#grid_"+this.name+"_field_"+b).w2field(c.type,c.options),$("#grid_"+this.name+"_field2_"+b).w2field(c.type,c.options),setTimeout(function(){$("#grid_"+a.name+"_field_"+b).keydown(),$("#grid_"+a.name+"_field2_"+b).keydown()},1);break;case"list":case"combo":case"enum":var i=c.options;"list"==c.type&&(i.selected={}),"enum"==c.type&&(i.selected=[]),d&&(i.selected=d.value),$("#grid_"+this.name+"_field_"+b).w2field(c.type,$.extend({openOnFocus:!0},i)),d&&null!=d.text&&$("#grid_"+this.name+"_field_"+b).data("selected",{id:d.value,text:d.text});break;case"select":for(var i='<option value="">--</option>',g=0;g<c.options.items.length;g++){var j=c.options.items[g];if($.isPlainObject(c.options.items[g])){var k=j.id,l=j.text;null==k&&null!=j.value&&(k=j.value),null==l&&null!=j.caption&&(l=j.caption),null==k&&(k=""),i+='<option value="'+k+'">'+l+"</option>"}else i+='<option value="'+j+'">'+j+"</option>"}$("#grid_"+this.name+"_field_"+b).html(i)}null!=d?("int"==d.type&&["in","not in"].indexOf(d.operator)!=-1&&$("#grid_"+this.name+"_field_"+b).w2field("clear").val(d.value),$("#grid_"+this.name+"_operator_"+b).val(d.operator).trigger("change"),$.isArray(d.value)?["in","not in"].indexOf(d.operator)!=-1?$("#grid_"+this.name+"_field_"+b).val(d.value).trigger("change"):($("#grid_"+this.name+"_field_"+b).val(d.value[0]).trigger("change"),$("#grid_"+this.name+"_field2_"+b).val(d.value[1]).trigger("change")):null!=d.value&&$("#grid_"+this.name+"_field_"+b).val(d.value).trigger("change")):$("#grid_"+this.name+"_operator_"+b).val(f).trigger("change")}$("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]").on("keypress",function(b){13==b.keyCode&&(a.search(),$().w2overlay({name:a.name+"-searchOverlay"}))})},getColumnsHTML:function(){function h(){var b="<tr>",c="<tr>",d="";""!=a.columnGroups[a.columnGroups.length-1].caption&&a.columnGroups.push({caption:""}),a.show.lineNumbers&&(b+='<td class="w2ui-head w2ui-col-number">    <div style="height: '+(a.recordHeight+1)+'px">&#160;</div></td>'),a.show.selectColumn&&(b+='<td class="w2ui-head w2ui-col-select">    <div style="height: 25px">&#160;</div></td>'),a.show.expandColumn&&(b+='<td class="w2ui-head w2ui-col-expand">    <div style="height: 25px">&#160;</div></td>');var e=0;c+='<td id="grid_'+a.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>';for(var f=0;f<a.columnGroups.length;f++){var g=a.columnGroups[f],h=a.columns[e];null!=g.colspan&&(g.span=g.colspan),null!=g.span&&g.span==parseInt(g.span)||(g.span=1);for(var i=0,j=e;j<e+g.span;j++)a.columns[j]&&!a.columns[j].hidden&&i++;if(f==a.columnGroups.length-1&&i++,i<=0);else if(g.master===!0){for(var k="",l=0;l<a.sortData.length;l++)a.sortData[l].field==h.field&&("asc"===(a.sortData[l].direction||"").toLowerCase()&&(k="w2ui-sort-up"),"desc"===(a.sortData[l].direction||"").toLowerCase()&&(k="w2ui-sort-down"));var m="";h.resizable!==!1&&(m='<div class="w2ui-resizer" name="'+e+'"></div>'),d='<td id="grid_'+a.name+"_column_"+e+'" class="w2ui-head '+k+'" col="'+e+'"     rowspan="2" colspan="'+i+'"     oncontextmenu = "w2ui[\''+a.name+"'].contextMenu(null, "+e+', event);"    onclick="w2ui[\''+a.name+"'].columnClick('"+h.field+"', event);\"    ondblclick=\"w2ui['"+a.name+"'].columnDblClick('"+h.field+"', event);\">"+m+'    <div class="w2ui-col-group w2ui-col-header '+(k?"w2ui-col-sorted":"")+'">        <div class="'+k+'"></div>'+(h.caption?h.caption:"&#160;")+"    </div></td>",h&&h.frozen?b+=d:c+=d}else d='<td id="grid_'+a.name+"_column_"+e+'" class="w2ui-head" col="'+e+'"         colspan="'+i+'">    <div class="w2ui-col-group">'+(g.caption?g.caption:"&#160;")+"    </div></td>",h&&h.frozen?b+=d:c+=d;e+=g.span}return b+="<td></td></tr>",c+='<td id="grid_'+a.name+'_column_end" class="w2ui-head" col="end"></td></tr>',[b,c]}function i(b){var c="<tr>",d="<tr>";a.show.lineNumbers&&(c+='<td class="w2ui-head w2ui-col-number"        onclick="w2ui[\''+a.name+"'].columnClick('line-number', event);\"       ondblclick=\"w2ui['"+a.name+"'].columnDblClick('line-number', event);\">    <div>#</div></td>"),a.show.selectColumn&&(c+='<td class="w2ui-head w2ui-col-select"       onclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div>        <input type="checkbox" id="grid_'+a.name+'_check_all" tabindex="-1"            style="'+(0==a.multiSelect?"display: none;":"")+'"            onmousedown="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"            onclick="var grid = w2ui[\''+a.name+"'];               if (this.checked) grid.selectAll(); else grid.selectNone();               if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;               clearTimeout(grid.last.kbd_timer); /* keep focus */            \"/>    </div></td>"),a.show.expandColumn&&(c+='<td class="w2ui-head w2ui-col-expand">    <div>&#160;</div></td>');var g,e=0,f=0;d+='<td id="grid_'+a.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>';for(var h=0;h<a.columns.length;h++){var i=a.columns[h];if(h==f&&(g=a.columnGroups[e++]||{},f+=g.span),(!(h<a.last.colStart||h>a.last.colEnd)||i.frozen)&&!i.hidden&&(g.master!==!0||b)){var j=a.getColumnCellHTML(h);i&&i.frozen?c+=j:d+=j}}return c+='<td class="w2ui-head w2ui-head-last"><div>&#160;</div></td>',d+='<td class="w2ui-head w2ui-head-last" col="end"><div>&#160;</div></td>',c+="</tr>",d+="</tr>",[c,d]}var a=this,b="",c="";if(this.show.columnHeaders)if(this.columnGroups.length>0){var d=i(!0),e=h(),f=i(!1);b=d[0]+e[0]+f[0],c=d[1]+e[1]+f[1]}else{var g=i(!0);b=g[0],c=g[1]}return[b,c]},getColumnCellHTML:function(a){var b=this.columns[a];if(null==b)return"";for(var c=!this.reorderColumns||this.columnGroups&&this.columnGroups.length?"":" w2ui-reorder-cols-head ",d="",e=0;e<this.sortData.length;e++)this.sortData[e].field==b.field&&("asc"===(this.sortData[e].direction||"").toLowerCase()&&(d="w2ui-sort-up"),"desc"===(this.sortData[e].direction||"").toLowerCase()&&(d="w2ui-sort-down"));var f=this.last.selection.columns,g=!1;for(var h in f)for(var e=0;e<f[h].length;e++)f[h][e]==a&&(g=!0);var i='<td id="grid_'+this.name+"_column_"+a+'" col="'+a+'" class="w2ui-head '+d+c+'" '+("normal"==this.columnTooltip&&b.tooltip?'title="'+b.tooltip+'" ':"")+"    onmouseover = \"w2ui['"+this.name+"'].columnTooltipShow('"+a+"', event);\"    onmouseout  = \"w2ui['"+this.name+"'].columnTooltipHide('"+a+"', event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(null, "+a+', event);"    onclick="w2ui[\''+this.name+"'].columnClick('"+b.field+"', event);\"    ondblclick=\"w2ui['"+this.name+"'].columnDblClick('"+b.field+"', event);\">"+(b.resizable!==!1?'<div class="w2ui-resizer" name="'+a+'"></div>':"")+'    <div class="w2ui-col-header '+(d?"w2ui-col-sorted":"")+" "+(g?"w2ui-col-selected":"")+'">        <div class="'+d+'"></div>'+(b.caption?b.caption:"&#160;")+"    </div></td>";return i},columnTooltipShow:function(a){if("normal"!=this.columnTooltip){var b=$(this.box).find("#grid_"+this.name+"_column_"+a),c=this.columns[a],d=this.columnTooltip;b.prop("_mouse_over",!0),setTimeout(function(){b.prop("_mouse_over")===!0&&b.prop("_mouse_tooltip")!==!0&&(b.prop("_mouse_tooltip",!0),b.w2tag(c.tooltip,{position:d}))},1)}},columnTooltipHide:function(a){if("normal"!=this.columnTooltip){var b=$(this.box).find("#grid_"+this.name+"_column_"+a);this.columns[a];b.removeProp("_mouse_over"),setTimeout(function(){b.prop("_mouse_over")!==!0&&b.prop("_mouse_tooltip")===!0&&(b.removeProp("_mouse_tooltip"),b.w2tag())},1)}},getRecordsHTML:function(){var a=this.records.length,b="object"!=typeof this.url?this.url:this.url.get;0==this.searchData.length||b||(a=this.last.searchIds.length),a>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start;var c=$("#grid_"+this.name+"_records"),d=Math.floor((c.height()||0)/this.recordHeight)+this.last.show_extra+1;(!this.fixedBody||d>a)&&(d=a);var e=this.getRecordHTML(-1,0),f="<table><tbody>"+e[0],g="<table><tbody>"+e[1];f+='<tr id="grid_'+this.name+'_frec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>',g+='<tr id="grid_'+this.name+'_rec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>';for(var h=0;h<d;h++)e=this.getRecordHTML(h,h+1),f+=e[0],g+=e[1];return f+='<tr id="grid_'+this.name+'_frec_bottom" line="bottom" style="height: '+(a-d)*this.recordHeight+'px">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_frec_more" style="display: none; visibility: hidden">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',g+='<tr id="grid_'+this.name+'_rec_bottom" line="bottom" style="height: '+(a-d)*this.recordHeight+'px">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',this.last.range_start=0,this.last.range_end=d,[f,g]},getSummaryHTML:function(){if(0!==this.summary.length){for(var a=this.getRecordHTML(-1,0),b="<table><tbody>"+a[0],c="<table><tbody>"+a[1],d=0;d<this.summary.length;d++)a=this.getRecordHTML(d,d+1,!0),b+=a[0],c+=a[1];return b+="</tbody></table>",c+="</tbody></table>",[b,c]}},scroll:function(a){function Z(){c.markSearch&&(clearTimeout(c.last.marker_timer),c.last.marker_timer=setTimeout(function(){for(var a=[],b=0;b<c.searchData.length;b++){var d=c.searchData[b],e=c.getSearch(d.field);e&&!e.hidden&&a.indexOf(d.value)==-1&&a.push(d.value)}a.length>0&&$(c.box).find(".w2ui-grid-data > div").w2marker(a)},50))}var c=((new Date).getTime(),this),d="object"!=typeof this.url?this.url:this.url.get,e=$("#grid_"+this.name+"_records"),f=$("#grid_"+this.name+"_frecords");if(a){var g=a.target.scrollTop,h=a.target.scrollLeft;c.last.scrollTop=g,c.last.scrollLeft=h,$("#grid_"+c.name+"_columns")[0].scrollLeft=h,$("#grid_"+c.name+"_summary")[0].scrollLeft=h,f[0].scrollTop=g}this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null);var i=null,j=null;if(c.disableCVS||c.columnGroups.length>0)i=0,j=c.columns.length-1;else{for(var k=e.width(),l=0,m=0;m<c.columns.length;m++)if(!c.columns[m].frozen&&!c.columns[m].hidden){var n=parseInt(c.columns[m].sizeCalculated?c.columns[m].sizeCalculated:c.columns[m].size);l+n+30>c.last.scrollLeft&&null==i&&(i=m),l+n-30>c.last.scrollLeft+k&&null==j&&(j=m),l+=n}null==j&&(j=c.columns.length-1)}if(null!=i&&(i<0&&(i=0),j<0&&(j=0),i==j&&(i>0?i--:j++),i!=c.last.colStart||j!=c.last.colEnd)){var o=$(c.box),p=Math.abs(i-c.last.colStart),q=Math.abs(j-c.last.colEnd);if(p<5&&q<5){var r=o.find(".w2ui-grid-columns #grid_"+c.name+"_column_start"),s=o.find(".w2ui-grid-columns .w2ui-head-last"),t=o.find("#grid_"+c.name+"_records .w2ui-grid-data-spacer"),u=o.find("#grid_"+c.name+"_records .w2ui-grid-data-last"),v=o.find("#grid_"+c.name+"_summary .w2ui-grid-data-spacer"),w=o.find("#grid_"+c.name+"_summary .w2ui-grid-data-last");if(i>c.last.colStart)for(var m=c.last.colStart;m<i;m++)o.find("#grid_"+c.name+"_columns #grid_"+c.name+"_column_"+m).remove(),o.find("#grid_"+c.name+'_records td[col="'+m+'"]').remove(),o.find("#grid_"+c.name+'_summary td[col="'+m+'"]').remove();if(j<c.last.colEnd)for(var m=c.last.colEnd;m>j;m--)o.find("#grid_"+c.name+"_columns #grid_"+c.name+"_column_"+m).remove(),o.find("#grid_"+c.name+'_records td[col="'+m+'"]').remove(),o.find("#grid_"+c.name+'_summary td[col="'+m+'"]').remove();if(i<c.last.colStart)for(var m=c.last.colStart-1;m>=i;m--)c.columns[m]&&(c.columns[m].frozen||c.columns[m].hidden)||(r.after(c.getColumnCellHTML(m)),t.each(function(a,b){var d=$(b).parent().attr("index"),e='<td class="w2ui-grid-data" col="'+m+'" style="height: 0px"></td>';null!=d&&(e=c.getCellHTML(parseInt(d),m,!1)),$(b).after(e)}),v.each(function(a,b){var d=$(b).parent().attr("index"),e='<td class="w2ui-grid-data" col="'+m+'" style="height: 0px"></td>';null!=d&&(e=c.getCellHTML(parseInt(d),m,!0)),$(b).after(e)}));if(j>c.last.colEnd)for(var m=c.last.colEnd+1;m<=j;m++)c.columns[m]&&(c.columns[m].frozen||c.columns[m].hidden)||(s.before(c.getColumnCellHTML(m)),u.each(function(a,b){var d=$(b).parent().attr("index"),e='<td class="w2ui-grid-data" col="'+m+'" style="height: 0px"></td>';null!=d&&(e=c.getCellHTML(parseInt(d),m,!1)),$(b).before(e)}),w.each(function(a,b){var d=$(b).parent().attr("index"),e=c.getCellHTML(parseInt(d),m,!0);$(b).before(e)}));c.last.colStart=i,c.last.colEnd=j,c.resizeRecords()}else{c.last.colStart=i,c.last.colEnd=j;var x=this.getColumnsHTML(),y=this.getRecordsHTML(),z=this.getSummaryHTML(),A=o.find("#grid_"+this.name+"_columns"),B=o.find("#grid_"+this.name+"_records"),C=o.find("#grid_"+this.name+"_frecords"),D=o.find("#grid_"+this.name+"_summary");A.find("tbody").html(x[1]),C.html(y[0]),B.prepend(y[1]),null!=z&&D.html(z[1]),setTimeout(function(){B.find("> table").not("table:first-child").remove(),D[0]&&(D[0].scrollLeft=c.last.scrollLeft)},1),c.resizeRecords()}}var E=this.records.length;if(0==this.searchData.length||d||(E=this.last.searchIds.length),0!==E&&0!==e.length&&0!==e.height()&&(E>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start,!(e.height()<E*this.recordHeight&&"hidden"==e.css("overflow-y")))){var F=Math.round(e[0].scrollTop/this.recordHeight+1),G=F+(Math.round(e.height()/this.recordHeight)-1);if(F>E&&(F=E),G>=E-1&&(G=E),$("#grid_"+this.name+"_footer .w2ui-footer-right").html((c.show.statusRange?w2utils.formatNumber(this.offset+F)+"-"+w2utils.formatNumber(this.offset+G)+(this.total!=-1?" "+w2utils.lang("of")+" "+w2utils.formatNumber(this.total):""):"")+(d&&c.show.statusBuffered?" ("+w2utils.lang("buffered")+" "+w2utils.formatNumber(E)+(this.offset>0?", skip "+w2utils.formatNumber(this.offset):"")+")":"")),d||this.fixedBody&&!(this.total!=-1&&this.total<=this.vs_start)){var H=Math.floor(e[0].scrollTop/this.recordHeight)-this.last.show_extra,I=H+Math.floor(e.height()/this.recordHeight)+2*this.last.show_extra+1;H<1&&(H=1),I>this.total&&this.total!=-1&&(I=this.total);var J=e.find("#grid_"+this.name+"_rec_top"),K=e.find("#grid_"+this.name+"_rec_bottom"),L=f.find("#grid_"+this.name+"_frec_top"),M=f.find("#grid_"+this.name+"_frec_bottom");String(J.next().prop("id")).indexOf("_expanded_row")!=-1&&(J.next().remove(),L.next().remove()),this.total>I&&String(K.prev().prop("id")).indexOf("_expanded_row")!=-1&&(K.prev().remove(),M.prev().remove());var N=parseInt(J.next().attr("line")),O=parseInt(K.prev().attr("line"));if(N<H||1==N||this.last.pull_refresh){if(I<=O+this.last.show_extra-2&&I!=this.total)return;for(this.last.pull_refresh=!1;;){var P=f.find("#grid_"+this.name+"_frec_top").next(),Q=e.find("#grid_"+this.name+"_rec_top").next();if("bottom"==Q.attr("line"))break;if(!(parseInt(Q.attr("line"))<H))break;P.remove(),Q.remove()}var R=e.find("#grid_"+this.name+"_rec_bottom").prev(),S=R.attr("line");"top"==S&&(S=H);for(var m=parseInt(S)+1;m<=I;m++)if(this.records[m-1]){var Q=this.records[m-1].w2ui;Q&&!Array.isArray(Q.children)&&(Q.expanded=!1);var T=this.getRecordHTML(m-1,m);K.before(T[1]),M.before(T[0])}Z(),setTimeout(function(){c.refreshRanges()},0)}else{if(H>=N-this.last.show_extra+2&&H>1)return;for(;;){var P=f.find("#grid_"+this.name+"_frec_bottom").prev(),Q=e.find("#grid_"+this.name+"_rec_bottom").prev();if("top"==Q.attr("line"))break;if(!(parseInt(Q.attr("line"))>I))break;P.remove(),Q.remove()}var R=e.find("#grid_"+this.name+"_rec_top").next(),S=R.attr("line");"bottom"==S&&(S=I);for(var m=parseInt(S)-1;m>=H;m--)if(this.records[m-1]){var Q=this.records[m-1].w2ui;Q&&!Array.isArray(Q.children)&&(Q.expanded=!1);var T=this.getRecordHTML(m-1,m);J.after(T[1]),L.after(T[0])}Z(),setTimeout(function(){c.refreshRanges()},0)}var U=(H-1)*c.recordHeight,V=(E-I)*c.recordHeight;V<0&&(V=0),J.css("height",U+"px"),L.css("height",U+"px"),K.css("height",V+"px"),M.css("height",V+"px"),c.last.range_start=H,c.last.range_end=I;var W=Math.floor(e[0].scrollTop/this.recordHeight),X=W+Math.floor(e.height()/this.recordHeight);if(X+10>E&&this.last.pull_more!==!0&&(E<this.total-this.offset||this.total==-1&&this.last.xhr_hasMore))if(this.autoLoad===!0)this.last.pull_more=!0,this.last.xhr_offset+=this.limit,this.request("get");else{var Y=$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more");"none"==Y.css("display")&&Y.show().on("click",function(){c.last.pull_more=!0,c.last.xhr_offset+=c.limit,c.request("get"),$(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>')}),(Y.find("td .w2ui-spinner").length>0||Y.find("td").text().indexOf("Load")==-1)&&Y.find("td").html("<div>"+w2utils.lang("Load")+" "+c.limit+" "+w2utils.lang("More")+"...</div>")}E>=this.total-this.offset&&this.total!=-1&&$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").hide()}}},getRecordHTML:function(a,b,c){var h,d="",e="",f="",g=this.last.selection;if(a==-1){e+='<tr line="0">',f+='<tr line="0">',this.show.lineNumbers&&(e+='<td class="w2ui-col-number" style="height: 0px;"></td>'),this.show.selectColumn&&(e+='<td class="w2ui-col-select" style="height: 0px;"></td>'),this.show.expandColumn&&(e+='<td class="w2ui-col-expand" style="height: 0px;"></td>'),f+='<td class="w2ui-grid-data w2ui-grid-data-spacer" col="start" style="height: 0px; width: 0px;"></td>';for(var i=0;i<this.columns.length;i++){var j=this.columns[i];if(d='<td class="w2ui-grid-data" col="'+i+'" style="height: 0px;"></td>',j.frozen&&!j.hidden)e+=d;else{if(j.hidden||i<this.last.colStart||i>this.last.colEnd)continue;f+=d}}return e+='<td class="w2ui-grid-data-last" style="height: 0px"></td>',f+='<td class="w2ui-grid-data-last" col="end" style="height: 0px"></td>',e+="</tr>",f+="</tr>",[e,f]}var k="object"!=typeof this.url?this.url:this.url.get;if(c!==!0)if(this.searchData.length>0&&!k){if(a>=this.last.searchIds.length)return"";a=this.last.searchIds[a],h=this.records[a]}else{if(a>=this.records.length)return"";h=this.records[a]}else{if(a>=this.summary.length)return"";h=this.summary[a]}if(!h)return"";null==h.recid&&null!=this.recid&&null!=h[this.recid]&&(h.recid=h[this.recid]);var m=(w2utils.escapeId(h.recid),!1);g.indexes.indexOf(a)!=-1&&(m=!0);var n=h.w2ui?h.w2ui.style:"";null!=n&&"string"==typeof n||(n="");var o=h.w2ui?h.w2ui.class:"";if(null!=o&&"string"==typeof o||(o=""),e+='<tr id="grid_'+this.name+"_frec_"+h.recid+'" recid="'+h.recid+'" line="'+b+'" index="'+a+'"  class="'+(b%2===0?"w2ui-even":"w2ui-odd")+" "+o+(m&&"row"==this.selectType?" w2ui-selected":"")+(h.w2ui&&h.w2ui.editable===!1?" w2ui-no-edit":"")+(h.w2ui&&h.w2ui.expanded===!0?" w2ui-expanded":"")+'" '+(c!==!0?w2utils.isIOS?"    onclick  = \"w2ui['"+this.name+"'].dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"w2ui['"+this.name+"'].click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover=\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(m||""==n?n.replace("background-color","none"):n)+'" '+(""!=n?'custom_style="'+n+'"':"")+">",f+='<tr id="grid_'+this.name+"_rec_"+h.recid+'" recid="'+h.recid+'" line="'+b+'" index="'+a+'"  class="'+(b%2===0?"w2ui-even":"w2ui-odd")+" "+o+(m&&"row"==this.selectType?" w2ui-selected":"")+(h.w2ui&&h.w2ui.editable===!1?" w2ui-no-edit":"")+(h.w2ui&&h.w2ui.expanded===!0?" w2ui-expanded":"")+'" '+(c!==!0?w2utils.isIOS?"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"var obj = w2ui['"+this.name+"']; obj.contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover=\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(m||""==n?n.replace("background-color","none"):n)+'" '+(""!=n?'custom_style="'+n+'"':"")+">",this.show.lineNumbers&&(e+='<td id="grid_'+this.name+"_cell_"+a+"_number"+(c?"_s":"")+'"    class="w2ui-col-number '+(m?" w2ui-row-selected":"")+'"'+(this.reorderRows?' style="cursor: move"':"")+">"+(c!==!0?this.getLineHTML(b,h):"")+"</td>"),this.show.selectColumn&&(e+='<td id="grid_'+this.name+"_cell_"+a+"_select"+(c?"_s":"")+'" class="w2ui-grid-data w2ui-col-select">'+(c!==!0?'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabindex="-1" '+(m?'checked="checked"':"")+' style="pointer-events: none"/>    </div>':"")+"</td>"),this.show.expandColumn){var p="";p=h.w2ui&&h.w2ui.expanded===!0?"-":"+",h.w2ui&&"none"==h.w2ui.expanded&&(p=""),h.w2ui&&"spinner"==h.w2ui.expanded&&(p='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),e+='<td id="grid_'+this.name+"_cell_"+a+"_expand"+(c?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(c!==!0?'    <div ondblclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"             onclick="w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'));                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">        "+p+" </div>":"")+"</td>"}f+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';for(var q=0,r=0;;){var s=1,j=this.columns[q];if(null==j)break;if(j.hidden)q++,r>0&&r--;else if(r>0){if(q++,null==this.columns[q])break;h.w2ui.colspan[this.columns[q-1].field]=0,r--}else{if(h.w2ui){var t=h.w2ui.colspan,u=this.columns[q].field;t&&0===t[u]&&delete t[u]}if(!(q<this.last.colStart||q>this.last.colEnd)||j.frozen){if(h.w2ui&&"object"==typeof h.w2ui.colspan){var v=parseInt(h.w2ui.colspan[j.field])||null;if(v>1){for(var w=0,i=q;i<q+v&&!(i>=this.columns.length);i++)this.columns[i].hidden&&w++;s=v-w,r=v-1}}var x=this.getCellHTML(a,q,c,s);j.frozen?e+=x:f+=x,q++}else q++}}return e+='<td class="w2ui-grid-data-last"></td>',f+='<td class="w2ui-grid-data-last" col="end"></td>',e+="</tr>",f+="</tr>",[e,f]},getLineHTML:function(a){return"<div>"+a+"</div>"},getCellHTML:function(a,b,c,d){var e=this.columns[b];if(null==e)return"";var f=c!==!0?this.records[a]:this.summary[a],g=this.getCellValue(a,b,c),h=this.getCellEditable(a,b),i="max-height: "+parseInt(this.recordHeight)+"px;",j=!c&&f&&f.w2ui&&f.w2ui.changes&&null!=f.w2ui.changes[e.field],k="",l="",m=this.last.selection,n=!1,o="";if(m.indexes.indexOf(a)!=-1&&(n=!0),null==d&&(d=f&&f.w2ui&&f.w2ui.colspan&&f.w2ui.colspan[e.field]?f.w2ui.colspan[e.field]:1),0===b&&f&&f.w2ui&&Array.isArray(f.w2ui.children)){for(var p=0,q=this.get(f.w2ui.parent_recid,!0);;){if(null==q)break;p++;var r=this.records[q].w2ui;if(null==r||null==r.parent_recid)break;q=this.get(r.parent_recid,!0)}if(f.w2ui.parent_recid)for(var s=0;s<p;s++)o+='<span class="w2ui-show-children w2ui-icon-empty"></span>';o+='<span class="w2ui-show-children '+(f.w2ui.children.length>0?f.w2ui.expanded?"w2ui-icon-collapse":"w2ui-icon-expand":"w2ui-icon-empty")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'))\"></span>"}if(e.info===!0&&(e.info={}),null!=e.info&&(e.info.icon||(e.info.icon="w2ui-icon-info"),o+='<span class="w2ui-info '+e.info.icon+'" style="'+(e.info.style||"")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].showBubble("+a+", "+b+')"></span>'),null!=e.render){if("function"==typeof e.render&&(g=$.trim(e.render.call(this,f,a,b,g)),(g.length<4||"<div"!=g.substr(0,4).toLowerCase())&&(g='<div style="'+i+'">'+o+String(g)+"</div>")),"object"==typeof e.render&&(g='<div style="'+i+'">'+o+(e.render[g]||"")+"</div>"),"string"==typeof e.render){var t=e.render.toLowerCase().indexOf(":"),r=[];t==-1?(r[0]=e.render.toLowerCase(),r[1]=""):(r[0]=e.render.toLowerCase().substr(0,t),r[1]=e.render.toLowerCase().substr(t+1));var u=w2utils.formatters[r[0]];g='<div style="'+i+'">'+o+("function"==typeof u?u(g,r[1]):"")+"</div>"}}else{if(h&&["checkbox","check"].indexOf(h.type)!=-1){var v=c?-(a+1):a;i+="text-align: center;",g='<input tabindex="-1" type="checkbox" '+(g?'checked="checked"':"")+" onclick=\"    var obj = w2ui['"+this.name+"'];     obj.editChange.call(obj, this, "+v+", "+b+', event); "/>',o=""}if(this.show.recordTitles){var w=w2utils.stripTags(String(g).replace(/"/g,"''"));null!=e.title&&("function"==typeof e.title&&(w=e.title.call(this,f,a,b)),"string"==typeof e.title&&(w=e.title))}g='<div style="'+i+'" title="'+(w||"")+'">'+o+String(g)+"</div>"}if(null==g&&(g=""),"string"==typeof e.render){var r=e.render.toLowerCase().split(":");["number","int","float","money","currency","percent","size"].indexOf(r[0])!=-1&&(k+="text-align: right;")}f&&f.w2ui&&("object"==typeof f.w2ui.style&&("string"==typeof f.w2ui.style[b]&&(k+=f.w2ui.style[b]+";"),"string"==typeof f.w2ui.style[e.field]&&(k+=f.w2ui.style[e.field]+";")),"object"==typeof f.w2ui.class&&("string"==typeof f.w2ui.class[b]&&(l+=f.w2ui.class[b]+" "),"string"==typeof f.w2ui.class[e.field]&&(l+=f.w2ui.class[e.field]+" ")));var x=!1;return n&&$.inArray(b,m.columns[a])!=-1&&(x=!0),g='<td class="w2ui-grid-data'+(x?" w2ui-selected":"")+" "+l+(j?" w2ui-changed":"")+'"    id="grid_'+this.name+"_data_"+a+"_"+b+'" col="'+b+'"    style="'+k+(null!=e.style?e.style:"")+'" '+(null!=e.attr?e.attr:"")+(d>1?'colspan="'+d+'"':"")+">"+g+"</td>"},showBubble:function(a,b){var c="",d=this.columns[b].info,e=this.records[a],f=$(this.box).find("#grid_"+this.name+"_data_"+a+"_"+b+" .w2ui-info");if(this.last.bubbleEl&&$(this.last.bubbleEl).w2tag(),this.last.bubbleEl=f,null==d.fields){d.fields=[];for(var g=0;g<this.columns.length;g++){var h=this.columns[g];d.fields.push(h.field+("string"==typeof h.render?":"+h.render:""))}}var i=d.fields;if("function"==typeof i&&(i=i(e,a,b)),"function"==typeof d.render)c=d.render(e,a,b);else if($.isArray(i)){c='<table cellpadding="0" cellspacing="0">';for(var g=0;g<i.length;g++){var j=String(i[g]).split(":");if(""!=j[0]&&"-"!=j[0]&&"--"!=j[0]&&"---"!=j[0]){var h=this.getColumn(j[0]);null==h&&(h={field:j[0],caption:j[0]});var k=h?this.parseField(e,h.field):"";j.length>1&&(w2utils.formatters[j[1]]?k=w2utils.formatters[j[1]](k,j[2]||null):console.log('ERROR: w2utils.formatters["'+j[1]+'"] does not exists.')),(d.showEmpty===!0||null!=k&&""!=k)&&(null!=d.maxLength&&"string"==typeof k&&k.length>d.maxLength&&(k=k.substr(0,d.maxLength)+"..."),c+="<tr><td>"+h.caption+"</td><td>"+((0===k?"0":k)||"")+"</td></tr>")}else c+='<tr><td colspan=2><div style="border-top: '+(""==j[0]?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>'}c+="</table>"}else if($.isPlainObject(i)){c='<table cellpadding="0" cellspacing="0">';for(var l in i){var m=i[l];if(""!=m&&"-"!=m&&"--"!=m&&"---"!=m){var j=String(m).split(":"),h=this.getColumn(j[0]);null==h&&(h={field:j[0],caption:j[0]});var k=h?this.parseField(e,h.field):"";j.length>1&&(w2utils.formatters[j[1]]?k=w2utils.formatters[j[1]](k,j[2]||null):console.log('ERROR: w2utils.formatters["'+j[1]+'"] does not exists.')),"function"==typeof m&&(k=m(e,a,b)),(d.showEmpty===!0||null!=k&&""!=k)&&(null!=d.maxLength&&"string"==typeof k&&k.length>d.maxLength&&(k=k.substr(0,d.maxLength)+"..."),c+="<tr><td>"+l+"</td><td>"+(k||"")+"</td></tr>")}else c+='<tr><td colspan=2><div style="border-top: '+(""==m?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>'}c+="</table>"}$(f).w2tag($.extend({html:c,left:-4,position:"bottom|top",className:"w2ui-info-bubble",style:"",hideOnClick:!0},d.options||{}))},getCellEditable:function(a,b){var c=this.columns[b],d=this.records[a];if(!d||!c)return null;var e=d.w2ui?d.w2ui.editable:null;if(e===!1)return null;if((null==e||e===!0)&&(e=c?c.editable:null,"function"==typeof e)){var f=this.getCellValue(a,b,!1);e=e.call(this,d,a,b,f)}return e},getCellValue:function(a,b,c){var d=this.columns[b],e=c!==!0?this.records[a]:this.summary[a],f=this.parseField(e,d.field);return e&&e.w2ui&&e.w2ui.changes&&null!=e.w2ui.changes[d.field]&&(f=e.w2ui.changes[d.field]),$.isPlainObject(f)&&(d.options&&d.options.items?(val=d.options.items.find(function(a){return a.id==f.id}),f=val?val.text:f.id):(null!=f.text&&(f=f.text),null!=f.id&&(f=f.id))),null==f&&(f=""),f},getFooterHTML:function(){return'<div>    <div class="w2ui-footer-left"></div>    <div class="w2ui-footer-right"></div>    <div class="w2ui-footer-center"></div></div>'},status:function(a){if(null!=a)$("#grid_"+this.name+"_footer").find(".w2ui-footer-left").html(a);else{var b="",c=this.getSelection();if(c.length>0&&(this.show.statusSelection&&c.length>1&&(b=String(c.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" "+w2utils.lang("selected")),
this.show.statusRecordID&&1==c.length)){var d=c[0];"object"==typeof d&&(d=d.recid+", "+w2utils.lang("Column")+": "+d.column),b=w2utils.lang("Record ID")+": "+d+" "}$("#grid_"+this.name+"_footer .w2ui-footer-left").html(b),1==c.length?(this.toolbar.enable("w2ui-edit"),this.toolbar.enable("w2ui-open"),this.toolbar.enable("w2ui-reply")):(this.toolbar.disable("w2ui-edit"),this.toolbar.disable("w2ui-open"),this.toolbar.disable("w2ui-reply")),c.length>=1?(this.toolbar.enable("w2ui-delete"),this.toolbar.enable("w2ui-status")):(this.toolbar.disable("w2ui-delete"),this.toolbar.disable("w2ui-status"))}},lock:function(a,b){var c=this,d=Array.prototype.slice.call(arguments,0);d.unshift(this.box),setTimeout(function(){$(c.box).find("#grid_"+c.name+"_empty_msg").remove(),w2utils.lock.apply(window,d)},10)},unlock:function(a){var b=this.box;setTimeout(function(){$(b).find(".w2ui-message").not(".w2ui-closing").length>0||w2utils.unlock(b,a)},25)},stateSave:function(a){if(!w2utils.hasLocalStorage)return null;for(var c={columns:[],show:$.extend({},this.show),last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,caption:this.last.caption,field:this.last.field,scrollTop:this.last.scrollTop,scrollLeft:this.last.scrollLeft},sortData:[],searchData:[]},d=0;d<this.columns.length;d++){var e=this.columns[d];c.columns.push({field:e.field,hidden:!!e.hidden,frozen:!!e.frozen,size:e.size?e.size:null,sizeCalculated:e.sizeCalculated?e.sizeCalculated:null,sizeOriginal:e.sizeOriginal?e.sizeOriginal:null,sizeType:e.sizeType?e.sizeType:null})}for(var d=0;d<this.sortData.length;d++)c.sortData.push($.extend({},this.sortData[d]));for(var d=0;d<this.searchData.length;d++)c.searchData.push($.extend({},this.searchData[d]));if(a!==!0){var f=this.trigger({phase:"before",type:"stateSave",target:this.name,state:c});if(f.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));try{var g=$.parseJSON(localStorage.w2ui||"{}");g||(g={}),g.states||(g.states={}),g.states[this.stateId||this.name]=c,localStorage.w2ui=JSON.stringify(g)}catch(a){return delete localStorage.w2ui,null}this.trigger($.extend(f,{phase:"after"}))}return c},stateRestore:function(a){var b=this,c="object"!=typeof this.url?this.url:this.url.get;if(!a)try{if(!w2utils.hasLocalStorage)return!1;var d=$.parseJSON(localStorage.w2ui||"{}");d||(d={}),d.states||(d.states={}),a=d.states[this.stateId||this.name]}catch(a){return delete localStorage.w2ui,null}var e=this.trigger({phase:"before",type:"stateRestore",target:this.name,state:a});if(e.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));if($.isPlainObject(a)){$.extend(this.show,a.show),$.extend(this.last,a.last);for(var f=this.last.scrollTop,g=this.last.scrollLeft,h=0;h<a.columns.length;h++){var d=a.columns[h],i=this.getColumn(d.field,!0);null!==i&&($.extend(this.columns[i],d),h!==i&&this.columns.splice(h,0,this.columns.splice(i,1)[0]))}this.sortData.splice(0,this.sortData.length);for(var h=0;h<a.sortData.length;h++)this.sortData.push(a.sortData[h]);this.searchData.splice(0,this.searchData.length);for(var h=0;h<a.searchData.length;h++)this.searchData.push(a.searchData[h]);setTimeout(function(){c||(b.sortData.length>0&&b.localSort(),b.searchData.length>0&&b.localSearch()),b.last.scrollTop=f,b.last.scrollLeft=g,b.refresh()},1)}return this.trigger($.extend(e,{phase:"after"})),!0},stateReset:function(){if(this.stateRestore(this.last.state),w2utils.hasLocalStorage)try{var b=$.parseJSON(localStorage.w2ui||"{}");b.states&&b.states[this.stateId||this.name]&&delete b.states[this.stateId||this.name],localStorage.w2ui=JSON.stringify(b)}catch(a){return delete localStorage.w2ui,null}},parseField:function(a,b){var c="";try{c=a;for(var d=String(b).split("."),e=0;e<d.length;e++)c=c[d[e]]}catch(a){c=""}return c},prepareData:function(){function d(b){for(var c=0;c<a.columns.length;c++){var e=a.columns[c];if(null!=b[e.field]&&"string"==typeof e.render){if(["number","int","float","money","currency","percent"].indexOf(e.render.split(":")[0])!=-1&&"number"!=typeof b[e.field]&&(b[e.field]=parseFloat(b[e.field])),["date","age"].indexOf(e.render.split(":")[0])!=-1&&!b[e.field+"_"]){var f=b[e.field];w2utils.isInt(f)&&(f=parseInt(f)),b[e.field+"_"]=new Date(f)}if(["time"].indexOf(e.render)!=-1)if(w2utils.isTime(b[e.field])){var g=w2utils.isTime(b[e.field],!0),f=new Date;f.setHours(g.hours,g.minutes,g.seconds?g.seconds:0,0),b[e.field+"_"]||(b[e.field+"_"]=f)}else{var g=b[e.field];w2utils.isInt(g)&&(g=parseInt(g));var g=null!=g?new Date(g):new Date,f=new Date;f.setHours(g.getHours(),g.getMinutes(),g.getSeconds(),0),b[e.field+"_"]||(b[e.field+"_"]=f)}}}if(b.w2ui&&b.w2ui.children&&b.w2ui.expanded!==!0)for(var h=0;h<b.w2ui.children.length;h++){var i=b.w2ui.children[h];d(i)}}for(var a=this,b=0;b<this.records.length;b++){var c=this.records[b];d(c)}},nextCell:function(a,b,c){var d=b+1;if(d>=this.columns.length)return null;var e=this.records[a].w2ui,g=(this.columns[b],this.columns[d]),h=e&&e.colspan&&!isNaN(e.colspan[g.field])?parseInt(e.colspan[g.field]):1;if(null==g)return null;if(g&&g.hidden||0===h)return this.nextCell(a,d,c);if(c){var i=this.getCellEditable(a,b);if(null==i||["checkbox","check"].indexOf(i.type)!=-1)return this.nextCell(a,d,c)}return d},prevCell:function(a,b,c){var d=b-1;if(d<0)return null;var e=this.records[a].w2ui,f=this.columns[d],g=e&&e.colspan&&!isNaN(e.colspan[f.field])?parseInt(e.colspan[f.field]):1;if(null==f)return null;if(f&&f.hidden||0===g)return this.prevCell(a,d,c);if(c){var h=this.getCellEditable(a,b);if(null==h||["checkbox","check"].indexOf(h.type)!=-1)return this.prevCell(a,d,c)}return d},nextRow:function(a,b){var c=this.last.searchIds,d=null;if(a+1<this.records.length&&0===c.length||c.length>0&&a<c[c.length-1]){if(a++,c.length>0)for(;;){if($.inArray(a,c)!=-1||a>this.records.length)break;a++}var e=this.records[a].w2ui,f=this.columns[b],g=e&&e.colspan&&null!=f&&!isNaN(e.colspan[f.field])?parseInt(e.colspan[f.field]):1;d=0===g?this.nextRow(a,b):a}return d},prevRow:function(a,b){var c=this.last.searchIds,d=null;if(a>0&&0===c.length||c.length>0&&a>c[0]){if(a--,c.length>0)for(;;){if($.inArray(a,c)!=-1||a<0)break;a--}var e=this.records[a].w2ui,f=this.columns[b],g=e&&e.colspan&&null!=f&&!isNaN(e.colspan[f.field])?parseInt(e.colspan[f.field]):1;d=0===g?this.prevRow(a,b):a}return d},selectionSave:function(){return this.last._selection=this.getSelection(),this.last._selection},selectionRestore:function(a){var b=(new Date).getTime();this.last.selection={indexes:[],columns:{}};for(var c=this.last.selection,d=this.last._selection,e=0;e<d.length;e++)if($.isPlainObject(d[e])){var f=this.get(d[e].recid,!0);null!=f&&(c.indexes.indexOf(f)==-1&&c.indexes.push(f),c.columns[f]||(c.columns[f]=[]),c.columns[f].push(d[e].column))}else{var f=this.get(d[e],!0);null!=f&&c.indexes.push(f)}return delete this.last._selection,a!==!0&&this.refresh(),(new Date).getTime()-b},message:function(a,b){"string"==typeof a&&(a={width:a.length<300?350:550,height:a.length<300?170:250,body:'<div class="w2ui-centered">'+a+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(a){setTimeout(function(){$(this.box).find(".w2ui-btn").focus()},25)},onClose:function(a){"function"==typeof b&&b()}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-grid-header:visible",body:".w2ui-grid-box"},a)}},$.extend(w2grid.prototype,w2utils.event),w2obj.grid=w2grid}(jQuery);var w2popup={};!function(a){a.fn.w2popup=function(b,c){null==b&&(c={},b="open"),a.isPlainObject(b)&&(c=b,b="open"),b=b.toLowerCase(),"load"===b&&"string"==typeof c&&(c=a.extend({url:c},arguments.length>2?arguments[2]:{})),"open"===b&&null!=c.url&&(b="load"),c=c||{};var d={};if(a(this).length>0&&"open"==b){if(a(this).find("div[rel=title], div[rel=body], div[rel=buttons]").length>0){if(a("#w2ui-popup").length>0){var e=a("#w2ui-popup").data("options");w2popup._prev={template:w2popup._template,title:e.title,body:e.body,buttons:e.buttons}}w2popup._template=this,a(this).find("div[rel=title]").length>0&&(d.title=a(this).find("div[rel=title]")),a(this).find("div[rel=body]").length>0&&(d.body=a(this).find("div[rel=body]"),d.style=a(this).find("div[rel=body]")[0].style.cssText),a(this).find("div[rel=buttons]").length>0&&(d.buttons=a(this).find("div[rel=buttons]"))}else d.title="&#160;",d.body=a(this).html();0!==parseInt(a(this).css("width"))&&(d.width=parseInt(a(this).css("width"))),0!==parseInt(a(this).css("height"))&&(d.height=parseInt(a(this).css("height")))}return w2popup[b](a.extend({},d,c))},w2popup={defaults:{title:"",body:"",buttons:"",style:"",color:"#000",opacity:.4,speed:.3,modal:!1,maximized:!1,keyboard:!0,width:500,height:300,showClose:!0,showMax:!1,transition:null},status:"closed",handlers:[],onOpen:null,onClose:null,onMax:null,onMin:null,onToggle:null,onKeydown:null,open:function(b){function q(b){return b||(b=window.event),w2popup.status="moving",m.resizing=!0,m.isLocked=1==a("#w2ui-popup > .w2ui-lock").length,m.x=b.screenX,m.y=b.screenY,m.pos_x=a("#w2ui-popup").position().left,m.pos_y=a("#w2ui-popup").position().top,m.isLocked||w2popup.lock({opacity:0}),a(document).on("mousemove",m.mvMove),a(document).on("mouseup",m.mvStop),b.stopPropagation?b.stopPropagation():b.cancelBubble=!0,!!b.preventDefault&&void b.preventDefault()}function r(b){1==m.resizing&&(b||(b=window.event),m.div_x=b.screenX-m.x,m.div_y=b.screenY-m.y,a("#w2ui-popup").css(w2utils.cssPrefix({transition:"none",transform:"translate3d("+m.div_x+"px, "+m.div_y+"px, 0px)"})))}function s(b){1==m.resizing&&(b||(b=window.event),w2popup.status="open",m.div_x=b.screenX-m.x,m.div_y=b.screenY-m.y,a("#w2ui-popup").css({left:m.pos_x+m.div_x+"px",top:m.pos_y+m.div_y+"px"}).css(w2utils.cssPrefix({transition:"none",transform:"translate3d(0px, 0px, 0px)"})),m.resizing=!1,a(document).off("mousemove",m.mvMove),a(document).off("mouseup",m.mvStop),m.isLocked||w2popup.unlock())}var c=this;if("closing"==w2popup.status)return void setTimeout(function(){c.open.call(c,b)},100);var d=a("#w2ui-popup").data("options"),b=a.extend({},this.defaults,d,{title:"",body:"",buttons:""},b,{maximized:!1});setTimeout(function(){a("#w2ui-popup").data("options",b)},100),0===a("#w2ui-popup").length&&(w2popup.onMax=null,w2popup.onMin=null,w2popup.onToggle=null,w2popup.onOpen=null,w2popup.onClose=null,w2popup.onKeydown=null),b.onOpen&&(w2popup.onOpen=b.onOpen),b.onClose&&(w2popup.onClose=b.onClose),b.onMax&&(w2popup.onMax=b.onMax),b.onMin&&(w2popup.onMin=b.onMin),b.onToggle&&(w2popup.onToggle=b.onToggle),b.onKeydown&&(w2popup.onKeydown=b.onKeydown),b.width=parseInt(b.width),b.height=parseInt(b.height);var e,f;void 0==window.innerHeight?(e=parseInt(document.documentElement.offsetWidth),f=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(e+=21,f+=4)):(e=parseInt(window.innerWidth),f=parseInt(window.innerHeight)),e-10<b.width&&(b.width=e-10),f-10<b.height&&(b.height=f-10);var g=(f-b.height)/2*.6,h=(e-b.width)/2;if(0===a("#w2ui-popup").length){var i=this.trigger({phase:"before",type:"open",target:"popup",options:b,present:!1});if(i.isCancelled===!0)return;w2popup.status="opening",w2popup.lockScreen(b);var j="";b.showClose&&(j+='<div class="w2ui-popup-button w2ui-popup-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>'),b.showMax&&(j+='<div class="w2ui-popup-button w2ui-popup-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>');var k='<div id="w2ui-popup" class="w2ui-popup" style="opacity: 0; left: '+h+"px; top: "+g+"px;     width: "+parseInt(b.width)+"px; height: "+parseInt(b.height)+"px; "+w2utils.cssPrefix("transform","scale(0.8)",!0)+'"></div>';a("body").append(k);var l=a("#w2ui-popup");if(l.find("div[rel=title], div[rel=body], div[rel=buttons]").length>0){var m=l.find("div[rel=title]");m.length>0&&(b.title=m.html(),m.remove());var m=l.find("div[rel=buttons]");m.length>0&&(b.buttons=m.html(),m.remove());var m=l.find("div[rel=body]");m.length>0?b.body=m.html():b.body=l.html()}var k='<div class="w2ui-popup-title" style="'+(b.title?"":"display: none")+'">'+j+'</div><div class="w2ui-box" style="'+(b.title?"":"top: 0px !important;")+(b.buttons?"":"bottom: 0px !important;")+'">    <div class="w2ui-popup-body'+(""!==!b.title?" w2ui-popup-no-title":"")+(b.buttons?"":" w2ui-popup-no-buttons")+'" style="'+b.style+'">    </div></div><div class="w2ui-popup-buttons" style="'+(b.buttons?"":"display: none")+'"></div><input class="w2ui-popup-hidden" style="position: absolute; top: -100px"/>';a("#w2ui-popup").html(k),b.title&&a("#w2ui-popup .w2ui-popup-title").append(b.title),b.buttons&&a("#w2ui-popup .w2ui-popup-buttons").append(b.buttons),b.body&&a("#w2ui-popup .w2ui-popup-body").append(b.body),setTimeout(function(){a("#w2ui-popup").css("opacity","1").css(w2utils.cssPrefix({transition:b.speed+"s opacity, "+b.speed+"s -webkit-transform",transform:"scale(1)"})),c.focus()},1),setTimeout(function(){a("#w2ui-popup").css(w2utils.cssPrefix("transform","")),w2popup.status="open",setTimeout(function(){c.trigger(a.extend(i,{phase:"after"}))},100)},1e3*b.speed)}else{null==w2popup._prev&&null!=w2popup._template&&c.restoreTemplate();var i=this.trigger({phase:"before",type:"open",target:"popup",options:b,present:!0});if(i.isCancelled===!0)return;w2popup.status="opening",null!=d&&(d.maximized||d.width==b.width&&d.height==b.height||w2popup.resize(b.width,b.height),b.prevSize=b.width+"px:"+b.height+"px",b.maximized=d.maximized);var n=a("#w2ui-popup .w2ui-box").clone();if(n.removeClass("w2ui-box").addClass("w2ui-box-temp").find(".w2ui-popup-body").empty().append(b.body),"string"==typeof b.body&&n.find("div[rel=title], div[rel=body], div[rel=buttons]").length>0){var m=n.find("div[rel=title]");m.length>0&&(b.title=m.html(),m.remove());var m=n.find("div[rel=buttons]");m.length>0&&(b.buttons=m.html(),m.remove());var m=n.find("div[rel=body]");m.length>0?b.body=m.html():b.body=n.html(),n.html(b.body)}a("#w2ui-popup .w2ui-box").after(n),b.buttons?(a("#w2ui-popup .w2ui-popup-buttons").show().html("").append(b.buttons),a("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-buttons"),a("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","")):(a("#w2ui-popup .w2ui-popup-buttons").hide().html(""),a("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-buttons"),a("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","0px")),b.title?(a("#w2ui-popup .w2ui-popup-title").show().html((b.showClose?'<div class="w2ui-popup-button w2ui-popup-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>':"")+(b.showMax?'<div class="w2ui-popup-button w2ui-popup-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>':"")).append(b.title),a("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-title"),a("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","")):(a("#w2ui-popup .w2ui-popup-title").hide().html(""),a("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-title"),a("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","0px"));var o=a("#w2ui-popup .w2ui-box")[0],p=a("#w2ui-popup .w2ui-box-temp")[0];w2utils.transition(o,p,b.transition,function(){c.restoreTemplate(),a(o).remove(),a(p).removeClass("w2ui-box-temp").addClass("w2ui-box");var d=a(p).find(".w2ui-popup-body");1==d.length&&(d[0].style.cssText=b.style),a("#w2ui-popup").data("prev-size",null),c.focus(),w2popup.status="open",c.trigger(a.extend(i,{phase:"after"}))})}b._last_focus=a(":focus"),b.keyboard&&a(document).on("keydown",this.keydown);var m={resizing:!1,mvMove:r,mvStop:s};return a("#w2ui-popup .w2ui-popup-title").on("mousedown",function(a){w2popup.get().maximized||q(a)}),this},keydown:function(b){var c=a("#w2ui-popup").data("options");if(!c||c.keyboard){var d=w2popup.trigger({phase:"before",type:"keydown",target:"popup",options:c,originalEvent:b});if(d.isCancelled!==!0){switch(b.keyCode){case 27:b.preventDefault(),a("#w2ui-popup .w2ui-message").length>0?w2popup.message():w2popup.close()}w2popup.trigger(a.extend(d,{phase:"after"}))}}},close:function(b){var c=this,b=a.extend({},a("#w2ui-popup").data("options"),b);if(0!==a("#w2ui-popup").length&&"closed"!=this.status){if("opening"==this.status)return void setTimeout(function(){w2popup.close()},100);var d=this.trigger({phase:"before",type:"close",target:"popup",options:b});d.isCancelled!==!0&&(w2popup.status="closing",a("#w2ui-popup").css("opacity","0").css(w2utils.cssPrefix({transition:b.speed+"s opacity, "+b.speed+"s -webkit-transform",transform:"scale(0.9)"})),w2popup.unlockScreen(b),setTimeout(function(){c.restoreTemplate(),a("#w2ui-popup").remove(),w2popup.status="closed",b._last_focus.length>0&&b._last_focus.focus(),c.trigger(a.extend(d,{phase:"after"}))},1e3*b.speed),b.keyboard&&a(document).off("keydown",this.keydown))}},toggle:function(){var b=this,c=a("#w2ui-popup").data("options"),d=this.trigger({phase:"before",type:"toggle",target:"popup",options:c});d.isCancelled!==!0&&(c.maximized===!0?w2popup.min():w2popup.max(),setTimeout(function(){b.trigger(a.extend(d,{phase:"after"}))},1e3*c.speed+50))},max:function(){var b=this,c=a("#w2ui-popup").data("options");if(c.maximized!==!0){var d=this.trigger({phase:"before",type:"max",target:"popup",options:c});d.isCancelled!==!0&&(w2popup.status="resizing",c.prevSize=a("#w2ui-popup").css("width")+":"+a("#w2ui-popup").css("height"),w2popup.resize(1e4,1e4,function(){w2popup.status="open",c.maximized=!0,b.trigger(a.extend(d,{phase:"after"})),a("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(function(){var b=a(this).attr("name");w2ui[b]&&w2ui[b].resize&&w2ui[b].resize()})}))}},min:function(){var b=this,c=a("#w2ui-popup").data("options");if(c.maximized===!0){var d=c.prevSize.split(":"),e=this.trigger({phase:"before",type:"min",target:"popup",options:c});e.isCancelled!==!0&&(w2popup.status="resizing",w2popup.resize(parseInt(d[0]),parseInt(d[1]),function(){w2popup.status="open",c.maximized=!1,c.prevSize=null,b.trigger(a.extend(e,{phase:"after"})),a("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(function(){var b=a(this).attr("name");w2ui[b]&&w2ui[b].resize&&w2ui[b].resize()})}))}},get:function(){return a("#w2ui-popup").data("options")},set:function(a){w2popup.open(a)},clear:function(){a("#w2ui-popup .w2ui-popup-title").html(""),a("#w2ui-popup .w2ui-popup-body").html(""),a("#w2ui-popup .w2ui-popup-buttons").html("")},reset:function(){w2popup.open(w2popup.defaults)},load:function(b){function g(c,d){if(delete b.url,a("body").append('<div id="w2ui-tmp" style="display: none">'+c+"</div>"),null!=d&&a("#w2ui-tmp #"+d).length>0?a("#w2ui-tmp #"+d).w2popup(b):a("#w2ui-tmp > div").w2popup(b),a("#w2ui-tmp > style").length>0){var e=a("<div>").append(a("#w2ui-tmp > style").clone()).html();0===a("#w2ui-popup #div-style").length&&a("#w2ui-popup").append('<div id="div-style" style="position: absolute; left: -100; width: 1px"></div>'),a("#w2ui-popup #div-style").html(e)}a("#w2ui-tmp").remove()}if(w2popup.status="loading",null==b.url)return void console.log("ERROR: The url parameter is empty.");var c=String(b.url).split("#"),d=c[0],e=c[1];null==b&&(b={});var f=a("#w2ui-popup").data(d);null!=f?g(f,e):a.get(d,function(b,c,f){g(f.responseText,e),a("#w2ui-popup").data(d,f.responseText)})},message:function(b){var c=this;a().w2tag(),b||(b={width:200,height:100});var d=parseInt(a("#w2ui-popup").width()),e=parseInt(a("#w2ui-popup").height());b.originalWidth=b.width,b.originalHeight=b.height,parseInt(b.width)<10&&(b.width=10),parseInt(b.height)<10&&(b.height=10),null==b.hideOnClick&&(b.hideOnClick=!1);var f=a("#w2ui-popup").data("options")||{},g=parseInt(a("#w2ui-popup > .w2ui-popup-title").css("height"));(null==b.width||b.width>f.width-10)&&(b.width=f.width-10),(null==b.height||b.height>f.height-g-5)&&(b.height=f.height-g-5),b.originalHeight<0&&(b.height=e+b.originalHeight-g),b.originalWidth<0&&(b.width=d+2*b.originalWidth);var h=a("#w2ui-popup .w2ui-popup-title"),i=a("#w2ui-popup .w2ui-message").length;if(""===a.trim(b.html)&&""===a.trim(b.body)&&""===a.trim(b.buttons)){var j=a("#w2ui-popup #w2ui-message"+(i-1)),b=j.data("options")||{};j.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+b.height+"px)"})),1==i?w2popup.unlock(150):a("#w2ui-popup #w2ui-message"+(i-2)).css("z-index",1500),setTimeout(function(){var a=j.data("prev_focus");j.remove(),a&&a.length>0?a.focus():c.focus(),"function"==typeof b.onClose&&b.onClose()},150)}else{""===a.trim(b.body)&&""===a.trim(b.buttons)||(b.html='<div class="w2ui-message-body">'+b.body+'</div><div class="w2ui-message-buttons">'+b.buttons+"</div>"),a("#w2ui-popup .w2ui-message").css("z-index",1390),h.css("z-index",1501),a("#w2ui-popup .w2ui-box").before('<div id="w2ui-message'+i+'" class="w2ui-message" style="display: none; z-index: 1500; '+(0===h.length?"top: 0px;":"top: "+w2utils.getSize(h,"height")+"px;")+(null!=b.width?"width: "+b.width+"px; left: "+(d-b.width)/2+"px;":"left: 10px; right: 10px;")+(null!=b.height?"height: "+b.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(b.hideOnClick===!0?'onclick="w2popup.message();"':"")+"></div>"),a("#w2ui-popup #w2ui-message"+i).data("options",b).data("prev_focus",a(":focus"));var k=a("#w2ui-popup #w2ui-message"+i).css("display");a("#w2ui-popup #w2ui-message"+i).css(w2utils.cssPrefix({transform:"none"==k?"translateY(-"+b.height+"px)":"translateY(0px)"})),"none"==k&&(a("#w2ui-popup #w2ui-message"+i).show().html(b.html),setTimeout(function(){a("#w2ui-popup #w2ui-message"+i).css(w2utils.cssPrefix({transform:"none"==k?"translateY(0px)":"translateY(-"+b.height+"px)"}))},1),0===i&&w2popup.lock(),setTimeout(function(){c.focus(),a("#w2ui-popup #w2ui-message"+i).css(w2utils.cssPrefix({transition:"0s"})),"function"==typeof b.onOpen&&b.onOpen()},350))}},focus:function(){var b=null,c=a("#w2ui-popup"),d="input:visible, button:visible, select:visible, textarea:visible";a(c).find(d).off(".keep-focus");var e=a("#w2ui-popup .w2ui-message").length-1,f=a("#w2ui-popup #w2ui-message"+e);if(f.length>0){var g=a(f[f.length-1]).find("button");g.length>0&&g[0].focus(),b=f}else if(c.length>0){var g=c.find(".w2ui-popup-buttons button");g.length>0&&g[0].focus(),b=c}a(b).find(d).on("blur.keep-focus",function(c){setTimeout(function(){var c=a(":focus");if(c.length>0&&!a(b).find(d).is(c)||c.hasClass("w2ui-popup-hidden")){var e=a(b).find(d);e.length>0&&e[0].focus()}},1)})},lock:function(b,c){var d=Array.prototype.slice.call(arguments,0);d.unshift(a("#w2ui-popup")),w2utils.lock.apply(window,d)},unlock:function(b){w2utils.unlock(a("#w2ui-popup"),b)},lockScreen:function(b){return!(a("#w2ui-lock").length>0)&&(null==b&&(b=a("#w2ui-popup").data("options")),null==b&&(b={}),b=a.extend({},w2popup.defaults,b),a("body").append('<div id="w2ui-lock"     onmousewheel="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; if (event.preventDefault) event.preventDefault(); else return false;"    style="position: '+("IE5"==w2utils.engine?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px;            padding: 0px; margin: 0px; background-color: "+b.color+'; width: 100%; height: 100%; opacity: 0;"></div>'),setTimeout(function(){a("#w2ui-lock").css("opacity",b.opacity).css(w2utils.cssPrefix("transition",b.speed+"s opacity"))},1),1==b.modal?(a("#w2ui-lock").on("mousedown",function(){a("#w2ui-lock").css("opacity","0.6").css(w2utils.cssPrefix("transition",".1s"))}),a("#w2ui-lock").on("mouseup",function(){setTimeout(function(){a("#w2ui-lock").css("opacity",b.opacity).css(w2utils.cssPrefix("transition",".1s"))},100)})):a("#w2ui-lock").on("mousedown",function(){w2popup.close()}),!0)},unlockScreen:function(b){return 0!==a("#w2ui-lock").length&&(null==b&&(b=a("#w2ui-popup").data("options")),null==b&&(b={}),b=a.extend({},w2popup.defaults,b),a("#w2ui-lock").css("opacity","0").css(w2utils.cssPrefix("transition",b.speed+"s opacity")),setTimeout(function(){a("#w2ui-lock").remove()},1e3*b.speed),!0)},resizeMessages:function(){a("#w2ui-popup").data("options");a("#w2ui-popup .w2ui-message").each(function(){var b=a(this).data("options"),c=a("#w2ui-popup");parseInt(b.width)<10&&(b.width=10),parseInt(b.height)<10&&(b.height=10);var d=parseInt(c.find("> .w2ui-popup-title").css("height")),e=parseInt(c.width()),f=parseInt(c.height());b.width=b.originalWidth,b.width>e-10&&(b.width=e-10),b.height=b.originalHeight,b.height>f-d-5&&(b.height=f-d-5),b.originalHeight<0&&(b.height=f+b.originalHeight-d),b.originalWidth<0&&(b.width=e+2*b.originalWidth),a(this).css({left:(e-b.width)/2+"px",width:b.width+"px",height:b.height+"px"})})},resize:function(b,c,d){var e=this,f=a("#w2ui-popup").data("options");b=parseInt(b),c=parseInt(c);var g,h;void 0==window.innerHeight?(g=parseInt(document.documentElement.offsetWidth),h=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(g+=21,h+=4)):(g=parseInt(window.innerWidth),h=parseInt(window.innerHeight)),g-10<b&&(b=g-10),h-10<c&&(c=h-10);var i=(h-c)/2*.6,j=(g-b)/2;a("#w2ui-popup").css(w2utils.cssPrefix({transition:f.speed+"s width, "+f.speed+"s height, "+f.speed+"s left, "+f.speed+"s top"})).css({top:i,left:j,width:b,height:c});var k=setInterval(function(){e.resizeMessages()},10);setTimeout(function(){clearInterval(k),f.width=b,f.height=c,e.resizeMessages(),"function"==typeof d&&d()},1e3*f.speed+50)},restoreTemplate:function(){var b=a("#w2ui-popup").data("options");if(null!=b){var c=w2popup._template,d=b.title,e=b.body,f=b.buttons;if(w2popup._prev?(c=w2popup._prev.template,d=w2popup._prev.title,e=w2popup._prev.body,f=w2popup._prev.buttons,delete w2popup._prev):delete w2popup._template,null!=c){var g=a(c);if(0===g.length)return;"body"==a(e).attr("rel")?(d&&g.append(d),e&&g.append(e),f&&g.append(f)):g.append(e)}}}},a.extend(w2popup,w2utils.event)}(jQuery);var w2alert=function(a,b,c){var d=jQuery;return null==b&&(b=w2utils.lang("Notification")),d("#w2ui-popup").length>0&&"closing"!=w2popup.status?w2popup.message({width:400,height:170,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+a+"</div>",buttons:'<button onclick="w2popup.message();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onOpen:function(){d("#w2ui-popup .w2ui-message .w2ui-popup-btn").focus()},onClose:function(){"function"==typeof c&&c()}}):w2popup.open({width:450,height:220,showMax:!1,showClose:!1,title:b,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+a+"</div>",buttons:'<button onclick="w2popup.close();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onOpen:function(a){setTimeout(function(){d("#w2ui-popup .w2ui-popup-btn").focus()},1)},onKeydown:function(a){d("#w2ui-popup .w2ui-popup-btn").focus().addClass("clicked")},onClose:function(){"function"==typeof c&&c()}}),{ok:function(a){return c=a,this},done:function(a){return c=a,this}}},w2confirm=function(a,b,c){var d=jQuery,e={},f={msg:"",title:w2utils.lang("Confirmation"),width:d("#w2ui-popup").length>0?400:450,height:d("#w2ui-popup").length>0?170:220,yes_text:"Yes",yes_class:"",yes_style:"",yes_callBack:null,no_text:"No",no_class:"",no_style:"",no_callBack:null,callBack:null};return 1==arguments.length&&"object"==typeof a?d.extend(e,f,a):"function"==typeof b?d.extend(e,f,{msg:a,callBack:b}):d.extend(e,f,{msg:a,title:b,callBack:c}),"object"==typeof e.btn_yes&&(e.yes_text=e.btn_yes.text||e.yes_text,e.yes_class=e.btn_yes.class||e.yes_class,e.yes_style=e.btn_yes.style||e.yes_style,e.yes_callBack=e.btn_yes.callBack||e.yes_callBack),"object"==typeof e.btn_no&&(e.no_text=e.btn_no.text||e.no_text,e.no_class=e.btn_no.class||e.no_class,e.no_style=e.btn_no.style||e.no_style,e.no_callBack=e.btn_no.callBack||e.no_callBack),d("#w2ui-popup").length>0&&"closing"!=w2popup.status&&w2popup.get()?(e.width>w2popup.get().width&&(e.width=w2popup.get().width),e.height>w2popup.get().height-50&&(e.height=w2popup.get().height-50),w2popup.message({width:e.width,height:e.height,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+e.msg+"</div>",buttons:'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+e.yes_class+'" style="'+e.yes_style+'">'+w2utils.lang(e.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+e.no_class+'" style="'+e.no_style+'">'+w2utils.lang(e.no_text)+"</button>",onOpen:function(){d("#w2ui-popup .w2ui-message .w2ui-btn").on("click.w2confirm",function(a){w2popup._confirm_btn=a.target.id,w2popup.message()})},onClose:function(){d("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2confirm"),setTimeout(function(){"function"==typeof e.callBack&&e.callBack(w2popup._confirm_btn),"Yes"==w2popup._confirm_btn&&"function"==typeof e.yes_callBack&&e.yes_callBack(),"No"==w2popup._confirm_btn&&"function"==typeof e.no_callBack&&e.no_callBack()},300)}})):(w2utils.isInt(e.height)||(e.height=e.height+50),w2popup.open({width:e.width,height:e.height,title:e.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+e.msg+"</div>",buttons:'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+e.yes_class+'" style="'+e.yes_style+'">'+w2utils.lang(e.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+e.no_class+'" style="'+e.no_style+'">'+w2utils.lang(e.no_text)+"</button>",onOpen:function(a){setTimeout(function(){d("#w2ui-popup .w2ui-popup-btn").on("click",function(a){w2popup.close(),"function"==typeof e.callBack&&e.callBack(a.target.id),"Yes"==a.target.id&&"function"==typeof e.yes_callBack&&e.yes_callBack(),"No"==a.target.id&&"function"==typeof e.no_callBack&&e.no_callBack()}),d("#w2ui-popup .w2ui-popup-btn#Yes").focus()},1)},onKeydown:function(a){if(0===d("#w2ui-popup .w2ui-message").length)switch(a.originalEvent.keyCode){case 13:d("#w2ui-popup .w2ui-popup-btn#Yes").focus().addClass("clicked"),w2popup.close();break;case 27:d("#w2ui-popup .w2ui-popup-btn#No").focus().click(),w2popup.close()}}})),{yes:function(a){return e.yes_callBack=a,this},no:function(a){return e.no_callBack=a,this}}},w2prompt=function(a,b,c){var d=jQuery,e={},f={label:"",value:"",attrs:"",textarea:!1,title:w2utils.lang("Notification"),ok_text:w2utils.lang("Ok"),cancel_text:w2utils.lang("Cancel"),width:d("#w2ui-popup").length>0?400:450,height:d("#w2ui-popup").length>0?170:220,callBack:null};return 1==arguments.length&&"object"==typeof a?d.extend(e,f,a):"function"==typeof b?d.extend(e,f,{label:a,callBack:b}):d.extend(e,f,{label:a,title:b,callBack:c}),d("#w2ui-popup").length>0&&"closing"!=w2popup.status&&w2popup.get()?(e.width>w2popup.get().width&&(e.width=w2popup.get().width),e.height>w2popup.get().height-50&&(e.height=w2popup.get().height-50),w2popup.message({width:e.width,height:e.height,body:e.textarea?'<div class="w2ui-prompt" style="font-size: 13px; padding: 15px 10px 0 10px;">  <div style="padding-bottom: 5px">'+e.label+'</div>  <textarea id="w2prompt" '+e.attrs+"></textarea></div>":'<div class="w2ui-prompt w2ui-centered" style="font-size: 13px;">  <label style="margin-right: 10px;">'+e.label+'</label>  <input id="w2prompt" '+e.attrs+"></div>",buttons:'<button id="Ok" class="w2ui-popup-btn w2ui-btn">'+e.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn">'+e.cancel_text+"</button>",onOpen:function(){d("#w2prompt").val(e.value),d("#w2ui-popup .w2ui-message .w2ui-btn#Ok").on("click.w2prompt",function(a){w2popup._prompt_value=d("#w2prompt").val(),w2popup.message()}),d("#w2ui-popup .w2ui-message .w2ui-btn#Cancel").on("click.w2prompt",function(a){w2popup._prompt_value=null,w2popup.message()}),setTimeout(function(){d("#w2prompt").focus()},100)},onClose:function(){d("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2prompt"),setTimeout(function(){"function"==typeof e.callBack&&null!=w2popup._prompt_value&&e.callBack(w2popup._prompt_value)},300)}})):(w2utils.isInt(e.height)||(e.height=e.height+50),w2popup.open({width:e.width,height:e.height,title:e.title,modal:!0,showClose:!1,
body:e.textarea?'<div class="w2ui-prompt" style="font-size: 13px; padding: 15px 10px 0 10px;">  <div style="padding-bottom: 5px">'+e.label+'</div>  <textarea id="w2prompt" '+e.attrs+"></textarea></div>":'<div class="w2ui-prompt w2ui-centered" style="font-size: 13px;">  <label style="margin-right: 10px;">'+e.label+'</label>  <input id="w2prompt" '+e.attrs+"></div>",buttons:'<button id="Ok" class="w2ui-popup-btn w2ui-btn">'+e.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn">'+e.cancel_text+"</button>",onOpen:function(a){setTimeout(function(){d("#w2prompt").val(e.value),d("#w2prompt").w2field("text"),d("#w2ui-popup .w2ui-popup-btn#Ok").on("click",function(a){w2popup._prompt_value=d("#w2prompt").val(),w2popup.close(),"function"==typeof e.callBack&&e.callBack(w2popup._prompt_value)}),d("#w2ui-popup .w2ui-popup-btn#Cancel").on("click",function(a){w2popup._prompt_value=null,w2popup.close()}),d("#w2ui-popup .w2ui-popup-btn#Ok"),setTimeout(function(){d("#w2prompt").focus()},100)},1)},onKeydown:function(a){if(0===d("#w2ui-popup .w2ui-message").length)switch(a.originalEvent.keyCode){case 13:d("#w2ui-popup .w2ui-popup-btn#Ok").focus().addClass("clicked"),w2popup.close();break;case 27:w2popup.close()}}})),{change:function(a){return d("#w2prompt").on("keyup",a).keyup(),this},ok:function(a){return e.callBack=a,this}}};!function(a){var b=function(b){this.box=null,this.name=null,this.active=null,this.flow="down",this.tooltip="top|left",this.tabs=[],this.routeData={},this.right="",this.style="",a.extend(this,{handlers:[]}),a.extend(!0,this,w2obj.tabs,b)};a.fn.w2tabs=function(c){if(a.isPlainObject(c)){if(!w2utils.checkName(c,"w2tabs"))return;for(var d=c.tabs||[],e=new b(c),f=0;f<d.length;f++)e.tabs[f]=a.extend({},b.prototype.tab,d[f]);return 0!==a(this).length&&e.render(a(this)[0]),w2ui[e.name]=e,e}var g=w2ui[a(this).attr("name")];return g?arguments.length>0?(g[c]&&g[c].apply(g,Array.prototype.slice.call(arguments,1)),this):g:null},b.prototype={onClick:null,onClose:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,tab:{id:null,text:null,route:null,hidden:!1,disabled:!1,closable:!1,tooltip:null,style:"",onClick:null,onRefresh:null,onClose:null},add:function(a){return this.insert(null,a)},insert:function(c,d){a.isArray(d)||(d=[d]);for(var e=0;e<d.length;e++){if(null==d[e].id)return void console.log('ERROR: The parameter "id" is required but not supplied. (obj: '+this.name+")");if(!w2utils.checkUniqueId(d[e].id,this.tabs,"tabs",this.name))return;var f=a.extend({},b.prototype.tab,d[e]);if(null==c)this.tabs.push(f);else{var g=this.get(c,!0);this.tabs=this.tabs.slice(0,g).concat([f],this.tabs.slice(g))}this.refresh(d[e].id),this.resize()}},remove:function(){for(var b=0,c=0;c<arguments.length;c++){var d=this.get(arguments[c]);if(!d)return!1;b++,this.tabs.splice(this.get(d.id,!0),1),a(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(d.id)).remove()}return this.resize(),b},select:function(a){return this.active!=a&&null!=this.get(a)&&(this.active=a,this.refresh(),!0)},set:function(b,c){var d=this.get(b,!0);return null!=d&&(a.extend(this.tabs[d],c),this.refresh(b),!0)},get:function(a,b){if(0===arguments.length){for(var c=[],d=0;d<this.tabs.length;d++)null!=this.tabs[d].id&&c.push(this.tabs[d].id);return c}for(var e=0;e<this.tabs.length;e++)if(this.tabs[e].id==a)return b===!0?e:this.tabs[e];return null},show:function(){for(var a=this,b=0,c=[],d=0;d<arguments.length;d++){var e=this.get(arguments[d]);e&&e.hidden!==!1&&(b++,e.hidden=!1,c.push(e.id))}return setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b]);a.resize()},15),b},hide:function(){for(var a=this,b=0,c=[],d=0;d<arguments.length;d++){var e=this.get(arguments[d]);e&&e.hidden!==!0&&(b++,e.hidden=!0,c.push(e.id))}return setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b]);a.resize()},15),b},enable:function(){for(var a=this,b=0,c=[],d=0;d<arguments.length;d++){var e=this.get(arguments[d]);e&&e.disabled!==!1&&(b++,e.disabled=!1,c.push(e.id))}return setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b])},15),b},disable:function(){for(var a=this,b=0,c=[],d=0;d<arguments.length;d++){var e=this.get(arguments[d]);e&&e.disabled!==!0&&(b++,e.disabled=!0,c.push(e.id))}return setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b])},15),b},tooltipShow:function(b,c,d){if(null!=this.tooltip){var e=a(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(b)),f=this.get(b),g=this.tooltip,h=f.tooltip;"function"==typeof h&&(h=h.call(this,f)),e.prop("_mouse_over",!0),setTimeout(function(){e.prop("_mouse_over")===!0&&e.prop("_mouse_tooltip")!==!0&&(e.prop("_mouse_tooltip",!0),e.w2tag(w2utils.lang(h),{position:g})),1==d&&e.w2tag(w2utils.lang(h),{position:g})},1)}},tooltipHide:function(b){if(null!=this.tooltip){var c=a(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(b));this.get(b);c.removeProp("_mouse_over"),setTimeout(function(){c.prop("_mouse_over")!==!0&&c.prop("_mouse_tooltip")===!0&&(c.removeProp("_mouse_tooltip"),c.w2tag())},1)}},refresh:function(b){var c=(new Date).getTime();"up"==this.flow?a(this.box).addClass("w2ui-tabs-up"):a(this.box).removeClass("w2ui-tabs-up");var d=this.trigger({phase:"before",type:"refresh",target:null!=b?b:this.name,object:this.get(b)});if(d.isCancelled!==!0){if(null==b)for(var e=0;e<this.tabs.length;e++)this.refresh(this.tabs[e].id);else{var f=this.get(b);if(null==f)return!1;null==f.text&&null!=f.caption&&(f.text=f.caption),null==f.tooltip&&null!=f.hint&&(f.tooltip=f.hint);var g=f.text;"function"==typeof g&&(g=g.call(this,f)),null==g&&(g="");var h=a(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(f.id)),i="";f.closable&&!f.disabled&&(i='<div class="w2ui-tab-close"     onmouseover = "w2ui[\''+this.name+"'].tooltipShow('"+f.id+"', event);\"    onmouseout  = \"w2ui['"+this.name+"'].tooltipHide('"+f.id+"', event);\"    onclick=\"w2ui['"+this.name+"'].animateClose('"+f.id+"', event);\"></div>");var j=i+'    <div class="w2ui-tab'+(this.active===f.id?" active":"")+(f.closable?" closable":"")+(f.class?" "+f.class:"")+'" style="'+f.style+'"         onmouseover = "'+(f.disabled?"":"w2ui['"+this.name+"'].tooltipShow('"+f.id+"', event);")+'"        onmouseout  = "'+(f.disabled?"":"w2ui['"+this.name+"'].tooltipHide('"+f.id+"', event);")+'"        onclick="w2ui[\''+this.name+"'].click('"+f.id+"', event);\">"+w2utils.lang(g)+"</div>";if(0===h.length){var k="";f.hidden&&(k+="display: none;"),f.disabled&&(k+="opacity: 0.2;");var l='<td id="tabs_'+this.name+"_tab_"+f.id+'" style="'+k+'" valign="middle">'+j+"</td>";this.get(b,!0)!==this.tabs.length-1&&a(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(b,!0))+1].id)).length>0?a(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(b,!0))+1].id)).before(l):a(this.box).find("#tabs_"+this.name+"_right").before(l)}else h.html(j),f.hidden?h.css("display","none"):h.css("display",""),f.disabled?h.css({opacity:"0.2"}):h.css({opacity:"1"})}return a("#tabs_"+this.name+"_right").html(this.right),this.trigger(a.extend(d,{phase:"after"})),(new Date).getTime()-c}},render:function(b){var c=(new Date).getTime(),d=this.trigger({phase:"before",type:"render",target:this.name,box:b});if(d.isCancelled!==!0){if(null!=b&&(a(this.box).find("> table #tabs_"+this.name+"_right").length>0&&a(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=b),!this.box)return!1;var e='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="1" width="100%"><tbody>    <tr><td width="100%" id="tabs_'+this.name+'_right" align="right">'+this.right+'</td></tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+this.name+"']; if (el) el.scroll('right');\"></div>";return a(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(e),a(this.box).length>0&&(a(this.box)[0].style.cssText+=this.style),this.trigger(a.extend(d,{phase:"after"})),this.refresh(),this.resize(),(new Date).getTime()-c}},scroll:function(b){var g,h,i,c=a(this.box),d=this,e=c.find(".w2ui-scroll-wrapper"),f=e.scrollLeft();switch(b){case"left":g=e.outerWidth(),h=e.find(":first").outerWidth(),i=f-g+50,i<=0&&(i=0),e.animate({scrollLeft:i},300);break;case"right":g=e.outerWidth(),h=e.find(":first").outerWidth(),i=f+g-50,i>=h-g&&(i=h-g),e.animate({scrollLeft:i},300)}setTimeout(function(){d.resize()},350)},resize:function(){var b=(new Date).getTime(),c=this.trigger({phase:"before",type:"resize",target:this.name});if(c.isCancelled!==!0){var d=a(this.box);d.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var e=d.find(".w2ui-scroll-wrapper");return e.find(":first").outerWidth()>e.outerWidth()&&(e.scrollLeft()>0&&d.find(".w2ui-scroll-left").show(),e.scrollLeft()<e.find(":first").outerWidth()-e.outerWidth()&&d.find(".w2ui-scroll-right").show()),this.trigger(a.extend(c,{phase:"after"})),(new Date).getTime()-b}},destroy:function(){var b=this.trigger({phase:"before",type:"destroy",target:this.name});b.isCancelled!==!0&&(a(this.box).find("> table #tabs_"+this.name+"_right").length>0&&a(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),delete w2ui[this.name],this.trigger(a.extend(b,{phase:"after"})))},click:function(b,c){var d=this.get(b);if(null==d||d.disabled)return!1;var e=this.trigger({phase:"before",type:"click",target:b,tab:d,object:d,originalEvent:c});if(e.isCancelled!==!0){if(a(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)+" .w2ui-tab").removeClass("active"),this.active=d.id,"string"==typeof d.route){var f=""!==d.route?String("/"+d.route).replace(/\/{2,}/g,"/"):"",g=w2utils.parseRoute(f);if(g.keys.length>0)for(var h=0;h<g.keys.length;h++)null!=this.routeData[g.keys[h].name]&&(f=f.replace(new RegExp(":"+g.keys[h].name,"g"),this.routeData[g.keys[h].name]));setTimeout(function(){window.location.hash=f},1)}this.trigger(a.extend(e,{phase:"after"})),this.refresh(b)}},animateClose:function(b,c){var d=this.get(b);if(null==d||d.disabled)return!1;var e=this.trigger({phase:"before",type:"close",target:b,object:this.get(b),originalEvent:c});if(e.isCancelled!==!0){var f=this;a(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(d.id)).css(w2utils.cssPrefix("transition",".2s")).css("opacity","0"),setTimeout(function(){var b=a(f.box).find("#tabs_"+f.name+"_tab_"+w2utils.escapeId(d.id)).width();a(f.box).find("#tabs_"+f.name+"_tab_"+w2utils.escapeId(d.id)).html('<div style="width: '+b+"px; "+w2utils.cssPrefix("transition",".2s",!0)+'"></div>'),setTimeout(function(){a(f.box).find("#tabs_"+f.name+"_tab_"+w2utils.escapeId(d.id)).find(":first-child").css({width:"0px"})},50)},200),setTimeout(function(){f.remove(b)},450),this.trigger(a.extend(e,{phase:"after"})),this.refresh()}},animateInsert:function(b,c){if(null!=this.get(b)&&a.isPlainObject(c)&&w2utils.checkUniqueId(c.id,this.tabs,"tabs",this.name)){var d=a(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(c.id));if(0===d.length){null==c.text&&null!=c.caption&&(c.text=c.caption);var e='<div id="_tmp_tabs" class="w2ui-reset w2ui-tabs" style="position: absolute; top: -1000px;"><table cellspacing="0" cellpadding="1" width="100%"><tbody><tr><td id="_tmp_simple_tab" style="" valign="middle">'+(c.closable?'<div class="w2ui-tab-close"></div>':"")+'    <div class="w2ui-tab '+(this.active===c.id?"active":"")+'">'+c.text+"</div></td></tr></tbody></table></div>";a("body").append(e);var f='<div style="width: 1px; '+w2utils.cssPrefix("transition",".2s",!0)+'">&#160;</div>',g="";c.hidden&&(g+="display: none;"),c.disabled&&(g+="opacity: 0.2;");var h='<td id="tabs_'+this.name+"_tab_"+c.id+'" style="'+g+'" valign="middle">'+f+"</td>";this.get(b,!0)!==this.tabs.length&&a(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(b,!0))].id)).length>0?a(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(b,!0))].id)).before(h):a(this.box).find("#tabs_"+this.name+"_right").before(h);var i=this;setTimeout(function(){var b=a("#_tmp_simple_tab").width();a("#_tmp_tabs").remove(),a("#tabs_"+i.name+"_tab_"+w2utils.escapeId(c.id)+" > div").css("width",b+"px")},1),setTimeout(function(){i.insert(b,c)},200)}}}},a.extend(b.prototype,w2utils.event),w2obj.tabs=b}(jQuery),function(a){var b=function(b){this.box=null,this.name=null,this.routeData={},this.items=[],this.right="",this.tooltip="top|left",a.extend(!0,this,w2obj.toolbar,b)};a.fn.w2toolbar=function(c){if(a.isPlainObject(c)){if(!w2utils.checkName(c,"w2toolbar"))return;var d=c.items||[],e=new b(c);a.extend(e,{items:[],handlers:[]});for(var f=0;f<d.length;f++)if(e.items[f]=a.extend({},b.prototype.item,d[f]),"menu-check"==e.items[f].type){var g=e.items[f];if(Array.isArray(g.selected)||(g.selected=[]),Array.isArray(g.items))for(var h=0;h<g.items.length;h++){var i=g.items[h];i.checked&&g.selected.indexOf(i.id)==-1&&g.selected.push(i.id),i.checked||g.selected.indexOf(i.id)==-1||(i.checked=!0),null==i.checked&&(i.checked=!1)}}else if("menu-radio"==e.items[f].type){var g=e.items[f];if(Array.isArray(g.items))for(var h=0;h<g.items.length;h++){var i=g.items[h];i.checked&&null==g.selected?g.selected=i.id:i.checked=!1,i.checked||g.selected!=i.id||(i.checked=!0),null==i.checked&&(i.checked=!1)}}return 0!==a(this).length&&e.render(a(this)[0]),w2ui[e.name]=e,e}var j=w2ui[a(this).attr("name")];return j?arguments.length>0?(j[c]&&j[c].apply(j,Array.prototype.slice.call(arguments,1)),this):j:null},b.prototype={onClick:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,item:{id:null,type:"button",text:null,html:"",tooltip:null,count:null,hidden:!1,disabled:!1,checked:!1,img:null,icon:null,route:null,arrow:!0,style:null,color:null,transparent:null,advanced:null,group:null,items:null,selected:null,overlay:{},onClick:null,onRefresh:null},add:function(a){this.insert(null,a)},insert:function(c,d){a.isArray(d)||(d=[d]);for(var e=0;e<d.length;e++){if(null==d[e].type)return void console.log('ERROR: The parameter "type" is required but not supplied in w2toolbar.add() method.');if(a.inArray(String(d[e].type),["button","check","radio","drop","menu","menu-radio","menu-check","color","text-color","break","html","spacer"])==-1)return void console.log('ERROR: The parameter "type" should be one of the following [button, check, radio, drop, menu, break, html, spacer] in w2toolbar.add() method.');if(null==d[e].id&&"break"!=d[e].type&&"spacer"!=d[e].type)return void console.log('ERROR: The parameter "id" is required but not supplied in w2toolbar.add() method.');if(!w2utils.checkUniqueId(d[e].id,this.items,"toolbar items",this.name))return;var f=a.extend({},b.prototype.item,d[e]);if(null==c)this.items.push(f);else{var g=this.get(c,!0);this.items=this.items.slice(0,g).concat([f],this.items.slice(g))}this.refresh(f.id),this.resize()}},remove:function(){for(var b=0,c=0;c<arguments.length;c++){var d=this.get(arguments[c]);if(d&&String(arguments[c]).indexOf(":")==-1){b++,a(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(d.id)).remove();var e=this.get(d.id,!0);null!=e&&this.items.splice(e,1)}}return this.resize(),b},set:function(b,c){var d=this.get(b);return null!=d&&(a.extend(d,c),this.refresh(String(b).split(":")[0]),!0)},get:function(a,b){if(0===arguments.length){for(var c=[],d=0;d<this.items.length;d++)null!=this.items[d].id&&c.push(this.items[d].id);return c}for(var e=String(a).split(":"),f=0;f<this.items.length;f++){var g=this.items[f];if(["menu","menu-radio","menu-check"].indexOf(g.type)!=-1&&2==e.length&&g.id==e[0])for(var h=0;h<g.items.length;h++){var i=g.items[h];if(i.id==e[1]||null==i.id&&i.text==e[1])return 1==b?h:i}else if(g.id==e[0])return 1==b?f:g}return null},show:function(){for(var a=this,b=0,c=[],d=0;d<arguments.length;d++){var e=this.get(arguments[d]);e&&(b++,e.hidden=!1,c.push(String(arguments[d]).split(":")[0]))}return setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b]);a.resize()},15),b},hide:function(){for(var a=this,b=0,c=[],d=0;d<arguments.length;d++){var e=this.get(arguments[d]);e&&(b++,e.hidden=!0,c.push(String(arguments[d]).split(":")[0]))}return setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b]),a.tooltipHide(c[b]);a.resize()},15),b},enable:function(){for(var a=this,b=0,c=[],d=0;d<arguments.length;d++){var e=this.get(arguments[d]);e&&(b++,e.disabled=!1,c.push(String(arguments[d]).split(":")[0]))}return setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b])},15),b},disable:function(){for(var a=this,b=0,c=[],d=0;d<arguments.length;d++){var e=this.get(arguments[d]);e&&(b++,e.disabled=!0,c.push(String(arguments[d]).split(":")[0]))}return setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b]),a.tooltipHide(c[b])},15),b},check:function(){for(var a=this,b=0,c=[],d=0;d<arguments.length;d++){var e=this.get(arguments[d]);e&&String(arguments[d]).indexOf(":")==-1&&(b++,e.checked=!0,c.push(String(arguments[d]).split(":")[0]))}return setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b])},15),b},uncheck:function(){for(var b=this,c=0,d=[],e=0;e<arguments.length;e++){var f=this.get(arguments[e]);f&&String(arguments[e]).indexOf(":")==-1&&(["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(f.type)!=-1&&f.checked&&setTimeout(function(){var c=a("#tb_"+b.name+"_item_"+w2utils.escapeId(f.id));c.w2overlay({name:b.name})},1),c++,f.checked=!1,d.push(String(arguments[e]).split(":")[0]))}return setTimeout(function(){for(var a=0;a<d.length;a++)b.refresh(d[a])},15),c},click:function(b,c){var d=this,e=String(b).split(":"),f=this.get(e[0]);if(e.length>1){var g=this.get(b);return void(g&&!g.disabled&&d.menuClick({name:d.name,item:f,subItem:g,originalEvent:c}))}if(f&&!f.disabled){var h=this.trigger({phase:"before",type:"click",target:null!=b?b:this.name,item:f,object:f,originalEvent:c});if(h.isCancelled===!0)return;var i="#tb_"+this.name+"_item_"+w2utils.escapeId(f.id)+" table.w2ui-button";if(a(i).removeClass("down"),"radio"==f.type){for(var j=0;j<this.items.length;j++){var k=this.items[j];null!=k&&k.id!=f.id&&"radio"===k.type&&k.group==f.group&&k.checked&&(k.checked=!1,this.refresh(k.id))}f.checked=!0,a(i).addClass("checked")}if(["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(f.type)!=-1&&(d.tooltipHide(b),f.checked?setTimeout(function(){var b=a("#tb_"+d.name+"_item_"+w2utils.escapeId(f.id));b.w2overlay({name:d.name}),f.checked=!1,d.refresh(f.id)},1):setTimeout(function(){function g(b){f.checked=!1,a(i).removeClass("checked")}var b=a("#tb_"+d.name+"_item_"+w2utils.escapeId(f.id));a.isPlainObject(f.overlay)||(f.overlay={});var c=(b.width()-50)/2;if(c>19&&(c=19),"drop"==f.type&&b.w2overlay(f.html,a.extend({name:d.name,left:c,top:3},f.overlay,{onHide:function(a){g()}})),["menu","menu-radio","menu-check"].indexOf(f.type)!=-1){var e="normal";"menu-radio"==f.type&&(e="radio",f.items.forEach(function(a){f.selected==a.id?a.checked=!0:a.checked=!1})),"menu-check"==f.type&&(e="check",f.items.forEach(function(b){a.isArray(f.selected)&&f.selected.indexOf(b.id)!=-1?b.checked=!0:b.checked=!1})),b.w2menu(a.extend({name:d.name,items:f.items,left:c,top:3},f.overlay,{type:e,select:function(a){d.menuClick({name:d.name,item:f,subItem:a.item,originalEvent:a.originalEvent,keepOpen:a.keepOpen})},onHide:function(a){g()}}))}["color","text-color"].indexOf(f.type)!=-1&&(null==f.transparent&&(f.transparent=!0),a(b).w2color({color:f.color,transparent:f.transparent,advanced:f.advanced,onHide:function(a){g(),d._tmpColor&&d.colorClick({name:d.name,item:f,color:d._tmpColor,final:!0}),delete d._tmpColor},onSelect:function(a){null!=a&&(d.colorClick({name:d.name,item:f,color:a}),d._tmpColor=a)}}))},1)),["check","menu","menu-radio","menu-check","drop","color","text-color"].indexOf(f.type)!=-1&&(f.checked=!f.checked,f.checked?a(i).addClass("checked"):a(i).removeClass("checked")),f.route){var l=String("/"+f.route).replace(/\/{2,}/g,"/"),m=w2utils.parseRoute(l);if(m.keys.length>0)for(var n=0;n<m.keys.length;n++)l=l.replace(new RegExp(":"+m.keys[n].name,"g"),this.routeData[m.keys[n].name]);setTimeout(function(){window.location.hash=l},1)}c&&["button","check","radio"].indexOf(f.type)!=-1&&this.tooltipShow(b,c,!0),this.trigger(a.extend(h,{phase:"after"}))}},scroll:function(b){var g,h,i,c=a(this.box),d=this,e=c.find(".w2ui-scroll-wrapper"),f=e.scrollLeft();switch(b){case"left":g=e.outerWidth(),h=e.find(":first").outerWidth(),i=f-g+50,i<=0&&(i=0),e.animate({scrollLeft:i},300);break;case"right":g=e.outerWidth(),h=e.find(":first").outerWidth(),i=f+g-50,i>=h-g&&(i=h-g),e.animate({scrollLeft:i},300)}setTimeout(function(){d.resize()},350)},render:function(b){var c=(new Date).getTime(),d=this.trigger({phase:"before",type:"render",target:this.name,box:b});if(d.isCancelled!==!0&&(null!=b&&(a(this.box).find("> table #tb_"+this.name+"_right").length>0&&a(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=b),this.box)){for(var e='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="0" width="100%"><tbody><tr>',f=0;f<this.items.length;f++){var g=this.items[f];null!=g&&(null==g.id&&(g.id="item_"+f),e+="spacer"==g.type?'<td width="100%" id="tb_'+this.name+"_item_"+g.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+g.id+'" style="'+(g.hidden?"display: none":"")+'"     class="'+(g.disabled?"disabled":"")+'" valign="middle"></td>')}return e+='<td width="100%" id="tb_'+this.name+'_right" align="right">'+this.right+"</td>",e+='</tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+this.name+"']; if (el) el.scroll('right');\"></div>",a(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(e),a(this.box).length>0&&(a(this.box)[0].style.cssText+=this.style),this.refresh(),this.resize(),this.trigger(a.extend(d,{phase:"after"})),(new Date).getTime()-c}},refresh:function(b){var c=(new Date).getTime(),d=this.trigger({phase:"before",type:"refresh",target:null!=b?b:this.name,item:this.get(b)});if(d.isCancelled!==!0){if(null!=b){var g=this.get(b);if(null==g)return!1;if("function"==typeof g.onRefresh){var h=this.trigger({phase:"before",type:"refresh",target:b,item:g,object:g});if(h.isCancelled===!0)return}var i=a(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(g.id)),j=this.getItemHTML(g);return 0===i.length?(j="spacer"==g.type?'<td width="100%" id="tb_'+this.name+"_item_"+g.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+g.id+'" style="'+(g.hidden?"display: none":"")+'"     class="'+(g.disabled?"disabled":"")+'" valign="middle">'+j+"</td>",this.get(b,!0)==this.items.length-1?a(this.box).find("#tb_"+this.name+"_right").before(j):a(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(this.items[parseInt(this.get(b,!0))+1].id)).before(j)):(["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(g.type)!=-1&&0==g.checked&&a("#w2ui-overlay-"+this.name).length>0&&a("#w2ui-overlay-"+this.name)[0].hide(),i.html(j),g.hidden?i.css("display","none"):i.css("display",""),g.disabled?i.addClass("disabled"):i.removeClass("disabled")),"function"==typeof g.onRefresh&&this.trigger(a.extend(h,{phase:"after"})),this.trigger(a.extend(d,{phase:"after"})),(new Date).getTime()-c}for(var e=0;e<this.items.length;e++){var f=this.items[e];null==f.id&&(f.id="item_"+e),this.refresh(f.id)}}},resize:function(){var b=(new Date).getTime(),c=this.trigger({phase:"before",type:"resize",target:this.name});if(c.isCancelled!==!0){var d=a(this.box);d.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var e=d.find(".w2ui-scroll-wrapper");return e.find(":first").outerWidth()>e.outerWidth()&&(e.scrollLeft()>0&&d.find(".w2ui-scroll-left").show(),e.scrollLeft()<e.find(":first").outerWidth()-e.outerWidth()&&d.find(".w2ui-scroll-right").show()),this.trigger(a.extend(c,{phase:"after"})),(new Date).getTime()-b}},destroy:function(){var b=this.trigger({phase:"before",type:"destroy",target:this.name});b.isCancelled!==!0&&(a(this.box).find("> table #tb_"+this.name+"_right").length>0&&a(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),a(this.box).html(""),delete w2ui[this.name],this.trigger(a.extend(b,{phase:"after"})))},getItemHTML:function(a){var b="";null!=a.caption&&null==a.text&&(a.text=a.caption),null==a.text&&(a.text=""),null==a.tooltip&&null!=a.hint&&(a.tooltip=a.hint),null==a.tooltip&&(a.tooltip="");var c="<td>&#160;</td>",d=a.text;if("function"==typeof d&&(d=d.call(this,a)),a.img&&(c='<td><div class="w2ui-tb-image w2ui-icon '+a.img+'"></div></td>'),a.icon&&(c='<td><div class="w2ui-tb-image"><span class="'+a.icon+'"></span></div></td>'),""===b)switch(a.type){case"color":case"text-color":"string"==typeof a.color&&("#"==a.color.substr(0,1)&&(a.color=a.color.substr(1)),3!=a.color.length&&6!=a.color.length||(a.color="#"+a.color)),"color"==a.type&&(d='<div style="height: 12px; width: 12px; margin-top: 1px; border: 1px solid #8A8A8A; border-radius: 1px; box-shadow: 0px 0px 1px #fff;         background-color: '+(null!=a.color?a.color:"#fff")+'; float: left;"></div>'+(a.text?'<div style="margin-left: 17px;">'+w2utils.lang(a.text)+"</div>":"")),"text-color"==a.type&&(d='<div style="color: '+(null!=a.color?a.color:"#444")+';">'+(a.text?w2utils.lang(a.text):"<b>Aa</b>")+"</div>");case"menu":case"menu-check":case"menu-radio":case"button":case"check":case"radio":case"drop":b+='<table cellpadding="0" cellspacing="0"        class="w2ui-button '+(a.checked?"checked":"")+'"        onclick     = "var el=w2ui[\''+this.name+"']; if (el) el.click('"+a.id+'\', event);"        onmouseover = "'+(a.disabled?"":"jQuery(this).addClass('over'); w2ui['"+this.name+"'].tooltipShow('"+a.id+"', event);")+'"       onmouseout  = "'+(a.disabled?"":"jQuery(this).removeClass('over').removeClass('down'); w2ui['"+this.name+"'].tooltipHide('"+a.id+"', event);")+'"       onmousedown = "'+(a.disabled?"":"jQuery(this).addClass('down');")+'"       onmouseup   = "'+(a.disabled?"":"jQuery(this).removeClass('down');")+'"><tbody><tr><td>  <table cellpadding="1" cellspacing="0"><tbody>  <tr>'+c+(""!==d?'<td class="w2ui-tb-caption" nowrap="nowrap" style="'+(a.style?a.style:"")+'">'+w2utils.lang(d)+"</td>":"")+(null!=a.count?'<td class="w2ui-tb-count" nowrap="nowrap"><span>'+a.count+"</span></td>":"")+(["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(a.type)!=-1&&a.arrow!==!1?'<td class="w2ui-tb-down" nowrap="nowrap"><div></div></td>':"")+"  </tr></tbody></table></td></tr></tbody></table>";break;case"break":b+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td><div class="w2ui-break">&#160;</div></td></tr></tbody></table>';break;case"html":b+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td nowrap="nowrap">'+("function"==typeof a.html?a.html.call(this,a):a.html)+"</td></tr></tbody></table>"}return"<div>"+b+"</div>"},tooltipShow:function(b,c,d){if(null!=this.tooltip){var e=a(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(b)),f=this.get(b),g=this.tooltip,h=f.tooltip;"function"==typeof h&&(h=h.call(this,f)),e.prop("_mouse_over",!0),setTimeout(function(){if(e.prop("_mouse_over")===!0&&e.prop("_mouse_tooltip")!==!0){if(e.prop("_mouse_tooltip",!0),["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(f.type)!=-1&&1==f.checked)return;e.w2tag(w2utils.lang(h),{position:g})}1==d&&e.w2tag(w2utils.lang(h),{position:g})},1)}},tooltipHide:function(b,c){if(null!=this.tooltip){var d=a(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(b));this.get(b);d.removeProp("_mouse_over"),setTimeout(function(){d.prop("_mouse_over")!==!0&&d.prop("_mouse_tooltip")===!0&&(d.removeProp("_mouse_tooltip"),d.w2tag())},1)}},menuClick:function(b){var c=this;if(b.item&&!b.item.disabled){var d=this.trigger({phase:"before",type:"click",target:b.item.id+":"+b.subItem.id,item:b.item,subItem:b.subItem,originalEvent:b.originalEvent});if(d.isCancelled===!0)return;var e=b.subItem,f=this.get(b.item.id);if("menu-radio"==f.type&&(f.selected=e.id,b.item.items.forEach(function(a){a.checked=!1}),e.checked=!0),"menu-check"==f.type)if(a.isArray(f.selected)||(f.selected=[]),null==e.group){var g=f.selected.indexOf(e.id);g==-1?(f.selected.push(e.id),e.checked=!0):(f.selected.splice(g,1),e.checked=!1)}else{var h=[];f.items.forEach(function(a){if(a.group===e.group){var b=f.selected.indexOf(a.id);b!=-1&&(a.id!=e.id&&h.push(a.id),f.selected.splice(b,1))}});var g=f.selected.indexOf(e.id);g==-1&&(f.selected.push(e.id),e.checked=!0)}if("string"==typeof e.route){var i=""!==e.route?String("/"+e.route).replace(/\/{2,}/g,"/"):"",j=w2utils.parseRoute(i);if(j.keys.length>0)for(var k=0;k<j.keys.length;k++)null!=c.routeData[j.keys[k].name]&&(i=i.replace(new RegExp(":"+j.keys[k].name,"g"),this.routeData[j.keys[k].name]));setTimeout(function(){window.location.hash=i},1)}this.refresh(b.item.id),this.trigger(a.extend(d,{phase:"after"}))}},colorClick:function(b){var c=this;if(b.item&&!b.item.disabled){var d=this.trigger({phase:"before",type:"click",target:b.item.id,item:b.item,color:b.color,final:b.final,originalEvent:b.originalEvent});if(d.isCancelled===!0)return;b.item.color=b.color,c.refresh(b.item.id),this.trigger(a.extend(d,{phase:"after"}))}}},a.extend(b.prototype,w2utils.event),w2obj.toolbar=b}(jQuery),function(a){var b=function(b){this.el=null,this.helpers={},this.type=b.type||"text",this.options=a.extend(!0,{},b),this.onSearch=b.onSearch||null,this.onRequest=b.onRequest||null,this.onLoad=b.onLoad||null,this.onError=b.onError||null,this.onClick=b.onClick||null,this.onAdd=b.onAdd||null,this.onNew=b.onNew||null,this.onRemove=b.onRemove||null,this.onMouseOver=b.onMouseOver||null,this.onMouseOut=b.onMouseOut||null,this.onIconClick=b.onIconClick||null,this.onScroll=b.onScroll||null,this.tmp={},delete this.options.type,delete this.options.onSearch,delete this.options.onRequest,delete this.options.onLoad,delete this.options.onError,delete this.options.onClick,delete this.options.onMouseOver,delete this.options.onMouseOut,delete this.options.onIconClick,delete this.options.onScroll,a.extend(!0,this,w2obj.field)};a.fn.w2field=function(c,d){if(0!==this.length){if(0===arguments.length){var f=a(this).data("w2field");return f}return"string"==typeof c&&"object"==typeof d&&(c=a.extend(!0,{},d,{type:c})),"string"==typeof c&&null==d&&(c={type:c}),c&&(c.type=String(c.type).toLowerCase()),this.each(function(d,e){var f=a(e).data("w2field");if(null==f){var f=new b(c);return a.extend(f,{handlers:[]}),e&&(f.el=a(e)[0]),f.init(),a(e).data("w2field",f),f}if(f.clear(),"clear"!=c.type){var f=new b(c);return a.extend(f,{handlers:[]}),e&&(f.el=a(e)[0]),f.init(),a(e).data("w2field",f),f}})}var e=b.prototype;if(e[c])return e[c].apply(e,Array.prototype.slice.call(arguments,1))},b.prototype={custom:{},addType:function(a,b){return a=String(a).toLowerCase(),this.custom[a]=b,!0},removeType:function(a){return a=String(a).toLowerCase(),!!this.custom[a]&&(delete this.custom[a],!0)},init:function(){var d,b=this,c=this.options;if("function"==typeof this.custom[this.type])return void this.custom[this.type].call(this,c);if(["INPUT","TEXTAREA"].indexOf(this.el.tagName.toUpperCase())==-1)return void console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el);switch(this.type){case"text":case"int":case"float":case"money":case"currency":case"percent":case"alphanumeric":case"bin":case"hex":d={min:null,max:null,step:1,autoFormat:!0,currencyPrefix:w2utils.settings.currencyPrefix,currencySuffix:w2utils.settings.currencySuffix,currencyPrecision:w2utils.settings.currencyPrecision,decimalSymbol:w2utils.settings.decimalSymbol,groupSymbol:w2utils.settings.groupSymbol,arrows:!1,keyboard:!0,precision:null,silent:!0,prefix:"",suffix:""},this.options=a.extend(!0,{},d,c),
c=this.options,c.numberRE=new RegExp("["+c.groupSymbol+"]","g"),c.moneyRE=new RegExp("["+c.currencyPrefix+c.currencySuffix+c.groupSymbol+"]","g"),c.percentRE=new RegExp("["+c.groupSymbol+"%]","g"),["text","alphanumeric","hex","bin"].indexOf(this.type)!=-1&&(c.arrows=!1,c.keyboard=!1),this.addPrefix(),this.addSuffix();break;case"color":d={prefix:"",suffix:'<div style="width: '+(parseInt(a(this.el).css("font-size"))||12)+'px">&#160;</div>',arrows:!1,keyboard:!1,advanced:null,transparent:!0},a.extend(c,d),this.addPrefix(),this.addSuffix(),""!==a(this.el).val()&&setTimeout(function(){b.change()},1);break;case"date":d={format:w2utils.settings.dateFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:{},colored:{},blockWeekDays:null},this.options=a.extend(!0,{},d,c),c=this.options,null==a(this.el).attr("placeholder")&&a(this.el).attr("placeholder",c.format);break;case"time":d={format:w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",noMinutes:!1},this.options=a.extend(!0,{},d,c),c=this.options,null==a(this.el).attr("placeholder")&&a(this.el).attr("placeholder",c.format);break;case"datetime":d={format:w2utils.settings.dateFormat+" | "+w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:[],colored:{},placeholder:null,btn_now:!0,noMinutes:!1},this.options=a.extend(!0,{},d,c),c=this.options,null==a(this.el).attr("placeholder")&&a(this.el).attr("placeholder",c.placeholder||c.format);break;case"list":case"combo":if(d={items:[],selected:{},url:null,recId:null,recText:null,method:null,interval:350,postData:{},minLength:1,cacheMax:250,maxDropHeight:350,maxDropWidth:null,match:"begins",silent:!0,icon:null,iconStyle:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onIconClick:null,renderDrop:null,compare:null,filter:!0,prefix:"",suffix:"",openOnFocus:!1,markSearch:!1},c.items=this.normMenu(c.items),"list"==this.type){if(d.openOnFocus=!0,a(this.el).addClass("w2ui-select"),!a.isPlainObject(c.selected)&&c.items)for(var e=0;e<c.items.length;e++){var f=c.items[e];if(f&&f.id===c.selected){c.selected=a.extend(!0,{},f);break}}this.watchSize()}c=a.extend({},d,c,{align:"both",altRows:!0}),this.options=c,a.isPlainObject(c.selected)||(c.selected={}),a(this.el).data("selected",c.selected),c.url&&(c.items=[],this.request(0)),"list"==this.type&&this.addFocus(),this.addPrefix(),this.addSuffix(),setTimeout(function(){b.refresh()},10),a(this.el).attr("autocomplete","off"),null!=c.selected.text&&a(this.el).val(c.selected.text);break;case"enum":d={items:[],selected:[],max:0,url:null,recId:null,recText:null,interval:350,method:null,postData:{},minLength:1,cacheMax:250,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,match:"contains",silent:!0,openOnFocus:!1,markSearch:!0,renderDrop:null,renderItem:null,compare:null,filter:!0,style:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseOver:null,onMouseOut:null,onScroll:null},c=a.extend({},d,c,{align:"both",suffix:"",altRows:!0}),c.items=this.normMenu(c.items),c.selected=this.normMenu(c.selected),this.options=c,a.isArray(c.selected)||(c.selected=[]),a(this.el).data("selected",c.selected),c.url&&(c.items=[],this.request(0)),this.addSuffix(),this.addMulti(),this.watchSize();break;case"file":d={selected:[],max:0,maxSize:0,maxFileSize:0,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,readContent:!0,silent:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseOver:null,onMouseOut:null},c=a.extend({},d,c,{align:"both",altRows:!0}),this.options=c,a.isArray(c.selected)||(c.selected=[]),a(this.el).data("selected",c.selected),null==a(this.el).attr("placeholder")&&a(this.el).attr("placeholder",w2utils.lang("Attach files by dragging and dropping or Click to Select")),this.addMulti(),this.watchSize()}this.tmp={onChange:function(a){b.change.call(b,a)},onClick:function(a){b.click.call(b,a)},onFocus:function(a){b.focus.call(b,a)},onBlur:function(a){b.blur.call(b,a)},onKeydown:function(a){b.keyDown.call(b,a)},onKeyup:function(a){b.keyUp.call(b,a)},onKeypress:function(a){b.keyPress.call(b,a)}},a(this.el).addClass("w2field w2ui-input").data("w2field",this).on("change.w2field",this.tmp.onChange).on("click.w2field",this.tmp.onClick).on("focus.w2field",this.tmp.onFocus).on("blur.w2field",this.tmp.onBlur).on("keydown.w2field",this.tmp.onKeydown).on("keyup.w2field",this.tmp.onKeyup).on("keypress.w2field",this.tmp.onKeypress).css(w2utils.cssPrefix("box-sizing","border-box")),this.change(a.Event("change"))},watchSize:function(){var b=this,c=a(b.el).data("tmp")||{};c.sizeTimer=setInterval(function(){a(b.el).parents("body").length>0?b.resize():clearInterval(c.sizeTimer)},200),a(b.el).data("tmp",c)},get:function(){var b;return b=["list","enum","file"].indexOf(this.type)!=-1?a(this.el).data("selected"):a(this.el).val()},set:function(b,c){if(["list","enum","file"].indexOf(this.type)!=-1){if("list"!=this.type&&c)null==a(this.el).data("selected")&&a(this.el).data("selected",[]),a(this.el).data("selected").push(b),a(this.el).change();else{var d="enum"==this.type?[b]:b;a(this.el).data("selected",d).change()}this.refresh()}else a(this.el).val(b)},setIndex:function(b,c){if(["list","enum"].indexOf(this.type)!=-1){var d=this.options.items;if(d&&d[b]){if("list"!=this.type&&c)null==a(this.el).data("selected")&&a(this.el).data("selected",[]),a(this.el).data("selected").push(d[b]),a(this.el).change();else{var e="enum"==this.type?[d[b]]:d[b];a(this.el).data("selected",e).change()}return this.refresh(),!0}}return!1},clear:function(){var c=this.options;["money","currency"].indexOf(this.type)!=-1&&a(this.el).val(a(this.el).val().replace(c.moneyRE,"")),"percent"==this.type&&a(this.el).val(a(this.el).val().replace(/%/g,"")),"list"==this.type&&a(this.el).removeClass("w2ui-select"),this.type="clear";var d=a(this.el).data("tmp");if(this.tmp){null!=d&&(a(this.el).height("auto"),d&&d["old-padding-left"]&&a(this.el).css("padding-left",d["old-padding-left"]),d&&d["old-padding-right"]&&a(this.el).css("padding-right",d["old-padding-right"]),d&&d["old-background-color"]&&a(this.el).css("background-color",d["old-background-color"]),d&&d["old-border-color"]&&a(this.el).css("border-color",d["old-border-color"]),clearInterval(d.sizeTimer)),a(this.el).val(this.clean(a(this.el).val())).removeClass("w2field").removeData().off(".w2field");for(var e in this.helpers)a(this.helpers[e]).remove();this.helpers={}}},refresh:function(){var b=this,c=this.options,d=a(this.el).data("selected"),e=(new Date).getTime();if(["list"].indexOf(this.type)!=-1&&(a(b.el).parent().css("white-space","nowrap"),b.helpers.prefix&&b.helpers.prefix.hide(),setTimeout(function(){if(b.helpers.focus){!a.isEmptyObject(d)&&c.icon?(c.prefix='<span class="w2ui-icon '+c.icon+'"style="cursor: pointer; font-size: 14px; display: inline-block; margin-top: -1px; color: #7F98AD;'+c.iconStyle+'"></span>',b.addPrefix()):(c.prefix="",b.addPrefix());var e=b.helpers.focus.find("input");""===a(e).val()?(a(e).css("text-indent","-9999em").prev().css("opacity",0),a(b.el).val(d&&null!=d.text?w2utils.lang(d.text):"")):(a(e).css("text-indent",0).prev().css("opacity",1),a(b.el).val(""),setTimeout(function(){b.helpers.prefix&&b.helpers.prefix.hide();var d="position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;";c.icon?(a(e).css("margin-left","17px"),a(b.helpers.focus).find(".icon-search").attr("style",d+"width: 11px !important; opacity: 1; display: block")):(a(e).css("margin-left","0px"),a(b.helpers.focus).find(".icon-search").attr("style",d+"width: 0px !important; opacity: 0; display: none"))},1)),a(b.el).prop("readonly")||a(b.el).prop("disabled")?setTimeout(function(){a(b.helpers.prefix).css("opacity","0.6"),a(b.helpers.suffix).css("opacity","0.6")},1):setTimeout(function(){a(b.helpers.prefix).css("opacity","1"),a(b.helpers.suffix).css("opacity","1")},1)}},1)),["enum","file"].indexOf(this.type)!=-1){var f="";if(d)for(var g=0;g<d.length;g++){var h=d[g],i="";i="function"==typeof c.renderItem?c.renderItem(h,g,'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+g+'">&#160;&#160;</div>'):'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+g+'">&#160;&#160;</div>'+("enum"==b.type?h.text:h.name+'<span class="file-size"> - '+w2utils.formatSize(h.size)+"</span>"),f+='<li index="'+g+'" style="max-width: '+parseInt(c.maxWidth)+"px; "+(h.style?h.style:"")+'">'+i+"</li>"}var j=b.helpers.multi,k=j.find("ul");if(j.attr("style",j.attr("style")+";"+c.style),a(b.el).css("z-index","-1"),a(b.el).prop("readonly")||a(b.el).prop("disabled")?setTimeout(function(){j[0].scrollTop=0,j.addClass("w2ui-readonly").find("li").css("opacity","0.9").parent().find("li.nomouse").hide().find("input").prop("readonly",!0).parents("ul").find(".w2ui-list-remove").hide()},1):setTimeout(function(){j.removeClass("w2ui-readonly").find("li").css("opacity","1").parent().find("li.nomouse").show().find("input").prop("readonly",!1).parents("ul").find(".w2ui-list-remove").show()},1),j.find(".w2ui-enum-placeholder").remove(),k.find("li").not("li.nomouse").remove(),""!==f)k.prepend(f);else if(null!=a(b.el).attr("placeholder")&&""===j.find("input").val()){var l="padding-top: "+a(this.el).css("padding-top")+";padding-left: "+a(this.el).css("padding-left")+"; box-sizing: "+a(this.el).css("box-sizing")+"; line-height: "+a(this.el).css("line-height")+"; font-size: "+a(this.el).css("font-size")+"; font-family: "+a(this.el).css("font-family")+"; ";j.prepend('<div class="w2ui-enum-placeholder" style="'+l+'">'+a(b.el).attr("placeholder")+"</div>")}j.off("scroll.w2field").on("scroll.w2field",function(c){var d=b.trigger({phase:"before",type:"scroll",target:b.el,originalEvent:c});d.isCancelled!==!0&&b.trigger(a.extend(d,{phase:"after"}))}).find("li").data("mouse","out").on("click",function(c){var e="LI"==c.target.tagName.toUpperCase()?c.target:a(c.target).parents("LI"),f=d[a(e).attr("index")];if(!a(e).hasClass("nomouse"))if(c.stopPropagation(),a(c.target).hasClass("w2ui-list-remove")){if(a(b.el).prop("readonly")||a(b.el).prop("disabled"))return;var g=b.trigger({phase:"before",type:"remove",target:b.el,originalEvent:c.originalEvent,item:f});if(g.isCancelled===!0)return;a().w2overlay(),d.splice(a(c.target).attr("index"),1),a(b.el).trigger("change"),a(c.target).parent().fadeOut("fast"),setTimeout(function(){b.refresh(),b.trigger(a.extend(g,{phase:"after"}))},300)}else{var g=b.trigger({phase:"before",type:"click",target:b.el,originalEvent:c.originalEvent,item:f});if(g.isCancelled===!0)return;if("file"==b.type){var h="";/image/i.test(f.type)&&(h='<div style="padding: 3px;">    <img src="'+(f.content?"data:"+f.type+";base64,"+f.content:"")+'" style="max-width: 300px;"         onload="var w = jQuery(this).width(); var h = jQuery(this).height();             if (w < 300 & h < 300) return;             if (w >= h && w > 300) jQuery(this).width(300);            if (w < h && h > 300) jQuery(this).height(300);"        onerror="this.style.display = \'none\'"    ></div>');var i='style="padding: 3px; text-align: right; color: #777;"',j='style="padding: 3px"';h+='<div style="padding: 8px;">    <table cellpadding="2"><tbody>    <tr><td '+i+">"+w2utils.lang("Name")+":</td><td "+j+">"+f.name+"</td></tr>    <tr><td "+i+">"+w2utils.lang("Size")+":</td><td "+j+">"+w2utils.formatSize(f.size)+"</td></tr>    <tr><td "+i+">"+w2utils.lang("Type")+":</td><td "+j+'>        <span style="width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap="nowrap";">'+f.type+"</span>    </td></tr>    <tr><td "+i+">"+w2utils.lang("Modified")+":</td><td "+j+">"+w2utils.date(f.modified)+"</td></tr>    </tbody></table></div>",a("#w2ui-overlay").remove(),a(e).w2overlay(h)}b.trigger(a.extend(g,{phase:"after"}))}}).on("mouseover",function(c){var e="LI"==c.target.tagName.toUpperCase()?c.target:a(c.target).parents("LI");if(!a(e).hasClass("nomouse")){if("out"==a(e).data("mouse")){var f=d[a(c.target).attr("index")],g=b.trigger({phase:"before",type:"mouseOver",target:b.el,originalEvent:c.originalEvent,item:f});if(g.isCancelled===!0)return;b.trigger(a.extend(g,{phase:"after"}))}a(e).data("mouse","over")}}).on("mouseout",function(c){var e="LI"==c.target.tagName.toUpperCase()?c.target:a(c.target).parents("LI");a(e).hasClass("nomouse")||(a(e).data("mouse","leaving"),setTimeout(function(){if("leaving"==a(e).data("mouse")){a(e).data("mouse","out");var f=d[a(c.target).attr("index")],g=b.trigger({phase:"before",type:"mouseOut",target:b.el,originalEvent:c.originalEvent,item:f});if(g.isCancelled===!0)return;b.trigger(a.extend(g,{phase:"after"}))}},0))}),a(this.el).height("auto");var m=a(j).find("> div.w2ui-multi-items").height()+2*w2utils.getSize(j,"+height");m<26&&(m=26),m>c.maxHeight&&(m=c.maxHeight),j.length>0&&(j[0].scrollTop=1e3);var n=w2utils.getSize(a(this.el),"height")-2;if(n>m&&(m=n),a(j).css({height:m+"px",overflow:m==c.maxHeight?"auto":"hidden"}),m<c.maxHeight&&a(j).prop("scrollTop",0),a(this.el).css({height:m+2+"px"}),"enum"==b.type){var o=b.helpers.multi.find("input");o.width(8*(o.val().length+2)+"px")}}return(new Date).getTime()-e},reset:function(){var a=this.type;this.clear(),this.type=a,this.init()},resize:function(){var b=this,c=a(b.el).width(),d=a(b.el).height();if(!(b.tmp.current_width==c&&d>0)){var e=this.helpers.focus,f=this.helpers.multi,g=this.helpers.suffix,h=this.helpers.prefix;if(e&&e.width(a(b.el).width()),f){var i=w2utils.getSize(b.el,"width")-parseInt(a(b.el).css("margin-left"),10)-parseInt(a(b.el).css("margin-right"),10);a(f).width(i)}g&&(b.options.suffix='<div class="arrow-down" style="margin-top: '+(parseInt(a(b.el).height())-6)/2+'px;"></div>',b.addSuffix()),h&&b.addPrefix(),b.tmp.current_width=c}},clean:function(b){if("number"==typeof b)return b;var c=this.options;return b=String(b).trim(),["int","float","money","currency","percent"].indexOf(this.type)!=-1&&("string"==typeof b&&(c.autoFormat&&["money","currency"].indexOf(this.type)!=-1&&(b=String(b).replace(c.moneyRE,"")),c.autoFormat&&"percent"==this.type&&(b=String(b).replace(c.percentRE,"")),c.autoFormat&&["int","float"].indexOf(this.type)!=-1&&(b=String(b).replace(c.numberRE,"")),b=b.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),parseFloat(b)==b&&(null!=c.min&&b<c.min&&(b=c.min,a(this.el).val(c.min)),null!=c.max&&b>c.max&&(b=c.max,a(this.el).val(c.max))),b=""!==b&&w2utils.isFloat(b)?Number(b):""),b},format:function(a){var b=this.options;if(b.autoFormat&&""!==a)switch(this.type){case"money":case"currency":a=w2utils.formatNumber(a,b.currencyPrecision,b.groupSymbol),""!==a&&(a=b.currencyPrefix+a+b.currencySuffix);break;case"percent":a=w2utils.formatNumber(a,b.precision,b.groupSymbol),""!==a&&(a+="%");break;case"float":a=w2utils.formatNumber(a,b.precision,b.groupSymbol);break;case"int":a=w2utils.formatNumber(a,0,b.groupSymbol)}return a},change:function(b){var c=this,d=c.options;if(["int","float","money","currency","percent"].indexOf(this.type)!=-1){var e=a(this.el).val(),f=this.format(this.clean(a(this.el).val()));if(""!==e&&e!=f)return a(this.el).val(f).change(),b.stopPropagation(),b.preventDefault(),!1}if("color"==this.type){var g="#"+a(this.el).val();6!=a(this.el).val().length&&3!=a(this.el).val().length&&(g=""),a(this.el).next().find("div").css("background-color",g),a(c.el).is(":focus")&&this.updateOverlay()}if(["list","enum","file"].indexOf(this.type)!=-1&&(c.refresh(),setTimeout(function(){c.refresh()},5)),["date","time","datetime"].indexOf(this.type)!=-1){var h=parseInt(c.el.value);w2utils.isInt(c.el.value)&&h>3e3&&("time"==this.type&&a(c.el).val(w2utils.formatTime(new Date(h),d.format)).change(),"date"==this.type&&a(c.el).val(w2utils.formatDate(new Date(h),d.format)).change(),"datetime"==this.type&&a(c.el).val(w2utils.formatDateTime(new Date(h),d.format)).change())}},click:function(b){b.stopPropagation(),["list","combo","enum"].indexOf(this.type)!=-1&&(a(this.el).is(":focus")||this.focus(b)),["date","time","color","datetime"].indexOf(this.type)!=-1&&this.updateOverlay()},focus:function(b){var c=this;this.options;if(["color","date","time","datetime"].indexOf(c.type)!==-1){if(a(c.el).prop("readonly")||a(c.el).prop("disabled"))return;a("#w2ui-overlay").length>0&&a("#w2ui-overlay")[0].hide(),setTimeout(function(){c.updateOverlay()},150)}if(["list","combo","enum"].indexOf(c.type)!=-1){if(a(c.el).prop("readonly")||a(c.el).prop("disabled"))return;a("#w2ui-overlay").length>0&&a("#w2ui-overlay")[0].hide(),c.resize(),setTimeout(function(){return"list"==c.type&&a(c.el).is(":focus")?void a(c.helpers.focus).find("input").focus():(c.search(),void setTimeout(function(){c.updateOverlay()},1))},1)}"file"==c.type&&a(c.helpers.multi).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"})},blur:function(b){var c=this,d=c.options,e=a(c.el).val().trim();["color","date","time","list","combo","enum","datetime"].indexOf(c.type)!=-1&&a("#w2ui-overlay").length>0&&a("#w2ui-overlay")[0].hide(),["int","float","money","currency","percent"].indexOf(c.type)!=-1&&(""===e||c.checkType(e)||(a(c.el).val("").change(),d.silent===!1&&(a(c.el).w2tag("Not a valid number"),setTimeout(function(){a(c.el).w2tag("")},3e3)))),["date","time","datetime"].indexOf(c.type)!=-1&&(""===e||c.inRange(c.el.value)?"date"!=c.type||""===e||w2utils.isDate(c.el.value,d.format)?"time"!=c.type||""===e||w2utils.isTime(c.el.value)?"datetime"!=c.type||""===e||w2utils.isDateTime(c.el.value,d.format)||(a(c.el).val("").removeData("selected").change(),d.silent===!1&&(a(c.el).w2tag("Not a valid date"),setTimeout(function(){a(c.el).w2tag("")},3e3))):(a(c.el).val("").removeData("selected").change(),d.silent===!1&&(a(c.el).w2tag("Not a valid time"),setTimeout(function(){a(c.el).w2tag("")},3e3))):(a(c.el).val("").removeData("selected").change(),d.silent===!1&&(a(c.el).w2tag("Not a valid date"),setTimeout(function(){a(c.el).w2tag("")},3e3))):(a(c.el).val("").removeData("selected").change(),d.silent===!1&&(a(c.el).w2tag("Not in range"),setTimeout(function(){a(c.el).w2tag("")},3e3)))),"enum"==c.type&&a(c.helpers.multi).find("input").val("").width(20),"file"==c.type&&a(c.helpers.multi).css({outline:"none"})},keyPress:function(a){var b=this;b.options;if(["int","float","money","currency","percent","hex","bin","color","alphanumeric"].indexOf(b.type)!=-1){if(a.metaKey||a.ctrlKey||a.altKey||a.charCode!=a.keyCode&&a.keyCode>0)return;var d=String.fromCharCode(a.charCode);if(!b.checkType(d,!0)&&13!=a.keyCode)return a.preventDefault(),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,!1}["date","time","datetime"].indexOf(b.type)!=-1&&9!==a.keyCode&&setTimeout(function(){b.updateOverlay()},1)},keyDown:function(b,c){var d=this,e=d.options,f=b.keyCode||c&&c.keyCode;if(["int","float","money","currency","percent"].indexOf(d.type)!=-1){if(!e.keyboard||a(d.el).prop("readonly")||a(d.el).prop("disabled"))return;var g=!1,h=parseFloat(a(d.el).val().replace(e.moneyRE,""))||0,i=e.step;switch((b.ctrlKey||b.metaKey)&&(i=10),f){case 38:if(b.shiftKey)break;a(d.el).val(h+i<=e.max||null==e.max?Number((h+i).toFixed(12)):e.max).change(),g=!0;break;case 40:if(b.shiftKey)break;a(d.el).val(h-i>=e.min||null==e.min?Number((h-i).toFixed(12)):e.min).change(),g=!0}g&&(b.preventDefault(),setTimeout(function(){d.el.setSelectionRange(d.el.value.length,d.el.value.length)},0))}if("date"==d.type){if(!e.keyboard||a(d.el).prop("readonly")||a(d.el).prop("disabled"))return;var g=!1,j=864e5,i=1;(b.ctrlKey||b.metaKey)&&(i=10);var k=w2utils.isDate(a(d.el).val(),e.format,!0);switch(k||(k=new Date,j=0),f){case 38:if(b.shiftKey)break;var l=w2utils.formatDate(k.getTime()+j,e.format);10==i&&(l=w2utils.formatDate(new Date(k.getFullYear(),k.getMonth()+1,k.getDate()),e.format)),a(d.el).val(l).change(),g=!0;break;case 40:if(b.shiftKey)break;var l=w2utils.formatDate(k.getTime()-j,e.format);10==i&&(l=w2utils.formatDate(new Date(k.getFullYear(),k.getMonth()-1,k.getDate()),e.format)),a(d.el).val(l).change(),g=!0}g&&(b.preventDefault(),setTimeout(function(){d.el.setSelectionRange(d.el.value.length,d.el.value.length),d.updateOverlay()},0))}if("time"==d.type){if(!e.keyboard||a(d.el).prop("readonly")||a(d.el).prop("disabled"))return;var g=!1,i=b.ctrlKey||b.metaKey?60:1,h=a(d.el).val(),m=d.toMin(h)||d.toMin((new Date).getHours()+":"+((new Date).getMinutes()-1));switch(f){case 38:if(b.shiftKey)break;m+=i,g=!0;break;case 40:if(b.shiftKey)break;m-=i,g=!0}g&&(a(d.el).val(d.fromMin(m)).change(),b.preventDefault(),setTimeout(function(){d.el.setSelectionRange(d.el.value.length,d.el.value.length)},0))}if("datetime"==d.type){if(!e.keyboard||a(d.el).prop("readonly")||a(d.el).prop("disabled"))return;var g=!1,j=864e5,i=1;(b.ctrlKey||b.metaKey)&&(i=10);var n=a(d.el).val(),k=w2utils.isDateTime(n,this.options.format,!0);switch(k||(k=new Date,j=0),f){case 38:if(b.shiftKey)break;var l=w2utils.formatDateTime(k.getTime()+j,e.format);10==i&&(l=w2utils.formatDateTime(new Date(k.getFullYear(),k.getMonth()+1,k.getDate()),e.format)),a(d.el).val(l).change(),g=!0;break;case 40:if(b.shiftKey)break;var l=w2utils.formatDateTime(k.getTime()-j,e.format);10==i&&(l=w2utils.formatDateTime(new Date(k.getFullYear(),k.getMonth()-1,k.getDate()),e.format)),a(d.el).val(l).change(),g=!0}g&&(b.preventDefault(),setTimeout(function(){d.el.setSelectionRange(d.el.value.length,d.el.value.length),d.updateOverlay()},0))}if("color"==d.type){if(a(d.el).prop("readonly")||a(d.el).prop("disabled"))return;if((b.ctrlKey||b.metaKey)&&!b.shiftKey){var o=null,p=null;switch(f){case 38:o="up";break;case 40:o="down";break;case 39:o="right";break;case 37:o="left"}d.el.nav&&null!=o&&(p=d.el.nav(o),a(d.el).val(p).change(),b.preventDefault())}}if(["list","combo","enum"].indexOf(d.type)!=-1){if(a(d.el).prop("readonly")||a(d.el).prop("disabled"))return;var q=a(d.el).data("selected"),r=a(d.el),s=!1;switch(["list","enum"].indexOf(d.type)!=-1&&("list"==d.type&&(r=a(d.helpers.focus).find("input")),"enum"==d.type&&(r=a(d.helpers.multi).find("input")),[37,38,39,40].indexOf(f)==-1&&setTimeout(function(){d.refresh()},1),86==b.keyCode&&(b.ctrlKey||b.metaKey)&&setTimeout(function(){d.refresh(),d.search(),d.request()},50)),f){case 27:"list"==d.type&&(""!==r.val()&&r.val(""),b.stopPropagation());break;case 37:case 39:break;case 13:if(0===a("#w2ui-overlay").length)break;var t=e.items[e.index];if("enum"==d.type)if(null!=t){var u=d.trigger({phase:"before",type:"add",target:d.el,originalEvent:b.originalEvent,item:t});if(u.isCancelled===!0)return;t=u.item,q.length>=e.max&&e.max>0&&q.pop(),delete t.hidden,delete d.tmp.force_open,q.push(t),a(d.el).change(),r.val("").width(20),d.refresh(),d.trigger(a.extend(u,{phase:"after"}))}else{t={id:r.val(),text:r.val()};var u=d.trigger({phase:"before",type:"new",target:d.el,originalEvent:b.originalEvent,item:t});if(u.isCancelled===!0)return;t=u.item,"function"==typeof d.onNew&&(q.length>=e.max&&e.max>0&&q.pop(),delete d.tmp.force_open,q.push(t),a(d.el).change(),r.val("").width(20),d.refresh()),d.trigger(a.extend(u,{phase:"after"}))}else t&&a(d.el).data("selected",t).val(t.text).change(),""===a(d.el).val()&&a(d.el).data("selected")&&a(d.el).removeData("selected").val("").change(),"list"==d.type&&(r.val(""),d.refresh()),d.tmp.force_hide=!0;break;case 8:case 46:if("enum"==d.type&&8==f&&""===r.val()&&q.length>0){var t=q[q.length-1],u=d.trigger({phase:"before",type:"remove",target:d.el,originalEvent:b.originalEvent,item:t});if(u.isCancelled===!0)return;q.pop(),a(d.el).trigger("change"),d.refresh(),d.trigger(a.extend(u,{phase:"after"}))}"list"==d.type&&""===r.val()&&(a(d.el).data("selected",{}).change(),d.refresh());break;case 38:for(e.index=w2utils.isInt(e.index)?parseInt(e.index):0,e.index--;e.index>0&&e.items[e.index].hidden;)e.index--;if(0===e.index&&e.items[e.index].hidden)for(;e.items[e.index]&&e.items[e.index].hidden;)e.index++;s=!0;break;case 40:for(e.index=w2utils.isInt(e.index)?parseInt(e.index):-1,e.index++;e.index<e.items.length-1&&e.items[e.index].hidden;)e.index++;if(e.index==e.items.length-1&&e.items[e.index].hidden)for(;e.items[e.index]&&e.items[e.index].hidden;)e.index--;""===r.val()&&0===a("#w2ui-overlay").length?d.tmp.force_open=!0:s=!0}if(s)return e.index<0&&(e.index=0),e.index>=e.items.length&&(e.index=e.items.length-1),d.updateOverlay(s),b.preventDefault(),void setTimeout(function(){if("enum"==d.type){var a=r.get(0);a.setSelectionRange(a.value.length,a.value.length)}else if("list"==d.type){var a=r.get(0);a.setSelectionRange(a.value.length,a.value.length)}else d.el.setSelectionRange(d.el.value.length,d.el.value.length)},0);"enum"==d.type&&r.width(8*(r.val().length+2)+"px")}},keyUp:function(b){var c=this;if(["list","combo","enum"].indexOf(this.type)!=-1){if(a(c.el).prop("readonly")||a(c.el).prop("disabled"))return;if([16,17,18,20,37,39,91].indexOf(b.keyCode)==-1){var d=a(this.helpers.focus).find("input");0===d.length&&(d=a(this.el));var e=this.trigger({phase:"before",type:"search",originalEvent:b,target:d,search:d.val()});if(e.isCancelled===!0)return;this.tmp.force_hide||this.request(),1==d.val().length&&this.refresh(),0!==a("#w2ui-overlay").length&&[38,40].indexOf(b.keyCode)!=-1||this.search(),this.trigger(a.extend(e,{phase:"after"}))}}},clearCache:function(){var a=this.options;a.items=[],this.tmp.xhr_loading=!1,this.tmp.xhr_search="",this.tmp.xhr_total=-1},request:function(b){var c=this,d=this.options,e=a(c.el).val()||"";if(d.url){if("enum"==c.type){var f=a(c.helpers.multi).find("input");e=0===f.length?"":f.val()}if("list"==c.type){var f=a(c.helpers.focus).find("input");e=0===f.length?"":f.val()}if(0!==d.minLength&&e.length<d.minLength)return d.items=[],void this.updateOverlay();null==b&&(b=d.interval),null==c.tmp.xhr_search&&(c.tmp.xhr_search=""),null==c.tmp.xhr_total&&(c.tmp.xhr_total=-1),d.url&&a(c.el).prop("readonly")!==!0&&a(c.el).prop("disabled")!==!0&&(0===d.items.length&&0!==c.tmp.xhr_total||c.tmp.xhr_total==d.cacheMax&&e.length>c.tmp.xhr_search.length||e.length>=c.tmp.xhr_search.length&&e.substr(0,c.tmp.xhr_search.length)!=c.tmp.xhr_search||e.length<c.tmp.xhr_search.length)&&(c.tmp.xhr&&c.tmp.xhr.abort(),c.tmp.xhr_loading=!0,c.search(),clearTimeout(c.tmp.timeout),c.tmp.timeout=setTimeout(function(){var b=d.url,f={search:e,max:d.cacheMax};a.extend(f,d.postData);var g=c.trigger({phase:"before",type:"request",search:e,target:c.el,url:b,postData:f});if(g.isCancelled!==!0){b=g.url,f=g.postData;var h={type:"GET",url:b,data:f,dataType:"JSON"};d.method&&(h.type=d.method),"JSON"==w2utils.settings.dataType&&(h.type="POST",h.data=JSON.stringify(h.data),h.contentType="application/json"),"HTTPJSON"==w2utils.settings.dataType&&(h.data={request:JSON.stringify(h.data)}),null!=d.method&&(h.type=d.method),c.tmp.xhr=a.ajax(h).done(function(b,g,h){var i=c.trigger({phase:"before",type:"load",target:c.el,search:f.search,data:b,xhr:h});if(i.isCancelled!==!0){if(b=i.data,"string"==typeof b&&(b=JSON.parse(b)),null==b.records&&null!=b.items&&(b.records=b.items,delete b.items),"success"!=b.status||!Array.isArray(b.records))return void console.log("ERROR: server did not return proper structure. It should return",{status:"success",records:[{id:1,text:"item"}]});b.records.length>d.cacheMax&&b.records.splice(d.cacheMax,1e5),null==d.recId&&null!=d.recid&&(d.recId=d.recid),(d.recId||d.recText)&&b.records.forEach(function(a){"string"==typeof d.recId&&(a.id=a[d.recId]),"function"==typeof d.recId&&(a.id=d.recId(a)),"string"==typeof d.recText&&(a.text=a[d.recText]),"function"==typeof d.recText&&(a.text=d.recText(a))}),c.tmp.xhr_loading=!1,c.tmp.xhr_search=e,c.tmp.xhr_total=b.records.length,d.items=c.normMenu(b.records),""===e&&0===b.records.length?c.tmp.emptySet=!0:c.tmp.emptySet=!1,c.search(),c.trigger(a.extend(i,{phase:"after"}))}}).fail(function(b,d,f){var g={status:d,error:f,rawResponseText:b.responseText},h=c.trigger({phase:"before",type:"error",target:c.el,search:e,error:g,xhr:b});if(h.isCancelled!==!0){if("abort"!=d){var i;try{i=a.parseJSON(b.responseText)}catch(a){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",records:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof i?i:b.responseText)}c.clearCache(),c.search(),c.trigger(a.extend(h,{phase:"after"}))}}),c.trigger(a.extend(g,{phase:"after"}))}},b))}},search:function(){var b=this,c=this.options,d=a(b.el).val(),e=b.el,f=[],g=a(b.el).data("selected");if("enum"==b.type){e=a(b.helpers.multi).find("input"),d=e.val();for(var h in g)g[h]&&f.push(g[h].id)}else if("list"==b.type){e=a(b.helpers.focus).find("input"),d=e.val();for(var h in g)g[h]&&f.push(g[h].id)}if(b.tmp.xhr_loading!==!0){for(var i=0,j=0;j<c.items.length;j++){var k=c.items[j];if(null!=c.compare)"function"==typeof c.compare&&(k.hidden=c.compare.call(this,k,d)===!1);else{var l="",m="";["is","begins"].indexOf(c.match)!=-1&&(l="^"),["is","ends"].indexOf(c.match)!=-1&&(m="$");try{var n=new RegExp(l+d+m,"i");n.test(k.text)||"..."==k.text?k.hidden=!1:k.hidden=!0}catch(a){}}c.filter===!1&&(k.hidden=!1),"enum"==b.type&&a.inArray(k.id,f)!=-1&&(k.hidden=!0),k.hidden!==!0&&(i++,delete k.hidden)}for(c.index=-1;c.items[c.index]&&c.items[c.index].hidden;)c.index++;i<=0&&(c.index=-1),c.spinner=!1,b.updateOverlay(),setTimeout(function(){var b=a("#w2ui-overlay").html()||"";c.markSearch&&b.indexOf("$.fn.w2menuHandler")!=-1&&a("#w2ui-overlay").w2marker(d)},1)}else c.items.splice(0,c.cacheMax),c.spinner=!0,b.updateOverlay()},updateOverlay:function(b){var c=this,d=this.options;if("color"==this.type){if(a(c.el).prop("readonly")||a(c.el).prop("disabled"))return;a(this.el).w2color({color:a(this.el).val(),transparent:d.transparent,advanced:d.advanced},function(b){null!=b&&a(c.el).val(b).change()})}if("date"==this.type){if(a(c.el).prop("readonly")||a(c.el).prop("disabled"))return;0===a("#w2ui-overlay").length&&a(c.el).w2overlay('<div class="w2ui-reset w2ui-calendar"></div>',{css:{"background-color":"#f5f5f5"},onShow:function(b){w2utils.isIE&&(console.log("IE"),a(".w2ui-calendar").on("mousedown",function(b){var c=a(b.target);1==c.length&&"w2ui-jump-year"==c[0].id&&a("#w2ui-overlay").data("keepOpen",!0)}))}});var e,f,g=w2utils.isDate(a(c.el).val(),c.options.format,!0);g&&(e=g.getMonth()+1,f=g.getFullYear()),function b(d,e){a("#w2ui-overlay > div > div").html(c.getMonthHTML(d,e,a(c.el).val())),a("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if(a(this).next().hasClass("w2ui-calendar-jump"))a(this).next().remove();else{var d,e;a(this).after('<div class="w2ui-calendar-jump" style=""></div>'),a(this).next().hide().html(c.getYearHTML()).fadeIn(200),setTimeout(function(){a("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){a(this).hasClass("w2ui-jump-month")&&(a(this).parent().find(".w2ui-jump-month").removeClass("selected"),a(this).addClass("selected"),e=a(this).attr("name")),a(this).hasClass("w2ui-jump-year")&&(a(this).parent().find(".w2ui-jump-year").removeClass("selected"),a(this).addClass("selected"),d=a(this).attr("name")),null!=d&&null!=e&&(a("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){b(parseInt(e)+1,d)},100))}),a("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1)}}),a("#w2ui-overlay .w2ui-date").on("mousedown",function(){var b=a(this).attr("date");a(c.el).val(b).change(),a(this).css({"background-color":"#B6D5FB","border-color":"#aaa"})}).on("mouseup",function(){setTimeout(function(){a("#w2ui-overlay").length>0&&a("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),a("#w2ui-overlay .previous").on("mousedown",function(){var a=c.options.current.split("/");a[0]=parseInt(a[0])-1,b(a[0],a[1])}),a("#w2ui-overlay .next").on("mousedown",function(){var a=c.options.current.split("/");a[0]=parseInt(a[0])+1,b(a[0],a[1])})}(e,f)}if("time"==this.type){if(a(c.el).prop("readonly")||a(c.el).prop("disabled"))return;0===a("#w2ui-overlay").length&&a(c.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#fff"}});var h="h24"==this.options.format;
a("#w2ui-overlay > div").html(c.getHourHTML()),a("#w2ui-overlay .w2ui-time").on("mousedown",function(b){a(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var d=a(this).attr("hour");a(c.el).val((d>12&&!h?d-12:d)+":00"+(h?"":d<12?" am":" pm")).change()}),null==this.options.noMinutes||this.options.noMinutes===!1?a("#w2ui-overlay .w2ui-time").on("mouseup",function(){var b=a(this).attr("hour");a("#w2ui-overlay").length>0&&a("#w2ui-overlay")[0].hide(),a(c.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),a("#w2ui-overlay > div").html(c.getMinHTML(b)),a("#w2ui-overlay .w2ui-time").on("mousedown",function(){a(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var d=a(this).attr("min");a(c.el).val((b>12&&!h?b-12:b)+":"+(d<10?0:"")+d+(h?"":b<12?" am":" pm")).change()}).on("mouseup",function(){setTimeout(function(){a("#w2ui-overlay").length>0&&a("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}):a("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){a("#w2ui-overlay").length>0&&a("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}if("datetime"==this.type){if(a(c.el).prop("readonly")||a(c.el).prop("disabled"))return;a("#w2ui-overlay .w2ui-time").length>0&&a("#w2ui-overlay")[0].hide(),0===a("#w2ui-overlay").length&&a(c.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#f5f5f5"},onShow:function(b){w2utils.isIE&&(console.log("IE"),a(".w2ui-calendar").on("mousedown",function(b){var c=a(b.target);1==c.length&&"w2ui-jump-year"==c[0].id&&a("#w2ui-overlay").data("keepOpen",!0)}))}});var e,f,g=w2utils.isDateTime(a(c.el).val(),c.options.format,!0);g&&(e=g.getMonth()+1,f=g.getFullYear());var i=null;!function b(e,f){a("#w2ui-overlay > div > div").html(c.getMonthHTML(e,f,a(c.el).val())+(d.btn_now?'<div class="w2ui-calendar-now now">'+w2utils.lang("Current Date & Time")+"</div>":"")),a("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if(a(this).next().hasClass("w2ui-calendar-jump"))a(this).next().remove();else{var d,e;a(this).after('<div class="w2ui-calendar-jump" style=""></div>'),a(this).next().hide().html(c.getYearHTML()).fadeIn(200),setTimeout(function(){a("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){a(this).hasClass("w2ui-jump-month")&&(a(this).parent().find(".w2ui-jump-month").removeClass("selected"),a(this).addClass("selected"),e=a(this).attr("name")),a(this).hasClass("w2ui-jump-year")&&(a(this).parent().find(".w2ui-jump-year").removeClass("selected"),a(this).addClass("selected"),d=a(this).attr("name")),null!=d&&null!=e&&(a("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){b(parseInt(e)+1,d)},100))}),a("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1)}}),a("#w2ui-overlay .w2ui-date").on("mousedown",function(){var b=a(this).attr("date");a(c.el).val(b).change(),a(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),i=new Date(a(this).attr("data-date"))}).on("mouseup",function(){var b,d;a("#w2ui-overlay").length>0&&a("#w2ui-overlay")[0].hide(),a(c.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}});"h24"==c.options.format;a("#w2ui-overlay > div").html(c.getHourHTML()),a("#w2ui-overlay .w2ui-time").on("mousedown",function(d){a(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),b=a(this).attr("hour"),i.setHours(b);var e=w2utils.formatDateTime(i,c.options.format);a(c.el).val(e).change()}),null==c.options.noMinutes||c.options.noMinutes===!1?a("#w2ui-overlay .w2ui-time").on("mouseup",function(){var e=a(this).attr("hour");a("#w2ui-overlay").length>0&&a("#w2ui-overlay")[0].hide(),a(c.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),a("#w2ui-overlay > div").html(c.getMinHTML(e)),a("#w2ui-overlay .w2ui-time").on("mousedown",function(){a(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),d=a(this).attr("min"),i.setHours(b,d);var e=w2utils.formatDateTime(i,c.options.format);a(c.el).val(e).change()}).on("mouseup",function(){setTimeout(function(){a("#w2ui-overlay").length>0&&a("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}):a("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){a("#w2ui-overlay").length>0&&a("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}),a("#w2ui-overlay .previous").on("mousedown",function(){var a=c.options.current.split("/");a[0]=parseInt(a[0])-1,b(a[0],a[1])}),a("#w2ui-overlay .next").on("mousedown",function(){var a=c.options.current.split("/");a[0]=parseInt(a[0])+1,b(a[0],a[1])}),a("#w2ui-overlay .now").on("mousedown",function(){var b=w2utils.formatDateTime(new Date,c.options.format);return a(c.el).val(b).change(),!1}).on("mouseup",function(){setTimeout(function(){a("#w2ui-overlay").length>0&&a("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}(e,f)}if(["list","combo","enum"].indexOf(this.type)!=-1){var j=this.el,k=this.el;if("enum"==this.type&&(j=a(this.helpers.multi),k=a(j).find("input")),"list"==this.type){var l=a(k).data("selected");a.isPlainObject(l)&&!a.isEmptyObject(l)&&d.index==-1&&d.items.forEach(function(a,b){a.id===l.id&&(d.index=b)}),k=a(this.helpers.focus).find("input")}if(a(k).is(":focus")){if(d.openOnFocus===!1&&""===a(k).val()&&c.tmp.force_open!==!0)return void a().w2overlay();if(c.tmp.force_hide)return a().w2overlay(),void setTimeout(function(){delete c.tmp.force_hide},1);""!==a(k).val()&&delete c.tmp.force_open;var m=w2utils.lang("No matches");null!=d.url&&a(k).val().length<d.minLength&&c.tmp.emptySet!==!0&&(m=d.minLength+" "+w2utils.lang("letters or more...")),null!=d.url&&""===a(k).val()&&c.tmp.emptySet!==!0&&(m=w2utils.lang("Type to search...")),null==d.url&&0===d.items.length&&(m=w2utils.lang("Empty list")),null!=d.msgNoItems&&(m=d.msgNoItems),"function"==m&&(m=m(d)),a(j).w2menu(b?"refresh-index":"refresh",a.extend(!0,{},d,{search:!1,render:d.renderDrop,maxHeight:d.maxDropHeight,maxWidth:d.maxDropWidth,msgNoItems:m,onSelect:function(b){if("enum"==c.type){var e=a(c.el).data("selected");if(b.item){var f=c.trigger({phase:"before",type:"add",target:c.el,originalEvent:b.originalEvent,item:b.item});if(f.isCancelled===!0)return;e.length>=d.max&&d.max>0&&e.pop(),delete b.item.hidden,e.push(b.item),a(c.el).data("selected",e).change(),a(c.helpers.multi).find("input").val("").width(20),c.refresh(),a("#w2ui-overlay").length>0&&a("#w2ui-overlay")[0].hide(),c.trigger(a.extend(f,{phase:"after"}))}}else a(c.el).data("selected",b.item).val(b.item.text).change(),c.helpers.focus&&c.helpers.focus.find("input").val("")}}))}}},inRange:function(b,c){var d=!1;if("date"==this.type){var e=w2utils.isDate(b,this.options.format,!0);if(e){if(this.options.start||this.options.end){var f="string"==typeof this.options.start?this.options.start:a(this.options.start).val(),g="string"==typeof this.options.end?this.options.end:a(this.options.end).val(),h=w2utils.isDate(f,this.options.format,!0),i=w2utils.isDate(g,this.options.format,!0),j=new Date(e);h||(h=j),i||(i=j),j>=h&&j<=i&&(d=!0)}else d=!0;if(this.options.blocked&&a.inArray(b,this.options.blocked)!=-1&&(d=!1),null!=this.options.blockWeekDays&&void 0!=this.options.blockWeekDays&&void 0!=this.options.blockWeekDays.length)for(var k=this.options.blockWeekDays.length,l=0;l<k;l++)e.getDay()==this.options.blockWeekDays[l]&&(d=!1)}}else if("time"==this.type)if(this.options.start||this.options.end){var m=this.toMin(b),n=this.toMin(this.options.start),o=this.toMin(this.options.end);n||(n=m),o||(o=m),m>=n&&m<=o&&(d=!0)}else d=!0;else if("datetime"==this.type){var e=w2utils.isDateTime(b,this.options.format,!0);if(e){if(this.options.start||this.options.end){var h,i;if("object"==typeof this.options.start&&this.options.start instanceof Date)h=this.options.start;else{var f="string"==typeof this.options.start?this.options.start:a(this.options.start).val();h=""!==f.trim()?w2utils.isDateTime(f,this.options.format,!0):""}if("object"==typeof this.options.end&&this.options.end instanceof Date)i=this.options.end;else{var g="string"==typeof this.options.end?this.options.end:a(this.options.end).val();i=""!==g.trim()?w2utils.isDateTime(g,this.options.format,!0):""}var j=e;h||(h=j),i||(i=j),c&&h instanceof Date&&(h.setHours(0),h.setMinutes(0),h.setSeconds(0)),j>=h&&j<=i&&(d=!0)}else d=!0;if(d&&this.options.blocked)for(var l=0;l<this.options.blocked.length;l++){var p=this.options.blocked[l];if("string"==typeof p&&(p=w2utils.isDateTime(p,this.options.format,!0)),"object"==typeof p&&p instanceof Date&&p.getFullYear()==e.getFullYear()&&p.getMonth()==e.getMonth()&&p.getDate()==e.getDate()){d=!1;break}}}}return d},checkType:function(a,b){var c=this;switch(c.type){case"int":return!(!b||["-",c.options.groupSymbol].indexOf(a)==-1)||w2utils.isInt(a.replace(c.options.numberRE,""));case"percent":a=a.replace(/%/g,"");case"float":return!(!b||["-",w2utils.settings.decimalSymbol,c.options.groupSymbol].indexOf(a)==-1)||w2utils.isFloat(a.replace(c.options.numberRE,""));case"money":case"currency":return!(!b||["-",c.options.decimalSymbol,c.options.groupSymbol,c.options.currencyPrefix,c.options.currencySuffix].indexOf(a)==-1)||w2utils.isFloat(a.replace(c.options.moneyRE,""));case"bin":return w2utils.isBin(a);case"hex":return w2utils.isHex(a);case"alphanumeric":return w2utils.isAlphaNumeric(a)}return!0},addPrefix:function(){var b=this;setTimeout(function(){if("clear"!==b.type){var c,d=a(b.el).data("tmp")||{};d["old-padding-left"]&&a(b.el).css("padding-left",d["old-padding-left"]),d["old-padding-left"]=a(b.el).css("padding-left"),a(b.el).data("tmp",d),b.helpers.prefix&&a(b.helpers.prefix).remove(),""!==b.options.prefix&&(a(b.el).before('<div class="w2ui-field-helper">'+b.options.prefix+"</div>"),c=a(b.el).prev(),c.css({color:a(b.el).css("color"),"font-family":a(b.el).css("font-family"),"font-size":a(b.el).css("font-size"),"padding-top":a(b.el).css("padding-top"),"padding-bottom":a(b.el).css("padding-bottom"),"padding-left":a(b.el).css("padding-left"),"padding-right":0,"margin-top":parseInt(a(b.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(a(b.el).css("margin-bottom"),10)+1+"px","margin-left":a(b.el).css("margin-left"),"margin-right":0}).on("click",function(c){if(b.options.icon&&"function"==typeof b.onIconClick){var d=b.trigger({phase:"before",type:"iconClick",target:b.el,el:a(this).find("span.w2ui-icon")[0]});if(d.isCancelled===!0)return;b.trigger(a.extend(d,{phase:"after"}))}else"list"==b.type?a(b.helpers.focus).find("input").focus():a(b.el).focus()}),a(b.el).css("padding-left",c.width()+parseInt(a(b.el).css("padding-left"),10)+"px"),b.helpers.prefix=c)}},1)},addSuffix:function(){var c,d,b=this;setTimeout(function(){if("clear"!==b.type){var e=a(b.el).data("tmp")||{};if(e["old-padding-right"]&&a(b.el).css("padding-right",e["old-padding-right"]),e["old-padding-right"]=a(b.el).css("padding-right"),a(b.el).data("tmp",e),d=parseInt(a(b.el).css("padding-right"),10),b.options.arrows){b.helpers.arrows&&a(b.helpers.arrows).remove(),a(b.el).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&#160;    <div class="w2ui-field-up" type="up">        <div class="arrow-up" type="up"></div>    </div>    <div class="w2ui-field-down" type="down">        <div class="arrow-down" type="down"></div>    </div></div>');w2utils.getSize(b.el,"height");c=a(b.el).next(),c.css({color:a(b.el).css("color"),"font-family":a(b.el).css("font-family"),"font-size":a(b.el).css("font-size"),height:a(b.el).height()+parseInt(a(b.el).css("padding-top"),10)+parseInt(a(b.el).css("padding-bottom"),10)+"px",padding:0,"margin-top":parseInt(a(b.el).css("margin-top"),10)+1+"px","margin-bottom":0,"border-left":"1px solid silver"}).css("margin-left","-"+(c.width()+parseInt(a(b.el).css("margin-right"),10)+12)+"px").on("mousedown",function(c){function e(){clearTimeout(d.data("_field_update_timer")),d.off("mouseup",e)}function f(d){a(b.el).focus(),b.keyDown(a.Event("keydown"),{keyCode:"up"==a(c.target).attr("type")?38:40}),d!==!1&&a("body").data("_field_update_timer",setTimeout(f,60))}var d=a("body");d.on("mouseup",e),d.data("_field_update_timer",setTimeout(f,700)),f(!1)}),d+=c.width()+12,a(b.el).css("padding-right",d+"px"),b.helpers.arrows=c}""!==b.options.suffix&&(b.helpers.suffix&&a(b.helpers.suffix).remove(),a(b.el).after('<div class="w2ui-field-helper">'+b.options.suffix+"</div>"),c=a(b.el).next(),c.css({color:a(b.el).css("color"),"font-family":a(b.el).css("font-family"),"font-size":a(b.el).css("font-size"),"padding-top":a(b.el).css("padding-top"),"padding-bottom":a(b.el).css("padding-bottom"),"padding-left":"3px","padding-right":a(b.el).css("padding-right"),"margin-top":parseInt(a(b.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(a(b.el).css("margin-bottom"),10)+1+"px"}).on("click",function(c){"list"==b.type?a(b.helpers.focus).find("input").focus():a(b.el).focus()}),c.css("margin-left","-"+(w2utils.getSize(c,"width")+parseInt(a(b.el).css("margin-right"),10)+2)+"px"),d+=c.width()+3,a(b.el).css("padding-right",d+"px"),b.helpers.suffix=c)}},1)},addFocus:function(){var e,b=this,d=(this.options,0);a(b.helpers.focus).remove();var f=a(b.el).attr("tabIndex");f&&f!=-1&&(b.el._tabIndex=f),b.el._tabIndex&&(f=b.el._tabIndex),null==f&&(f=-1);var g='<div class="w2ui-field-helper">    <div class="w2ui-icon icon-search" style="opacity: 0; display: none"></div>    <input type="text" autocomplete="off" tabIndex="'+f+'"/></div>';a(b.el).attr("tabindex",-1).before(g);var h=a(b.el).prev();b.helpers.focus=h,h.css({width:a(b.el).width(),"margin-top":a(b.el).css("margin-top"),"margin-left":parseInt(a(b.el).css("margin-left"))+parseInt(a(b.el).css("padding-left"))+"px","margin-bottom":a(b.el).css("margin-bottom"),"margin-right":a(b.el).css("margin-right")}).find("input").css({cursor:"default",width:"100%",outline:"none",opacity:1,margin:0,border:"1px solid transparent",padding:a(b.el).css("padding-top"),"padding-left":0,"margin-left":d>0?d+6:0,"background-color":"transparent"}),h.find("input").on("click",function(c){0===a("#w2ui-overlay").length&&b.focus(c),c.stopPropagation()}).on("focus",function(c){e=a(b.el).attr("placeholder"),a(b.el).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"}),a(this).val(""),a(b.el).triggerHandler("focus"),c.stopPropagation?c.stopPropagation():c.cancelBubble=!0}).on("blur",function(c){a(b.el).css("outline","none"),a(this).val(""),b.refresh(),a(b.el).triggerHandler("blur"),c.stopPropagation?c.stopPropagation():c.cancelBubble=!0,null!=e&&a(b.el).attr("placeholder",e)}).on("keydown",function(c){var d=this;b.keyDown(c),setTimeout(function(){""===d.value?a(b.el).attr("placeholder",e):a(b.el).attr("placeholder","")},10)}).on("keyup",function(a){b.keyUp(a)}).on("keypress",function(a){b.keyPress(a)}),h.on("click",function(b){a(this).find("input").focus()}),b.refresh()},addMulti:function(){var b=this;this.options;a(b.helpers.multi).remove();var d="",e="margin-top     : 0px; margin-bottom  : 0px; margin-left    : "+a(b.el).css("margin-left")+"; margin-right   : "+a(b.el).css("margin-right")+"; width          : "+(w2utils.getSize(b.el,"width")-parseInt(a(b.el).css("margin-left"),10)-parseInt(a(b.el).css("margin-right"),10))+"px;";if("enum"==b.type){var f=a(b.el).attr("tabIndex");f&&f!=-1&&(b.el._tabIndex=f),b.el._tabIndex&&(f=b.el._tabIndex),null==f&&(f=-1),d='<div class="w2ui-field-helper w2ui-list" style="'+e+'; box-sizing: border-box">    <div style="padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">    <ul>        <li style="padding-left: 0px; padding-right: 0px" class="nomouse">            <input type="text" style="width: 20px; margin: -3px 0 0; padding: 2px 0; border-color: white" autocomplete="off"'+(a(b.el).prop("readonly")?' readonly="readonly"':"")+(a(b.el).prop("disabled")?' disabled="disabled"':"")+' tabindex="'+f+'"/>        </li>    </ul>    </div></div>'}"file"==b.type&&(d='<div class="w2ui-field-helper w2ui-list" style="'+e+'; box-sizing: border-box">   <div style="position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;">       <input class="file-input" type="file" style="width: 100%; height: 100%; opacity: 0;" name="attachment" multiple tabindex="-1"'+(a(b.el).prop("readonly")?' readonly="readonly"':"")+(a(b.el).prop("disabled")?' disabled="disabled"':"")+(a(b.el).attr("accept")?' accept="'+a(b.el).attr("accept")+'"':"")+'/>   </div>    <div style="position: absolute; padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">        <ul><li style="padding-left: 0px; padding-right: 0px" class="nomouse"></li></ul>    </div></div>');var g=a(b.el).data("tmp")||{};g["old-background-color"]=a(b.el).css("background-color"),g["old-border-color"]=a(b.el).css("border-color"),a(b.el).data("tmp",g),a(b.el).before(d).css({"background-color":"transparent","border-color":"transparent"});var h=a(b.el).prev();b.helpers.multi=h,"enum"==b.type&&(a(b.el).attr("tabindex",-1),h.find("input").on("click",function(c){0===a("#w2ui-overlay").length&&b.focus(c),a(b.el).triggerHandler("click")}).on("focus",function(c){a(h).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"}),a(b.el).triggerHandler("focus"),c.stopPropagation?c.stopPropagation():c.cancelBubble=!0}).on("blur",function(c){a(h).css("outline","none"),a(b.el).triggerHandler("blur"),c.stopPropagation?c.stopPropagation():c.cancelBubble=!0}).on("keyup",function(a){b.keyUp(a)}).on("keydown",function(a){b.keyDown(a)}).on("keypress",function(a){b.keyPress(a)}),h.on("click",function(b){a(this).find("input").focus()})),"file"==b.type&&(a(b.el).css("outline","none"),h.on("click",function(c){a(b.el).focus(),a(b.el).prop("readonly")||a(b.el).prop("disabled")||(b.blur(c),b.resize(),setTimeout(function(){h.find("input").click()},10))}).on("dragenter",function(c){a(b.el).prop("readonly")||a(b.el).prop("disabled")||a(h).addClass("w2ui-file-dragover")}).on("dragleave",function(c){if(!a(b.el).prop("readonly")&&!a(b.el).prop("disabled")){var d=a(c.target).parents(".w2ui-field-helper");0===d.length&&a(h).removeClass("w2ui-file-dragover")}}).on("drop",function(c){if(!a(b.el).prop("readonly")&&!a(b.el).prop("disabled")){a(h).removeClass("w2ui-file-dragover");for(var d=c.originalEvent.dataTransfer.files,e=0,f=d.length;e<f;e++)b.addFile.call(b,d[e]);c.preventDefault(),c.stopPropagation()}}).on("dragover",function(a){a.preventDefault(),a.stopPropagation()}),h.find("input").on("click",function(a){a.stopPropagation()}).on("change",function(){if("undefined"!=typeof this.files)for(var a=0,c=this.files.length;a<c;a++)b.addFile.call(b,this.files[a])})),b.refresh()},addFile:function(b){var i,c=this,d=this.options,e=a(c.el).data("selected"),f={name:b.name,type:b.type,modified:b.lastModifiedDate,size:b.size,content:null,file:b},g=0,h=0;if(e)for(var j=0;j<e.length;j++){if(e[j].name==b.name&&e[j].size==b.size)return;g+=e[j].size,h++}var k=c.trigger({phase:"before",type:"add",target:c.el,file:f,total:h,totalSize:g});if(k.isCancelled!==!0){if(0!==d.maxFileSize&&f.size>d.maxFileSize)return i="Maximum file size is "+w2utils.formatSize(d.maxFileSize),d.silent===!1&&a(c.el).w2tag(i),void console.log("ERROR: "+i);if(0!==d.maxSize&&g+f.size>d.maxSize)return i=w2utils.lang("Maximum total size is")+" "+w2utils.formatSize(d.maxSize),void(d.silent===!1?a(c.el).w2tag(i):console.log("ERROR: "+i));if(0!==d.max&&h>=d.max)return i=w2utils.lang("Maximum number of files is")+" "+d.max,void(d.silent===!1?a(c.el).w2tag(i):console.log("ERROR: "+i));if(e.push(f),"undefined"!=typeof FileReader&&d.readContent===!0){var l=new FileReader;l.onload=function(){return function(b){var d=b.target.result,e=d.indexOf(",");f.content=d.substr(e+1),c.refresh(),a(c.el).trigger("change"),c.trigger(a.extend(k,{phase:"after"}))}}(),l.readAsDataURL(b)}else c.refresh(),a(c.el).trigger("change"),c.trigger(a.extend(k,{phase:"after"}))}},normMenu:function(b){if(a.isArray(b)){for(var c=0;c<b.length;c++)"string"==typeof b[c]?b[c]={id:b[c],text:b[c]}:(null!=b[c].text&&null==b[c].id&&(b[c].id=b[c].text),null==b[c].text&&null!=b[c].id&&(b[c].text=b[c].id),null!=b[c].caption&&(b[c].text=b[c].caption));return b}if("function"==typeof b)return this.normMenu(b());if("object"==typeof b){var d=[];for(var c in b)d.push({id:c,text:b[c]});return d}},getMonthHTML:function(a,b,c){var d=new Date,e=w2utils.settings.fullmonths,f=["31","28","31","30","31","30","31","31","30","31","30","31"],g=d.getFullYear()+"/"+(Number(d.getMonth())+1)+"/"+d.getDate(),h=w2utils.settings.fulldays.slice(),i=w2utils.settings.shortdays.slice();"M"!=w2utils.settings.weekStarts&&(h.unshift(h.pop()),i.unshift(i.pop()));var j=this.options;null==j&&(j={}),b=w2utils.isInt(b)?parseInt(b):d.getFullYear(),a=w2utils.isInt(a)?parseInt(a):d.getMonth()+1,a>12&&(a-=12,b++),(a<1||0===a)&&(a+=12,b--),b/4==Math.floor(b/4)?f[1]="29":f[1]="28",j.current=a+"/"+b,d=new Date(b,a-1,1);for(var k=d.getDay(),l="",m=0;m<i.length;m++)l+='<td title="'+h[m]+'">'+i[m]+"</td>";var n='<div class="w2ui-calendar-title title">    <div class="w2ui-calendar-previous previous"> <div></div> </div>    <div class="w2ui-calendar-next next"> <div></div> </div> '+e[a-1]+", "+b+'</div><table class="w2ui-calendar-days" cellspacing="0"><tbody>    <tr class="w2ui-day-title">'+l+"</tr>    <tr>",o=1;if("M"!=w2utils.settings.weekStarts&&k++,"datetime"===this.type){var p=w2utils.isDateTime(c,j.format,!0);c=w2utils.formatDate(p,w2utils.settings.dateFormat)}for(var q=1;q<43;q++){if(0===k&&1==q){for(var r=0;r<6;r++)n+='<td class="w2ui-day-empty">&#160;</td>';q+=6}else if(q<k||o>f[a-1]){n+='<td class="w2ui-day-empty">&#160;</td>',q%7===0&&(n+="</tr><tr>");continue}var s=b+"/"+a+"/"+o,t=new Date(s),u="";6===t.getDay()&&(u=" w2ui-saturday"),0===t.getDay()&&(u=" w2ui-sunday"),s==g&&(u+=" w2ui-today");var y,z,v=o,w="",x="";if("datetime"===this.type?(y=w2utils.formatDateTime(s,j.format),z=w2utils.formatDate(s,w2utils.settings.dateFormat)):(y=w2utils.formatDate(s,j.format),z=y),j.colored&&void 0!==j.colored[z]){var A=j.colored[z].split(":");x="background-color: "+A[0]+";",w="color: "+A[1]+";"}n+='<td class="'+(this.inRange(y,!0)?"w2ui-date "+(z==c?"w2ui-date-selected":""):"w2ui-blocked")+u+'"    style="'+w+x+'" date="'+y+'" data-date="'+t+'">'+v+"</td>",(q%7===0||0===k&&1==q)&&(n+="</tr><tr>"),o++}return n+="</tr></tbody></table>"},getYearHTML:function(){for(var a=w2utils.settings.shortmonths,b=w2utils.settings.dateStartYear,c=w2utils.settings.dateEndYear,d="",e="",f=0;f<a.length;f++)d+='<div class="w2ui-jump-month" name="'+f+'">'+a[f]+"</div>";for(var g=b;g<=c;g++)e+='<div class="w2ui-jump-year" name="'+g+'">'+g+"</div>";return'<div id="w2ui-jump-month">'+d+'</div><div id="w2ui-jump-year">'+e+"</div>"},getHourHTML:function(){var a=[],b=this.options;null==b&&(b={format:w2utils.settings.timeFormat});for(var c=b.format.indexOf("h24")>-1,d=0;d<24;d++){var e=(d>=12&&!c?d-12:d)+":00"+(c?"":d<12?" am":" pm");12!=d||c||(e="12:00 pm"),a[Math.floor(d/8)]||(a[Math.floor(d/8)]="");var f=this.fromMin(this.toMin(e)),g=this.fromMin(this.toMin(e)+59);if("datetime"===this.type){var h=w2utils.isDateTime(this.el.value,b.format,!0),i=b.format.split("|")[0].trim();f=w2utils.formatDate(h,i)+" "+f,g=w2utils.formatDate(h,i)+" "+g}a[Math.floor(d/8)]+='<div class="'+(this.inRange(f)||this.inRange(g)?"w2ui-time ":"w2ui-blocked")+'" hour="'+d+'">'+e+"</div>"}var j='<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Hour")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+a[0]+"</td>       <td>"+a[1]+"</td>       <td>"+a[2]+"</td>   </tr></tbody></table></div></div>";return j},getMinHTML:function(a){null==a&&(a=0);var b=this.options;null==b&&(b={format:w2utils.settings.timeFormat});for(var c=b.format.indexOf("h24")>-1,d=[],e=0;e<60;e+=5){var f=(a>12&&!c?a-12:a)+":"+(e<10?0:"")+e+" "+(c?"":a<12?"am":"pm"),g=f,h=e<20?0:e<40?1:2;if(d[h]||(d[h]=""),"datetime"===this.type){var i=w2utils.isDateTime(this.el.value,b.format,!0),j=b.format.split("|")[0].trim();g=w2utils.formatDate(i,j)+" "+g}d[h]+='<div class="'+(this.inRange(g)?"w2ui-time ":"w2ui-blocked")+'" min="'+e+'">'+f+"</div>"}var k='<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Minute")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+d[0]+"</td>       <td>"+d[1]+"</td>       <td>"+d[2]+"</td>   </tr></tbody></table></div></div>";return k},toMin:function(a){if("string"!=typeof a)return null;var b=a.split(":");return 2!==b.length?null:(b[0]=parseInt(b[0]),b[1]=parseInt(b[1]),a.indexOf("pm")!=-1&&12!=b[0]&&(b[0]+=12),60*b[0]+b[1])},fromMin:function(a){var b="";a>=1440&&(a%=1440),a<0&&(a=1440+a);var c=Math.floor(a/60),d=(a%60<10?"0":"")+a%60,e=this.options;return null==e&&(e={format:w2utils.settings.timeFormat}),b=e.format.indexOf("h24")!=-1?c+":"+d:(c<=12?c:c-12)+":"+d+" "+(c>=12?"pm":"am")}},a.extend(b.prototype,w2utils.event),w2obj.field=b}(jQuery),function($){var w2form=function(a){this.name=null,this.header="",this.box=null,this.url="",this.routeData={},this.formURL="",this.formHTML="",this.page=0,this.recid=0,this.fields=[],this.actions={},this.record={},this.original={},this.postData={},this.httpHeaders={},this.method=null,this.toolbar={},this.tabs={},this.style="",this.focus=0,this.multipart=!1,this.isGenerated=!1,this.last={xhr:null},$.extend(!0,this,w2obj.form,a)};$.fn.w2form=function(a){if($.isPlainObject(a)){var b=this;if(!w2utils.checkName(a,"w2form"))return;var c=a.record,d=a.original,e=a.fields,f=a.toolbar,g=a.tabs,h=new w2form(a);if($.extend(h,{record:{},original:{},fields:[],tabs:{},toolbar:{},handlers:[]}),$.isArray(g)){$.extend(!0,h.tabs,{tabs:[]});for(var i=0;i<g.length;i++){var j=g[i];"object"==typeof j?(h.tabs.tabs.push(j),j.active===!0&&(h.tabs.active=j.id)):h.tabs.tabs.push({id:j,caption:j})}}else $.extend(!0,h.tabs,g);if($.extend(!0,h.toolbar,f),e)for(var k=0;k<e.length;k++){var l=$.extend(!0,{},e[k]);null==l.name&&null!=l.field&&(l.name=l.field),null==l.field&&null!=l.name&&(l.field=l.name),h.fields[k]=l}for(var k in c)$.isPlainObject(c[k])?h.record[k]=$.extend(!0,{},c[k]):h.record[k]=c[k];for(var k in d)$.isPlainObject(d[k])?h.original[k]=$.extend(!0,{},d[k]):h.original[k]=d[k];return b.length>0&&(h.box=b[0]),""!==h.formURL?$.get(h.formURL,function(a){h.formHTML=a,h.isGenerated=!0,0===$(h.box).length&&0===a.length||($(h.box).html(a),h.render(h.box))}):""!==h.formHTML||(0!==$(this).length&&""!==$.trim($(this).html())?h.formHTML=$(this).html():h.formHTML=h.generateHTML()),w2ui[h.name]=h,""===h.formURL&&(String(h.formHTML).indexOf("w2ui-page")==-1&&(h.formHTML='<div class="w2ui-page page-0">'+h.formHTML+"</div>"),$(h.box).html(h.formHTML),h.isGenerated=!0,h.render(h.box)),h}var b=w2ui[$(this).attr("name")];return b?arguments.length>0?(b[a]&&b[a].apply(b,Array.prototype.slice.call(arguments,1)),this):b:null},w2form.prototype={onRequest:null,onLoad:null,onValidate:null,onSubmit:null,onProgress:null,onSave:null,onChange:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onAction:null,onToolbar:null,onError:null,msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Loadding...",msgSaving:"Posting...",get:function(a,b){if(0===arguments.length){for(var c=[],d=0;d<this.fields.length;d++)null!=this.fields[d].name&&c.push(this.fields[d].name);return c}for(var e=0;e<this.fields.length;e++)if(this.fields[e].name==a)return b===!0?e:this.fields[e];return null},set:function(a,b){for(var c=0;c<this.fields.length;c++)if(this.fields[c].name==a)return $.extend(this.fields[c],b),this.refresh(),!0;return!1},show:function(){for(var a=0,b=0;b<arguments.length;b++){var c=this.get(arguments[b]);c&&c.hidden&&(c.hidden=!1,a++)}return a>0&&this.refresh(),a},hide:function(){for(var a=0,b=0;b<arguments.length;b++){var c=this.get(arguments[b]);c&&!c.hidden&&(c.hidden=!0,a++)}return a>0&&this.refresh(),a},enable:function(){for(var a=0,b=0;b<arguments.length;b++){var c=this.get(arguments[b]);c&&c.disabled&&(c.disabled=!1,a++)}return a>0&&this.refresh(),a},disable:function(){for(var a=0,b=0;b<arguments.length;b++){var c=this.get(arguments[b]);c&&!c.disabled&&(c.disabled=!0,a++)}return a>0&&this.refresh(),a},reload:function(a){var b="object"!=typeof this.url?this.url:this.url.get;b&&0!==this.recid&&null!=this.recid?this.request(a):"function"==typeof a&&a()},clear:function(){this.recid=0,this.record={},$().w2tag(),this.refresh()},error:function(a){var b=this,c=this.trigger({target:this.name,type:"error",message:a,xhr:this.last.xhr});return c.isCancelled===!0?void("function"==typeof callBack&&callBack()):(setTimeout(function(){b.message(a)},1),void this.trigger($.extend(c,{phase:"after"})))},message:function(a){"string"==typeof a&&(a={width:a.length<300?350:550,height:a.length<300?170:250,body:'<div class="w2ui-centered">'+a+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(a){setTimeout(function(){$(a.box).find(".w2ui-btn").focus()},25)}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-form-header:visible",body:".w2ui-form-box"},a)},validate:function(a){null==a&&(a=!0),$().w2tag();for(var b=[],c=0;c<this.fields.length;c++){var d=this.fields[c];switch(null==this.record[d.name]&&(this.record[d.name]=""),d.type){case"int":this.record[d.name]&&!w2utils.isInt(this.record[d.name])&&b.push({field:d,error:w2utils.lang("Not an integer")});break;case"float":this.record[d.name]&&!w2utils.isFloat(this.record[d.name])&&b.push({field:d,error:w2utils.lang("Not a float")});break;case"money":this.record[d.name]&&!w2utils.isMoney(this.record[d.name])&&b.push({field:d,error:w2utils.lang("Not in money format")});break;case"color":case"hex":this.record[d.name]&&!w2utils.isHex(this.record[d.name])&&b.push({field:d,error:w2utils.lang("Not a hex number")});break;case"email":this.record[d.name]&&!w2utils.isEmail(this.record[d.name])&&b.push({field:d,error:w2utils.lang("Not a valid email")});break;case"checkbox":1==this.record[d.name]?this.record[d.name]=1:this.record[d.name]=0;break;case"date":d.options.format||(d.options.format=w2utils.settings.dateFormat),this.record[d.name]&&!w2utils.isDate(this.record[d.name],d.options.format)&&b.push({field:d,error:w2utils.lang("Not a valid date")+": "+d.options.format});break;case"list":case"combo":break;case"enum":}var e=this.record[d.name];d.required&&(""===e||$.isArray(e)&&0===e.length||$.isPlainObject(e)&&$.isEmptyObject(e))&&b.push({field:d,error:w2utils.lang("Required field")}),d.equalto&&this.record[d.name]!=this.record[d.equalto]&&b.push({field:d,error:w2utils.lang("Field should be equal to ")+d.equalto})}var f=this.trigger({phase:"before",target:this.name,type:"validate",errors:b});if(f.isCancelled!==!0){if(a)for(var g=0;g<f.errors.length;g++){var h=f.errors[g],i=$.extend({class:"w2ui-error"},h.options);null!=h.field&&("radio"==h.field.type?$($(h.field.el).parents("div")[0]).w2tag(h.error,i):["enum","file"].indexOf(h.field.type)!=-1?!function(a){setTimeout(function(){var b=$(a.field.el).data("w2field").helpers.multi;$(a.field.el).w2tag(a.error,a.options),$(b).addClass("w2ui-error")},1)}(h):$(h.field.el).w2tag(h.error,i),this.goto(b[0].field.page))}return this.trigger($.extend(f,{phase:"after"})),b}},getChanges:function(){var a=function(b,c,d){for(var e in b)"object"==typeof b[e]?(d[e]=a(b[e],c[e]||{},{}),d[e]&&!$.isEmptyObject(d[e])||delete d[e]):b[e]!=c[e]&&(d[e]=b[e]);return d};return a(this.record,this.original,{})},request:function(postData,callBack){var obj=this;if("function"==typeof postData&&(callBack=postData,postData=null),null==postData&&(postData={}),this.url&&("object"!=typeof this.url||this.url.get)){null==this.recid&&(this.recid=0);var params={};params.cmd="get",params.recid=this.recid,params.name=this.name,$.extend(params,this.postData),$.extend(params,postData);var edata=this.trigger({phase:"before",type:"request",target:this.name,url:this.url,postData:params,
httpHeaders:this.httpHeaders});if(edata.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));this.record={},this.original={},this.lock(w2utils.lang(this.msgRefresh));var url=edata.url;if("object"==typeof edata.url&&edata.url.get&&(url=edata.url.get),this.last.xhr)try{this.last.xhr.abort()}catch(a){}if(!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:edata.postData,headers:edata.httpHeaders,dataType:"text"};switch(w2utils.settings.dataType){case"HTTP":ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":ajaxOptions.data={request:JSON.stringify(ajaxOptions.data)};break;case"RESTFULL":ajaxOptions.type="GET",ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":ajaxOptions.type="GET",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json";break;case"JSON":ajaxOptions.type="POST",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"}this.method&&(ajaxOptions.type=this.method),this.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.unlock();var edata=obj.trigger({phase:"before",target:obj.name,type:"load",xhr:xhr});if(edata.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));var data,responseText=obj.last.xhr.responseText;if("error"!=status){if(null!=responseText&&""!==responseText){if("object"==typeof responseText)data=responseText;else try{eval("data = "+responseText)}catch(a){}null==data&&(data={status:"error",message:w2utils.lang(obj.msgNotJSON),responseText:responseText}),"error"==data.status?obj.error(w2utils.lang(data.message)):(obj.record=$.extend({},data.record),obj.original=$.extend({},data.record))}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText),data={status:"error",message:w2utils.lang(obj.msgAJAXerror),responseText:responseText};obj.trigger($.extend(edata,{phase:"after"})),obj.refresh(),"function"==typeof callBack&&callBack(data)}).fail(function(a,b,c){var d={status:b,error:c,rawResponseText:a.responseText},e=obj.trigger({phase:"before",type:"error",error:d,xhr:a});if(e.isCancelled!==!0){if("abort"!=b){var f;try{f=$.parseJSON(a.responseText)}catch(a){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",items:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof f?f:a.responseText)}obj.trigger($.extend(e,{phase:"after"}))}}),this.trigger($.extend(edata,{phase:"after"}))}},submit:function(a,b){return this.save(a,b)},save:function(postData,callBack){var obj=this;$(this.box).find(":focus").change(),"function"==typeof postData&&(callBack=postData,postData=null);var errors=obj.validate(!0);if(0===errors.length){if(null==postData&&(postData={}),!obj.url||"object"==typeof obj.url&&!obj.url.save)return void console.log("ERROR: Form cannot be saved because no url is defined.");obj.lock(w2utils.lang(obj.msgSaving)+' <span id="'+obj.name+'_progress"></span>'),setTimeout(function(){function apend(a,b,c,d){function e(b,c,d){if("object"==typeof b&&b instanceof File&&a.append(d,b),"object"==typeof b)if(b&&b.constructor===Array)for(var f=0;f<b.length;f++){var g=c?c[f]:c;e(b[f],g,d+"["+f+"]")}else apend(a,b,c,d)}null==d&&(d="");for(var f in b){var g=""==d?f:"${p}[${prop}]",h=c?c[f]:c;e(b[f],h,g)}}var params={};params.cmd="save",params.recid=obj.recid,params.name=obj.name,$.extend(params,obj.postData),$.extend(params,postData),obj.multipart||obj.fields.forEach(function(a){"file"==a.type&&Array.isArray(obj.record[a.field])&&obj.record[a.field].forEach(function(a){delete a.file})}),params.record=$.extend(!0,{},obj.record);var edata=obj.trigger({phase:"before",type:"submit",target:obj.name,url:obj.url,postData:params,httpHeaders:obj.httpHeaders});if(edata.isCancelled!==!0){var url=edata.url;if("object"==typeof edata.url&&edata.url.save&&(url=edata.url.save),obj.last.xhr)try{obj.last.xhr.abort()}catch(a){}if(!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:edata.postData,headers:edata.httpHeaders,dataType:"text",xhr:function(){var a=new window.XMLHttpRequest;return a.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=obj.trigger({phase:"before",type:"progress",total:a.total,loaded:a.loaded,originalEvent:a});if(b.isCancelled===!0)return;var c=Math.round(a.loaded/a.total*100);$("#"+obj.name+"_progress").text(""+c+"%"),obj.trigger($.extend(b,{phase:"after"}))}},!1),a}};switch(w2utils.settings.dataType){case"HTTP":ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":ajaxOptions.data={request:JSON.stringify(ajaxOptions.data)};break;case"RESTFULL":0!==obj.recid&&null!=obj.recid&&(ajaxOptions.type="PUT"),ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":0!==obj.recid&&null!=obj.recid&&(ajaxOptions.type="PUT"),ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json";break;case"JSON":if(ajaxOptions.type="POST",ajaxOptions.contentType="application/json",obj.multipart){var fdata=new FormData;fdata.append("__body",JSON.stringify(ajaxOptions.data)),apend(fdata,ajaxOptions.data),ajaxOptions.data=fdata,ajaxOptions.contentType=!1,ajaxOptions.processData=!1}else ajaxOptions.data=JSON.stringify(ajaxOptions.data)}this.method&&(ajaxOptions.type=this.method),obj.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.unlock();var edata=obj.trigger({phase:"before",target:obj.name,type:"save",xhr:xhr,status:status});if(edata.isCancelled!==!0){var data,responseText=xhr.responseText;if("error"!=status){if(null!=responseText&&""!==responseText){if("object"==typeof responseText)data=responseText;else try{eval("data = "+responseText)}catch(a){}null==data&&(data={status:"error",message:w2utils.lang(obj.msgNotJSON),responseText:responseText}),"error"==data.status?obj.error(w2utils.lang(data.message)):obj.original=$.extend({},obj.record)}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText),data={status:"error",message:w2utils.lang(obj.msgAJAXerror),responseText:responseText};obj.trigger($.extend(edata,{phase:"after"})),obj.refresh(),"success"==data.status&&"function"==typeof callBack&&callBack(data)}}).fail(function(a,b,c){var d={status:b,error:c,rawResponseText:a.responseText},e=obj.trigger({phase:"before",type:"error",error:d,xhr:a});e.isCancelled!==!0&&(console.log("ERROR: server communication failed. The server should return",{status:"success"},"OR",{status:"error",message:"error message"},", instead the AJAX request produced this: ",d),obj.trigger($.extend(e,{phase:"after"})))}),obj.trigger($.extend(edata,{phase:"after"}))}},50)}},lock:function(a,b){var c=Array.prototype.slice.call(arguments,0);c.unshift(this.box),setTimeout(function(){w2utils.lock.apply(window,c)},10)},unlock:function(a){var b=this.box;setTimeout(function(){w2utils.unlock(b,a)},25)},goto:function(a){this.page!==a&&(null!=a&&(this.page=a),$(this.box).data("auto-size")===!0&&$(this.box).height(0),this.refresh())},generateHTML:function(){for(var c,d,e,a=[],b="",f=0;f<this.fields.length;f++){e="";var g=this.fields[f];null==g.html&&(g.html={}),null==g.options&&(g.options={}),g.html=$.extend(!0,{caption:"",span:6,attr:"",text:"",style:"",page:0,column:0},g.html),null==c&&(c=g.html.page),null==d&&(d=g.html.column),""===g.html.caption&&(g.html.caption=g.name);var h='<input name="'+g.name+'" class="w2ui-input" type="text" '+g.html.attr+' tabindex="'+(f+1)+'"/>';switch(g.type){case"pass":case"password":h='<input name="'+g.name+'" class="w2ui-input" type = "password" '+g.html.attr+' tabindex="'+(f+1)+'"/>';break;case"checkbox":h='<input name="'+g.name+'" class="w2ui-input" type="checkbox" '+g.html.attr+' tabindex="'+(f+1)+'"/>';break;case"radio":h="";var i=g.options.items?g.options.items:g.html.items;$.isArray(i)||(i=[]),i.length>0&&(i=w2obj.field.prototype.normMenu(i));for(var j=0;j<i.length;j++)h+='<label><input name="'+g.name+'" class="w2ui-input" type = "radio" '+g.html.attr+' value="'+i[j].id+'"/>&#160;'+i[j].text+"</label><br/>";break;case"select":h='<select name="'+g.name+'" class="w2ui-input" '+g.html.attr+' tabindex="'+(f+1)+'">';var i=g.options.items?g.options.items:g.html.items;$.isArray(i)||(i=[]),i.length>0&&(i=w2obj.field.prototype.normMenu(i));for(var j=0;j<i.length;j++)h+='<option value="'+i[j].id+'">'+i[j].text+"</option>";h+="</select>";break;case"textarea":h='<textarea name="'+g.name+'" class="w2ui-input" '+g.html.attr+' tabindex="'+(f+1)+'"></textarea>';break;case"toggle":h='<input name="'+g.name+'" type="checkbox" '+g.html.attr+' class="w2ui-input w2ui-toggle" tabindex="'+(f+1)+'"/><div><div></div></div>';break;case"html":case"custom":case"empty":h=""}""!==b&&(c!=g.html.page||d!=g.html.column||g.html.group&&b!=g.html.group)&&(a[c][d]+="\n   </div>",b=""),g.html.group&&b!=g.html.group&&(e+='\n   <div class="w2ui-group-title">'+g.html.group+'</div>\n   <div class="w2ui-group">',b=g.html.group),e+='\n      <div class="w2ui-field '+(null!=g.html.span?"w2ui-span"+g.html.span:"")+'" style="'+g.html.style+'">\n         <label>'+w2utils.lang(g.html.caption)+"</label>\n         <div>"+h+w2utils.lang(g.html.text)+"</div>\n      </div>",null==a[g.html.page]&&(a[g.html.page]=[]),null==a[g.html.page][g.html.column]&&(a[g.html.page][g.html.column]=""),a[g.html.page][g.html.column]+=e,c=g.html.page,d=g.html.column}if(""!==b&&(a[c][d]+="\n   </div>"),this.tabs.tabs)for(var j=0;j<this.tabs.tabs.length;j++)null==a[j]&&(a[j]=[]);var k="";if(!$.isEmptyObject(this.actions)){k+='\n<div class="w2ui-buttons">';for(var m in this.actions){var n=this.actions[m],o={caption:"",style:"",class:""};$.isPlainObject(n)?(n.caption&&(o.caption=n.caption),n.style&&(o.style=n.style),n.class&&(o.class=n.class)):(o.caption=m,["save","update","create","reply"].indexOf(m.toLowerCase())!=-1?o.class="w2ui-btn-blue":o.class=""),k+='\n    <button name="'+m+'" class="w2ui-btn '+o.class+'" style="'+o.style+'">'+w2utils.lang(o.caption)+"</button>"}k+="\n</div>"}e="";for(var p=0;p<a.length;p++){e+='<div class="w2ui-page page-'+p+'" '+(0===p?"":'style="display: none;"')+'><div class="w2ui-column-container" style="display: flex;">';for(var q=0;q<a[p].length;q++)e+='<div class="w2ui-column col-'+q+'">'+(a[p][q]||"")+"\n</div>";e+="\n</div></div>"}return e+=k},action:function(a,b){var c=this.actions[a],d=c;$.isPlainObject(c)&&c.onClick&&(d=c.onClick);var e=this.trigger({phase:"before",target:a,type:"action",click:d,originalEvent:b});e.isCancelled!==!0&&("function"==typeof d&&d.call(this,b),this.trigger($.extend(e,{phase:"after"})))},resize:function(){function k(){c.width($(a.box).width()).height($(a.box).height()),e.css("top",""!==a.header?w2utils.getSize(d,"height"):0),f.css("top",(""!==a.header?w2utils.getSize(d,"height"):0)+("object"==typeof a.toolbar&&$.isArray(a.toolbar.items)&&a.toolbar.items.length>0?w2utils.getSize(e,"height"):0)),g.css("top",(""!==a.header?w2utils.getSize(d,"height"):0)+("object"==typeof a.toolbar&&$.isArray(a.toolbar.items)&&a.toolbar.items.length>0?w2utils.getSize(e,"height")+5:0)+("object"==typeof a.tabs&&$.isArray(a.tabs.tabs)&&a.tabs.tabs.length>0?w2utils.getSize(f,"height")+5:0)),g.css("bottom",j.length>0?w2utils.getSize(j,"height"):0)}var a=this,b=this.trigger({phase:"before",target:this.name,type:"resize"});if(b.isCancelled!==!0){var c=$(this.box).find("> div.w2ui-form-box"),d=$(this.box).find("> div .w2ui-form-header"),e=$(this.box).find("> div .w2ui-form-toolbar"),f=$(this.box).find("> div .w2ui-form-tabs"),g=$(this.box).find("> div .w2ui-page"),h=$(this.box).find("> div .w2ui-page.page-"+this.page),i=$(this.box).find("> div .w2ui-page.page-"+this.page+" > div"),j=$(this.box).find("> div .w2ui-buttons");k(),0!==parseInt($(this.box).height())&&$(this.box).data("auto-size")!==!0||($(this.box).height((d.length>0?w2utils.getSize(d,"height"):0)+("object"==typeof this.tabs&&$.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?w2utils.getSize(f,"height"):0)+("object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&this.toolbar.items.length>0?w2utils.getSize(e,"height"):0)+(g.length>0?w2utils.getSize(i,"height")+w2utils.getSize(h,"+height")+12:0)+(j.length>0?w2utils.getSize(j,"height"):0)),$(this.box).data("auto-size",!0)),k(),this.toolbar&&this.toolbar.resize&&this.toolbar.resize(),this.tabs&&this.tabs.resize&&this.tabs.resize(),a.trigger($.extend(b,{phase:"after"}))}},refresh:function(a){var b=(new Date).getTime(),c=this;if(this.box&&this.isGenerated&&null!=$(this.box).html()){var d=this.trigger({phase:"before",target:this.name,type:"refresh",page:this.page,field:a});if(d.isCancelled!==!0){if(null!=a)var e=c.get(a,!0),f=e+1;else{$(this.box).find("input, textarea, select").each(function(a,b){var d=null!=$(b).attr("name")?$(b).attr("name"):$(b).attr("id"),e=c.get(d);if(e){var f=$(b).parents(".w2ui-page");if(f.length>0)for(var g=0;g<100;g++)if(f.hasClass("page-"+g)){e.page=g;break}}}),$(this.box).find(".w2ui-page").hide(),$(this.box).find(".w2ui-page.page-"+this.page).show(),$(this.box).find(".w2ui-form-header").html(this.header),"object"==typeof this.tabs&&$.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?($("#form_"+this.name+"_tabs").show(),this.tabs.active=this.tabs.tabs[this.page].id,this.tabs.refresh()):$("#form_"+this.name+"_tabs").hide(),"object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&this.toolbar.items.length>0?($("#form_"+this.name+"_toolbar").show(),this.toolbar.refresh()):$("#form_"+this.name+"_toolbar").hide();var e=0,f=this.fields.length}for(var g=e;g<f;g++){var a=this.fields[g];null==a.name&&null!=a.field&&(a.name=a.field),null==a.field&&null!=a.name&&(a.field=a.name),a.$el=$(this.box).find('[name="'+String(a.name).replace(/\\/g,"\\\\")+'"]'),a.el=a.$el[0],null==a.el&&console.log('ERROR: Cannot associate field "'+a.name+'" with html control. Make sure html control exists with the same name.'),a.el&&(a.el.id=a.name);var h=$(a).data("w2field");h&&h.clear(),$(a.$el).off("change").on("change",function(){var a=this.value,b=null!=c.record[this.name]?c.record[this.name]:"",d=c.get(this.name);if(["list","enum","file"].indexOf(d.type)!=-1&&$(this).data("selected")){var e=$(this).data("selected"),f=c.record[this.name];if($.isArray(e)){a=[];for(var g=0;g<e.length;g++)a[g]=$.extend(!0,{},e[g])}if($.isPlainObject(e)&&(a=$.extend(!0,{},e)),$.isArray(f)){b=[];for(var g=0;g<f.length;g++)b[g]=$.extend(!0,{},f[g])}$.isPlainObject(f)&&(b=$.extend(!0,{},f))}if(["toggle","checkbox"].indexOf(d.type)!=-1&&(a=!!$(this).prop("checked")&&("on"==$(this).prop("value")||$(this).prop("value"))),["int","float","percent","money","currency"].indexOf(d.type)!=-1&&(a=$(this).data("w2field").clean(a)),a!==b){var h=c.trigger({phase:"before",target:this.name,type:"change",value_new:a,value_previous:b});if(h.isCancelled===!0)return void $(this).val(c.record[this.name]);var i=this.value;if("select"==this.type&&(i=this.value),"checkbox"==this.type&&(i=!!this.checked),"radio"==this.type&&d.$el.each(function(a,b){b.checked&&(i=b.value)}),["int","float","percent","money","currency","list","combo","enum","file","toggle"].indexOf(d.type)!=-1&&(i=a),["enum","file"].indexOf(d.type)!=-1&&i.length>0){var j=$(d.el).data("w2field").helpers.multi;$(j).removeClass("w2ui-error")}(""===i||null==i||$.isArray(i)&&0===i.length||$.isPlainObject(i)&&$.isEmptyObject(i))&&(i=null),c.record[this.name]=i,c.trigger($.extend(h,{phase:"after"}))}}),a.required?$(a.el).parent().parent().addClass("w2ui-required"):$(a.el).parent().parent().removeClass("w2ui-required"),null!=a.disabled&&(a.disabled?$(a.el).prop("readonly",!0):$(a.el).prop("readonly",!1)),a.hidden?$(a.el).parent().parent().hide():$(a.el).parent().parent().show()}$(this.box).find("button, input[type=button]").each(function(a,b){$(b).off("click").on("click",function(a){var b=this.value;this.id&&(b=this.id),this.name&&(b=this.name),c.action(b,a)})});for(var g=e;g<f;g++){var a=this.fields[g],i=null!=this.record[a.name]?this.record[a.name]:"";if(a.el)switch($(a.el).hasClass("w2ui-input")||$(a.el).addClass("w2ui-input"),a.type=String(a.type).toLowerCase(),a.options||(a.options={}),a.type){case"text":case"textarea":case"email":case"pass":case"password":a.el.value=i;break;case"int":case"float":case"money":case"currency":case"percent":a.el.value=i,$(a.el).w2field($.extend({},a.options,{type:a.type}));break;case"hex":case"alphanumeric":case"color":case"date":case"time":a.el.value=i,$(a.el).w2field($.extend({},a.options,{type:a.type}));break;case"toggle":w2utils.isFloat(i)&&(i=parseFloat(i)),$(a.el).prop("checked",!!i),this.record[a.name]=!!i&&i;break;case"list":case"combo":if("list"==a.type){var j=$.isPlainObject(i)?i.id:$.isPlainObject(a.options.selected)?a.options.selected.id:i;a.options.items||(a.options.items=[]);var k=a.options.items;$.isArray(k)&&k.length>0&&!$.isPlainObject(k[0])&&(a.options.items=w2obj.field.prototype.normMenu(k));for(var l=0;l<a.options.items.length;l++){var m=a.options.items[l];if(m.id==j){i=$.extend(!0,{},m),c.record[a.name]=i;break}}}else"combo"!=a.type||$.isPlainObject(i)?$.isPlainObject(i)&&null!=i.text?a.el.value=i.text:a.el.value="":a.el.value=i;$.isPlainObject(i)||(i={}),$(a.el).w2field($.extend({},a.options,{type:a.type,selected:i}));break;case"enum":case"file":$.isArray(i)||(i=[]),$(a.el).w2field($.extend({},a.options,{type:a.type,selected:i}));break;case"select":var k=a.options.items;if(null!=k&&k.length>0){k=w2obj.field.prototype.normMenu(k),$(a.el).html("");for(var n=0;n<k.length;n++)$(a.el).append('<option value="'+k[n].id+'">'+k[n].text+"</option")}$(a.el).val(i);break;case"radio":$(a.$el).prop("checked",!1).each(function(a,b){$(b).val()==i&&$(b).prop("checked",!0)});break;case"checkbox":$(a.el).prop("checked",!!i);break;case"html":case"custom":case"empty":break;default:$(a.el).val(i),$(a.el).w2field($.extend({},a.options,{type:a.type}))}}for(var h=$(this.box).find(".w2ui-page"),l=0;l<h.length;l++)$(h[l]).find("> *").length>1&&$(h[l]).wrapInner("<div></div>");return this.trigger($.extend(d,{phase:"after"})),this.resize(),(new Date).getTime()-b}}},render:function(a){function g(){var a=$(c.box).find("div:not(.w2ui-field-helper) > input, select, textarea, div > label:nth-child(1) > :radio").not(".file-input");a.length>c.focus&&a[c.focus].focus()}var b=(new Date).getTime(),c=this;if("object"==typeof a&&($(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),this.box=a),this.isGenerated&&this.box){var d=this.trigger({phase:"before",target:this.name,type:"render",box:null!=a?a:this.box});if(d.isCancelled!==!0){$.isEmptyObject(this.original)&&!$.isEmptyObject(this.record)&&(this.original=$.extend(!0,{},this.record));var e='<div class="w2ui-form-box">'+(""!==this.header?'<div class="w2ui-form-header">'+this.header+"</div>":"")+'    <div id="form_'+this.name+'_toolbar" class="w2ui-form-toolbar" style="display: none"></div>    <div id="form_'+this.name+'_tabs" class="w2ui-form-tabs" style="display: none"></div>'+this.formHTML+"</div>";$(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-form").html(e),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),"function"!=typeof this.toolbar.render&&(this.toolbar=$().w2toolbar($.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.toolbar.on("click",function(a){var b=c.trigger({phase:"before",type:"toolbar",target:a.target,originalEvent:a});b.isCancelled!==!0&&c.trigger($.extend(b,{phase:"after"}))})),"object"==typeof this.toolbar&&"function"==typeof this.toolbar.render&&this.toolbar.render($("#form_"+this.name+"_toolbar")[0]),"function"!=typeof this.tabs.render&&(this.tabs=$().w2tabs($.extend({},this.tabs,{name:this.name+"_tabs",owner:this,active:this.tabs.active})),this.tabs.on("click",function(a){c.goto(this.get(a.target,!0))})),"object"==typeof this.tabs&&"function"==typeof this.tabs.render&&(this.tabs.render($("#form_"+this.name+"_tabs")[0]),this.tabs.active&&this.tabs.click(this.tabs.active)),this.trigger($.extend(d,{phase:"after"})),this.resize();var f="object"!=typeof this.url?this.url:this.url.get;return f&&0!==this.recid&&null!=this.recid?this.request():this.refresh(),0===$(".w2ui-layout").length&&(this.tmp_resize=function(a){w2ui[c.name].resize()},$(window).off("resize","body").on("resize","body",this.tmp_resize)),this.focus>=0&&setTimeout(function(){0===$(c.box).find("input, select, textarea").length?setTimeout(g,500):g()},10),(new Date).getTime()-b}}},destroy:function(){var a=this.trigger({phase:"before",target:this.name,type:"destroy"});a.isCancelled!==!0&&("object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),"object"==typeof this.tabs&&this.tabs.destroy&&this.tabs.destroy(),$(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),delete w2ui[this.name],this.trigger($.extend(a,{phase:"after"})),$(window).off("resize","body"))}},$.extend(w2form.prototype,w2utils.event),w2obj.form=w2form}(jQuery);